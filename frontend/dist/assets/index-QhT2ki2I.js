var Il=Object.defineProperty;var Vl=(t,e,l)=>e in t?Il(t,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[e]=l;var zt=(t,e,l)=>Vl(t,typeof e!="symbol"?e+"":e,l);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const b of o.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&n(b)}).observe(document,{childList:!0,subtree:!0});function l(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=l(i);fetch(i.href,o)}})();function G(){}function jl(t){return t()}function sl(){return Object.create(null)}function ue(t){t.forEach(jl)}function Rl(t){return typeof t=="function"}function Ve(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let dt;function mt(t,e){return t===e?!0:(dt||(dt=document.createElement("a")),dt.href=e,t===dt.href)}function Nl(t){return Object.keys(t).length===0}function Fl(t,...e){if(t==null){for(const n of e)n(void 0);return G}const l=t.subscribe(...e);return l.unsubscribe?()=>l.unsubscribe():l}function bt(t,e,l){t.$$.on_destroy.push(Fl(e,l))}function s(t,e){t.appendChild(e)}function M(t,e,l){t.insertBefore(e,l||null)}function E(t){t.parentNode&&t.parentNode.removeChild(t)}function Hl(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function r(t){return document.createElement(t)}function Ie(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function R(t){return document.createTextNode(t)}function _(){return R(" ")}function gt(){return R("")}function X(t,e,l,n){return t.addEventListener(e,l,n),()=>t.removeEventListener(e,l,n)}function a(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function we(t){return t===""?null:+t}function Ul(t){return Array.from(t.childNodes)}function B(t,e){e=""+e,t.data!==e&&(t.data=e)}function he(t,e){t.value=e??""}function il(t,e,l,n){l==null?t.style.removeProperty(e):t.style.setProperty(e,l,"")}function al(t,e,l){for(let n=0;n<t.options.length;n+=1){const i=t.options[n];if(i.__value===e){i.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function Bl(t){const e=t.querySelector(":checked");return e&&e.__value}function Wl(t,e,{bubbles:l=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:l,cancelable:n})}let Ke;function Ge(t){Ke=t}function It(){if(!Ke)throw new Error("Function called outside component initialization");return Ke}function Vt(t){It().$$.on_mount.push(t)}function Dl(t){It().$$.on_destroy.push(t)}function Nt(){const t=It();return(e,l,{cancelable:n=!1}={})=>{const i=t.$$.callbacks[e];if(i){const o=Wl(e,l,{cancelable:n});return i.slice().forEach(b=>{b.call(t,o)}),!o.defaultPrevented}return!0}}const De=[],fe=[];let Oe=[];const Dt=[],Jl=Promise.resolve();let Ot=!1;function ql(){Ot||(Ot=!0,Jl.then(Ol))}function ht(t){Oe.push(t)}function Yl(t){Dt.push(t)}const Et=new Set;let Me=0;function Ol(){if(Me!==0)return;const t=Ke;do{try{for(;Me<De.length;){const e=De[Me];Me++,Ge(e),Gl(e.$$)}}catch(e){throw De.length=0,Me=0,e}for(Ge(null),De.length=0,Me=0;fe.length;)fe.pop()();for(let e=0;e<Oe.length;e+=1){const l=Oe[e];Et.has(l)||(Et.add(l),l())}Oe.length=0}while(De.length);for(;Dt.length;)Dt.pop()();Ot=!1,Et.clear(),Ge(t)}function Gl(t){if(t.fragment!==null){t.update(),ue(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ht)}}function Kl(t){const e=[],l=[];Oe.forEach(n=>t.indexOf(n)===-1?e.push(n):l.push(n)),l.forEach(n=>n()),Oe=e}const pt=new Set;let ye;function Zl(){ye={r:0,c:[],p:ye}}function Ql(){ye.r||ue(ye.c),ye=ye.p}function ke(t,e){t&&t.i&&(pt.delete(t),t.i(e))}function Le(t,e,l,n){if(t&&t.o){if(pt.has(t))return;pt.add(t),ye.c.push(()=>{pt.delete(t),n&&(l&&t.d(1),n())}),t.o(e)}else n&&n()}function rl(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Xl(t,e,l){const n=t.$$.props[e];n!==void 0&&(t.$$.bound[n]=l,l(t.$$.ctx[n]))}function vt(t){t&&t.c()}function Ze(t,e,l){const{fragment:n,after_update:i}=t.$$;n&&n.m(e,l),ht(()=>{const o=t.$$.on_mount.map(jl).filter(Rl);t.$$.on_destroy?t.$$.on_destroy.push(...o):ue(o),t.$$.on_mount=[]}),i.forEach(ht)}function Qe(t,e){const l=t.$$;l.fragment!==null&&(Kl(l.after_update),ue(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function $l(t,e){t.$$.dirty[0]===-1&&(De.push(t),ql(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Xe(t,e,l,n,i,o,b=null,u=[-1]){const c=Ke;Ge(t);const f=t.$$={fragment:null,ctx:[],props:o,update:G,not_equal:i,bound:sl(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:sl(),dirty:u,skip_bound:!1,root:e.target||c.$$.root};b&&b(f.root);let g=!1;if(f.ctx=l?l(t,e.props||{},(m,d,...h)=>{const v=h.length?h[0]:d;return f.ctx&&i(f.ctx[m],f.ctx[m]=v)&&(!f.skip_bound&&f.bound[m]&&f.bound[m](v),g&&$l(t,m)),d}):[],f.update(),g=!0,ue(f.before_update),f.fragment=n?n(f.ctx):!1,e.target){if(e.hydrate){const m=Ul(e.target);f.fragment&&f.fragment.l(m),m.forEach(E)}else f.fragment&&f.fragment.c();e.intro&&ke(t.$$.fragment),Ze(t,e.target,e.anchor),Ol()}Ge(c)}class $e{constructor(){zt(this,"$$");zt(this,"$$set")}$destroy(){Qe(this,1),this.$destroy=G}$on(e,l){if(!Rl(l))return G;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(l),()=>{const i=n.indexOf(l);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!Nl(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const en="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(en);const je=[];function tn(t,e=G){let l;const n=new Set;function i(u){if(Ve(t,u)&&(t=u,l)){const c=!je.length;for(const f of n)f[1](),je.push(f,t);if(c){for(let f=0;f<je.length;f+=2)je[f][0](je[f+1]);je.length=0}}}function o(u){i(u(t))}function b(u,c=G){const f=[u,c];return n.add(f),n.size===1&&(l=e(i,o)||G),u(t),()=>{n.delete(f),n.size===0&&l&&(l(),l=null)}}return{set:i,update:o,subscribe:b}}const Y=tn({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,previewStream:null,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});function Ll(t){Y.update(e=>({...e,videoFrame:t}))}function ln(t,e,l){Y.update(n=>({...n,realtimeData:t,trajectoryData:e||n.trajectoryData,velocityData:l||n.velocityData}))}function nn(t){Y.update(e=>({...e,localVideoUrl:t}))}function Mt(t){Y.update(e=>({...e,isCameraPreview:!!t}))}function sn(t){Y.update(e=>({...e,previewStream:t||null}))}function Lt(){Y.update(t=>({...t,previewStream:null}))}function ol(t){Y.update(e=>({...e,inputMode:t==="upload"||t==="camera"?t:"none"}))}function an(t){let e;return{c(){e=r("div"),e.innerHTML='<svg class="w-24 h-24 mx-auto text-slate-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> <p class="text-slate-400 text-lg">Nessun video caricato</p> <p class="text-slate-500 text-sm mt-2">Carica o registra un video per iniziare</p>',a(e,"class","text-center p-8")},m(l,n){M(l,e,n)},p:G,d(l){l&&E(e)}}}function rn(t){let e,l,n,i,o,b,u,c=t[4].isRecording&&cl(),f=t[4].isAnalyzing&&fl(),g=t[4].isCalibrating&&ul(),m=t[0]&&!t[4].localVideoUrl&&dl(t);return{c(){e=r("img"),n=_(),c&&c.c(),i=_(),f&&f.c(),o=_(),g&&g.c(),b=_(),m&&m.c(),u=gt(),mt(e.src,l=t[8])||a(e,"src",l),a(e,"alt","Video frame"),a(e,"class","w-full h-full max-w-full max-h-full object-contain")},m(d,h){M(d,e,h),M(d,n,h),c&&c.m(d,h),M(d,i,h),f&&f.m(d,h),M(d,o,h),g&&g.m(d,h),M(d,b,h),m&&m.m(d,h),M(d,u,h)},p(d,h){h&256&&!mt(e.src,l=d[8])&&a(e,"src",l),d[4].isRecording?c||(c=cl(),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null),d[4].isAnalyzing?f||(f=fl(),f.c(),f.m(o.parentNode,o)):f&&(f.d(1),f=null),d[4].isCalibrating?g||(g=ul(),g.c(),g.m(b.parentNode,b)):g&&(g.d(1),g=null),d[0]&&!d[4].localVideoUrl?m?m.p(d,h):(m=dl(d),m.c(),m.m(u.parentNode,u)):m&&(m.d(1),m=null)},d(d){d&&(E(e),E(n),E(i),E(o),E(b),E(u)),c&&c.d(d),f&&f.d(d),g&&g.d(d),m&&m.d(d)}}}function on(t){let e,l;return{c(){e=r("video"),mt(e.src,l=t[4].localVideoUrl)||a(e,"src",l),e.controls=!0,a(e,"class","w-full h-full object-contain")},m(n,i){M(n,e,i),t[12](e)},p(n,i){i&16&&!mt(e.src,l=n[4].localVideoUrl)&&a(e,"src",l)},d(n){n&&E(e),t[12](null)}}}function cn(t){let e;return{c(){e=r("video"),e.autoplay=!0,e.playsInline=!0,e.muted=!0,a(e,"class","w-full h-full object-contain")},m(l,n){M(l,e,n),t[11](e)},p:G,d(l){l&&E(e),t[11](null)}}}function cl(t){let e;return{c(){e=r("div"),e.innerHTML='<div class="w-3 h-3 bg-white rounded-full animate-pulse svelte-1mb1g50"></div> <span class="text-white font-semibold text-sm">REC</span>',a(e,"class","absolute top-4 right-4 flex items-center gap-2 bg-red-600 px-4 py-2 rounded-full")},m(l,n){M(l,e,n)},d(l){l&&E(e)}}}function fl(t){let e;return{c(){e=r("div"),e.innerHTML='<span class="text-white font-semibold text-sm">ANALYZING</span>',a(e,"class","absolute top-4 left-4 bg-green-600 px-4 py-2 rounded-full")},m(l,n){M(l,e,n)},d(l){l&&E(e)}}}function ul(t){let e;return{c(){e=r("div"),e.innerHTML='<span class="text-white font-semibold text-sm">CALIBRATING</span>',a(e,"class","absolute top-4 left-4 bg-yellow-600 px-4 py-2 rounded-full")},m(l,n){M(l,e,n)},d(l){l&&E(e)}}}function dl(t){let e,l,n,i,o,b=`${t[2]+1} / ${Math.max(t[1],0)}`,u,c,f,g,m,d=t[5]&&pl(t);return{c(){e=r("div"),l=r("input"),i=_(),o=r("div"),u=R(b),c=_(),d&&d.c(),f=gt(),a(l,"type","range"),a(l,"min","0"),a(l,"max",n=Math.max(t[1]-1,0)),a(l,"class","w-64 md:w-96 accent-purple-500"),a(o,"class","text-slate-300 text-sm whitespace-nowrap"),a(e,"class","absolute bottom-4 left-1/2 -translate-x-1/2 bg-slate-900/80 backdrop-blur px-4 py-3 rounded-full border border-slate-700 flex items-center gap-4")},m(h,v){M(h,e,v),s(e,l),he(l,t[2]),s(e,i),s(e,o),s(o,u),M(h,c,v),d&&d.m(h,v),M(h,f,v),g||(m=[X(l,"change",t[13]),X(l,"input",t[13]),X(l,"input",t[14])],g=!0)},p(h,v){v&2&&n!==(n=Math.max(h[1]-1,0))&&a(l,"max",n),v&4&&he(l,h[2]),v&6&&b!==(b=`${h[2]+1} / ${Math.max(h[1],0)}`)&&B(u,b),h[5]?d?d.p(h,v):(d=pl(h),d.c(),d.m(f.parentNode,f)):d&&(d.d(1),d=null)},d(h){h&&(E(e),E(c),E(f)),d&&d.d(h),g=!1,ue(m)}}}function pl(t){let e,l;return{c(){e=r("div"),l=R(t[5]),a(e,"class","absolute bottom-16 left-1/2 -translate-x-1/2 bg-red-600/80 text-white text-xs px-3 py-1 rounded")},m(n,i){M(n,e,i),s(e,l)},p(n,i){i&32&&B(l,n[5])},d(n){n&&E(e)}}}function fn(t){let e,l,n,i;function o(c,f){return c[4].isCameraPreview&&c[4].previewStream?cn:c[0]&&c[4].localVideoUrl?on:c[8]?rn:an}let b=o(t),u=b(t);return{c(){e=r("div"),l=r("div"),l.innerHTML='<h2 class="text-xl font-semibold text-white">Anteprima Video</h2>',n=_(),i=r("div"),u.c(),a(l,"class","video-header bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4"),a(i,"class","video-content aspect-video bg-black flex items-center justify-center relative"),a(i,"data-reflow",t[7]),a(e,"class","video-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700")},m(c,f){M(c,e,f),s(e,l),s(e,n),s(e,i),u.m(i,null),t[15](e)},p(c,[f]){b===(b=o(c))&&u?u.p(c,f):(u.d(1),u=b(c),u&&(u.c(),u.m(i,null))),f&128&&a(i,"data-reflow",c[7])},i:G,o:G,d(c){c&&E(e),u.d(),t[15](null)}}}function un(t,e,l){let n,i;bt(t,Y,x=>l(4,i=x));let{analysisCompleted:o=!1}=e,b=0,u=0,c=!1,f="",g,m,d,h,v=0,C;async function p(){try{const j=await(await fetch("http://localhost:5000/api/video/info")).json();j&&j.success&&(l(1,b=j.total_frames||0),l(10,c=!0))}catch{}}async function S(x){l(5,f="");try{const N=await(await fetch(`http://localhost:5000/api/video/frame_at?index=${x}`)).json();N&&N.success?(l(2,u=N.index),Ll(N.frame)):N&&N.error&&l(5,f=N.error)}catch{l(5,f="Errore caricamento frame")}finally{}}function P(x){!o||b<=0||(g&&clearTimeout(g),g=setTimeout(()=>{S(x)},50))}function A(){l(7,v++,v)}Vt(()=>{if(i.isCameraPreview&&i.previewStream&&C)try{l(3,C.srcObject=i.previewStream,C)}catch{}typeof window<"u"&&"ResizeObserver"in window?(d=new ResizeObserver(()=>{A()}),m&&d.observe(m)):typeof window<"u"&&window.addEventListener("resize",A),h=()=>{A(),setTimeout(A,50),setTimeout(A,150)},typeof document<"u"&&(document.addEventListener("fullscreenchange",h),document.addEventListener("webkitfullscreenchange",h),document.addEventListener("mozfullscreenchange",h),document.addEventListener("MSFullscreenChange",h))}),Dl(()=>{d&&m&&d.unobserve(m),d&&d.disconnect(),typeof window<"u"&&window.removeEventListener("resize",A),typeof document<"u"&&h&&(document.removeEventListener("fullscreenchange",h),document.removeEventListener("webkitfullscreenchange",h),document.removeEventListener("mozfullscreenchange",h),document.removeEventListener("MSFullscreenChange",h))});function z(x){fe[x?"unshift":"push"](()=>{C=x,l(3,C),l(4,i)})}function y(x){fe[x?"unshift":"push"](()=>{C=x,l(3,C),l(4,i)})}function T(){u=we(this.value),l(2,u)}const k=x=>P(+x.target.value);function I(x){fe[x?"unshift":"push"](()=>{m=x,l(6,m)})}return t.$$set=x=>{"analysisCompleted"in x&&l(0,o=x.analysisCompleted)},t.$$.update=()=>{if(t.$$.dirty&16&&l(8,n=i.videoFrame?`data:image/jpeg;base64,${i.videoFrame}`:null),t.$$.dirty&1031&&(async()=>o&&!c&&(await p(),b>0&&await S(u)))(),t.$$.dirty&24&&i.isCameraPreview&&i.previewStream&&C)try{l(3,C.srcObject=i.previewStream,C)}catch{}},[o,b,u,C,i,f,m,v,n,P,c,z,y,T,k,I]}class dn extends $e{constructor(e){super(),Xe(this,e,un,fn,Ve,{analysisCompleted:0})}}async function pn(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("API mediaDevices non disponibile");let t=null;try{t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}catch{}try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput")}finally{if(t)try{t.getTracks().forEach(e=>e.stop())}catch{}}}async function mn(t,e){const l=Array.isArray(e)?e:[],n=l[t]||l[0];return n&&n.deviceId?await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:n.deviceId}},audio:!1}):await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}function jt(t){var e;try{(e=t==null?void 0:t.getTracks())==null||e.forEach(l=>l.stop())}catch{}}const hn="http://localhost:5000";async function ie(t,e={}){const l=await fetch(`${hn}${t}`,e);try{return await l.json()}catch{return{}}}const Re={setCamera(t){return ie("/api/settings/camera",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({index:Number(t)})})},setFps(t){return ie("/api/settings/fps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:t})})},setHeight(t){return ie("/api/settings/height",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:t})})},setMass(t){return ie("/api/settings/mass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:t})})},startRecording(){return ie("/api/recording/start",{method:"POST"})},stopRecording(){return ie("/api/recording/stop",{method:"POST"})},startCalibration(){return ie("/api/calibration/start",{method:"POST"})},calibrationStatus(){return ie("/api/calibration/status")},startAnalysis(){return ie("/api/analysis/start",{method:"POST"})},analysisStatus(){return ie("/api/analysis/status")},analysisResults(){return ie("/api/analysis/results")},pauseAnalysis(){return ie("/api/analysis/pause",{method:"POST"})},resumeAnalysis(){return ie("/api/analysis/resume",{method:"POST"})},stopAnalysis(){return ie("/api/analysis/stop",{method:"POST"})},videoFrame(){return ie("/api/video/frame")},analysisData(){return ie("/api/analysis/data")}};function ml(t,e,l){const n=t.slice();return n[10]=e[l],n[12]=l,n}function hl(t){let e,l,n,i,o,b,u,c,f,g,m,d,h,v,C,p,S,P,A=t[4]&&bl(t);function z(k,I){return k[2]?vn:k[3].length>0?gn:bn}let y=z(t),T=y(t);return{c(){e=r("div"),l=r("div"),n=r("div"),i=r("h4"),i.textContent="Seleziona fotocamera",o=_(),b=r("button"),b.textContent="✕",u=_(),c=r("div"),A&&A.c(),f=_(),T.c(),g=_(),m=r("div"),d=r("button"),d.textContent="Annulla",h=_(),v=r("button"),C=R("Conferma e anteprima"),a(i,"class","text-white font-semibold"),a(b,"class","text-slate-300 hover:text-white"),a(n,"class","px-6 py-4 border-b border-slate-700 flex items-center justify-between"),a(c,"class","p-6 space-y-4"),a(d,"class","btn-secondary"),a(v,"class","btn-primary"),v.disabled=p=t[2]||t[3].length===0,a(m,"class","px-6 py-4 border-t border-slate-700 flex gap-2 justify-end"),a(l,"class","bg-slate-800 border border-slate-700 rounded-xl w-full max-w-md shadow-2xl"),a(e,"class","fixed inset-0 z-50 flex items-center justify-center bg-black/60")},m(k,I){M(k,e,I),s(e,l),s(l,n),s(n,i),s(n,o),s(n,b),s(l,u),s(l,c),A&&A.m(c,null),s(c,f),T.m(c,null),s(l,g),s(l,m),s(m,d),s(m,h),s(m,v),s(v,C),S||(P=[X(b,"click",t[5]),X(d,"click",t[5]),X(v,"click",t[6])],S=!0)},p(k,I){k[4]?A?A.p(k,I):(A=bl(k),A.c(),A.m(c,f)):A&&(A.d(1),A=null),y===(y=z(k))&&T?T.p(k,I):(T.d(1),T=y(k),T&&(T.c(),T.m(c,null))),I&12&&p!==(p=k[2]||k[3].length===0)&&(v.disabled=p)},d(k){k&&E(e),A&&A.d(),T.d(),S=!1,ue(P)}}}function bl(t){let e,l;return{c(){e=r("div"),l=R(t[4]),a(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-3 text-red-300 text-sm")},m(n,i){M(n,e,i),s(e,l)},p(n,i){i&16&&B(l,n[4])},d(n){n&&E(e)}}}function bn(t){let e;return{c(){e=r("p"),e.textContent="Nessuna fotocamera disponibile.",a(e,"class","text-slate-400")},m(l,n){M(l,e,n)},p:G,d(l){l&&E(e)}}}function gn(t){let e,l,n,i,o,b=rl(t[3]),u=[];for(let c=0;c<b.length;c+=1)u[c]=gl(ml(t,b,c));return{c(){e=r("label"),e.textContent="Fotocamera",l=_(),n=r("select");for(let c=0;c<u.length;c+=1)u[c].c();a(e,"for","camera-select"),a(e,"class","block text-sm font-medium text-slate-300 mb-2"),a(n,"id","camera-select"),a(n,"class","input-field"),t[0]===void 0&&ht(()=>t[8].call(n))},m(c,f){M(c,e,f),M(c,l,f),M(c,n,f);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(n,null);al(n,t[0],!0),i||(o=[X(n,"change",t[7]),X(n,"change",t[8])],i=!0)},p(c,f){if(f&8){b=rl(c[3]);let g;for(g=0;g<b.length;g+=1){const m=ml(c,b,g);u[g]?u[g].p(m,f):(u[g]=gl(m),u[g].c(),u[g].m(n,null))}for(;g<u.length;g+=1)u[g].d(1);u.length=b.length}f&1&&al(n,c[0])},d(c){c&&(E(e),E(l),E(n)),Hl(u,c),i=!1,ue(o)}}}function vn(t){let e;return{c(){e=r("p"),e.textContent="Caricamento fotocamere...",a(e,"class","text-slate-300")},m(l,n){M(l,e,n)},p:G,d(l){l&&E(e)}}}function gl(t){let e,l=(t[10].label||`Camera ${t[12]}`)+"",n;return{c(){e=r("option"),n=R(l),e.__value=t[12],he(e,e.__value)},m(i,o){M(i,e,o),s(e,n)},p(i,o){o&8&&l!==(l=(i[10].label||`Camera ${i[12]}`)+"")&&B(n,l)},d(i){i&&E(e)}}}function _n(t){let e,l=t[1]&&hl(t);return{c(){l&&l.c(),e=gt()},m(n,i){l&&l.m(n,i),M(n,e,i)},p(n,[i]){n[1]?l?l.p(n,i):(l=hl(n),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},i:G,o:G,d(n){n&&E(e),l&&l.d(n)}}}function yn(t,e,l){let{show:n=!1}=e,{loading:i=!1}=e,{cameras:o=[]}=e,{selectedIndex:b=null}=e,{error:u=""}=e;const c=Nt();function f(){c("close")}function g(){c("confirm")}function m(h){const v=Number(h.target.value);c("select",{index:v})}function d(){b=Bl(this),l(0,b)}return t.$$set=h=>{"show"in h&&l(1,n=h.show),"loading"in h&&l(2,i=h.loading),"cameras"in h&&l(3,o=h.cameras),"selectedIndex"in h&&l(0,b=h.selectedIndex),"error"in h&&l(4,u=h.error)},[b,n,i,o,u,f,g,m,d]}class wn extends $e{constructor(e){super(),Xe(this,e,yn,_n,Ve,{show:1,loading:2,cameras:3,selectedIndex:0,error:4})}}function vl(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
          Indietro`,a(e,"class","bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2")},m(i,o){M(i,e,o),l||(n=X(e,"click",t[23]),l=!0)},p:G,d(i){i&&E(e),l=!1,n()}}}function _l(t){let e,l,n;return{c(){e=r("div"),l=r("p"),n=R(t[5]),a(l,"class","text-red-400 text-sm"),a(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-4")},m(i,o){M(i,e,o),s(e,l),s(l,n)},p(i,o){o[0]&32&&B(n,i[5])},d(i){i&&E(e)}}}function yl(t){let e,l,n=t[13].inputMode==="camera"?"1. Registra Video":"1. Carica o Registra Video",i,o,b,u=t[13].inputMode!=="camera"&&wl(t);function c(m,d){return m[13].isRecording?kn:xn}let f=c(t),g=f(t);return{c(){e=r("div"),l=r("h3"),i=R(n),o=_(),u&&u.c(),b=_(),g.c(),a(l,"class","text-lg font-semibold text-white mb-4"),a(e,"class","space-y-4")},m(m,d){M(m,e,d),s(e,l),s(l,i),s(e,o),u&&u.m(e,null),s(e,b),g.m(e,null)},p(m,d){d[0]&8192&&n!==(n=m[13].inputMode==="camera"?"1. Registra Video":"1. Carica o Registra Video")&&B(i,n),m[13].inputMode!=="camera"?u?u.p(m,d):(u=wl(m),u.c(),u.m(e,b)):u&&(u.d(1),u=null),f===(f=c(m))&&g?g.p(m,d):(g.d(1),g=f(m),g&&(g.c(),g.m(e,null)))},d(m){m&&E(e),u&&u.d(),g.d()}}}function wl(t){let e,l,n,i,o,b,u,c,f=t[1]?"Caricamento...":"Carica Video",g,m,d,h,v,C;return{c(){e=r("label"),l=r("input"),i=_(),o=r("div"),b=Ie("svg"),u=Ie("path"),c=_(),g=R(f),d=_(),h=r("div"),h.textContent="oppure",a(l,"type","file"),a(l,"accept","video/*"),l.disabled=n=t[1]||t[13].isRecording,a(l,"class","hidden"),a(u,"stroke-linecap","round"),a(u,"stroke-linejoin","round"),a(u,"stroke-width","2"),a(u,"d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"),a(b,"class","w-5 h-5 inline mr-2"),a(b,"fill","none"),a(b,"stroke","currentColor"),a(b,"viewBox","0 0 24 24"),a(o,"class",m="btn-primary cursor-pointer text-center "+(t[1]?"opacity-50":"")),a(e,"class","block"),a(h,"class","text-center text-slate-400 text-sm")},m(p,S){M(p,e,S),s(e,l),s(e,i),s(e,o),s(o,b),s(b,u),s(o,c),s(o,g),M(p,d,S),M(p,h,S),v||(C=X(l,"change",t[14]),v=!0)},p(p,S){S[0]&8194&&n!==(n=p[1]||p[13].isRecording)&&(l.disabled=n),S[0]&2&&f!==(f=p[1]?"Caricamento...":"Carica Video")&&B(g,f),S[0]&2&&m!==(m="btn-primary cursor-pointer text-center "+(p[1]?"opacity-50":""))&&a(o,"class",m)},d(p){p&&(E(e),E(d),E(h)),v=!1,C()}}}function kn(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12"></rect></svg>
            Ferma Registrazione`,a(e,"class","btn-danger w-full")},m(i,o){M(i,e,o),l||(n=X(e,"click",t[18]),l=!0)},p:G,d(i){i&&E(e),l=!1,n()}}}function xn(t){let e,l,n,i,o=t[13].inputMode==="camera"?"Cambia Telecamera":"Registra Video",b,u,c,f,g,m,d=t[13].isCameraPreview&&kl(t),h=t[13].isCameraPreview&&xl();return{c(){e=r("button"),l=Ie("svg"),n=Ie("path"),i=_(),b=R(o),u=_(),d&&d.c(),c=_(),h&&h.c(),f=gt(),a(n,"stroke-linecap","round"),a(n,"stroke-linejoin","round"),a(n,"stroke-width","2"),a(n,"d","M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"),a(l,"class","w-5 h-5 inline mr-2"),a(l,"fill","none"),a(l,"stroke","currentColor"),a(l,"viewBox","0 0 24 24"),a(e,"class","btn-secondary w-full")},m(v,C){M(v,e,C),s(e,l),s(l,n),s(e,i),s(e,b),M(v,u,C),d&&d.m(v,C),M(v,c,C),h&&h.m(v,C),M(v,f,C),g||(m=X(e,"click",t[16]),g=!0)},p(v,C){C[0]&8192&&o!==(o=v[13].inputMode==="camera"?"Cambia Telecamera":"Registra Video")&&B(b,o),v[13].isCameraPreview?d?d.p(v,C):(d=kl(v),d.c(),d.m(c.parentNode,c)):d&&(d.d(1),d=null),v[13].isCameraPreview?h||(h=xl(),h.c(),h.m(f.parentNode,f)):h&&(h.d(1),h=null)},d(v){v&&(E(e),E(u),E(c),E(f)),d&&d.d(v),h&&h.d(v),g=!1,m()}}}function kl(t){let e,l,n;return{c(){e=r("button"),e.textContent="Analizza Video",a(e,"class","btn-primary w-full mt-3")},m(i,o){M(i,e,o),l||(n=X(e,"click",t[15]),l=!0)},p:G,d(i){i&&E(e),l=!1,n()}}}function xl(t){let e;return{c(){e=r("div"),e.textContent='Anteprima fotocamera attiva. Premi "Analizza Video" per iniziare la registrazione, poi "Ferma Registrazione" al termine del salto.',a(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-3 text-blue-300 text-sm")},m(l,n){M(l,e,n)},d(l){l&&E(e)}}}function Cl(t){let e,l,n,i,o,b,u,c,f,g,m,d,h,v,C,p,S,P,A,z,y,T,k,I,x,j=t[6]?"Calibrazione e Analisi in corso...":"Avvia Analisi",N,U,K,te,ne,L=t[6]&&Sl();return{c(){e=r("div"),l=r("h3"),l.textContent="2. Calibrazione Sistema",n=_(),i=r("div"),o=r("label"),o.textContent="FPS Video",b=_(),u=r("input"),c=_(),f=r("p"),f.textContent="Frame per secondo del video",g=_(),m=r("div"),d=r("label"),d.textContent="Altezza Persona (cm)",h=_(),v=r("input"),C=_(),p=r("p"),p.textContent="Altezza reale della persona",S=_(),P=r("div"),A=r("label"),A.textContent="Massa Corporea (kg)",z=_(),y=r("input"),T=_(),k=r("p"),k.textContent="Peso della persona",I=_(),x=r("button"),N=R(j),K=_(),L&&L.c(),a(l,"class","text-lg font-semibold text-white mb-4"),a(o,"for","fps-input"),a(o,"class","block text-sm font-medium text-slate-300 mb-2"),a(u,"id","fps-input"),a(u,"type","number"),a(u,"min","1"),a(u,"max","240"),u.disabled=t[6],a(u,"class","input-field"),a(f,"class","text-slate-500 text-xs mt-1"),a(d,"for","height-input"),a(d,"class","block text-sm font-medium text-slate-300 mb-2"),a(v,"id","height-input"),a(v,"type","number"),a(v,"min","100"),a(v,"max","250"),v.disabled=t[6],a(v,"class","input-field"),a(p,"class","text-slate-500 text-xs mt-1"),a(A,"for","mass-input"),a(A,"class","block text-sm font-medium text-slate-300 mb-2"),a(y,"id","mass-input"),a(y,"type","number"),a(y,"min","40"),a(y,"max","150"),y.disabled=t[6],a(y,"class","input-field"),a(k,"class","text-slate-500 text-xs mt-1"),x.disabled=t[6],a(x,"class",U="btn-primary w-full "+(t[6]?"opacity-50":"")),a(e,"class","space-y-4")},m(V,W){M(V,e,W),s(e,l),s(e,n),s(e,i),s(i,o),s(i,b),s(i,u),he(u,t[2]),s(i,c),s(i,f),s(e,g),s(e,m),s(m,d),s(m,h),s(m,v),he(v,t[3]),s(m,C),s(m,p),s(e,S),s(e,P),s(P,A),s(P,z),s(P,y),he(y,t[4]),s(P,T),s(P,k),s(e,I),s(e,x),s(x,N),s(e,K),L&&L.m(e,null),te||(ne=[X(u,"input",t[28]),X(v,"input",t[29]),X(y,"input",t[30]),X(x,"click",t[24])],te=!0)},p(V,W){W[0]&64&&(u.disabled=V[6]),W[0]&4&&we(u.value)!==V[2]&&he(u,V[2]),W[0]&64&&(v.disabled=V[6]),W[0]&8&&we(v.value)!==V[3]&&he(v,V[3]),W[0]&64&&(y.disabled=V[6]),W[0]&16&&we(y.value)!==V[4]&&he(y,V[4]),W[0]&64&&j!==(j=V[6]?"Calibrazione e Analisi in corso...":"Avvia Analisi")&&B(N,j),W[0]&64&&(x.disabled=V[6]),W[0]&64&&U!==(U="btn-primary w-full "+(V[6]?"opacity-50":""))&&a(x,"class",U),V[6]?L||(L=Sl(),L.c(),L.m(e,null)):L&&(L.d(1),L=null)},d(V){V&&E(e),L&&L.d(),te=!1,ue(ne)}}}function Sl(t){let e;return{c(){e=r("div"),e.innerHTML='<p class="text-blue-400 text-sm">Sistema in calibrazione. Assicurati che la persona sia in posizione eretta nel frame.</p>',a(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-4")},m(l,n){M(l,e,n)},d(l){l&&E(e)}}}function Tl(t){var de,ge,Ne,be;let e,l,n,i,o,b,u,c,f,g,m,d,h=(((de=t[13].realtimeData)==null?void 0:de.current_height)??0)+"",v,C,p,S,P,A,z,y=(((ge=t[13].realtimeData)==null?void 0:ge.max_height)??0)+"",T,k,I,x,j,N,U,K=(((Ne=t[13].realtimeData)==null?void 0:Ne.takeoff_velocity)??0)+"",te,ne,L,V,W,$,H,J=(((be=t[13].realtimeData)==null?void 0:be.estimated_power)??0)+"",Q,D,w;function O(ee,ce){return ee[7]?Cn:Sn}let F=O(t),le=F(t),Z=t[7]&&Pl(t);return{c(){e=r("div"),l=r("h3"),l.textContent="3. Analisi Salto",n=_(),le.c(),i=_(),o=r("div"),b=r("h4"),b.textContent="Dati in Tempo Reale",u=_(),c=r("div"),f=r("div"),g=r("p"),g.textContent="Altezza Corrente",m=_(),d=r("p"),v=R(h),C=R(" cm"),p=_(),S=r("div"),P=r("p"),P.textContent="Altezza Max",A=_(),z=r("p"),T=R(y),k=R(" cm"),I=_(),x=r("div"),j=r("p"),j.textContent="Velocità Decollo",N=_(),U=r("p"),te=R(K),ne=R(" cm/s"),L=_(),V=r("div"),W=r("p"),W.textContent="Potenza Est.",$=_(),H=r("p"),Q=R(J),D=R(" W"),w=_(),Z&&Z.c(),a(l,"class","text-lg font-semibold text-white mb-4"),a(b,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3"),a(g,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(d,"class","text-xl font-bold text-blue-400"),a(f,"class","text-center"),a(P,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(z,"class","text-xl font-bold text-green-400"),a(S,"class","text-center"),a(j,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(U,"class","text-xl font-bold text-purple-400"),a(x,"class","text-center"),a(W,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(H,"class","text-xl font-bold text-yellow-400"),a(V,"class","text-center"),a(c,"class","grid grid-cols-2 gap-3"),a(o,"class","bg-slate-900/50 rounded-xl p-4 border border-slate-700"),a(e,"class","space-y-4")},m(ee,ce){M(ee,e,ce),s(e,l),s(e,n),le.m(e,null),s(e,i),s(e,o),s(o,b),s(o,u),s(o,c),s(c,f),s(f,g),s(f,m),s(f,d),s(d,v),s(d,C),s(c,p),s(c,S),s(S,P),s(S,A),s(S,z),s(z,T),s(z,k),s(c,I),s(c,x),s(x,j),s(x,N),s(x,U),s(U,te),s(U,ne),s(c,L),s(c,V),s(V,W),s(V,$),s(V,H),s(H,Q),s(H,D),s(e,w),Z&&Z.m(e,null)},p(ee,ce){var Fe,He,pe,ve;F===(F=O(ee))&&le?le.p(ee,ce):(le.d(1),le=F(ee),le&&(le.c(),le.m(e,i))),ce[0]&8192&&h!==(h=(((Fe=ee[13].realtimeData)==null?void 0:Fe.current_height)??0)+"")&&B(v,h),ce[0]&8192&&y!==(y=(((He=ee[13].realtimeData)==null?void 0:He.max_height)??0)+"")&&B(T,y),ce[0]&8192&&K!==(K=(((pe=ee[13].realtimeData)==null?void 0:pe.takeoff_velocity)??0)+"")&&B(te,K),ce[0]&8192&&J!==(J=(((ve=ee[13].realtimeData)==null?void 0:ve.estimated_power)??0)+"")&&B(Q,J),ee[7]?Z?Z.p(ee,ce):(Z=Pl(ee),Z.c(),Z.m(e,null)):Z&&(Z.d(1),Z=null)},d(ee){ee&&E(e),le.d(),Z&&Z.d()}}}function Cn(t){let e;return{c(){e=r("div"),e.innerHTML='<p class="text-green-400 text-sm font-medium">Analisi in corso...</p> <p class="text-slate-400 text-xs mt-1">Il sistema sta elaborando il salto</p>',a(e,"class","bg-green-500/10 border border-green-500/50 rounded-lg p-4")},m(l,n){M(l,e,n)},p:G,d(l){l&&E(e)}}}function Sn(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            Avvia Analisi`,a(e,"class","btn-primary w-full")},m(i,o){M(i,e,o),l||(n=X(e,"click",t[19]),l=!0)},p:G,d(i){i&&E(e),l=!1,n()}}}function Pl(t){let e,l,n,i,o;function b(f,g){return f[13].isPaused?Pn:Tn}let u=b(t),c=u(t);return{c(){e=r("div"),c.c(),l=_(),n=r("button"),n.textContent="Annulla",a(n,"class","btn-danger flex-1"),a(e,"class","flex gap-2")},m(f,g){M(f,e,g),c.m(e,null),s(e,l),s(e,n),i||(o=X(n,"click",t[22]),i=!0)},p(f,g){u===(u=b(f))&&c?c.p(f,g):(c.d(1),c=u(f),c&&(c.c(),c.m(e,l)))},d(f){f&&E(e),c.d(),i=!1,o()}}}function Tn(t){let e,l,n;return{c(){e=r("button"),e.textContent="Pausa",a(e,"class","btn-secondary flex-1")},m(i,o){M(i,e,o),l||(n=X(e,"click",t[20]),l=!0)},p:G,d(i){i&&E(e),l=!1,n()}}}function Pn(t){let e,l,n;return{c(){e=r("button"),e.textContent="Riprendi",a(e,"class","btn-secondary flex-1")},m(i,o){M(i,e,o),l||(n=X(e,"click",t[21]),l=!0)},p:G,d(i){i&&E(e),l=!1,n()}}}function An(t){let e,l,n,i,o,b,u,c,f,g,m,d,h,v,C,p,S,P,A,z,y,T,k,I,x,j,N,U,K,te,ne,L=t[0]>1&&vl(t);function V(D){t[25](D)}let W={show:t[8],loading:t[11],cameras:t[9],error:t[12]};t[10]!==void 0&&(W.selectedIndex=t[10]),v=new wn({props:W}),fe.push(()=>Xl(v,"selectedIndex",V)),v.$on("close",t[26]),v.$on("confirm",t[17]),v.$on("select",t[27]);let $=t[5]&&_l(t),H=t[0]===1&&yl(t),J=t[0]===2&&Cl(t),Q=t[0]===3&&Tl(t);return{c(){e=r("div"),l=r("div"),n=r("div"),i=r("div"),o=r("h2"),o.textContent="Step Holder",b=_(),u=r("p"),c=R("Step "),f=R(t[0]),g=R(" di 3"),m=_(),L&&L.c(),d=_(),h=r("div"),vt(v.$$.fragment),p=_(),$&&$.c(),S=_(),H&&H.c(),P=_(),J&&J.c(),A=_(),Q&&Q.c(),z=_(),y=r("div"),T=r("div"),k=r("span"),k.textContent="Progresso",I=_(),x=r("span"),j=R(t[0]),N=R("/3"),U=_(),K=r("div"),te=r("div"),a(o,"class","text-xl font-semibold text-white"),a(u,"class","text-purple-100 text-sm mt-1"),a(n,"class","flex justify-between items-center"),a(l,"class","step-header bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-4"),a(k,"class","text-xs text-slate-400"),a(x,"class","text-xs text-slate-400"),a(T,"class","flex justify-between items-center mb-2"),a(te,"class","bg-gradient-to-r from-purple-600 to-pink-600 h-2 rounded-full transition-all duration-300"),il(te,"width",t[0]/3*100+"%"),a(K,"class","w-full bg-slate-700 rounded-full h-2"),a(y,"class","mt-8 pt-6 border-t border-slate-700"),a(h,"class","step-content p-6 space-y-6 flex-1 overflow-auto svelte-10imy5p"),a(e,"class","step-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 h-full flex flex-col")},m(D,w){M(D,e,w),s(e,l),s(l,n),s(n,i),s(i,o),s(i,b),s(i,u),s(u,c),s(u,f),s(u,g),s(n,m),L&&L.m(n,null),s(e,d),s(e,h),Ze(v,h,null),s(h,p),$&&$.m(h,null),s(h,S),H&&H.m(h,null),s(h,P),J&&J.m(h,null),s(h,A),Q&&Q.m(h,null),s(h,z),s(h,y),s(y,T),s(T,k),s(T,I),s(T,x),s(x,j),s(x,N),s(y,U),s(y,K),s(K,te),ne=!0},p(D,w){(!ne||w[0]&1)&&B(f,D[0]),D[0]>1?L?L.p(D,w):(L=vl(D),L.c(),L.m(n,null)):L&&(L.d(1),L=null);const O={};w[0]&256&&(O.show=D[8]),w[0]&2048&&(O.loading=D[11]),w[0]&512&&(O.cameras=D[9]),w[0]&4096&&(O.error=D[12]),!C&&w[0]&1024&&(C=!0,O.selectedIndex=D[10],Yl(()=>C=!1)),v.$set(O),D[5]?$?$.p(D,w):($=_l(D),$.c(),$.m(h,S)):$&&($.d(1),$=null),D[0]===1?H?H.p(D,w):(H=yl(D),H.c(),H.m(h,P)):H&&(H.d(1),H=null),D[0]===2?J?J.p(D,w):(J=Cl(D),J.c(),J.m(h,A)):J&&(J.d(1),J=null),D[0]===3?Q?Q.p(D,w):(Q=Tl(D),Q.c(),Q.m(h,z)):Q&&(Q.d(1),Q=null),(!ne||w[0]&1)&&B(j,D[0]),(!ne||w[0]&1)&&il(te,"width",D[0]/3*100+"%")},i(D){ne||(ke(v.$$.fragment,D),ne=!0)},o(D){Le(v.$$.fragment,D),ne=!1},d(D){D&&E(e),L&&L.d(),Qe(v),$&&$.d(),H&&H.d(),J&&J.d(),Q&&Q.d()}}}function zn(t,e,l){let n;bt(t,Y,w=>l(13,n=w));let{currentStep:i=1}=e;const o=Nt();let b=null,u=!1,c=30,f=170,g=70,m="",d=!1,h=!1,v=!1,C=[],p=null,S=!1,P="";async function A(w){if(b=w.target.files[0],b){try{const O=URL.createObjectURL(b);nn(O)}catch{}ol("upload"),await z()}}async function z(){if(!b)return;l(1,u=!0),l(5,m="");const w=new FormData;w.append("video",b);try{const F=await(await fetch("http://localhost:5000/api/video/upload",{method:"POST",body:w})).json();F.success?(l(2,c=Math.round(F.fps)||30),o("stepComplete",{step:1,data:F})):l(5,m=F.error||"Errore caricamento video")}catch{l(5,m="Errore di connessione al server")}finally{l(1,u=!1)}}async function y(){try{if(p!=null)try{await Re.setCamera(Number(p))}catch{l(5,m="Errore impostazione fotocamera");return}const w=await Re.startRecording();if(w.success){Y.update(O=>({...O,isRecording:!0}));try{jt(n.previewStream)}catch{}Lt(),Mt(!1)}else l(5,m=w.error||"Errore avvio registrazione")}catch{l(5,m="Errore di connessione al server")}}function T(){l(12,P=""),l(8,v=!0),k()}async function k(){l(11,S=!0),l(9,C=[]),l(10,p=null);try{const w=await pn();w.length>0?(l(9,C=w),l(10,p=0)):l(12,P="Nessuna fotocamera trovata")}catch{l(12,P="Errore rilevamento fotocamere")}finally{l(11,S=!1)}}async function I(){if(l(12,P=""),p==null){l(12,P="Seleziona una fotocamera");return}try{l(8,v=!1);try{jt(n.previewStream);const w=await mn(Number(p),C);sn(w),Mt(!0),ol("camera")}catch{l(12,P="Impossibile avviare l'anteprima fotocamera")}}catch{l(12,P="Errore apertura anteprima")}}async function x(){try{const O=await(await fetch("http://localhost:5000/api/recording/stop",{method:"POST"})).json();O.success&&(Y.update(F=>({...F,isRecording:!1})),o("stepComplete",{step:1,data:O}))}catch{l(5,m="Errore stop registrazione")}}async function j(){if(l(5,m=""),n.inputMode==="camera"&&!n.isRecording)try{if((await Re.startRecording()).success){Y.update(O=>({...O,isRecording:!0}));try{jt(n.previewStream)}catch{}Lt(),Mt(!1)}}catch{l(5,m="Errore avvio registrazione");return}try{const w=await Re.startAnalysis();w.success?(l(7,h=!0),Y.update(O=>({...O,isAnalyzing:!0})),N()):l(5,m=w.error||"Errore avvio analisi")}catch{l(5,m="Errore di connessione")}}async function N(){const w=setInterval(async()=>{try{if(!(await Re.analysisStatus()).is_analyzing){clearInterval(w);const F=await Re.analysisResults();F.success&&(l(7,h=!1),Y.update(le=>({...le,isAnalyzing:!1})),o("stepComplete",{step:3,data:{...F.results,trajectory:F.trajectory,velocity:F.velocity}}))}}catch{}},500)}async function U(){try{await fetch("http://localhost:5000/api/analysis/pause",{method:"POST"}),Y.update(w=>({...w,isPaused:!0}))}catch{}}async function K(){try{await fetch("http://localhost:5000/api/analysis/resume",{method:"POST"}),Y.update(w=>({...w,isPaused:!1}))}catch{}}async function te(){try{await fetch("http://localhost:5000/api/analysis/stop",{method:"POST"})}catch{}o("cancelToStep1")}function ne(){o("goBack")}async function L(){l(5,m="");try{await fetch("http://localhost:5000/api/settings/fps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:c})}),await fetch("http://localhost:5000/api/settings/height",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:f})}),await fetch("http://localhost:5000/api/settings/mass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:g})})}catch{l(5,m="Errore impostazioni");return}try{const O=await(await fetch("http://localhost:5000/api/calibration/start",{method:"POST"})).json();O.success?(l(6,d=!0),Y.update(F=>({...F,isCalibrating:!0})),V()):l(5,m=O.error||"Errore calibrazione")}catch{l(5,m="Errore di connessione")}}async function V(){const w=setInterval(async()=>{try{const F=await(await fetch("http://localhost:5000/api/calibration/status")).json();F.success&&!F.in_progress?(clearInterval(w),l(6,d=!1),Y.update(le=>({...le,isCalibrating:!1})),o("stepComplete",{step:2,data:F}),await j()):F.success===!1&&!F.in_progress&&(clearInterval(w),l(6,d=!1),Y.update(le=>({...le,isCalibrating:!1})),l(5,m="Calibrazione fallita"))}catch{clearInterval(w),l(6,d=!1),l(5,m="Errore verifica calibrazione")}},500)}function W(w){p=w,l(10,p)}const $=()=>l(8,v=!1),H=w=>l(10,p=w.detail.index);function J(){c=we(this.value),l(2,c)}function Q(){f=we(this.value),l(3,f)}function D(){g=we(this.value),l(4,g)}return t.$$set=w=>{"currentStep"in w&&l(0,i=w.currentStep)},[i,u,c,f,g,m,d,h,v,C,p,S,P,n,A,y,T,I,x,j,U,K,te,ne,L,W,$,H,J,Q,D]}class En extends $e{constructor(e){super(),Xe(this,e,zn,An,Ve,{currentStep:0},null,[-1,-1])}}function Al(t){let e,l,n,i;return{c(){e=r("div"),l=r("h3"),l.textContent="Traiettoria del Salto",n=_(),i=r("canvas"),a(l,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(i,"width","400"),a(i,"height","250"),a(i,"class","w-full rounded-lg"),a(e,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700")},m(o,b){M(o,e,b),s(e,l),s(e,n),s(e,i),t[8](i)},p:G,d(o){o&&E(e),t[8](null)}}}function zl(t){let e,l,n,i;return{c(){e=r("div"),l=r("h3"),l.textContent="Velocità nel Tempo",n=_(),i=r("canvas"),a(l,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(i,"width","400"),a(i,"height","250"),a(i,"class","w-full rounded-lg"),a(e,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700")},m(o,b){M(o,e,b),s(e,l),s(e,n),s(e,i),t[9](i)},p:G,d(o){o&&E(e),t[9](null)}}}function El(t){let e,l,n;return{c(){e=r("div"),l=r("p"),n=R(t[4]),a(l,"class","text-blue-400 text-sm"),a(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-4")},m(i,o){M(i,e,o),s(e,l),s(l,n)},p(i,o){o&16&&B(n,i[4])},d(i){i&&E(e)}}}function Mn(t){let e,l,n,i,o,b,u,c,f,g,m,d,h=t[0].max_height+"",v,C,p,S,P,A,z,y=t[0].flight_time+"",T,k,I,x,j,N,U,K=t[0].takeoff_velocity+"",te,ne,L,V,W,$,H,J=t[0].estimated_power+"",Q,D,w,O,F,le,Z,de,ge,Ne,be,ee=t[0].contact_time+"",ce,Fe,He,pe,ve,Ft,Ue,et=t[0].eccentric_time+"",_t,Ht,Ut,xe,tt,Bt,Be,lt=t[0].concentric_time+"",yt,Wt,Jt,Ce,nt,qt,We,st=t[0].fall_time+"",wt,Yt,Gt,Se,it,Kt,Te,Pe,at,Zt,Je,rt=t[0].average_force+"",kt,Qt,Xt,Ae,ot,$t,qe,ct=t[0].jump_detected?"Sì":"No",xt,ft,el,Ct,St,Tt,ze,me,_e,Ee,tl,ut=t[3]?"Salvataggio...":"Salva Risultati",Pt,ll,Ye,At,nl,ae=t[5].trajectoryData.length>0&&Al(t),re=t[5].velocityData.length>0&&zl(t),oe=t[4]&&El(t);return{c(){e=r("div"),l=r("div"),l.innerHTML='<h2 class="text-xl font-semibold text-white">Risultati Analisi</h2> <p class="text-green-100 text-sm mt-1">Analisi completata con successo</p>',n=_(),i=r("div"),o=r("div"),b=r("h3"),b.textContent="Metriche Principali",u=_(),c=r("div"),f=r("div"),g=r("p"),g.textContent="Altezza Max",m=_(),d=r("p"),v=R(h),C=R(" cm"),p=_(),S=r("div"),P=r("p"),P.textContent="Tempo di Volo",A=_(),z=r("p"),T=R(y),k=R(" s"),I=_(),x=r("div"),j=r("p"),j.textContent="Velocità Decollo",N=_(),U=r("p"),te=R(K),ne=R(" cm/s"),L=_(),V=r("div"),W=r("p"),W.textContent="Potenza Est.",$=_(),H=r("p"),Q=R(J),D=R(" W"),w=_(),O=r("div"),F=r("h3"),F.textContent="Analisi Fasi",le=_(),Z=r("div"),de=r("div"),ge=r("span"),ge.textContent="Tempo Contatto",Ne=_(),be=r("span"),ce=R(ee),Fe=R(" s"),He=_(),pe=r("div"),ve=r("span"),ve.textContent="Fase Eccentrica",Ft=_(),Ue=r("span"),_t=R(et),Ht=R(" s"),Ut=_(),xe=r("div"),tt=r("span"),tt.textContent="Fase Concentrica",Bt=_(),Be=r("span"),yt=R(lt),Wt=R(" s"),Jt=_(),Ce=r("div"),nt=r("span"),nt.textContent="Tempo Caduta",qt=_(),We=r("span"),wt=R(st),Yt=R(" s"),Gt=_(),Se=r("div"),it=r("h3"),it.textContent="Parametri Biomeccanici",Kt=_(),Te=r("div"),Pe=r("div"),at=r("span"),at.textContent="Forza Media",Zt=_(),Je=r("span"),kt=R(rt),Qt=R(" N"),Xt=_(),Ae=r("div"),ot=r("span"),ot.textContent="Salto Rilevato",$t=_(),qe=r("span"),xt=R(ct),el=_(),ae&&ae.c(),Ct=_(),re&&re.c(),St=_(),oe&&oe.c(),Tt=_(),ze=r("div"),me=r("button"),_e=Ie("svg"),Ee=Ie("path"),tl=_(),Pt=R(ut),ll=_(),Ye=r("button"),Ye.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        Nuova Analisi`,a(l,"class","results-header bg-gradient-to-r from-green-600 to-teal-600 px-6 py-4"),a(b,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(g,"class","text-xs text-slate-400 mb-1"),a(d,"class","text-2xl font-bold text-green-400"),a(P,"class","text-xs text-slate-400 mb-1"),a(z,"class","text-2xl font-bold text-blue-400"),a(j,"class","text-xs text-slate-400 mb-1"),a(U,"class","text-2xl font-bold text-purple-400"),a(W,"class","text-xs text-slate-400 mb-1"),a(H,"class","text-2xl font-bold text-yellow-400"),a(c,"class","grid grid-cols-2 gap-4"),a(o,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700"),a(F,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(ge,"class","text-sm text-slate-400"),a(be,"class","text-lg font-semibold text-white"),a(de,"class","flex justify-between items-center"),a(ve,"class","text-sm text-slate-400"),a(Ue,"class","text-lg font-semibold text-white"),a(pe,"class","flex justify-between items-center"),a(tt,"class","text-sm text-slate-400"),a(Be,"class","text-lg font-semibold text-white"),a(xe,"class","flex justify-between items-center"),a(nt,"class","text-sm text-slate-400"),a(We,"class","text-lg font-semibold text-white"),a(Ce,"class","flex justify-between items-center"),a(Z,"class","space-y-3"),a(O,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700"),a(it,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(at,"class","text-sm text-slate-400"),a(Je,"class","text-lg font-semibold text-white"),a(Pe,"class","flex justify-between items-center"),a(ot,"class","text-sm text-slate-400"),a(qe,"class",ft="text-lg font-semibold "+(t[0].jump_detected?"text-green-400":"text-red-400")),a(Ae,"class","flex justify-between items-center"),a(Te,"class","space-y-3"),a(Se,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700"),a(Ee,"stroke-linecap","round"),a(Ee,"stroke-linejoin","round"),a(Ee,"stroke-width","2"),a(Ee,"d","M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"),a(_e,"class","w-5 h-5 inline mr-2"),a(_e,"fill","none"),a(_e,"stroke","currentColor"),a(_e,"viewBox","0 0 24 24"),me.disabled=t[3],a(me,"class","flex-1 bg-gradient-to-r from-green-600 to-teal-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-green-700 hover:to-teal-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"),a(Ye,"class","flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl"),a(ze,"class","flex gap-3 pt-4"),a(i,"class","results-content p-6 space-y-6 flex-1 overflow-auto svelte-dxhq61"),a(e,"class","results-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 h-full flex flex-col")},m(q,se){M(q,e,se),s(e,l),s(e,n),s(e,i),s(i,o),s(o,b),s(o,u),s(o,c),s(c,f),s(f,g),s(f,m),s(f,d),s(d,v),s(d,C),s(c,p),s(c,S),s(S,P),s(S,A),s(S,z),s(z,T),s(z,k),s(c,I),s(c,x),s(x,j),s(x,N),s(x,U),s(U,te),s(U,ne),s(c,L),s(c,V),s(V,W),s(V,$),s(V,H),s(H,Q),s(H,D),s(i,w),s(i,O),s(O,F),s(O,le),s(O,Z),s(Z,de),s(de,ge),s(de,Ne),s(de,be),s(be,ce),s(be,Fe),s(Z,He),s(Z,pe),s(pe,ve),s(pe,Ft),s(pe,Ue),s(Ue,_t),s(Ue,Ht),s(Z,Ut),s(Z,xe),s(xe,tt),s(xe,Bt),s(xe,Be),s(Be,yt),s(Be,Wt),s(Z,Jt),s(Z,Ce),s(Ce,nt),s(Ce,qt),s(Ce,We),s(We,wt),s(We,Yt),s(i,Gt),s(i,Se),s(Se,it),s(Se,Kt),s(Se,Te),s(Te,Pe),s(Pe,at),s(Pe,Zt),s(Pe,Je),s(Je,kt),s(Je,Qt),s(Te,Xt),s(Te,Ae),s(Ae,ot),s(Ae,$t),s(Ae,qe),s(qe,xt),s(i,el),ae&&ae.m(i,null),s(i,Ct),re&&re.m(i,null),s(i,St),oe&&oe.m(i,null),s(i,Tt),s(i,ze),s(ze,me),s(me,_e),s(_e,Ee),s(me,tl),s(me,Pt),s(ze,ll),s(ze,Ye),At||(nl=[X(me,"click",t[7]),X(Ye,"click",t[6])],At=!0)},p(q,[se]){se&1&&h!==(h=q[0].max_height+"")&&B(v,h),se&1&&y!==(y=q[0].flight_time+"")&&B(T,y),se&1&&K!==(K=q[0].takeoff_velocity+"")&&B(te,K),se&1&&J!==(J=q[0].estimated_power+"")&&B(Q,J),se&1&&ee!==(ee=q[0].contact_time+"")&&B(ce,ee),se&1&&et!==(et=q[0].eccentric_time+"")&&B(_t,et),se&1&&lt!==(lt=q[0].concentric_time+"")&&B(yt,lt),se&1&&st!==(st=q[0].fall_time+"")&&B(wt,st),se&1&&rt!==(rt=q[0].average_force+"")&&B(kt,rt),se&1&&ct!==(ct=q[0].jump_detected?"Sì":"No")&&B(xt,ct),se&1&&ft!==(ft="text-lg font-semibold "+(q[0].jump_detected?"text-green-400":"text-red-400"))&&a(qe,"class",ft),q[5].trajectoryData.length>0?ae?ae.p(q,se):(ae=Al(q),ae.c(),ae.m(i,Ct)):ae&&(ae.d(1),ae=null),q[5].velocityData.length>0?re?re.p(q,se):(re=zl(q),re.c(),re.m(i,St)):re&&(re.d(1),re=null),q[4]?oe?oe.p(q,se):(oe=El(q),oe.c(),oe.m(i,Tt)):oe&&(oe.d(1),oe=null),se&8&&ut!==(ut=q[3]?"Salvataggio...":"Salva Risultati")&&B(Pt,ut),se&8&&(me.disabled=q[3])},i:G,o:G,d(q){q&&E(e),ae&&ae.d(),re&&re.d(),oe&&oe.d(),At=!1,ue(nl)}}}function jn(t,e,l){let n;bt(t,Y,p=>l(5,n=p));let{results:i}=e;const o=Nt();let b,u;Vt(()=>{b&&n.trajectoryData.length>0&&c(),u&&n.velocityData.length>0&&f()});function c(){const p=b.getContext("2d"),S=b.width,P=b.height;p.fillStyle="#1e293b",p.fillRect(0,0,S,P);const A=n.trajectoryData;if(A.length===0)return;const z=Math.max(...A.map(j=>j.t)),y=Math.max(...A.map(j=>j.y)),T=Math.min(...A.map(j=>j.y)),k=40,I=S-2*k,x=P-2*k;p.strokeStyle="#475569",p.lineWidth=2,p.beginPath(),p.moveTo(k,k),p.lineTo(k,P-k),p.lineTo(S-k,P-k),p.stroke(),p.strokeStyle="#334155",p.lineWidth=1;for(let j=0;j<=5;j++){const N=k+x*j/5;p.beginPath(),p.moveTo(k,N),p.lineTo(S-k,N),p.stroke()}p.strokeStyle="#3b82f6",p.lineWidth=3,p.beginPath(),A.forEach((j,N)=>{const U=k+j.t/z*I,K=P-k-(j.y-T)/(y-T)*x;N===0?p.moveTo(U,K):p.lineTo(U,K)}),p.stroke(),p.fillStyle="#94a3b8",p.font="12px sans-serif",p.fillText("Tempo (s)",S/2-30,P-10),p.save(),p.translate(15,P/2),p.rotate(-Math.PI/2),p.fillText("Altezza (cm)",0,0),p.restore()}function f(){const p=u.getContext("2d"),S=u.width,P=u.height;p.fillStyle="#1e293b",p.fillRect(0,0,S,P);const A=n.velocityData;if(A.length===0)return;const z=Math.max(...A.map(j=>j.t)),y=Math.max(...A.map(j=>Math.abs(j.v))),T=40,k=S-2*T,I=P-2*T;p.strokeStyle="#475569",p.lineWidth=2,p.beginPath(),p.moveTo(T,T),p.lineTo(T,P-T),p.lineTo(S-T,P-T),p.stroke();const x=P-T-I/2;p.strokeStyle="#64748b",p.lineWidth=1,p.beginPath(),p.moveTo(T,x),p.lineTo(S-T,x),p.stroke(),p.strokeStyle="#a855f7",p.lineWidth=3,p.beginPath(),A.forEach((j,N)=>{const U=T+j.t/z*k,K=x-j.v/y*(I/2);N===0?p.moveTo(U,K):p.lineTo(U,K)}),p.stroke(),p.fillStyle="#94a3b8",p.font="12px sans-serif",p.fillText("Tempo (s)",S/2-30,P-10),p.save(),p.translate(15,P/2),p.rotate(-Math.PI/2),p.fillText("Velocità (cm/s)",0,0),p.restore()}function g(){o("reset")}let m=!1,d="";async function h(){l(3,m=!0),l(4,d="");try{const S=await(await fetch("http://localhost:5000/api/results/save",{method:"POST"})).json();S.success?l(4,d="Risultati salvati con successo!"):l(4,d=S.error||"Errore durante il salvataggio")}catch{l(4,d="Errore di connessione al server")}finally{l(3,m=!1)}}function v(p){fe[p?"unshift":"push"](()=>{b=p,l(1,b)})}function C(p){fe[p?"unshift":"push"](()=>{u=p,l(2,u)})}return t.$$set=p=>{"results"in p&&l(0,i=p.results)},[i,b,u,m,d,n,g,h,v,C]}class Rn extends $e{constructor(e){super(),Xe(this,e,jn,Mn,Ve,{results:0})}}function Dn(t){let e,l;return e=new Rn({props:{results:t[2]}}),e.$on("reset",t[7]),{c(){vt(e.$$.fragment)},m(n,i){Ze(e,n,i),l=!0},p(n,i){const o={};i&4&&(o.results=n[2]),e.$set(o)},i(n){l||(ke(e.$$.fragment,n),l=!0)},o(n){Le(e.$$.fragment,n),l=!1},d(n){Qe(e,n)}}}function On(t){let e,l;return e=new En({props:{currentStep:t[0]}}),e.$on("stepComplete",t[5]),e.$on("goBack",t[8]),e.$on("cancelToStep1",t[9]),{c(){vt(e.$$.fragment)},m(n,i){Ze(e,n,i),l=!0},p(n,i){const o={};i&1&&(o.currentStep=n[0]),e.$set(o)},i(n){l||(ke(e.$$.fragment,n),l=!0)},o(n){Le(e.$$.fragment,n),l=!1},d(n){Qe(e,n)}}}function Ln(t){let e,l,n,i,o,b,u,c,f,g,m,d,h,v,C,p,S,P,A;d=new dn({props:{analysisCompleted:t[1]}});const z=[On,Dn],y=[];function T(k,I){return k[1]?1:0}return C=T(t),p=y[C]=z[C](t),{c(){e=r("main"),l=r("header"),n=r("div"),i=r("div"),o=r("h1"),o.textContent="Jump Analyzer Pro",b=_(),u=r("button"),u.textContent="Annulla Analisi",c=_(),f=r("div"),g=r("div"),m=r("div"),vt(d.$$.fragment),h=_(),v=r("div"),p.c(),a(o,"class","text-4xl font-bold text-white tracking-tight"),a(u,"class","bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold border border-red-500/50 shadow-md"),a(i,"class","flex items-center justify-between"),a(n,"class","max-w-[1400px] mx-auto px-6 py-6"),a(l,"class","bg-slate-800/50 backdrop-blur-sm border-b border-slate-700"),a(m,"class","lg:col-span-2"),a(v,"class","lg:col-span-1"),a(g,"class","grid grid-cols-1 lg:grid-cols-3 gap-6"),a(f,"class","max-w-[1400px] mx-auto px-6 py-8"),a(e,"class","min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900")},m(k,I){M(k,e,I),s(e,l),s(l,n),s(n,i),s(i,o),s(i,b),s(i,u),s(e,c),s(e,f),s(f,g),s(g,m),Ze(d,m,null),t[10](m),s(g,h),s(g,v),y[C].m(v,null),t[11](v),S=!0,P||(A=X(u,"click",t[6]),P=!0)},p(k,[I]){const x={};I&2&&(x.analysisCompleted=k[1]),d.$set(x);let j=C;C=T(k),C===j?y[C].p(k,I):(Zl(),Le(y[j],1,1,()=>{y[j]=null}),Ql(),p=y[C],p?p.p(k,I):(p=y[C]=z[C](k),p.c()),ke(p,1),p.m(v,null))},i(k){S||(ke(d.$$.fragment,k),ke(p),S=!0)},o(k){Le(d.$$.fragment,k),Le(p),S=!1},d(k){k&&E(e),Qe(d),t[10](null),y[C].d(),t[11](null),P=!1,A()}}}async function Rt(){try{await fetch("http://localhost:5000/api/analysis/stop",{method:"POST"})}catch{}}async function Ml(){try{await fetch("http://localhost:5000/api/recording/stop",{method:"POST"})}catch{}}function In(t,e,l){let n;bt(t,Y,z=>l(15,n=z));let i=1,o=!1,b=null,u,c,f,g,m;function d(){if(!c||!f)return;if(typeof window<"u"?window.innerWidth>=1024:!0){const y=c.clientHeight;l(4,f.style.height=y?`${y}px`:"",f)}else l(4,f.style.height="",f)}Vt(()=>{u=setInterval(async()=>{if(n.isAnalyzing||n.isRecording||n.isCalibrating){try{const y=await(await fetch("http://localhost:5000/api/video/frame")).json();y.success&&y.frame&&Ll(y.frame)}catch{}if(n.isAnalyzing)try{const y=await(await fetch("http://localhost:5000/api/analysis/data")).json();y.realtime&&ln(y.realtime,y.trajectory,y.velocity)}catch{}}},100),window&&"ResizeObserver"in window?(g=new ResizeObserver(()=>{d()}),c&&g.observe(c)):window.addEventListener("resize",d),m=()=>{d(),setTimeout(d,50),setTimeout(d,150)},typeof document<"u"&&(document.addEventListener("fullscreenchange",m),document.addEventListener("webkitfullscreenchange",m),document.addEventListener("mozfullscreenchange",m),document.addEventListener("MSFullscreenChange",m)),setTimeout(d,0)}),Dl(()=>{u&&clearInterval(u),g&&c&&g.unobserve(c),g&&g.disconnect(),typeof window<"u"&&window.removeEventListener("resize",d),typeof document<"u"&&m&&(document.removeEventListener("fullscreenchange",m),document.removeEventListener("webkitfullscreenchange",m),document.removeEventListener("mozfullscreenchange",m),document.removeEventListener("MSFullscreenChange",m))});function h(z){const{step:y,data:T}=z.detail;y===1?l(0,i=2):y===2?(l(0,i=3),d()):y===3&&(l(2,b=T),l(1,o=!0),d())}async function v(){var z,y;try{await fetch("http://localhost:5000/api/analysis/stop",{method:"POST"})}catch{}try{await fetch("http://localhost:5000/api/recording/stop",{method:"POST"})}catch{}try{(y=(z=n.previewStream)==null?void 0:z.getTracks())==null||y.forEach(T=>T.stop())}catch{}Lt(),Y.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});try{window.close()}catch{}}function C(){l(1,o=!1),l(2,b=null),l(0,i=1),Y.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null})}async function p(){i>1&&(i===2?(await Rt(),await Ml(),Y.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null})):i===3&&(await Rt(),Y.update(z=>({...z,isAnalyzing:!1,isPaused:!1,isCameraPreview:z.isCameraPreview,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:z.localVideoUrl}))),l(0,i--,i),d())}async function S(){await Rt(),await Ml(),l(0,i=1),Y.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null}),d()}function P(z){fe[z?"unshift":"push"](()=>{c=z,l(3,c)})}function A(z){fe[z?"unshift":"push"](()=>{f=z,l(4,f)})}return d(),[i,o,b,c,f,h,v,C,p,S,P,A]}class Vn extends $e{constructor(e){super(),Xe(this,e,In,Ln,Ve,{})}}new Vn({target:document.getElementById("app")});
