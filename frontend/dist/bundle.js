var Vn=Object.defineProperty;var Nn=(H,ue,_e)=>ue in H?Vn(H,ue,{enumerable:!0,configurable:!0,writable:!0,value:_e}):H[ue]=_e;var Ut=(H,ue,_e)=>Nn(H,typeof ue!="symbol"?ue+"":ue,_e);(function(){"use strict";function H(){}function ue(t){return t()}function _e(){return Object.create(null)}function de(t){t.forEach(ue)}function Bt(t){return typeof t=="function"}function Ae(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let nt;function it(t,e){return t===e?!0:(nt||(nt=document.createElement("a")),nt.href=e,t===nt.href)}function Il(t){return Object.keys(t).length===0}function Vl(t,...e){if(t==null){for(const n of e)n(void 0);return H}const l=t.subscribe(...e);return l.unsubscribe?()=>l.unsubscribe():l}function st(t,e,l){t.$$.on_destroy.push(Vl(e,l))}function i(t,e){t.appendChild(e)}function E(t,e,l){t.insertBefore(e,l||null)}function P(t){t.parentNode&&t.parentNode.removeChild(t)}function Nl(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function r(t){return document.createElement(t)}function Te(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function D(t){return document.createTextNode(t)}function _(){return D(" ")}function at(){return D("")}function Q(t,e,l,n){return t.addEventListener(e,l,n),()=>t.removeEventListener(e,l,n)}function a(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function we(t){return t===""?null:+t}function Fl(t){return Array.from(t.childNodes)}function J(t,e){e=""+e,t.data!==e&&(t.data=e)}function me(t,e){t.value=e??""}function Wt(t,e,l,n){l==null?t.style.removeProperty(e):t.style.setProperty(e,l,"")}function Jt(t,e,l){for(let n=0;n<t.options.length;n+=1){const s=t.options[n];if(s.__value===e){s.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function Hl(t){const e=t.querySelector(":checked");return e&&e.__value}function Ul(t,e,{bubbles:l=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:l,cancelable:n})}let He;function Ue(t){He=t}function kt(){if(!He)throw new Error("Function called outside component initialization");return He}function xt(t){kt().$$.on_mount.push(t)}function qt(t){kt().$$.on_destroy.push(t)}function Ct(){const t=kt();return(e,l,{cancelable:n=!1}={})=>{const s=t.$$.callbacks[e];if(s){const u=Ul(e,l,{cancelable:n});return s.slice().forEach(g=>{g.call(t,u)}),!u.defaultPrevented}return!0}}const Pe=[],pe=[];let ze=[];const St=[],Bl=Promise.resolve();let At=!1;function Wl(){At||(At=!0,Bl.then(Gt))}function rt(t){ze.push(t)}function Jl(t){St.push(t)}const Tt=new Set;let Ee=0;function Gt(){if(Ee!==0)return;const t=He;do{try{for(;Ee<Pe.length;){const e=Pe[Ee];Ee++,Ue(e),ql(e.$$)}}catch(e){throw Pe.length=0,Ee=0,e}for(Ue(null),Pe.length=0,Ee=0;pe.length;)pe.pop()();for(let e=0;e<ze.length;e+=1){const l=ze[e];Tt.has(l)||(Tt.add(l),l())}ze.length=0}while(Pe.length);for(;St.length;)St.pop()();At=!1,Tt.clear(),Ue(t)}function ql(t){if(t.fragment!==null){t.update(),de(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(rt)}}function Gl(t){const e=[],l=[];ze.forEach(n=>t.indexOf(n)===-1?e.push(n):l.push(n)),l.forEach(n=>n()),ze=e}const ot=new Set;let ye;function Yl(){ye={r:0,c:[],p:ye}}function Kl(){ye.r||de(ye.c),ye=ye.p}function ke(t,e){t&&t.i&&(ot.delete(t),t.i(e))}function Me(t,e,l,n){if(t&&t.o){if(ot.has(t))return;ot.add(t),ye.c.push(()=>{ot.delete(t),n&&(l&&t.d(1),n())}),t.o(e)}else n&&n()}function Yt(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Zl(t,e,l){const n=t.$$.props[e];n!==void 0&&(t.$$.bound[n]=l,l(t.$$.ctx[n]))}function ct(t){t&&t.c()}function Be(t,e,l){const{fragment:n,after_update:s}=t.$$;n&&n.m(e,l),rt(()=>{const u=t.$$.on_mount.map(ue).filter(Bt);t.$$.on_destroy?t.$$.on_destroy.push(...u):de(u),t.$$.on_mount=[]}),s.forEach(rt)}function We(t,e){const l=t.$$;l.fragment!==null&&(Gl(l.after_update),de(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function Ql(t,e){t.$$.dirty[0]===-1&&(Pe.push(t),Wl(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Je(t,e,l,n,s,u,g=null,c=[-1]){const o=He;Ue(t);const f=t.$$={fragment:null,ctx:[],props:u,update:H,not_equal:s,bound:_e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(o?o.$$.context:[])),callbacks:_e(),dirty:c,skip_bound:!1,root:e.target||o.$$.root};g&&g(f.root);let h=!1;if(f.ctx=l?l(t,e.props||{},(b,p,...m)=>{const v=m.length?m[0]:p;return f.ctx&&s(f.ctx[b],f.ctx[b]=v)&&(!f.skip_bound&&f.bound[b]&&f.bound[b](v),h&&Ql(t,b)),p}):[],f.update(),h=!0,de(f.before_update),f.fragment=n?n(f.ctx):!1,e.target){if(e.hydrate){const b=Fl(e.target);f.fragment&&f.fragment.l(b),b.forEach(P)}else f.fragment&&f.fragment.c();e.intro&&ke(t.$$.fragment),Be(t,e.target,e.anchor),Gt()}Ue(o)}class qe{constructor(){Ut(this,"$$");Ut(this,"$$set")}$destroy(){We(this,1),this.$destroy=H}$on(e,l){if(!Bt(l))return H;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(l),()=>{const s=n.indexOf(l);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!Il(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Xl="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Xl);const je=[];function $l(t,e=H){let l;const n=new Set;function s(c){if(Ae(t,c)&&(t=c,l)){const o=!je.length;for(const f of n)f[1](),je.push(f,t);if(o){for(let f=0;f<je.length;f+=2)je[f][0](je[f+1]);je.length=0}}}function u(c){s(c(t))}function g(c,o=H){const f=[c,o];return n.add(f),n.size===1&&(l=e(s,u)||H),c(t),()=>{n.delete(f),n.size===0&&l&&(l(),l=null)}}return{set:s,update:u,subscribe:g}}const K=$l({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,previewStream:null,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});function Kt(t){K.update(e=>({...e,videoFrame:t}))}function en(t,e,l){K.update(n=>({...n,realtimeData:t,trajectoryData:e||n.trajectoryData,velocityData:l||n.velocityData}))}function tn(t){K.update(e=>({...e,localVideoUrl:t}))}function Pt(t){K.update(e=>({...e,isCameraPreview:!!t}))}function ln(t){K.update(e=>({...e,previewStream:t||null}))}function zt(){K.update(t=>({...t,previewStream:null}))}function Et(t){K.update(e=>({...e,inputMode:t==="upload"||t==="camera"?t:"none"}))}const le=()=>typeof window<"u"&&window.BACKEND_URL?window.BACKEND_URL:"http://localhost:5000",nn=le();async function ae(t,e={}){const l=`${nn}${t}`,n=await fetch(l,e);try{return await n.json()}catch{return{}}}const Ge={setCamera(t){return ae("/api/settings/camera",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({index:Number(t)})})},setFps(t){return ae("/api/settings/fps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:t})})},setHeight(t){return ae("/api/settings/height",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:t})})},setMass(t){return ae("/api/settings/mass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:t})})},startRecording(){return ae("/api/recording/start",{method:"POST"})},stopRecording(){return ae("/api/recording/stop",{method:"POST"})},startCalibration(){return ae("/api/calibration/start",{method:"POST"})},calibrationStatus(){return ae("/api/calibration/status")},startAnalysis(){return ae("/api/analysis/start",{method:"POST"})},analysisStatus(){return ae("/api/analysis/status")},analysisResults(){return ae("/api/analysis/results")},pauseAnalysis(){return ae("/api/analysis/pause",{method:"POST"})},resumeAnalysis(){return ae("/api/analysis/resume",{method:"POST"})},stopAnalysis(){return ae("/api/analysis/stop",{method:"POST"})},videoFrame(){return ae("/api/video/frame")},analysisData(){return ae("/api/analysis/data")}};function sn(t){let e;return{c(){e=r("div"),e.innerHTML='<svg class="w-24 h-24 mx-auto text-slate-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> <p class="text-slate-400 text-lg">Nessun video caricato</p> <p class="text-slate-500 text-sm mt-2">Carica o registra un video per iniziare</p>',a(e,"class","text-center p-8")},m(l,n){E(l,e,n)},p:H,d(l){l&&P(e)}}}function an(t){let e,l,n,s,u,g,c,o=t[4].isRecording&&Zt(),f=t[4].isAnalyzing&&Qt(),h=t[4].isCalibrating&&Xt(),b=t[0]&&!t[4].localVideoUrl&&$t(t);return{c(){e=r("img"),n=_(),o&&o.c(),s=_(),f&&f.c(),u=_(),h&&h.c(),g=_(),b&&b.c(),c=at(),it(e.src,l=t[8])||a(e,"src",l),a(e,"alt","Video frame"),a(e,"class","w-full h-full max-w-full max-h-full object-contain")},m(p,m){E(p,e,m),E(p,n,m),o&&o.m(p,m),E(p,s,m),f&&f.m(p,m),E(p,u,m),h&&h.m(p,m),E(p,g,m),b&&b.m(p,m),E(p,c,m)},p(p,m){m&256&&!it(e.src,l=p[8])&&a(e,"src",l),p[4].isRecording?o||(o=Zt(),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null),p[4].isAnalyzing?f||(f=Qt(),f.c(),f.m(u.parentNode,u)):f&&(f.d(1),f=null),p[4].isCalibrating?h||(h=Xt(),h.c(),h.m(g.parentNode,g)):h&&(h.d(1),h=null),p[0]&&!p[4].localVideoUrl?b?b.p(p,m):(b=$t(p),b.c(),b.m(c.parentNode,c)):b&&(b.d(1),b=null)},d(p){p&&(P(e),P(n),P(s),P(u),P(g),P(c)),o&&o.d(p),f&&f.d(p),h&&h.d(p),b&&b.d(p)}}}function rn(t){let e,l;return{c(){e=r("video"),it(e.src,l=t[4].localVideoUrl)||a(e,"src",l),e.controls=!0,a(e,"class","w-full h-full object-contain")},m(n,s){E(n,e,s),t[12](e)},p(n,s){s&16&&!it(e.src,l=n[4].localVideoUrl)&&a(e,"src",l)},d(n){n&&P(e),t[12](null)}}}function on(t){let e;return{c(){e=r("video"),e.autoplay=!0,e.playsInline=!0,e.muted=!0,a(e,"class","w-full h-full object-contain")},m(l,n){E(l,e,n),t[11](e)},p:H,d(l){l&&P(e),t[11](null)}}}function Zt(t){let e;return{c(){e=r("div"),e.innerHTML='<div class="w-3 h-3 bg-white rounded-full animate-pulse svelte-1mb1g50"></div> <span class="text-white font-semibold text-sm">REC</span>',a(e,"class","absolute top-4 right-4 flex items-center gap-2 bg-red-600 px-4 py-2 rounded-full")},m(l,n){E(l,e,n)},d(l){l&&P(e)}}}function Qt(t){let e;return{c(){e=r("div"),e.innerHTML='<span class="text-white font-semibold text-sm">ANALYZING</span>',a(e,"class","absolute top-4 left-4 bg-green-600 px-4 py-2 rounded-full")},m(l,n){E(l,e,n)},d(l){l&&P(e)}}}function Xt(t){let e;return{c(){e=r("div"),e.innerHTML='<span class="text-white font-semibold text-sm">CALIBRATING</span>',a(e,"class","absolute top-4 left-4 bg-yellow-600 px-4 py-2 rounded-full")},m(l,n){E(l,e,n)},d(l){l&&P(e)}}}function $t(t){let e,l,n,s,u,g=`${t[2]+1} / ${Math.max(t[1],0)}`,c,o,f,h,b,p=t[5]&&el(t);return{c(){e=r("div"),l=r("input"),s=_(),u=r("div"),c=D(g),o=_(),p&&p.c(),f=at(),a(l,"type","range"),a(l,"min","0"),a(l,"max",n=Math.max(t[1]-1,0)),a(l,"class","w-64 md:w-96 accent-purple-500"),a(u,"class","text-slate-300 text-sm whitespace-nowrap"),a(e,"class","absolute bottom-4 left-1/2 -translate-x-1/2 bg-slate-900/80 backdrop-blur px-4 py-3 rounded-full border border-slate-700 flex items-center gap-4")},m(m,v){E(m,e,v),i(e,l),me(l,t[2]),i(e,s),i(e,u),i(u,c),E(m,o,v),p&&p.m(m,v),E(m,f,v),h||(b=[Q(l,"change",t[13]),Q(l,"input",t[13]),Q(l,"input",t[14])],h=!0)},p(m,v){v&2&&n!==(n=Math.max(m[1]-1,0))&&a(l,"max",n),v&4&&me(l,m[2]),v&6&&g!==(g=`${m[2]+1} / ${Math.max(m[1],0)}`)&&J(c,g),m[5]?p?p.p(m,v):(p=el(m),p.c(),p.m(f.parentNode,f)):p&&(p.d(1),p=null)},d(m){m&&(P(e),P(o),P(f)),p&&p.d(m),h=!1,de(b)}}}function el(t){let e,l;return{c(){e=r("div"),l=D(t[5]),a(e,"class","absolute bottom-16 left-1/2 -translate-x-1/2 bg-red-600/80 text-white text-xs px-3 py-1 rounded")},m(n,s){E(n,e,s),i(e,l)},p(n,s){s&32&&J(l,n[5])},d(n){n&&P(e)}}}function cn(t){let e,l,n,s;function u(o,f){return o[4].isCameraPreview&&o[4].previewStream?on:o[0]&&o[4].localVideoUrl?rn:o[8]?an:sn}let g=u(t),c=g(t);return{c(){e=r("div"),l=r("div"),l.innerHTML='<h2 class="text-xl font-semibold text-white">Anteprima Video</h2>',n=_(),s=r("div"),c.c(),a(l,"class","video-header bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4"),a(s,"class","video-content aspect-video bg-black flex items-center justify-center relative"),a(s,"data-reflow",t[7]),a(e,"class","video-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700")},m(o,f){E(o,e,f),i(e,l),i(e,n),i(e,s),c.m(s,null),t[15](e)},p(o,[f]){g===(g=u(o))&&c?c.p(o,f):(c.d(1),c=g(o),c&&(c.c(),c.m(s,null))),f&128&&a(s,"data-reflow",o[7])},i:H,o:H,d(o){o&&P(e),c.d(),t[15](null)}}}function fn(t,e,l){let n,s;st(t,K,C=>l(4,s=C));let{analysisCompleted:u=!1}=e,g=0,c=0,o=!1,f="",h,b,p,m,v=0,x;async function d(){try{const w=await(await fetch(`${le()}/api/video/info`)).json();w&&w.success&&(l(1,g=w.total_frames||0),l(10,o=!0))}catch{}}async function S(C){l(5,f="");try{const j=await(await fetch(`${le()}/api/video/frame_at?index=${C}`)).json();j&&j.success?(l(2,c=j.index),Kt(j.frame)):j&&j.error&&l(5,f=j.error)}catch{l(5,f="Errore caricamento frame")}finally{}}function A(C){!u||g<=0||(h&&clearTimeout(h),h=setTimeout(()=>{S(C)},50))}function T(){l(7,v++,v)}xt(()=>{if(s.isCameraPreview&&s.previewStream&&x)try{l(3,x.srcObject=s.previewStream,x)}catch{}typeof window<"u"&&"ResizeObserver"in window?(p=new ResizeObserver(()=>{T()}),b&&p.observe(b)):typeof window<"u"&&window.addEventListener("resize",T),m=()=>{T(),setTimeout(T,50),setTimeout(T,150)},typeof document<"u"&&(document.addEventListener("fullscreenchange",m),document.addEventListener("webkitfullscreenchange",m),document.addEventListener("mozfullscreenchange",m),document.addEventListener("MSFullscreenChange",m))}),qt(()=>{p&&b&&p.unobserve(b),p&&p.disconnect(),typeof window<"u"&&window.removeEventListener("resize",T),typeof document<"u"&&m&&(document.removeEventListener("fullscreenchange",m),document.removeEventListener("webkitfullscreenchange",m),document.removeEventListener("mozfullscreenchange",m),document.removeEventListener("MSFullscreenChange",m))});function I(C){pe[C?"unshift":"push"](()=>{x=C,l(3,x),l(4,s)})}function z(C){pe[C?"unshift":"push"](()=>{x=C,l(3,x),l(4,s)})}function M(){c=we(this.value),l(2,c)}const k=C=>A(+C.target.value);function L(C){pe[C?"unshift":"push"](()=>{b=C,l(6,b)})}return t.$$set=C=>{"analysisCompleted"in C&&l(0,u=C.analysisCompleted)},t.$$.update=()=>{if(t.$$.dirty&16&&l(8,n=s.videoFrame?`data:image/jpeg;base64,${s.videoFrame}`:null),t.$$.dirty&1031&&(async()=>u&&!o&&(await d(),g>0&&await S(c)))(),t.$$.dirty&24&&s.isCameraPreview&&s.previewStream&&x)try{l(3,x.srcObject=s.previewStream,x)}catch{}},[u,g,c,x,s,f,b,v,n,A,o,I,z,M,k,L]}class un extends qe{constructor(e){super(),Je(this,e,fn,cn,Ae,{analysisCompleted:0})}}async function dn(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("API mediaDevices non disponibile");let t=null;try{t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}catch{}try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput")}finally{if(t)try{t.getTracks().forEach(e=>e.stop())}catch{}}}async function pn(t,e){const l=Array.isArray(e)?e:[],n=l[t]||l[0];return n&&n.deviceId?await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:n.deviceId}},audio:!1}):await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}function Mt(t){var e;try{(e=t==null?void 0:t.getTracks())==null||e.forEach(l=>l.stop())}catch{}}function tl(t,e,l){const n=t.slice();return n[10]=e[l],n[12]=l,n}function ll(t){let e,l,n,s,u,g,c,o,f,h,b,p,m,v,x,d,S,A,T=t[4]&&nl(t);function I(k,L){return k[2]?hn:k[3].length>0?bn:mn}let z=I(t),M=z(t);return{c(){e=r("div"),l=r("div"),n=r("div"),s=r("h4"),s.textContent="Seleziona fotocamera",u=_(),g=r("button"),g.textContent="✕",c=_(),o=r("div"),T&&T.c(),f=_(),M.c(),h=_(),b=r("div"),p=r("button"),p.textContent="Annulla",m=_(),v=r("button"),x=D("Conferma e anteprima"),a(s,"class","text-white font-semibold"),a(g,"class","text-slate-300 hover:text-white"),a(n,"class","px-6 py-4 border-b border-slate-700 flex items-center justify-between"),a(o,"class","p-6 space-y-4"),a(p,"class","btn-secondary"),a(v,"class","btn-primary"),v.disabled=d=t[2]||t[3].length===0,a(b,"class","px-6 py-4 border-t border-slate-700 flex gap-2 justify-end"),a(l,"class","bg-slate-800 border border-slate-700 rounded-xl w-full max-w-md shadow-2xl"),a(e,"class","fixed inset-0 z-50 flex items-center justify-center bg-black/60")},m(k,L){E(k,e,L),i(e,l),i(l,n),i(n,s),i(n,u),i(n,g),i(l,c),i(l,o),T&&T.m(o,null),i(o,f),M.m(o,null),i(l,h),i(l,b),i(b,p),i(b,m),i(b,v),i(v,x),S||(A=[Q(g,"click",t[5]),Q(p,"click",t[5]),Q(v,"click",t[6])],S=!0)},p(k,L){k[4]?T?T.p(k,L):(T=nl(k),T.c(),T.m(o,f)):T&&(T.d(1),T=null),z===(z=I(k))&&M?M.p(k,L):(M.d(1),M=z(k),M&&(M.c(),M.m(o,null))),L&12&&d!==(d=k[2]||k[3].length===0)&&(v.disabled=d)},d(k){k&&P(e),T&&T.d(),M.d(),S=!1,de(A)}}}function nl(t){let e,l;return{c(){e=r("div"),l=D(t[4]),a(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-3 text-red-300 text-sm")},m(n,s){E(n,e,s),i(e,l)},p(n,s){s&16&&J(l,n[4])},d(n){n&&P(e)}}}function mn(t){let e;return{c(){e=r("p"),e.textContent="Nessuna fotocamera disponibile.",a(e,"class","text-slate-400")},m(l,n){E(l,e,n)},p:H,d(l){l&&P(e)}}}function bn(t){let e,l,n,s,u,g=Yt(t[3]),c=[];for(let o=0;o<g.length;o+=1)c[o]=il(tl(t,g,o));return{c(){e=r("label"),e.textContent="Fotocamera",l=_(),n=r("select");for(let o=0;o<c.length;o+=1)c[o].c();a(e,"for","camera-select"),a(e,"class","block text-sm font-medium text-slate-300 mb-2"),a(n,"id","camera-select"),a(n,"class","input-field"),t[0]===void 0&&rt(()=>t[8].call(n))},m(o,f){E(o,e,f),E(o,l,f),E(o,n,f);for(let h=0;h<c.length;h+=1)c[h]&&c[h].m(n,null);Jt(n,t[0],!0),s||(u=[Q(n,"change",t[7]),Q(n,"change",t[8])],s=!0)},p(o,f){if(f&8){g=Yt(o[3]);let h;for(h=0;h<g.length;h+=1){const b=tl(o,g,h);c[h]?c[h].p(b,f):(c[h]=il(b),c[h].c(),c[h].m(n,null))}for(;h<c.length;h+=1)c[h].d(1);c.length=g.length}f&1&&Jt(n,o[0])},d(o){o&&(P(e),P(l),P(n)),Nl(c,o),s=!1,de(u)}}}function hn(t){let e;return{c(){e=r("p"),e.textContent="Caricamento fotocamere...",a(e,"class","text-slate-300")},m(l,n){E(l,e,n)},p:H,d(l){l&&P(e)}}}function il(t){let e,l=(t[10].label||`Camera ${t[12]}`)+"",n;return{c(){e=r("option"),n=D(l),e.__value=t[12],me(e,e.__value)},m(s,u){E(s,e,u),i(e,n)},p(s,u){u&8&&l!==(l=(s[10].label||`Camera ${s[12]}`)+"")&&J(n,l)},d(s){s&&P(e)}}}function gn(t){let e,l=t[1]&&ll(t);return{c(){l&&l.c(),e=at()},m(n,s){l&&l.m(n,s),E(n,e,s)},p(n,[s]){n[1]?l?l.p(n,s):(l=ll(n),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},i:H,o:H,d(n){n&&P(e),l&&l.d(n)}}}function vn(t,e,l){let{show:n=!1}=e,{loading:s=!1}=e,{cameras:u=[]}=e,{selectedIndex:g=null}=e,{error:c=""}=e;const o=Ct();function f(){o("close")}function h(){o("confirm")}function b(m){const v=Number(m.target.value);o("select",{index:v})}function p(){g=Hl(this),l(0,g)}return t.$$set=m=>{"show"in m&&l(1,n=m.show),"loading"in m&&l(2,s=m.loading),"cameras"in m&&l(3,u=m.cameras),"selectedIndex"in m&&l(0,g=m.selectedIndex),"error"in m&&l(4,c=m.error)},[g,n,s,u,c,f,h,b,p]}class _n extends qe{constructor(e){super(),Je(this,e,vn,gn,Ae,{show:1,loading:2,cameras:3,selectedIndex:0,error:4})}}function sl(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
          Indietro`,a(e,"class","bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2")},m(s,u){E(s,e,u),l||(n=Q(e,"click",t[23]),l=!0)},p:H,d(s){s&&P(e),l=!1,n()}}}function al(t){let e,l,n;return{c(){e=r("div"),l=r("p"),n=D(t[5]),a(l,"class","text-red-400 text-sm"),a(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-4")},m(s,u){E(s,e,u),i(e,l),i(l,n)},p(s,u){u[0]&32&&J(n,s[5])},d(s){s&&P(e)}}}function rl(t){let e,l,n=t[13].inputMode==="camera"?"1. Registra Video":"1. Carica o Registra Video",s,u,g,c=t[13].inputMode!=="camera"&&ol(t);function o(b,p){return b[13].isRecording?wn:yn}let f=o(t),h=f(t);return{c(){e=r("div"),l=r("h3"),s=D(n),u=_(),c&&c.c(),g=_(),h.c(),a(l,"class","text-lg font-semibold text-white mb-4"),a(e,"class","space-y-4")},m(b,p){E(b,e,p),i(e,l),i(l,s),i(e,u),c&&c.m(e,null),i(e,g),h.m(e,null)},p(b,p){p[0]&8192&&n!==(n=b[13].inputMode==="camera"?"1. Registra Video":"1. Carica o Registra Video")&&J(s,n),b[13].inputMode!=="camera"?c?c.p(b,p):(c=ol(b),c.c(),c.m(e,g)):c&&(c.d(1),c=null),f===(f=o(b))&&h?h.p(b,p):(h.d(1),h=f(b),h&&(h.c(),h.m(e,null)))},d(b){b&&P(e),c&&c.d(),h.d()}}}function ol(t){let e,l,n,s,u,g,c,o,f=t[1]?"Caricamento...":"Carica Video",h,b,p,m,v,x;return{c(){e=r("label"),l=r("input"),s=_(),u=r("div"),g=Te("svg"),c=Te("path"),o=_(),h=D(f),p=_(),m=r("div"),m.textContent="oppure",a(l,"type","file"),a(l,"accept","video/*"),l.disabled=n=t[1]||t[13].isRecording,a(l,"class","hidden"),a(c,"stroke-linecap","round"),a(c,"stroke-linejoin","round"),a(c,"stroke-width","2"),a(c,"d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"),a(g,"class","w-5 h-5 inline mr-2"),a(g,"fill","none"),a(g,"stroke","currentColor"),a(g,"viewBox","0 0 24 24"),a(u,"class",b="btn-primary cursor-pointer text-center "+(t[1]?"opacity-50":"")),a(e,"class","block"),a(m,"class","text-center text-slate-400 text-sm")},m(d,S){E(d,e,S),i(e,l),i(e,s),i(e,u),i(u,g),i(g,c),i(u,o),i(u,h),E(d,p,S),E(d,m,S),v||(x=Q(l,"change",t[14]),v=!0)},p(d,S){S[0]&8194&&n!==(n=d[1]||d[13].isRecording)&&(l.disabled=n),S[0]&2&&f!==(f=d[1]?"Caricamento...":"Carica Video")&&J(h,f),S[0]&2&&b!==(b="btn-primary cursor-pointer text-center "+(d[1]?"opacity-50":""))&&a(u,"class",b)},d(d){d&&(P(e),P(p),P(m)),v=!1,x()}}}function wn(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12"></rect></svg>
            Ferma Registrazione`,a(e,"class","btn-danger w-full")},m(s,u){E(s,e,u),l||(n=Q(e,"click",t[18]),l=!0)},p:H,d(s){s&&P(e),l=!1,n()}}}function yn(t){let e,l,n,s,u=t[13].inputMode==="camera"?"Cambia Telecamera":"Registra Video",g,c,o,f,h,b,p=t[13].isCameraPreview&&cl(t),m=t[13].isCameraPreview&&fl();return{c(){e=r("button"),l=Te("svg"),n=Te("path"),s=_(),g=D(u),c=_(),p&&p.c(),o=_(),m&&m.c(),f=at(),a(n,"stroke-linecap","round"),a(n,"stroke-linejoin","round"),a(n,"stroke-width","2"),a(n,"d","M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"),a(l,"class","w-5 h-5 inline mr-2"),a(l,"fill","none"),a(l,"stroke","currentColor"),a(l,"viewBox","0 0 24 24"),a(e,"class","btn-secondary w-full")},m(v,x){E(v,e,x),i(e,l),i(l,n),i(e,s),i(e,g),E(v,c,x),p&&p.m(v,x),E(v,o,x),m&&m.m(v,x),E(v,f,x),h||(b=Q(e,"click",t[16]),h=!0)},p(v,x){x[0]&8192&&u!==(u=v[13].inputMode==="camera"?"Cambia Telecamera":"Registra Video")&&J(g,u),v[13].isCameraPreview?p?p.p(v,x):(p=cl(v),p.c(),p.m(o.parentNode,o)):p&&(p.d(1),p=null),v[13].isCameraPreview?m||(m=fl(),m.c(),m.m(f.parentNode,f)):m&&(m.d(1),m=null)},d(v){v&&(P(e),P(c),P(o),P(f)),p&&p.d(v),m&&m.d(v),h=!1,b()}}}function cl(t){let e,l,n;return{c(){e=r("button"),e.textContent="Analizza Video",a(e,"class","btn-primary w-full mt-3")},m(s,u){E(s,e,u),l||(n=Q(e,"click",t[15]),l=!0)},p:H,d(s){s&&P(e),l=!1,n()}}}function fl(t){let e;return{c(){e=r("div"),e.textContent='Anteprima fotocamera attiva. Premi "Analizza Video" per iniziare la registrazione, poi "Ferma Registrazione" al termine del salto.',a(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-3 text-blue-300 text-sm")},m(l,n){E(l,e,n)},d(l){l&&P(e)}}}function ul(t){let e,l,n,s,u,g,c,o,f,h,b,p,m,v,x,d,S,A,T,I,z,M,k,L,C,w=t[6]?"Calibrazione e Analisi in corso...":"Avvia Analisi",j,N,Z,ne,ie,O=t[6]&&dl();return{c(){e=r("div"),l=r("h3"),l.textContent="2. Calibrazione Sistema",n=_(),s=r("div"),u=r("label"),u.textContent="FPS Video",g=_(),c=r("input"),o=_(),f=r("p"),f.textContent="Frame per secondo del video",h=_(),b=r("div"),p=r("label"),p.textContent="Altezza Persona (cm)",m=_(),v=r("input"),x=_(),d=r("p"),d.textContent="Altezza reale della persona",S=_(),A=r("div"),T=r("label"),T.textContent="Massa Corporea (kg)",I=_(),z=r("input"),M=_(),k=r("p"),k.textContent="Peso della persona",L=_(),C=r("button"),j=D(w),Z=_(),O&&O.c(),a(l,"class","text-lg font-semibold text-white mb-4"),a(u,"for","fps-input"),a(u,"class","block text-sm font-medium text-slate-300 mb-2"),a(c,"id","fps-input"),a(c,"type","number"),a(c,"min","1"),a(c,"max","240"),c.disabled=t[6],a(c,"class","input-field"),a(f,"class","text-slate-500 text-xs mt-1"),a(p,"for","height-input"),a(p,"class","block text-sm font-medium text-slate-300 mb-2"),a(v,"id","height-input"),a(v,"type","number"),a(v,"min","100"),a(v,"max","250"),v.disabled=t[6],a(v,"class","input-field"),a(d,"class","text-slate-500 text-xs mt-1"),a(T,"for","mass-input"),a(T,"class","block text-sm font-medium text-slate-300 mb-2"),a(z,"id","mass-input"),a(z,"type","number"),a(z,"min","40"),a(z,"max","150"),z.disabled=t[6],a(z,"class","input-field"),a(k,"class","text-slate-500 text-xs mt-1"),C.disabled=t[6],a(C,"class",N="btn-primary w-full "+(t[6]?"opacity-50":"")),a(e,"class","space-y-4")},m(V,q){E(V,e,q),i(e,l),i(e,n),i(e,s),i(s,u),i(s,g),i(s,c),me(c,t[2]),i(s,o),i(s,f),i(e,h),i(e,b),i(b,p),i(b,m),i(b,v),me(v,t[3]),i(b,x),i(b,d),i(e,S),i(e,A),i(A,T),i(A,I),i(A,z),me(z,t[4]),i(A,M),i(A,k),i(e,L),i(e,C),i(C,j),i(e,Z),O&&O.m(e,null),ne||(ie=[Q(c,"input",t[28]),Q(v,"input",t[29]),Q(z,"input",t[30]),Q(C,"click",t[24])],ne=!0)},p(V,q){q[0]&64&&(c.disabled=V[6]),q[0]&4&&we(c.value)!==V[2]&&me(c,V[2]),q[0]&64&&(v.disabled=V[6]),q[0]&8&&we(v.value)!==V[3]&&me(v,V[3]),q[0]&64&&(z.disabled=V[6]),q[0]&16&&we(z.value)!==V[4]&&me(z,V[4]),q[0]&64&&w!==(w=V[6]?"Calibrazione e Analisi in corso...":"Avvia Analisi")&&J(j,w),q[0]&64&&(C.disabled=V[6]),q[0]&64&&N!==(N="btn-primary w-full "+(V[6]?"opacity-50":""))&&a(C,"class",N),V[6]?O||(O=dl(),O.c(),O.m(e,null)):O&&(O.d(1),O=null)},d(V){V&&P(e),O&&O.d(),ne=!1,de(ie)}}}function dl(t){let e;return{c(){e=r("div"),e.innerHTML='<p class="text-blue-400 text-sm">Sistema in calibrazione. Assicurati che la persona sia in posizione eretta nel frame.</p>',a(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-4")},m(l,n){E(l,e,n)},d(l){l&&P(e)}}}function pl(t){var be,xe,Ye,ve;let e,l,n,s,u,g,c,o,f,h,b,p,m=(((be=t[13].realtimeData)==null?void 0:be.current_height)??0)+"",v,x,d,S,A,T,I,z=(((xe=t[13].realtimeData)==null?void 0:xe.max_height)??0)+"",M,k,L,C,w,j,N,Z=(((Ye=t[13].realtimeData)==null?void 0:Ye.takeoff_velocity)??0)+"",ne,ie,O,V,q,ee,W,G=(((ve=t[13].realtimeData)==null?void 0:ve.estimated_power)??0)+"",X,R,$;function y(te,fe){return te[7]?kn:xn}let U=y(t),F=U(t),B=t[7]&&ml(t);return{c(){e=r("div"),l=r("h3"),l.textContent="3. Analisi Salto",n=_(),F.c(),s=_(),u=r("div"),g=r("h4"),g.textContent="Dati in Tempo Reale",c=_(),o=r("div"),f=r("div"),h=r("p"),h.textContent="Altezza Corrente",b=_(),p=r("p"),v=D(m),x=D(" cm"),d=_(),S=r("div"),A=r("p"),A.textContent="Altezza Max",T=_(),I=r("p"),M=D(z),k=D(" cm"),L=_(),C=r("div"),w=r("p"),w.textContent="Velocità Decollo",j=_(),N=r("p"),ne=D(Z),ie=D(" cm/s"),O=_(),V=r("div"),q=r("p"),q.textContent="Potenza Est.",ee=_(),W=r("p"),X=D(G),R=D(" W"),$=_(),B&&B.c(),a(l,"class","text-lg font-semibold text-white mb-4"),a(g,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3"),a(h,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(p,"class","text-xl font-bold text-blue-400"),a(f,"class","text-center"),a(A,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(I,"class","text-xl font-bold text-green-400"),a(S,"class","text-center"),a(w,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(N,"class","text-xl font-bold text-purple-400"),a(C,"class","text-center"),a(q,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(W,"class","text-xl font-bold text-yellow-400"),a(V,"class","text-center"),a(o,"class","grid grid-cols-2 gap-3"),a(u,"class","bg-slate-900/50 rounded-xl p-4 border border-slate-700"),a(e,"class","space-y-4")},m(te,fe){E(te,e,fe),i(e,l),i(e,n),F.m(e,null),i(e,s),i(e,u),i(u,g),i(u,c),i(u,o),i(o,f),i(f,h),i(f,b),i(f,p),i(p,v),i(p,x),i(o,d),i(o,S),i(S,A),i(S,T),i(S,I),i(I,M),i(I,k),i(o,L),i(o,C),i(C,w),i(C,j),i(C,N),i(N,ne),i(N,ie),i(o,O),i(o,V),i(V,q),i(V,ee),i(V,W),i(W,X),i(W,R),i(e,$),B&&B.m(e,null)},p(te,fe){var Ke,Ze,he,Ce;U===(U=y(te))&&F?F.p(te,fe):(F.d(1),F=U(te),F&&(F.c(),F.m(e,s))),fe[0]&8192&&m!==(m=(((Ke=te[13].realtimeData)==null?void 0:Ke.current_height)??0)+"")&&J(v,m),fe[0]&8192&&z!==(z=(((Ze=te[13].realtimeData)==null?void 0:Ze.max_height)??0)+"")&&J(M,z),fe[0]&8192&&Z!==(Z=(((he=te[13].realtimeData)==null?void 0:he.takeoff_velocity)??0)+"")&&J(ne,Z),fe[0]&8192&&G!==(G=(((Ce=te[13].realtimeData)==null?void 0:Ce.estimated_power)??0)+"")&&J(X,G),te[7]?B?B.p(te,fe):(B=ml(te),B.c(),B.m(e,null)):B&&(B.d(1),B=null)},d(te){te&&P(e),F.d(),B&&B.d()}}}function kn(t){let e;return{c(){e=r("div"),e.innerHTML='<p class="text-green-400 text-sm font-medium">Analisi in corso...</p> <p class="text-slate-400 text-xs mt-1">Il sistema sta elaborando il salto</p>',a(e,"class","bg-green-500/10 border border-green-500/50 rounded-lg p-4")},m(l,n){E(l,e,n)},p:H,d(l){l&&P(e)}}}function xn(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            Avvia Analisi`,a(e,"class","btn-primary w-full")},m(s,u){E(s,e,u),l||(n=Q(e,"click",t[19]),l=!0)},p:H,d(s){s&&P(e),l=!1,n()}}}function ml(t){let e,l,n,s,u;function g(f,h){return f[13].isPaused?Sn:Cn}let c=g(t),o=c(t);return{c(){e=r("div"),o.c(),l=_(),n=r("button"),n.textContent="Annulla",a(n,"class","btn-danger flex-1"),a(e,"class","flex gap-2")},m(f,h){E(f,e,h),o.m(e,null),i(e,l),i(e,n),s||(u=Q(n,"click",t[22]),s=!0)},p(f,h){c===(c=g(f))&&o?o.p(f,h):(o.d(1),o=c(f),o&&(o.c(),o.m(e,l)))},d(f){f&&P(e),o.d(),s=!1,u()}}}function Cn(t){let e,l,n;return{c(){e=r("button"),e.textContent="Pausa",a(e,"class","btn-secondary flex-1")},m(s,u){E(s,e,u),l||(n=Q(e,"click",t[20]),l=!0)},p:H,d(s){s&&P(e),l=!1,n()}}}function Sn(t){let e,l,n;return{c(){e=r("button"),e.textContent="Riprendi",a(e,"class","btn-secondary flex-1")},m(s,u){E(s,e,u),l||(n=Q(e,"click",t[21]),l=!0)},p:H,d(s){s&&P(e),l=!1,n()}}}function An(t){let e,l,n,s,u,g,c,o,f,h,b,p,m,v,x,d,S,A,T,I,z,M,k,L,C,w,j,N,Z,ne,ie,O=(t[0]>1||t[13].isCameraPreview)&&sl(t);function V(R){t[25](R)}let q={show:t[8],loading:t[11],cameras:t[9],error:t[12]};t[10]!==void 0&&(q.selectedIndex=t[10]),v=new _n({props:q}),pe.push(()=>Zl(v,"selectedIndex",V)),v.$on("close",t[26]),v.$on("confirm",t[17]),v.$on("select",t[27]);let ee=t[5]&&al(t),W=t[0]===1&&rl(t),G=t[0]===2&&ul(t),X=t[0]===3&&pl(t);return{c(){e=r("div"),l=r("div"),n=r("div"),s=r("div"),u=r("h2"),u.textContent="Step Holder",g=_(),c=r("p"),o=D("Step "),f=D(t[0]),h=D(" di 3"),b=_(),O&&O.c(),p=_(),m=r("div"),ct(v.$$.fragment),d=_(),ee&&ee.c(),S=_(),W&&W.c(),A=_(),G&&G.c(),T=_(),X&&X.c(),I=_(),z=r("div"),M=r("div"),k=r("span"),k.textContent="Progresso",L=_(),C=r("span"),w=D(t[0]),j=D("/3"),N=_(),Z=r("div"),ne=r("div"),a(u,"class","text-xl font-semibold text-white"),a(c,"class","text-purple-100 text-sm mt-1"),a(n,"class","flex justify-between items-center"),a(l,"class","step-header bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-4"),a(k,"class","text-xs text-slate-400"),a(C,"class","text-xs text-slate-400"),a(M,"class","flex justify-between items-center mb-2"),a(ne,"class","bg-gradient-to-r from-purple-600 to-pink-600 h-2 rounded-full transition-all duration-300"),Wt(ne,"width",t[0]/3*100+"%"),a(Z,"class","w-full bg-slate-700 rounded-full h-2"),a(z,"class","mt-8 pt-6 border-t border-slate-700"),a(m,"class","step-content p-6 space-y-6 flex-1 overflow-auto svelte-10imy5p"),a(e,"class","step-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 h-full flex flex-col")},m(R,$){E(R,e,$),i(e,l),i(l,n),i(n,s),i(s,u),i(s,g),i(s,c),i(c,o),i(c,f),i(c,h),i(n,b),O&&O.m(n,null),i(e,p),i(e,m),Be(v,m,null),i(m,d),ee&&ee.m(m,null),i(m,S),W&&W.m(m,null),i(m,A),G&&G.m(m,null),i(m,T),X&&X.m(m,null),i(m,I),i(m,z),i(z,M),i(M,k),i(M,L),i(M,C),i(C,w),i(C,j),i(z,N),i(z,Z),i(Z,ne),ie=!0},p(R,$){(!ie||$[0]&1)&&J(f,R[0]),R[0]>1||R[13].isCameraPreview?O?O.p(R,$):(O=sl(R),O.c(),O.m(n,null)):O&&(O.d(1),O=null);const y={};$[0]&256&&(y.show=R[8]),$[0]&2048&&(y.loading=R[11]),$[0]&512&&(y.cameras=R[9]),$[0]&4096&&(y.error=R[12]),!x&&$[0]&1024&&(x=!0,y.selectedIndex=R[10],Jl(()=>x=!1)),v.$set(y),R[5]?ee?ee.p(R,$):(ee=al(R),ee.c(),ee.m(m,S)):ee&&(ee.d(1),ee=null),R[0]===1?W?W.p(R,$):(W=rl(R),W.c(),W.m(m,A)):W&&(W.d(1),W=null),R[0]===2?G?G.p(R,$):(G=ul(R),G.c(),G.m(m,T)):G&&(G.d(1),G=null),R[0]===3?X?X.p(R,$):(X=pl(R),X.c(),X.m(m,I)):X&&(X.d(1),X=null),(!ie||$[0]&1)&&J(w,R[0]),(!ie||$[0]&1)&&Wt(ne,"width",R[0]/3*100+"%")},i(R){ie||(ke(v.$$.fragment,R),ie=!0)},o(R){Me(v.$$.fragment,R),ie=!1},d(R){R&&P(e),O&&O.d(),We(v),ee&&ee.d(),W&&W.d(),G&&G.d(),X&&X.d()}}}function Tn(t,e,l){let n;st(t,K,y=>l(13,n=y));let{currentStep:s=1}=e;const u=Ct();let g=null,c=!1,o=30,f=170,h=70,b="",p=!1,m=!1,v=!1,x=[],d=null,S=!1,A="";async function T(y){if(g=y.target.files[0],g){try{const U=URL.createObjectURL(g);tn(U)}catch{}Et("upload"),await I()}}async function I(){if(!g)return;l(1,c=!0),l(5,b="");const y=new FormData;y.append("video",g);try{const F=await(await fetch(`${le()}/api/video/upload`,{method:"POST",body:y})).json();F.success?(l(2,o=Math.round(F.fps)||30),u("stepComplete",{step:1,data:F})):l(5,b=F.error||"Errore caricamento video")}catch{l(5,b="Errore di connessione al server")}finally{l(1,c=!1)}}async function z(){try{if(d!=null)try{await Ge.setCamera(Number(d))}catch{l(5,b="Errore impostazione fotocamera");return}try{Mt(n.previewStream)}catch{}zt(),Pt(!1);const y=await Ge.startRecording();y.success?K.update(U=>({...U,isRecording:!0})):l(5,b=y.error||"Errore avvio registrazione")}catch{l(5,b="Errore di connessione al server")}}function M(){l(12,A=""),l(8,v=!0),k()}async function k(){l(11,S=!0),l(9,x=[]),l(10,d=null);try{const y=await dn();y.length>0?(l(9,x=y),l(10,d=0)):l(12,A="Nessuna fotocamera trovata")}catch{l(12,A="Errore rilevamento fotocamere")}finally{l(11,S=!1)}}async function L(){if(l(12,A=""),d==null){l(12,A="Seleziona una fotocamera");return}try{l(8,v=!1);try{Mt(n.previewStream);const y=await pn(Number(d),x);ln(y),Pt(!0),Et("camera")}catch{l(12,A="Impossibile avviare l'anteprima fotocamera")}}catch{l(12,A="Errore apertura anteprima")}}async function C(){try{const U=await(await fetch(`${le()}/api/recording/stop`,{method:"POST"})).json();U.success&&(K.update(F=>({...F,isRecording:!1})),u("stepComplete",{step:1,data:U}))}catch{l(5,b="Errore stop registrazione")}}async function w(){l(5,b="");try{const y=await fetch(`${le()}/api/video/info`).then(U=>U.json());if(!(y!=null&&y.video_path)){l(5,b="Nessun video disponibile: registra o carica prima il video.");return}}catch{l(5,b="Errore verifica video disponibile");return}try{const y=await Ge.startAnalysis();y.success?(l(7,m=!0),K.update(U=>({...U,isAnalyzing:!0})),j()):l(5,b=y.error||"Errore avvio analisi")}catch{l(5,b="Errore di connessione")}}async function j(){const y=setInterval(async()=>{try{if(!(await Ge.analysisStatus()).is_analyzing){clearInterval(y);const F=await Ge.analysisResults();F.success&&(l(7,m=!1),K.update(B=>({...B,isAnalyzing:!1})),u("stepComplete",{step:3,data:{...F.results,trajectory:F.trajectory,velocity:F.velocity}}))}}catch{}},500)}async function N(){try{await fetch(`${le()}/api/analysis/pause`,{method:"POST"}),K.update(y=>({...y,isPaused:!0}))}catch{}}async function Z(){try{await fetch(`${le()}/api/analysis/resume`,{method:"POST"}),K.update(y=>({...y,isPaused:!1}))}catch{}}async function ne(){try{await fetch(`${le()}/api/analysis/stop`,{method:"POST"})}catch{}u("cancelToStep1")}function ie(){s===1&&n.isCameraPreview?O():u("goBack")}async function O(){try{Mt(n.previewStream)}catch{}zt(),Pt(!1),Et("none"),l(10,d=null)}async function V(){l(5,b="");try{await fetch(`${le()}/api/settings/fps`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:o})}),await fetch(`${le()}/api/settings/height`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:f})}),await fetch(`${le()}/api/settings/mass`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:h})})}catch{l(5,b="Errore impostazioni");return}try{const U=await(await fetch(`${le()}/api/calibration/start`,{method:"POST"})).json();U.success?(l(6,p=!0),K.update(F=>({...F,isCalibrating:!0})),q()):l(5,b=U.error||"Errore calibrazione")}catch{l(5,b="Errore di connessione")}}async function q(){const y=setInterval(async()=>{try{const F=await(await fetch(`${le()}/api/calibration/status`)).json();F.success&&!F.in_progress?(clearInterval(y),l(6,p=!1),K.update(B=>({...B,isCalibrating:!1})),u("stepComplete",{step:2,data:F}),await w()):F.success===!1&&!F.in_progress&&(clearInterval(y),l(6,p=!1),K.update(B=>({...B,isCalibrating:!1})),l(5,b="Calibrazione fallita"))}catch{clearInterval(y),l(6,p=!1),l(5,b="Errore verifica calibrazione")}},500)}function ee(y){d=y,l(10,d)}const W=()=>l(8,v=!1),G=y=>l(10,d=y.detail.index);function X(){o=we(this.value),l(2,o)}function R(){f=we(this.value),l(3,f)}function $(){h=we(this.value),l(4,h)}return t.$$set=y=>{"currentStep"in y&&l(0,s=y.currentStep)},[s,c,o,f,h,b,p,m,v,x,d,S,A,n,T,z,M,L,C,w,N,Z,ne,ie,V,ee,W,G,X,R,$]}class Pn extends qe{constructor(e){super(),Je(this,e,Tn,An,Ae,{currentStep:0},null,[-1,-1])}}function bl(t){let e,l,n,s;return{c(){e=r("div"),l=r("h3"),l.textContent="Traiettoria del Salto",n=_(),s=r("canvas"),a(l,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(s,"width","400"),a(s,"height","250"),a(s,"class","w-full rounded-lg"),a(e,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700")},m(u,g){E(u,e,g),i(e,l),i(e,n),i(e,s),t[8](s)},p:H,d(u){u&&P(e),t[8](null)}}}function hl(t){let e,l,n,s;return{c(){e=r("div"),l=r("h3"),l.textContent="Velocità nel Tempo",n=_(),s=r("canvas"),a(l,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(s,"width","400"),a(s,"height","250"),a(s,"class","w-full rounded-lg"),a(e,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700")},m(u,g){E(u,e,g),i(e,l),i(e,n),i(e,s),t[9](s)},p:H,d(u){u&&P(e),t[9](null)}}}function gl(t){let e,l,n;return{c(){e=r("div"),l=r("p"),n=D(t[4]),a(l,"class","text-blue-400 text-sm"),a(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-4")},m(s,u){E(s,e,u),i(e,l),i(l,n)},p(s,u){u&16&&J(n,s[4])},d(s){s&&P(e)}}}function zn(t){let e,l,n,s,u,g,c,o,f,h,b,p,m=t[0].max_height+"",v,x,d,S,A,T,I,z=t[0].flight_time+"",M,k,L,C,w,j,N,Z=t[0].takeoff_velocity+"",ne,ie,O,V,q,ee,W,G=t[0].estimated_power+"",X,R,$,y,U,F,B,be,xe,Ye,ve,te=t[0].contact_time+"",fe,Ke,Ze,he,Ce,_l,Qe,ft=t[0].eccentric_time+"",jt,wl,yl,De,ut,kl,Xe,dt=t[0].concentric_time+"",Dt,xl,Cl,Re,pt,Sl,$e,mt=t[0].fall_time+"",Rt,Al,Tl,Le,bt,Pl,Oe,Ie,ht,zl,et,gt=t[0].average_force+"",Lt,El,Ml,Ve,vt,jl,tt,_t=t[0].jump_detected?"Sì":"No",Ot,wt,Dl,It,Vt,Nt,Ne,ge,Se,Fe,Rl,yt=t[3]?"Salvataggio...":"Salva Risultati",Ft,Ll,lt,Ht,Ol,re=t[5].trajectoryData.length>0&&bl(t),oe=t[5].velocityData.length>0&&hl(t),ce=t[4]&&gl(t);return{c(){e=r("div"),l=r("div"),l.innerHTML='<h2 class="text-xl font-semibold text-white">Risultati Analisi</h2> <p class="text-green-100 text-sm mt-1">Analisi completata con successo</p>',n=_(),s=r("div"),u=r("div"),g=r("h3"),g.textContent="Metriche Principali",c=_(),o=r("div"),f=r("div"),h=r("p"),h.textContent="Altezza Max",b=_(),p=r("p"),v=D(m),x=D(" cm"),d=_(),S=r("div"),A=r("p"),A.textContent="Tempo di Volo",T=_(),I=r("p"),M=D(z),k=D(" s"),L=_(),C=r("div"),w=r("p"),w.textContent="Velocità Decollo",j=_(),N=r("p"),ne=D(Z),ie=D(" cm/s"),O=_(),V=r("div"),q=r("p"),q.textContent="Potenza Est.",ee=_(),W=r("p"),X=D(G),R=D(" W"),$=_(),y=r("div"),U=r("h3"),U.textContent="Analisi Fasi",F=_(),B=r("div"),be=r("div"),xe=r("span"),xe.textContent="Tempo Contatto",Ye=_(),ve=r("span"),fe=D(te),Ke=D(" s"),Ze=_(),he=r("div"),Ce=r("span"),Ce.textContent="Fase Eccentrica",_l=_(),Qe=r("span"),jt=D(ft),wl=D(" s"),yl=_(),De=r("div"),ut=r("span"),ut.textContent="Fase Concentrica",kl=_(),Xe=r("span"),Dt=D(dt),xl=D(" s"),Cl=_(),Re=r("div"),pt=r("span"),pt.textContent="Tempo Caduta",Sl=_(),$e=r("span"),Rt=D(mt),Al=D(" s"),Tl=_(),Le=r("div"),bt=r("h3"),bt.textContent="Parametri Biomeccanici",Pl=_(),Oe=r("div"),Ie=r("div"),ht=r("span"),ht.textContent="Forza Media",zl=_(),et=r("span"),Lt=D(gt),El=D(" N"),Ml=_(),Ve=r("div"),vt=r("span"),vt.textContent="Salto Rilevato",jl=_(),tt=r("span"),Ot=D(_t),Dl=_(),re&&re.c(),It=_(),oe&&oe.c(),Vt=_(),ce&&ce.c(),Nt=_(),Ne=r("div"),ge=r("button"),Se=Te("svg"),Fe=Te("path"),Rl=_(),Ft=D(yt),Ll=_(),lt=r("button"),lt.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        Nuova Analisi`,a(l,"class","results-header bg-gradient-to-r from-green-600 to-teal-600 px-6 py-4"),a(g,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(h,"class","text-xs text-slate-400 mb-1"),a(p,"class","text-2xl font-bold text-green-400"),a(A,"class","text-xs text-slate-400 mb-1"),a(I,"class","text-2xl font-bold text-blue-400"),a(w,"class","text-xs text-slate-400 mb-1"),a(N,"class","text-2xl font-bold text-purple-400"),a(q,"class","text-xs text-slate-400 mb-1"),a(W,"class","text-2xl font-bold text-yellow-400"),a(o,"class","grid grid-cols-2 gap-4"),a(u,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700"),a(U,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(xe,"class","text-sm text-slate-400"),a(ve,"class","text-lg font-semibold text-white"),a(be,"class","flex justify-between items-center"),a(Ce,"class","text-sm text-slate-400"),a(Qe,"class","text-lg font-semibold text-white"),a(he,"class","flex justify-between items-center"),a(ut,"class","text-sm text-slate-400"),a(Xe,"class","text-lg font-semibold text-white"),a(De,"class","flex justify-between items-center"),a(pt,"class","text-sm text-slate-400"),a($e,"class","text-lg font-semibold text-white"),a(Re,"class","flex justify-between items-center"),a(B,"class","space-y-3"),a(y,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700"),a(bt,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(ht,"class","text-sm text-slate-400"),a(et,"class","text-lg font-semibold text-white"),a(Ie,"class","flex justify-between items-center"),a(vt,"class","text-sm text-slate-400"),a(tt,"class",wt="text-lg font-semibold "+(t[0].jump_detected?"text-green-400":"text-red-400")),a(Ve,"class","flex justify-between items-center"),a(Oe,"class","space-y-3"),a(Le,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700"),a(Fe,"stroke-linecap","round"),a(Fe,"stroke-linejoin","round"),a(Fe,"stroke-width","2"),a(Fe,"d","M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"),a(Se,"class","w-5 h-5 inline mr-2"),a(Se,"fill","none"),a(Se,"stroke","currentColor"),a(Se,"viewBox","0 0 24 24"),ge.disabled=t[3],a(ge,"class","flex-1 bg-gradient-to-r from-green-600 to-teal-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-green-700 hover:to-teal-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"),a(lt,"class","flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl"),a(Ne,"class","flex gap-3 pt-4"),a(s,"class","results-content p-6 space-y-6 flex-1 overflow-auto svelte-dxhq61"),a(e,"class","results-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 h-full flex flex-col")},m(Y,se){E(Y,e,se),i(e,l),i(e,n),i(e,s),i(s,u),i(u,g),i(u,c),i(u,o),i(o,f),i(f,h),i(f,b),i(f,p),i(p,v),i(p,x),i(o,d),i(o,S),i(S,A),i(S,T),i(S,I),i(I,M),i(I,k),i(o,L),i(o,C),i(C,w),i(C,j),i(C,N),i(N,ne),i(N,ie),i(o,O),i(o,V),i(V,q),i(V,ee),i(V,W),i(W,X),i(W,R),i(s,$),i(s,y),i(y,U),i(y,F),i(y,B),i(B,be),i(be,xe),i(be,Ye),i(be,ve),i(ve,fe),i(ve,Ke),i(B,Ze),i(B,he),i(he,Ce),i(he,_l),i(he,Qe),i(Qe,jt),i(Qe,wl),i(B,yl),i(B,De),i(De,ut),i(De,kl),i(De,Xe),i(Xe,Dt),i(Xe,xl),i(B,Cl),i(B,Re),i(Re,pt),i(Re,Sl),i(Re,$e),i($e,Rt),i($e,Al),i(s,Tl),i(s,Le),i(Le,bt),i(Le,Pl),i(Le,Oe),i(Oe,Ie),i(Ie,ht),i(Ie,zl),i(Ie,et),i(et,Lt),i(et,El),i(Oe,Ml),i(Oe,Ve),i(Ve,vt),i(Ve,jl),i(Ve,tt),i(tt,Ot),i(s,Dl),re&&re.m(s,null),i(s,It),oe&&oe.m(s,null),i(s,Vt),ce&&ce.m(s,null),i(s,Nt),i(s,Ne),i(Ne,ge),i(ge,Se),i(Se,Fe),i(ge,Rl),i(ge,Ft),i(Ne,Ll),i(Ne,lt),Ht||(Ol=[Q(ge,"click",t[7]),Q(lt,"click",t[6])],Ht=!0)},p(Y,[se]){se&1&&m!==(m=Y[0].max_height+"")&&J(v,m),se&1&&z!==(z=Y[0].flight_time+"")&&J(M,z),se&1&&Z!==(Z=Y[0].takeoff_velocity+"")&&J(ne,Z),se&1&&G!==(G=Y[0].estimated_power+"")&&J(X,G),se&1&&te!==(te=Y[0].contact_time+"")&&J(fe,te),se&1&&ft!==(ft=Y[0].eccentric_time+"")&&J(jt,ft),se&1&&dt!==(dt=Y[0].concentric_time+"")&&J(Dt,dt),se&1&&mt!==(mt=Y[0].fall_time+"")&&J(Rt,mt),se&1&&gt!==(gt=Y[0].average_force+"")&&J(Lt,gt),se&1&&_t!==(_t=Y[0].jump_detected?"Sì":"No")&&J(Ot,_t),se&1&&wt!==(wt="text-lg font-semibold "+(Y[0].jump_detected?"text-green-400":"text-red-400"))&&a(tt,"class",wt),Y[5].trajectoryData.length>0?re?re.p(Y,se):(re=bl(Y),re.c(),re.m(s,It)):re&&(re.d(1),re=null),Y[5].velocityData.length>0?oe?oe.p(Y,se):(oe=hl(Y),oe.c(),oe.m(s,Vt)):oe&&(oe.d(1),oe=null),Y[4]?ce?ce.p(Y,se):(ce=gl(Y),ce.c(),ce.m(s,Nt)):ce&&(ce.d(1),ce=null),se&8&&yt!==(yt=Y[3]?"Salvataggio...":"Salva Risultati")&&J(Ft,yt),se&8&&(ge.disabled=Y[3])},i:H,o:H,d(Y){Y&&P(e),re&&re.d(),oe&&oe.d(),ce&&ce.d(),Ht=!1,de(Ol)}}}function En(t,e,l){let n;st(t,K,d=>l(5,n=d));let{results:s}=e;const u=Ct();let g,c;xt(()=>{g&&n.trajectoryData.length>0&&o(),c&&n.velocityData.length>0&&f()});function o(){const d=g.getContext("2d"),S=g.width,A=g.height;d.fillStyle="#1e293b",d.fillRect(0,0,S,A);const T=n.trajectoryData;if(T.length===0)return;const I=Math.max(...T.map(w=>w.t)),z=Math.max(...T.map(w=>w.y)),M=Math.min(...T.map(w=>w.y)),k=40,L=S-2*k,C=A-2*k;d.strokeStyle="#475569",d.lineWidth=2,d.beginPath(),d.moveTo(k,k),d.lineTo(k,A-k),d.lineTo(S-k,A-k),d.stroke(),d.strokeStyle="#334155",d.lineWidth=1;for(let w=0;w<=5;w++){const j=k+C*w/5;d.beginPath(),d.moveTo(k,j),d.lineTo(S-k,j),d.stroke()}d.strokeStyle="#3b82f6",d.lineWidth=3,d.beginPath(),T.forEach((w,j)=>{const N=k+w.t/I*L,Z=A-k-(w.y-M)/(z-M)*C;j===0?d.moveTo(N,Z):d.lineTo(N,Z)}),d.stroke(),d.fillStyle="#94a3b8",d.font="12px sans-serif",d.fillText("Tempo (s)",S/2-30,A-10),d.save(),d.translate(15,A/2),d.rotate(-Math.PI/2),d.fillText("Altezza (cm)",0,0),d.restore()}function f(){const d=c.getContext("2d"),S=c.width,A=c.height;d.fillStyle="#1e293b",d.fillRect(0,0,S,A);const T=n.velocityData;if(T.length===0)return;const I=Math.max(...T.map(w=>w.t)),z=Math.max(...T.map(w=>Math.abs(w.v))),M=40,k=S-2*M,L=A-2*M;d.strokeStyle="#475569",d.lineWidth=2,d.beginPath(),d.moveTo(M,M),d.lineTo(M,A-M),d.lineTo(S-M,A-M),d.stroke();const C=A-M-L/2;d.strokeStyle="#64748b",d.lineWidth=1,d.beginPath(),d.moveTo(M,C),d.lineTo(S-M,C),d.stroke(),d.strokeStyle="#a855f7",d.lineWidth=3,d.beginPath(),T.forEach((w,j)=>{const N=M+w.t/I*k,Z=C-w.v/z*(L/2);j===0?d.moveTo(N,Z):d.lineTo(N,Z)}),d.stroke(),d.fillStyle="#94a3b8",d.font="12px sans-serif",d.fillText("Tempo (s)",S/2-30,A-10),d.save(),d.translate(15,A/2),d.rotate(-Math.PI/2),d.fillText("Velocità (cm/s)",0,0),d.restore()}function h(){u("reset")}let b=!1,p="";async function m(){l(3,b=!0),l(4,p="");try{const S=await(await fetch(`${le()}/api/results/save`,{method:"POST"})).json();S.success?l(4,p="Risultati salvati con successo!"):l(4,p=S.error||"Errore durante il salvataggio")}catch{l(4,p="Errore di connessione al server")}finally{l(3,b=!1)}}function v(d){pe[d?"unshift":"push"](()=>{g=d,l(1,g)})}function x(d){pe[d?"unshift":"push"](()=>{c=d,l(2,c)})}return t.$$set=d=>{"results"in d&&l(0,s=d.results)},[s,g,c,b,p,n,h,m,v,x]}class Mn extends qe{constructor(e){super(),Je(this,e,En,zn,Ae,{results:0})}}function jn(t){let e,l;return e=new Mn({props:{results:t[2]}}),e.$on("reset",t[7]),{c(){ct(e.$$.fragment)},m(n,s){Be(e,n,s),l=!0},p(n,s){const u={};s&4&&(u.results=n[2]),e.$set(u)},i(n){l||(ke(e.$$.fragment,n),l=!0)},o(n){Me(e.$$.fragment,n),l=!1},d(n){We(e,n)}}}function Dn(t){let e,l;return e=new Pn({props:{currentStep:t[0]}}),e.$on("stepComplete",t[5]),e.$on("goBack",t[8]),e.$on("cancelToStep1",t[9]),{c(){ct(e.$$.fragment)},m(n,s){Be(e,n,s),l=!0},p(n,s){const u={};s&1&&(u.currentStep=n[0]),e.$set(u)},i(n){l||(ke(e.$$.fragment,n),l=!0)},o(n){Me(e.$$.fragment,n),l=!1},d(n){We(e,n)}}}function Rn(t){let e,l,n,s,u,g,c,o,f,h,b,p,m,v,x,d,S,A,T;p=new un({props:{analysisCompleted:t[1]}});const I=[Dn,jn],z=[];function M(k,L){return k[1]?1:0}return x=M(t),d=z[x]=I[x](t),{c(){e=r("main"),l=r("header"),n=r("div"),s=r("div"),u=r("h1"),u.textContent="Jump Analyzer Pro",g=_(),c=r("button"),c.textContent="Annulla Analisi",o=_(),f=r("div"),h=r("div"),b=r("div"),ct(p.$$.fragment),m=_(),v=r("div"),d.c(),a(u,"class","text-4xl font-bold text-white tracking-tight"),a(c,"class","bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold border border-red-500/50 shadow-md transition-colors"),a(s,"class","flex items-center justify-between"),a(n,"class","max-w-[1400px] mx-auto px-6 py-6"),a(l,"class","bg-slate-800/50 backdrop-blur-sm border-b border-slate-700"),a(b,"class","lg:col-span-2"),a(v,"class","lg:col-span-1"),a(h,"class","grid grid-cols-1 lg:grid-cols-3 gap-6"),a(f,"class","max-w-[1400px] mx-auto px-6 py-8"),a(e,"class","min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900")},m(k,L){E(k,e,L),i(e,l),i(l,n),i(n,s),i(s,u),i(s,g),i(s,c),i(e,o),i(e,f),i(f,h),i(h,b),Be(p,b,null),t[12](b),i(h,m),i(h,v),z[x].m(v,null),t[13](v),S=!0,A||(T=Q(c,"click",t[6]),A=!0)},p(k,[L]){const C={};L&2&&(C.analysisCompleted=k[1]),p.$set(C);let w=x;x=M(k),x===w?z[x].p(k,L):(Yl(),Me(z[w],1,1,()=>{z[w]=null}),Kl(),d=z[x],d?d.p(k,L):(d=z[x]=I[x](k),d.c()),ke(d,1),d.m(v,null))},i(k){S||(ke(p.$$.fragment,k),ke(d),S=!0)},o(k){Me(p.$$.fragment,k),Me(d),S=!1},d(k){k&&P(e),We(p),t[12](null),z[x].d(),t[13](null),A=!1,T()}}}let Ln=500;function On(t,e,l){let n;st(t,K,w=>l(18,n=w));let s=1,u=!1,g=null,c,o,f,h,b,p,m=150,v=0;function x(){if(!o||!f)return;if(typeof window<"u"?window.innerWidth>=1024:!0){const j=o.clientHeight;l(4,f.style.height=j?`${j}px`:"",f)}else l(4,f.style.height="",f)}function d(){p&&clearTimeout(p),p=setTimeout(x,100)}async function S(){if(!(!n.isAnalyzing&&!n.isRecording&&!n.isCalibrating))try{if(n.isAnalyzing||n.isRecording||n.isCalibrating){const w=await fetch(`${le()}/api/video/frame`,{signal:AbortSignal.timeout(1e3)});if(w.ok){const j=await w.json();j.success&&j.frame&&Kt(j.frame)}}if(n.isAnalyzing){const w=await fetch(`${le()}/api/analysis/data`,{signal:AbortSignal.timeout(1e3)});if(w.ok){const j=await w.json();j.realtime&&en(j.realtime,j.trajectory,j.velocity)}}v>0&&(v=Math.max(0,v-1),l(11,m=Math.max(150,m-50)))}catch{v++,v>3&&l(11,m=Math.min(Ln,m+50))}}xt(()=>{l(10,c=setInterval(S,m)),window&&"ResizeObserver"in window?(h=new ResizeObserver(d),o&&h.observe(o)):window==null||window.addEventListener("resize",d),b=()=>{d(),setTimeout(x,150)},typeof document<"u"&&(document.addEventListener("fullscreenchange",b),document.addEventListener("webkitfullscreenchange",b),document.addEventListener("mozfullscreenchange",b),document.addEventListener("MSFullscreenChange",b)),setTimeout(x,0)}),qt(()=>{c&&clearInterval(c),p&&clearTimeout(p),h&&o&&h.unobserve(o),h&&h.disconnect(),typeof window<"u"&&window.removeEventListener("resize",d),typeof document<"u"&&b&&(document.removeEventListener("fullscreenchange",b),document.removeEventListener("webkitfullscreenchange",b),document.removeEventListener("mozfullscreenchange",b),document.removeEventListener("MSFullscreenChange",b))});function A(w){const{step:j,data:N}=w.detail;j===1?l(0,s=2):j===2?(l(0,s=3),x()):j===3&&(l(2,g=N),l(1,u=!0),x())}async function T(){const w=[];n.isAnalyzing&&w.push(fetch(`${le()}/api/analysis/stop`,{method:"POST"}).catch(()=>{})),n.isRecording&&w.push(fetch(`${le()}/api/recording/stop`,{method:"POST"}).catch(()=>{})),await Promise.all(w)}async function I(){var w,j;await T();try{(j=(w=n.previewStream)==null?void 0:w.getTracks())==null||j.forEach(N=>N.stop())}catch{}zt(),K.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});try{window.close()}catch{}}function z(){l(1,u=!1),l(2,g=null),l(0,s=1),v=0,l(11,m=150),K.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null})}async function M(){s>1&&(s===2?(await T(),K.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null})):s===3&&(await T(),K.update(w=>({...w,isAnalyzing:!1,isPaused:!1,isCameraPreview:w.isCameraPreview,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:w.localVideoUrl}))),l(0,s--,s),x())}async function k(){await T(),l(0,s=1),K.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null}),x()}function L(w){pe[w?"unshift":"push"](()=>{o=w,l(3,o)})}function C(w){pe[w?"unshift":"push"](()=>{f=w,l(4,f)})}return t.$$.update=()=>{t.$$.dirty&3072&&c&&(clearInterval(c),l(10,c=setInterval(S,m)))},[s,u,g,o,f,A,I,z,M,k,c,m,L,C]}class In extends qe{constructor(e){super(),Je(this,e,On,Rn,Ae,{})}}window.__APP_LOADING__=!0;function vl(){try{const t=document.getElementById("app");if(!t)throw new Error("Elemento #app non trovato nel DOM");t.innerHTML="";const e=new In({target:t});window.__APP_LOADED__=!0,window.__APP_LOADING__=!1}catch(t){console.error("Errore durante l'inizializzazione dell'app:",t),window.__APP_LOADING__=!1;const e=document.getElementById("app");e&&(e.innerHTML=`
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #0f172a; color: white; font-family: sans-serif; padding: 20px;">
          <div style="text-align: center; max-width: 600px;">
            <h1 style="color: #ef4444; margin-bottom: 20px;">Errore di Caricamento</h1>
            <p style="color: #94a3b8; margin-bottom: 10px;">Si è verificato un errore durante il caricamento dell'applicazione.</p>
            <p style="color: #64748b; font-size: 14px; margin-top: 20px; word-break: break-word;">${t.message||"Errore sconosciuto"}</p>
            <p style="color: #64748b; font-size: 12px; margin-top: 10px;">Stack: ${t.stack||"N/A"}</p>
            <p style="color: #64748b; font-size: 12px; margin-top: 10px;">Apri la console del browser (F12) per maggiori dettagli.</p>
          </div>
        </div>
      `)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",vl):vl()})();
