var Pn=Object.defineProperty;var zn=(Q,_e,je)=>_e in Q?Pn(Q,_e,{enumerable:!0,configurable:!0,writable:!0,value:je}):Q[_e]=je;var zt=(Q,_e,je)=>zn(Q,typeof _e!="symbol"?_e+"":_e,je);(function(){"use strict";function Q(){}function _e(t){return t()}function je(){return Object.create(null)}function he(t){t.forEach(_e)}function Dt(t){return typeof t=="function"}function Le(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let tt;function lt(t,e){return t===e?!0:(tt||(tt=document.createElement("a")),tt.href=e,t===tt.href)}function _l(t){return Object.keys(t).length===0}function wl(t,...e){if(t==null){for(const n of e)n(void 0);return Q}const l=t.subscribe(...e);return l.unsubscribe?()=>l.unsubscribe():l}function nt(t,e,l){t.$$.on_destroy.push(wl(e,l))}function fe(t){return t??""}function yl(t,e,l){return t.set(l),e}function s(t,e){t.appendChild(e)}function F(t,e,l){t.insertBefore(e,l||null)}function L(t){t.parentNode&&t.parentNode.removeChild(t)}function xl(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function o(t){return document.createElement(t)}function re(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function H(t){return document.createTextNode(t)}function y(){return H(" ")}function ht(){return H("")}function X(t,e,l,n){return t.addEventListener(e,l,n),()=>t.removeEventListener(e,l,n)}function kl(t){return function(e){e.target===this&&t.call(this,e)}}function i(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function Ae(t){return t===""?null:+t}function Cl(t){return Array.from(t.childNodes)}function ne(t,e){e=""+e,t.data!==e&&(t.data=e)}function xe(t,e){t.value=e??""}function Lt(t,e,l,n){l==null?t.style.removeProperty(e):t.style.setProperty(e,l,"")}function Rt(t,e,l){for(let n=0;n<t.options.length;n+=1){const a=t.options[n];if(a.__value===e){a.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function Ml(t){const e=t.querySelector(":checked");return e&&e.__value}function Sl(t,e,{bubbles:l=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:l,cancelable:n})}let We;function Ge(t){We=t}function bt(){if(!We)throw new Error("Function called outside component initialization");return We}function Ft(t){bt().$$.on_mount.push(t)}function Tl(t){bt().$$.on_destroy.push(t)}function gt(){const t=bt();return(e,l,{cancelable:n=!1}={})=>{const a=t.$$.callbacks[e];if(a){const f=Sl(e,l,{cancelable:n});return a.slice().forEach(d=>{d.call(t,f)}),!f.defaultPrevented}return!0}}const Re=[],Ee=[];let Fe=[];const vt=[],jl=Promise.resolve();let _t=!1;function Al(){_t||(_t=!0,jl.then(Bt))}function it(t){Fe.push(t)}function El(t){vt.push(t)}const wt=new Set;let Be=0;function Bt(){if(Be!==0)return;const t=We;do{try{for(;Be<Re.length;){const e=Re[Be];Be++,Ge(e),Pl(e.$$)}}catch(e){throw Re.length=0,Be=0,e}for(Ge(null),Re.length=0,Be=0;Ee.length;)Ee.pop()();for(let e=0;e<Fe.length;e+=1){const l=Fe[e];wt.has(l)||(wt.add(l),l())}Fe.length=0}while(Re.length);for(;vt.length;)vt.pop()();_t=!1,wt.clear(),Ge(t)}function Pl(t){if(t.fragment!==null){t.update(),he(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(it)}}function zl(t){const e=[],l=[];Fe.forEach(n=>t.indexOf(n)===-1?e.push(n):l.push(n)),l.forEach(n=>n()),Fe=e}const st=new Set;let Pe;function Dl(){Pe={r:0,c:[],p:Pe}}function Ll(){Pe.r||he(Pe.c),Pe=Pe.p}function ze(t,e){t&&t.i&&(st.delete(t),t.i(e))}function Ie(t,e,l,n){if(t&&t.o){if(st.has(t))return;st.add(t),Pe.c.push(()=>{st.delete(t),n&&(l&&t.d(1),n())}),t.o(e)}else n&&n()}function It(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Rl(t,e,l){const n=t.$$.props[e];n!==void 0&&(t.$$.bound[n]=l,l(t.$$.ctx[n]))}function at(t){t&&t.c()}function Je(t,e,l){const{fragment:n,after_update:a}=t.$$;n&&n.m(e,l),it(()=>{const f=t.$$.on_mount.map(_e).filter(Dt);t.$$.on_destroy?t.$$.on_destroy.push(...f):he(f),t.$$.on_mount=[]}),a.forEach(it)}function qe(t,e){const l=t.$$;l.fragment!==null&&(zl(l.after_update),he(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function Fl(t,e){t.$$.dirty[0]===-1&&(Re.push(t),Al(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ze(t,e,l,n,a,f,d=null,r=[-1]){const c=We;Ge(t);const u=t.$$={fragment:null,ctx:[],props:f,update:Q,not_equal:a,bound:je(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:je(),dirty:r,skip_bound:!1,root:e.target||c.$$.root};d&&d(u.root);let m=!1;if(u.ctx=l?l(t,e.props||{},(p,b,...w)=>{const h=w.length?w[0]:b;return u.ctx&&a(u.ctx[p],u.ctx[p]=h)&&(!u.skip_bound&&u.bound[p]&&u.bound[p](h),m&&Fl(t,p)),b}):[],u.update(),m=!0,he(u.before_update),u.fragment=n?n(u.ctx):!1,e.target){if(e.hydrate){const p=Cl(e.target);u.fragment&&u.fragment.l(p),p.forEach(L)}else u.fragment&&u.fragment.c();e.intro&&ze(t.$$.fragment),Je(t,e.target,e.anchor),Bt()}Ge(c)}class Ke{constructor(){zt(this,"$$");zt(this,"$$set")}$destroy(){qe(this,1),this.$destroy=Q}$on(e,l){if(!Dt(l))return Q;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(l),()=>{const a=n.indexOf(l);a!==-1&&n.splice(a,1)}}$set(e){this.$$set&&!_l(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Bl="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Bl);const Ve=[];function Il(t,e=Q){let l;const n=new Set;function a(r){if(Le(t,r)&&(t=r,l)){const c=!Ve.length;for(const u of n)u[1](),Ve.push(u,t);if(c){for(let u=0;u<Ve.length;u+=2)Ve[u][0](Ve[u+1]);Ve.length=0}}}function f(r){a(r(t))}function d(r,c=Q){const u=[r,c];return n.add(u),n.size===1&&(l=e(a,f)||Q),r(t),()=>{n.delete(u),n.size===0&&l&&(l(),l=null)}}return{set:a,update:f,subscribe:d}}const le=Il({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,previewStream:null,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});function Vt(t){le.update(e=>({...e,videoFrame:t}))}function Vl(t,e,l){le.update(n=>({...n,realtimeData:t,trajectoryData:e||n.trajectoryData,velocityData:l||n.velocityData}))}function Hl(t){le.update(e=>({...e,localVideoUrl:t}))}function yt(t){le.update(e=>({...e,isCameraPreview:!!t}))}function Ol(t){le.update(e=>({...e,previewStream:t||null}))}function xt(){le.update(t=>({...t,previewStream:null}))}function kt(t){le.update(e=>({...e,inputMode:t==="upload"||t==="camera"?t:"none"}))}const be=()=>typeof window<"u"&&window.BACKEND_URL?window.BACKEND_URL:"http://localhost:5000",Nl=be();async function oe(t,e={}){const l=`${Nl}${t}`,n=await fetch(l,e);try{return await n.json()}catch{return{}}}const de={setCamera(t){return oe("/api/settings/camera",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({index:Number(t)})})},setFps(t){return oe("/api/settings/fps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:t})})},setHeight(t){return oe("/api/settings/height",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:t})})},setMass(t){return oe("/api/settings/mass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:t})})},startRecording(){return oe("/api/recording/start",{method:"POST"})},stopRecording(){return oe("/api/recording/stop",{method:"POST"})},startCalibration(){return oe("/api/calibration/start",{method:"POST"})},calibrationStatus(){return oe("/api/calibration/status")},startAnalysis(){return oe("/api/analysis/start",{method:"POST"})},analysisStatus(){return oe("/api/analysis/status")},analysisResults(){return oe("/api/analysis/results")},pauseAnalysis(){return oe("/api/analysis/pause",{method:"POST"})},resumeAnalysis(){return oe("/api/analysis/resume",{method:"POST"})},stopAnalysis(){return oe("/api/analysis/stop",{method:"POST"})},videoFrame(){return oe("/api/video/frame")},analysisData(){return oe("/api/analysis/data")},async getPlayerData(t,e){var l;try{document.cookie=`session_id=${e}; path=/api/players`;const n=await fetch(`http://localhost:5173/api/players/${t}`,{method:"GET",credentials:"include",headers:{Accept:"*/*"}});if(!n.ok)return{success:!1,error:`Errore HTTP: ${n.status}`};const a=await n.json();return(l=a==null?void 0:a.data)!=null&&l.info?{success:!0,data:{height_cm:a.data.info.height_cm,weight_kg:a.data.info.weight_kg,name:a.data.info.name,surname:a.data.info.surname,position:a.data.info.position}}:{success:!1,error:"Dati giocatore non validi"}}catch(n){return{success:!1,error:`Errore di connessione: ${n.message}`}}}};function Ul(t){let e;return{c(){e=H("SOURCE MEDIA")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function Yl(t){let e;return{c(){e=H("LIVE PREVIEW")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function Wl(t){let e;return{c(){e=H("VIDEO ANALYZED")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function Gl(t){let e;return{c(){e=o("div"),e.innerHTML='<svg class="w-16 h-16 mx-auto text-slate-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> <p class="text-slate-400 text-sm">Nessun video caricato</p>',i(e,"class","text-center p-8 opacity-50")},m(l,n){F(l,e,n)},p:Q,d(l){l&&L(e)}}}function Jl(t){let e,l,n,a,f,d=t[4].isRecording&&Ht(),r=t[4].isAnalyzing&&Ot();return{c(){e=o("img"),n=y(),d&&d.c(),a=y(),r&&r.c(),f=ht(),lt(e.src,l=t[6])||i(e,"src",l),i(e,"alt","Video frame"),i(e,"class","w-full h-full object-contain")},m(c,u){F(c,e,u),F(c,n,u),d&&d.m(c,u),F(c,a,u),r&&r.m(c,u),F(c,f,u)},p(c,u){u&64&&!lt(e.src,l=c[6])&&i(e,"src",l),c[4].isRecording?d||(d=Ht(),d.c(),d.m(a.parentNode,a)):d&&(d.d(1),d=null),c[4].isAnalyzing?r||(r=Ot(),r.c(),r.m(f.parentNode,f)):r&&(r.d(1),r=null)},d(c){c&&(L(e),L(n),L(a),L(f)),d&&d.d(c),r&&r.d(c)}}}function ql(t){let e,l;return{c(){e=o("video"),lt(e.src,l=t[4].localVideoUrl)||i(e,"src",l),e.controls=!0,i(e,"class","w-full h-full object-contain")},m(n,a){F(n,e,a),t[10](e)},p(n,a){a&16&&!lt(e.src,l=n[4].localVideoUrl)&&i(e,"src",l)},d(n){n&&L(e),t[10](null)}}}function Zl(t){let e;return{c(){e=o("video"),e.autoplay=!0,e.playsInline=!0,e.muted=!0,i(e,"class","w-full h-full object-contain")},m(l,n){F(l,e,n),t[9](e)},p:Q,d(l){l&&L(e),t[9](null)}}}function Ht(t){let e;return{c(){e=o("div"),e.innerHTML='<div class="w-2 h-2 bg-white rounded-full"></div><span class="text-white text-xs font-bold">REC</span>',i(e,"class","absolute top-4 right-4 flex items-center gap-2 bg-red-600 px-3 py-1 rounded-full shadow-lg animate-pulse")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function Ot(t){let e;return{c(){e=o("div"),e.innerHTML='<span class="text-white text-xs font-bold">ANALYZING...</span>',i(e,"class","absolute bottom-4 left-4 bg-green-600/90 backdrop-blur px-3 py-1 rounded-lg border border-green-500/50")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function Nt(t){let e,l,n,a,f,d,r,c,u,m,p,b,w,h;return{c(){e=o("div"),l=o("div"),n=o("div"),a=o("span"),f=H("Frame "),d=H(t[2]),r=y(),c=o("span"),u=H(t[1]),m=y(),p=o("input"),i(n,"class","flex justify-between text-[10px] font-mono text-slate-400 px-0.5"),i(p,"type","range"),i(p,"min","0"),i(p,"max",b=Math.max(t[1]-1,0)),i(p,"class","w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-500"),i(l,"class","flex-1 flex flex-col gap-1.5 justify-center"),i(e,"class","h-16 bg-slate-900/95 border-t border-slate-800/80 backdrop-blur-sm px-6 flex items-center gap-6 shrink-0")},m(C,v){F(C,e,v),s(e,l),s(l,n),s(n,a),s(a,f),s(a,d),s(n,r),s(n,c),s(c,u),s(l,m),s(l,p),xe(p,t[2]),w||(h=[X(p,"change",t[11]),X(p,"input",t[11]),X(p,"input",t[12])],w=!0)},p(C,v){v&4&&ne(d,C[2]),v&2&&ne(u,C[1]),v&2&&b!==(b=Math.max(C[1]-1,0))&&i(p,"max",b),v&4&&xe(p,C[2])},d(C){C&&L(e),w=!1,he(h)}}}function Kl(t){let e,l,n,a,f,d,r,c,u;function m(_,j){return _[0]?Wl:_[4].isCameraPreview?Yl:Ul}let p=m(t),b=p(t);function w(_,j){return _[4].isCameraPreview&&_[4].previewStream?Zl:_[4].localVideoUrl&&!_[4].isAnalyzing&&!_[4].isRecording?ql:_[6]?Jl:Gl}let h=w(t),C=h(t),v=t[0]&&!t[4].localVideoUrl&&t[1]>0&&Nt(t);return{c(){e=o("div"),l=o("div"),n=o("div"),a=o("span"),a.textContent="Analisi Biomeccanica",f=y(),d=o("span"),b.c(),r=y(),c=o("div"),C.c(),u=y(),v&&v.c(),i(a,"class","text-white font-medium text-sm drop-shadow-md"),i(d,"class","text-[10px] font-mono text-slate-300 opacity-80"),i(n,"class","flex flex-col"),i(l,"class","absolute top-0 left-0 right-0 p-4 z-10 bg-gradient-to-b from-black/90 via-black/40 to-transparent flex justify-between items-start pointer-events-none"),i(c,"class","flex-1 bg-black flex items-center justify-center relative overflow-hidden"),i(e,"class","bg-black rounded-2xl overflow-hidden border border-slate-800 relative shadow-2xl ring-1 ring-white/5 group h-full flex flex-col")},m(_,j){F(_,e,j),s(e,l),s(l,n),s(n,a),s(n,f),s(n,d),b.m(d,null),s(e,r),s(e,c),C.m(c,null),s(e,u),v&&v.m(e,null),t[13](e)},p(_,[j]){p!==(p=m(_))&&(b.d(1),b=p(_),b&&(b.c(),b.m(d,null))),h===(h=w(_))&&C?C.p(_,j):(C.d(1),C=h(_),C&&(C.c(),C.m(c,null))),_[0]&&!_[4].localVideoUrl&&_[1]>0?v?v.p(_,j):(v=Nt(_),v.c(),v.m(e,null)):v&&(v.d(1),v=null)},i:Q,o:Q,d(_){_&&L(e),b.d(),C.d(),v&&v.d(),t[13](null)}}}function Ql(t,e,l){let n,a;nt(t,le,M=>l(4,a=M));let{analysisCompleted:f=!1}=e,d=0,r=0,c=!1,u="",m,p,b;async function w(){try{const O=await(await fetch(`${be()}/api/video/info`)).json();O&&O.success&&(l(1,d=O.total_frames||0),l(8,c=!0))}catch{}}async function h(M){try{const P=await(await fetch(`${be()}/api/video/frame_at?index=${M}`)).json();P&&P.success?(l(2,r=P.index),Vt(P.frame)):P&&P.error&&(u=P.error)}catch{u="Errore caricamento frame"}finally{}}function C(M){!f||d<=0||(m&&clearTimeout(m),m=setTimeout(()=>h(M),50))}Ft(()=>{if(a.isCameraPreview&&a.previewStream&&b)try{l(3,b.srcObject=a.previewStream,b)}catch{}});function v(M){Ee[M?"unshift":"push"](()=>{b=M,l(3,b),l(4,a)})}function _(M){Ee[M?"unshift":"push"](()=>{b=M,l(3,b),l(4,a)})}function j(){r=Ae(this.value),l(2,r)}const A=M=>C(+M.target.value);function Y(M){Ee[M?"unshift":"push"](()=>{p=M,l(5,p)})}return t.$$set=M=>{"analysisCompleted"in M&&l(0,f=M.analysisCompleted)},t.$$.update=()=>{if(t.$$.dirty&16&&l(6,n=a.videoFrame?`data:image/jpeg;base64,${a.videoFrame}`:null),t.$$.dirty&263&&f&&!c&&w().then(()=>{d>0&&h(r)}),t.$$.dirty&24&&a.isCameraPreview&&a.previewStream&&b)try{l(3,b.srcObject=a.previewStream,b)}catch{}},[f,d,r,b,a,p,n,C,c,v,_,j,A,Y]}class Xl extends Ke{constructor(e){super(),Ze(this,e,Ql,Kl,Le,{analysisCompleted:0})}}async function $l(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("API mediaDevices non disponibile");let t=null;try{t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}catch{}try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput")}finally{if(t)try{t.getTracks().forEach(e=>e.stop())}catch{}}}async function en(t,e){const l=Array.isArray(e)?e:[],n=l[t]||l[0];return n&&n.deviceId?await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:n.deviceId}},audio:!1}):await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}function Ct(t){var e;try{(e=t==null?void 0:t.getTracks())==null||e.forEach(l=>l.stop())}catch{}}function Ut(t,e,l){const n=t.slice();return n[11]=e[l],n[13]=l,n}function Yt(t){let e,l,n,a,f,d,r,c,u,m,p,b,w,h,C,v,_,j,A=t[4]&&Wt(t);function Y(P,N){return P[2]?nn:P[3].length>0?ln:tn}let M=Y(t),O=M(t);return{c(){e=o("div"),l=o("div"),n=o("div"),a=o("h4"),a.textContent="Seleziona fotocamera",f=y(),d=o("button"),d.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',r=y(),c=o("div"),A&&A.c(),u=y(),O.c(),m=y(),p=o("div"),b=o("button"),b.textContent="Annulla",w=y(),h=o("button"),C=H("Conferma e anteprima"),i(a,"id","camera-modal-title"),i(a,"class","text-white font-semibold text-lg"),i(d,"class","text-slate-400 hover:text-white focus:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-800 rounded p-1"),i(d,"aria-label","Chiudi modal"),i(n,"class","px-4 sm:px-6 py-3 sm:py-4 border-b border-slate-700 flex items-center justify-between"),i(c,"class","p-4 sm:p-6 space-y-4"),i(b,"class","btn-secondary"),i(b,"aria-label","Annulla selezione fotocamera"),i(h,"class","btn-primary"),h.disabled=v=t[2]||t[3].length===0,i(h,"aria-label","Conferma selezione e avvia anteprima"),i(p,"class","px-4 sm:px-6 py-3 sm:py-4 border-t border-slate-700 flex gap-2 sm:gap-3 justify-end"),i(l,"class","bg-slate-800 border border-slate-700 rounded-xl w-full max-w-md shadow-2xl"),i(l,"role","document"),i(e,"class","fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4"),i(e,"role","dialog"),i(e,"aria-modal","true"),i(e,"aria-labelledby","camera-modal-title")},m(P,N){F(P,e,N),s(e,l),s(l,n),s(n,a),s(n,f),s(n,d),s(l,r),s(l,c),A&&A.m(c,null),s(c,u),O.m(c,null),s(l,m),s(l,p),s(p,b),s(p,w),s(p,h),s(h,C),_||(j=[X(d,"click",t[5]),X(b,"click",t[5]),X(h,"click",t[6]),X(e,"click",kl(t[5])),X(e,"keydown",t[9])],_=!0)},p(P,N){P[4]?A?A.p(P,N):(A=Wt(P),A.c(),A.m(c,u)):A&&(A.d(1),A=null),M===(M=Y(P))&&O?O.p(P,N):(O.d(1),O=M(P),O&&(O.c(),O.m(c,null))),N&12&&v!==(v=P[2]||P[3].length===0)&&(h.disabled=v)},d(P){P&&L(e),A&&A.d(),O.d(),_=!1,he(j)}}}function Wt(t){let e,l;return{c(){e=o("div"),l=H(t[4]),i(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-3 text-red-300 text-sm"),i(e,"role","alert")},m(n,a){F(n,e,a),s(e,l)},p(n,a){a&16&&ne(l,n[4])},d(n){n&&L(e)}}}function tn(t){let e;return{c(){e=o("p"),e.textContent="Nessuna fotocamera disponibile.",i(e,"class","text-slate-400"),i(e,"role","status")},m(l,n){F(l,e,n)},p:Q,d(l){l&&L(e)}}}function ln(t){let e,l,n,a,f,d,r,c,u=It(t[3]),m=[];for(let p=0;p<u.length;p+=1)m[p]=Gt(Ut(t,u,p));return{c(){e=o("div"),l=o("label"),l.textContent="Fotocamera",n=y(),a=o("select");for(let p=0;p<m.length;p+=1)m[p].c();f=y(),d=o("p"),d.textContent="Seleziona una fotocamera dalla lista",i(l,"for","camera-select"),i(l,"class","block text-sm font-medium text-slate-300 mb-2"),i(a,"id","camera-select"),i(a,"class","input-field"),i(a,"aria-describedby","camera-select-help"),t[0]===void 0&&it(()=>t[8].call(a)),i(d,"id","camera-select-help"),i(d,"class","sr-only")},m(p,b){F(p,e,b),s(e,l),s(e,n),s(e,a);for(let w=0;w<m.length;w+=1)m[w]&&m[w].m(a,null);Rt(a,t[0],!0),s(e,f),s(e,d),r||(c=[X(a,"change",t[7]),X(a,"change",t[8])],r=!0)},p(p,b){if(b&8){u=It(p[3]);let w;for(w=0;w<u.length;w+=1){const h=Ut(p,u,w);m[w]?m[w].p(h,b):(m[w]=Gt(h),m[w].c(),m[w].m(a,null))}for(;w<m.length;w+=1)m[w].d(1);m.length=u.length}b&1&&Rt(a,p[0])},d(p){p&&L(e),xl(m,p),r=!1,he(c)}}}function nn(t){let e;return{c(){e=o("div"),e.innerHTML='<svg class="animate-spin h-5 w-5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <p class="text-slate-300">Caricamento fotocamere...</p>',i(e,"class","flex items-center gap-3"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){F(l,e,n)},p:Q,d(l){l&&L(e)}}}function Gt(t){let e,l=(t[11].label||`Camera ${t[13]+1}`)+"",n;return{c(){e=o("option"),n=H(l),e.__value=t[13],xe(e,e.__value)},m(a,f){F(a,e,f),s(e,n)},p(a,f){f&8&&l!==(l=(a[11].label||`Camera ${a[13]+1}`)+"")&&ne(n,l)},d(a){a&&L(e)}}}function sn(t){let e,l=t[1]&&Yt(t);return{c(){l&&l.c(),e=ht()},m(n,a){l&&l.m(n,a),F(n,e,a)},p(n,[a]){n[1]?l?l.p(n,a):(l=Yt(n),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},i:Q,o:Q,d(n){n&&L(e),l&&l.d(n)}}}function an(t,e,l){let{show:n=!1}=e,{loading:a=!1}=e,{cameras:f=[]}=e,{selectedIndex:d=null}=e,{error:r=""}=e;const c=gt();function u(){c("close")}function m(){c("confirm")}function p(h){const C=Number(h.target.value);c("select",{index:C})}function b(){d=Ml(this),l(0,d)}const w=h=>h.key==="Escape"&&u();return t.$$set=h=>{"show"in h&&l(1,n=h.show),"loading"in h&&l(2,a=h.loading),"cameras"in h&&l(3,f=h.cameras),"selectedIndex"in h&&l(0,d=h.selectedIndex),"error"in h&&l(4,r=h.error)},[d,n,a,f,r,u,m,p,b,w]}class on extends Ke{constructor(e){super(),Ze(this,e,an,sn,Le,{show:1,loading:2,cameras:3,selectedIndex:0,error:4})}}function rn(t){let e;return{c(){e=H("Elaborazione Analisi")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function cn(t){let e;return{c(){e=H("Calibrazione & Dati")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function dn(t){let e;return{c(){e=H("Acquisizione Video")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function Jt(t){let e,l,n;return{c(){e=o("button"),e.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>',i(e,"class","text-slate-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-800"),i(e,"aria-label","Torna indietro")},m(a,f){F(a,e,f),l||(n=X(e,"click",t[24]),l=!0)},p:Q,d(a){a&&L(e),l=!1,n()}}}function qt(t){let e,l,n,a,f,d,r,c;return{c(){e=o("div"),l=re("svg"),n=re("circle"),a=re("line"),f=re("line"),d=y(),r=o("p"),c=H(t[5]),i(n,"cx","12"),i(n,"cy","12"),i(n,"r","10"),i(a,"x1","12"),i(a,"y1","8"),i(a,"x2","12"),i(a,"y2","12"),i(f,"x1","12"),i(f,"y1","16"),i(f,"x2","12.01"),i(f,"y2","16"),i(l,"class","w-5 h-5 text-red-400 shrink-0 mt-0.5"),i(l,"fill","none"),i(l,"stroke","currentColor"),i(l,"viewBox","0 0 24 24"),i(r,"class","text-red-400 text-sm font-medium"),i(e,"class","bg-red-500/10 border border-red-500/20 rounded-lg p-3 flex items-start gap-3")},m(u,m){F(u,e,m),s(e,l),s(l,n),s(l,a),s(l,f),s(e,d),s(e,r),s(r,c)},p(u,m){m[0]&32&&ne(c,u[5])},d(u){u&&L(e)}}}function Zt(t){let e,l,n=t[13].inputMode!=="camera"&&Kt(t);function a(r,c){return r[13].isRecording?fn:un}let f=a(t),d=f(t);return{c(){e=o("div"),n&&n.c(),l=y(),d.c(),i(e,"class","space-y-5 animate-in fade-in slide-in-from-right-2 duration-300")},m(r,c){F(r,e,c),n&&n.m(e,null),s(e,l),d.m(e,null)},p(r,c){r[13].inputMode!=="camera"?n?n.p(r,c):(n=Kt(r),n.c(),n.m(e,l)):n&&(n.d(1),n=null),f===(f=a(r))&&d?d.p(r,c):(d.d(1),d=f(r),d&&(d.c(),d.m(e,null)))},d(r){r&&L(e),n&&n.d(),d.d()}}}function Kt(t){let e,l,n,a,f,d,r,c,u,m=t[1]?"Caricamento in corso...":"Carica un file video",p,b,w,h,C,v,_,j;return{c(){e=o("div"),l=o("input"),a=y(),f=o("div"),d=o("div"),d.innerHTML='<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>',r=y(),c=o("div"),u=o("p"),p=H(m),b=y(),w=o("p"),w.textContent="MP4, MOV, AVI fino a 50MB",C=y(),v=o("div"),v.innerHTML='<div class="grow border-t border-slate-700"></div> <span class="shrink-0 mx-4 text-xs text-slate-500 font-medium uppercase">Oppure</span> <div class="grow border-t border-slate-700"></div>',i(l,"type","file"),i(l,"accept","video/*"),l.disabled=n=t[1]||t[13].isRecording,i(l,"class","absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10 disabled:cursor-not-allowed"),i(d,"class","w-12 h-12 rounded-full bg-slate-700 group-hover:bg-indigo-600/20 group-hover:text-indigo-400 flex items-center justify-center transition-colors text-slate-400"),i(u,"class","text-sm font-semibold text-white group-hover:text-indigo-300 transition-colors"),i(w,"class","text-xs text-slate-500 mt-1"),i(f,"class",h="flex flex-col items-center gap-3 "+(t[1]?"opacity-50":"")),i(e,"class","bg-slate-800/50 border border-slate-700 border-dashed rounded-xl p-6 text-center hover:bg-slate-800 transition-colors group cursor-pointer relative"),i(v,"class","relative flex items-center py-2")},m(A,Y){F(A,e,Y),s(e,l),s(e,a),s(e,f),s(f,d),s(f,r),s(f,c),s(c,u),s(u,p),s(c,b),s(c,w),F(A,C,Y),F(A,v,Y),_||(j=X(l,"change",t[14]),_=!0)},p(A,Y){Y[0]&8194&&n!==(n=A[1]||A[13].isRecording)&&(l.disabled=n),Y[0]&2&&m!==(m=A[1]?"Caricamento in corso...":"Carica un file video")&&ne(p,m),Y[0]&2&&h!==(h="flex flex-col items-center gap-3 "+(A[1]?"opacity-50":""))&&i(f,"class",h)},d(A){A&&(L(e),L(C),L(v)),_=!1,j()}}}function fn(t){let e,l,n,a,f,d,r,c,u,m;return{c(){e=o("div"),l=o("div"),l.innerHTML='<div class="w-4 h-4 bg-red-500 rounded animate-pulse"></div>',n=y(),a=o("h3"),a.textContent="Registrazione in corso",f=y(),d=o("p"),d.textContent="Esegui il salto ora...",r=y(),c=o("button"),c.innerHTML=`<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12"></rect></svg>
                Termina Registrazione`,i(l,"class","w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4"),i(a,"class","text-white font-semibold mb-1"),i(d,"class","text-slate-400 text-xs mb-6"),i(c,"class","btn-danger w-full flex items-center justify-center gap-2 py-3"),i(e,"class","bg-red-900/20 border border-red-500/30 rounded-lg p-6 text-center animate-pulse-fade")},m(p,b){F(p,e,b),s(e,l),s(e,n),s(e,a),s(e,f),s(e,d),s(e,r),s(e,c),u||(m=X(c,"click",t[18]),u=!0)},p:Q,d(p){p&&L(e),u=!1,m()}}}function un(t){let e,l,n,a,f=t[13].inputMode==="camera"?"Cambia Sorgente Video":"Usa Fotocamera",d,r,c,u,m,p=t[13].isCameraPreview&&Qt(t);return{c(){e=o("button"),l=re("svg"),n=re("path"),a=y(),d=H(f),r=y(),p&&p.c(),c=ht(),i(n,"stroke-linecap","round"),i(n,"stroke-linejoin","round"),i(n,"stroke-width","2"),i(n,"d","M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"),i(l,"class","w-5 h-5"),i(l,"fill","none"),i(l,"stroke","currentColor"),i(l,"viewBox","0 0 24 24"),i(e,"class","btn-secondary w-full flex items-center justify-center gap-2 py-3")},m(b,w){F(b,e,w),s(e,l),s(l,n),s(e,a),s(e,d),F(b,r,w),p&&p.m(b,w),F(b,c,w),u||(m=X(e,"click",t[15]),u=!0)},p(b,w){w[0]&8192&&f!==(f=b[13].inputMode==="camera"?"Cambia Sorgente Video":"Usa Fotocamera")&&ne(d,f),b[13].isCameraPreview?p?p.p(b,w):(p=Qt(b),p.c(),p.m(c.parentNode,c)):p&&(p.d(1),p=null)},d(b){b&&(L(e),L(r),L(c)),p&&p.d(b),u=!1,m()}}}function Qt(t){let e,l,n,a,f,d,r,c;return{c(){e=o("div"),l=o("div"),l.innerHTML='<div class="w-2 h-2 rounded-full bg-indigo-400 animate-pulse"></div> <h4 class="text-sm font-medium text-indigo-300">Anteprima Attiva</h4>',n=y(),a=o("p"),a.textContent="Posizionati correttamente nel riquadro. Quando sei pronto, avvia l'analisi.",f=y(),d=o("button"),d.innerHTML=`<div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                  REC &amp; Analizza`,i(l,"class","flex items-center gap-3 mb-3"),i(a,"class","text-xs text-indigo-200/70 mb-4 leading-relaxed"),i(d,"class","btn-primary w-full flex items-center justify-center gap-2 py-3 shadow-lg shadow-indigo-900/40"),i(e,"class","bg-indigo-900/20 border border-indigo-500/30 rounded-lg p-4 mt-4 animate-pulse-fade")},m(u,m){F(u,e,m),s(e,l),s(e,n),s(e,a),s(e,f),s(e,d),r||(c=X(d,"click",t[17]),r=!0)},p:Q,d(u){u&&L(e),r=!1,c()}}}function Xt(t){let e,l,n,a,f,d,r,c,u,m,p,b,w,h,C,v,_,j,A,Y,M,O;function P(x,T){return x[6]?mn:pn}let N=P(t),I=N(t);return{c(){e=o("div"),l=o("div"),n=o("div"),a=o("label"),a.textContent="FPS Video",f=y(),d=o("div"),r=o("input"),c=y(),u=o("div"),u.innerHTML='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',m=y(),p=o("div"),b=o("label"),b.textContent="Altezza (cm)",w=y(),h=o("input"),C=y(),v=o("div"),_=o("label"),_.textContent="Massa (kg)",j=y(),A=o("input"),Y=y(),I.c(),i(a,"for","fps-input"),i(a,"class","block text-xs font-medium text-slate-400 uppercase tracking-wide mb-1.5"),i(r,"id","fps-input"),i(r,"type","number"),i(r,"min","1"),i(r,"max","240"),r.disabled=t[6],i(r,"class","input-field pl-10 font-mono text-sm"),i(u,"class","absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"),i(d,"class","relative"),i(n,"class","col-span-2"),i(b,"for","height-input"),i(b,"class","block text-xs font-medium text-slate-400 uppercase tracking-wide mb-1.5"),i(h,"id","height-input"),i(h,"type","number"),i(h,"min","100"),i(h,"max","250"),h.disabled=t[6],i(h,"class","input-field font-mono text-sm"),i(_,"for","mass-input"),i(_,"class","block text-xs font-medium text-slate-400 uppercase tracking-wide mb-1.5"),i(A,"id","mass-input"),i(A,"type","number"),i(A,"min","40"),i(A,"max","150"),A.disabled=t[6],i(A,"class","input-field font-mono text-sm"),i(l,"class","grid grid-cols-2 gap-4"),i(e,"class","space-y-5 animate-in fade-in slide-in-from-right-2 duration-300")},m(x,T){F(x,e,T),s(e,l),s(l,n),s(n,a),s(n,f),s(n,d),s(d,r),xe(r,t[2]),s(d,c),s(d,u),s(l,m),s(l,p),s(p,b),s(p,w),s(p,h),xe(h,t[3]),s(l,C),s(l,v),s(v,_),s(v,j),s(v,A),xe(A,t[4]),s(e,Y),I.m(e,null),M||(O=[X(r,"input",t[28]),X(h,"input",t[29]),X(A,"input",t[30])],M=!0)},p(x,T){T[0]&64&&(r.disabled=x[6]),T[0]&4&&Ae(r.value)!==x[2]&&xe(r,x[2]),T[0]&64&&(h.disabled=x[6]),T[0]&8&&Ae(h.value)!==x[3]&&xe(h,x[3]),T[0]&64&&(A.disabled=x[6]),T[0]&16&&Ae(A.value)!==x[4]&&xe(A,x[4]),N===(N=P(x))&&I?I.p(x,T):(I.d(1),I=N(x),I&&(I.c(),I.m(e,null)))},d(x){x&&L(e),I.d(),M=!1,he(O)}}}function pn(t){let e,l,n;return{c(){e=o("button"),e.innerHTML=`<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            Conferma e Avvia`,i(e,"class","btn-primary w-full flex items-center justify-center gap-2 py-3 mt-2")},m(a,f){F(a,e,f),l||(n=X(e,"click",t[19]),l=!0)},p:Q,d(a){a&&L(e),l=!1,n()}}}function mn(t){let e;return{c(){e=o("div"),e.innerHTML='<svg class="animate-spin h-8 w-8 text-indigo-500 mb-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <p class="text-indigo-300 text-sm font-medium">Calibrazione in corso...</p> <p class="text-indigo-400/60 text-xs mt-1">Mantieni il soggetto in posizione eretta</p>',i(e,"class","bg-indigo-900/20 border border-indigo-500/30 rounded-lg p-4 flex flex-col items-center text-center animate-pulse")},m(l,n){F(l,e,n)},p:Q,d(l){l&&L(e)}}}function $t(t){var Te,se,ce,ke;let e,l,n,a,f,d,r,c,u,m,p,b,w=(((Te=t[13].realtimeData)==null?void 0:Te.current_height)??0)+"",h,C,v,_,j,A,Y,M=(((se=t[13].realtimeData)==null?void 0:se.max_height)??0)+"",O,P,N,I,x,T,k,$=(((ce=t[13].realtimeData)==null?void 0:ce.takeoff_velocity)??0)+"",S,B,V,D,E,U,W=(((ke=t[13].realtimeData)==null?void 0:ke.estimated_power)??0)+"",Z,G,q;function K(te,ae){return te[7]?bn:hn}let g=K(t),z=g(t),R=t[7]&&el(),ee=t[7]&&tl(t);return{c(){e=o("div"),z.c(),l=y(),n=o("div"),a=o("div"),f=o("h3"),f.textContent="Metriche Live",d=y(),R&&R.c(),r=y(),c=o("div"),u=o("div"),m=o("span"),m.textContent="Alt. Corrente",p=y(),b=o("span"),h=H(w),C=H(" cm"),v=y(),_=o("div"),j=o("span"),j.textContent="Alt. Max",A=y(),Y=o("span"),O=H(M),P=H(" cm"),N=y(),I=o("div"),x=o("span"),x.textContent="Vel. Decollo",T=y(),k=o("span"),S=H($),B=y(),V=o("div"),D=o("span"),D.textContent="Potenza",E=y(),U=o("span"),Z=H(W),G=H(" W"),q=y(),ee&&ee.c(),i(f,"class","text-[10px] font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2"),i(a,"class","px-4 py-2 border-b border-slate-700 bg-slate-800/50 flex justify-between items-center"),i(m,"class","text-[10px] text-slate-500 uppercase tracking-wide font-semibold mb-0.5"),i(b,"class","text-lg font-mono font-bold text-blue-400"),i(u,"class","flex flex-col"),i(j,"class","text-[10px] text-slate-500 uppercase tracking-wide font-semibold mb-0.5"),i(Y,"class","text-lg font-mono font-bold text-emerald-400"),i(_,"class","flex flex-col"),i(x,"class","text-[10px] text-slate-500 uppercase tracking-wide font-semibold mb-0.5"),i(k,"class","text-lg font-mono font-bold text-purple-400"),i(I,"class","flex flex-col"),i(D,"class","text-[10px] text-slate-500 uppercase tracking-wide font-semibold mb-0.5"),i(U,"class","text-lg font-mono font-bold text-amber-400"),i(V,"class","flex flex-col"),i(c,"class","p-4 grid grid-cols-2 gap-4"),i(n,"class","bg-slate-800 rounded-lg border border-slate-700 overflow-hidden shadow-sm"),i(e,"class","space-y-5 animate-in fade-in slide-in-from-right-2 duration-300")},m(te,ae){F(te,e,ae),z.m(e,null),s(e,l),s(e,n),s(n,a),s(a,f),s(a,d),R&&R.m(a,null),s(n,r),s(n,c),s(c,u),s(u,m),s(u,p),s(u,b),s(b,h),s(b,C),s(c,v),s(c,_),s(_,j),s(_,A),s(_,Y),s(Y,O),s(Y,P),s(c,N),s(c,I),s(I,x),s(I,T),s(I,k),s(k,S),s(c,B),s(c,V),s(V,D),s(V,E),s(V,U),s(U,Z),s(U,G),s(e,q),ee&&ee.m(e,null)},p(te,ae){var ge,Ce,De,ue;g===(g=K(te))&&z?z.p(te,ae):(z.d(1),z=g(te),z&&(z.c(),z.m(e,l))),te[7]?R||(R=el(),R.c(),R.m(a,null)):R&&(R.d(1),R=null),ae[0]&8192&&w!==(w=(((ge=te[13].realtimeData)==null?void 0:ge.current_height)??0)+"")&&ne(h,w),ae[0]&8192&&M!==(M=(((Ce=te[13].realtimeData)==null?void 0:Ce.max_height)??0)+"")&&ne(O,M),ae[0]&8192&&$!==($=(((De=te[13].realtimeData)==null?void 0:De.takeoff_velocity)??0)+"")&&ne(S,$),ae[0]&8192&&W!==(W=(((ue=te[13].realtimeData)==null?void 0:ue.estimated_power)??0)+"")&&ne(Z,W),te[7]?ee?ee.p(te,ae):(ee=tl(te),ee.c(),ee.m(e,null)):ee&&(ee.d(1),ee=null)},d(te){te&&L(e),z.d(),R&&R.d(),ee&&ee.d()}}}function hn(t){let e,l,n;return{c(){e=o("button"),e.innerHTML=`<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Riavvia Analisi`,i(e,"class","btn-primary w-full flex items-center justify-center gap-2 py-3")},m(a,f){F(a,e,f),l||(n=X(e,"click",t[20]),l=!0)},p:Q,d(a){a&&L(e),l=!1,n()}}}function bn(t){let e;return{c(){e=o("div"),e.innerHTML='<div class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span></div> <div><p class="text-emerald-400 text-sm font-medium">Elaborazione in corso...</p> <p class="text-emerald-500/60 text-xs">Analisi traiettoria e fasi</p></div>',i(e,"class","bg-emerald-900/20 border border-emerald-500/30 rounded-lg p-4 flex items-center gap-3 animate-pulse")},m(l,n){F(l,e,n)},p:Q,d(l){l&&L(e)}}}function el(t){let e;return{c(){e=o("div"),i(e,"class","w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function tl(t){let e,l,n,a,f;function d(u,m){return u[13].isPaused?vn:gn}let r=d(t),c=r(t);return{c(){e=o("div"),c.c(),l=y(),n=o("button"),n.textContent="Stop",i(n,"class","btn-danger text-xs py-2"),i(e,"class","grid grid-cols-2 gap-2 pt-2")},m(u,m){F(u,e,m),c.m(e,null),s(e,l),s(e,n),a||(f=X(n,"click",t[23]),a=!0)},p(u,m){r===(r=d(u))&&c?c.p(u,m):(c.d(1),c=r(u),c&&(c.c(),c.m(e,l)))},d(u){u&&L(e),c.d(),a=!1,f()}}}function gn(t){let e,l,n;return{c(){e=o("button"),e.textContent="Pausa",i(e,"class","btn-secondary text-xs py-2")},m(a,f){F(a,e,f),l||(n=X(e,"click",t[21]),l=!0)},p:Q,d(a){a&&L(e),l=!1,n()}}}function vn(t){let e,l,n;return{c(){e=o("button"),e.textContent="Riprendi",i(e,"class","btn-secondary text-xs py-2")},m(a,f){F(a,e,f),l||(n=X(e,"click",t[22]),l=!0)},p:Q,d(a){a&&L(e),l=!1,n()}}}function _n(t){let e,l,n,a,f,d,r,c,u,m,p,b,w,h,C,v,_,j,A,Y,M,O,P;function N(E,U){return E[0]===1?dn:E[0]===2?cn:rn}let I=N(t),x=I(t),T=(t[0]>1||t[13].isCameraPreview)&&Jt(t);function k(E){t[25](E)}let $={show:t[8],loading:t[11],cameras:t[9],error:t[12]};t[10]!==void 0&&($.selectedIndex=t[10]),_=new on({props:$}),Ee.push(()=>Rl(_,"selectedIndex",k)),_.$on("close",t[26]),_.$on("confirm",t[16]),_.$on("select",t[27]);let S=t[5]&&qt(t),B=t[0]===1&&Zt(t),V=t[0]===2&&Xt(t),D=t[0]===3&&$t(t);return{c(){e=o("div"),l=o("div"),n=o("div"),a=o("div"),f=o("h2"),d=o("span"),r=H(t[0]),c=H(`\r
            CONFIGURAZIONE`),u=y(),m=o("p"),x.c(),p=y(),T&&T.c(),b=y(),w=o("div"),h=o("div"),C=y(),v=o("div"),at(_.$$.fragment),A=y(),S&&S.c(),Y=y(),B&&B.c(),M=y(),V&&V.c(),O=y(),D&&D.c(),i(d,"class","bg-indigo-600 w-6 h-6 rounded flex items-center justify-center text-[10px]"),i(f,"class","text-sm font-bold text-white tracking-tight flex items-center gap-2"),i(m,"class","text-slate-500 text-xs mt-1 font-medium pl-8"),i(n,"class","px-5 py-4 flex justify-between items-center"),i(h,"class","h-full bg-indigo-500 transition-all duration-500 ease-out"),Lt(h,"width",t[0]/3*100+"%"),i(w,"class","w-full h-1 bg-slate-800"),i(l,"class","shrink-0 bg-slate-900 z-10 border-b border-slate-800"),i(v,"class","flex-1 overflow-y-auto p-5 custom-scrollbar bg-slate-900/50 space-y-6"),i(e,"class","bg-slate-900 rounded-2xl border border-slate-800 shadow-xl overflow-hidden relative ring-1 ring-white/5 flex flex-col h-full w-full"),i(e,"role","region"),i(e,"aria-label","Pannello controllo analisi")},m(E,U){F(E,e,U),s(e,l),s(l,n),s(n,a),s(a,f),s(f,d),s(d,r),s(f,c),s(a,u),s(a,m),x.m(m,null),s(n,p),T&&T.m(n,null),s(l,b),s(l,w),s(w,h),s(e,C),s(e,v),Je(_,v,null),s(v,A),S&&S.m(v,null),s(v,Y),B&&B.m(v,null),s(v,M),V&&V.m(v,null),s(v,O),D&&D.m(v,null),P=!0},p(E,U){(!P||U[0]&1)&&ne(r,E[0]),I!==(I=N(E))&&(x.d(1),x=I(E),x&&(x.c(),x.m(m,null))),E[0]>1||E[13].isCameraPreview?T?T.p(E,U):(T=Jt(E),T.c(),T.m(n,null)):T&&(T.d(1),T=null),(!P||U[0]&1)&&Lt(h,"width",E[0]/3*100+"%");const W={};U[0]&256&&(W.show=E[8]),U[0]&2048&&(W.loading=E[11]),U[0]&512&&(W.cameras=E[9]),U[0]&4096&&(W.error=E[12]),!j&&U[0]&1024&&(j=!0,W.selectedIndex=E[10],El(()=>j=!1)),_.$set(W),E[5]?S?S.p(E,U):(S=qt(E),S.c(),S.m(v,Y)):S&&(S.d(1),S=null),E[0]===1?B?B.p(E,U):(B=Zt(E),B.c(),B.m(v,M)):B&&(B.d(1),B=null),E[0]===2?V?V.p(E,U):(V=Xt(E),V.c(),V.m(v,O)):V&&(V.d(1),V=null),E[0]===3?D?D.p(E,U):(D=$t(E),D.c(),D.m(v,null)):D&&(D.d(1),D=null)},i(E){P||(ze(_.$$.fragment,E),P=!0)},o(E){Ie(_.$$.fragment,E),P=!1},d(E){E&&L(e),x.d(),T&&T.d(),qe(_),S&&S.d(),B&&B.d(),V&&V.d(),D&&D.d()}}}function wn(t,e,l){let n;nt(t,le,g=>l(13,n=g));let{currentStep:a=1}=e;const f=gt();let d=null,r=!1,c=30,u=192,m=97,p="",b=!1,w=!1,h=!1,C=[],v=null,_=!1,j="";async function A(g){if(d=g.target.files[0],d){try{const z=URL.createObjectURL(d);Hl(z)}catch{}kt("upload"),await Y()}}async function Y(){if(!d)return;l(1,r=!0),l(5,p="");const g=new FormData;g.append("video",d);try{const R=await(await fetch(`${be()}/api/video/upload`,{method:"POST",body:g})).json();R.success?(l(2,c=Math.round(R.fps)||30),f("stepComplete",{step:1,data:R})):l(5,p=R.error||"Errore caricamento video")}catch{l(5,p="Errore di connessione al server")}finally{l(1,r=!1)}}function M(){l(12,j=""),l(8,h=!0),O()}async function O(){l(11,_=!0),l(9,C=[]),l(10,v=null);try{const g=await $l();g.length>0?(l(9,C=g),l(10,v=0)):l(12,j="Nessuna fotocamera trovata")}catch{l(12,j="Errore rilevamento fotocamere")}finally{l(11,_=!1)}}async function P(){if(l(12,j=""),v==null){l(12,j="Seleziona una fotocamera");return}try{l(8,h=!1);try{Ct(n.previewStream);const g=await en(Number(v),C);Ol(g),yt(!0),kt("camera")}catch{l(12,j="Impossibile avviare l'anteprima fotocamera")}}catch{l(12,j="Errore apertura anteprima")}}async function N(){try{if(v!=null)try{await de.setCamera(Number(v))}catch{l(5,p="Errore impostazione fotocamera");return}try{Ct(n.previewStream)}catch{}xt(),yt(!1);const g=await de.startRecording();g.success?le.update(z=>({...z,isRecording:!0})):l(5,p=g.error||"Errore avvio registrazione")}catch{l(5,p="Errore di connessione al server")}}async function I(){try{const z=await(await fetch(`${be()}/api/recording/stop`,{method:"POST"})).json();z.success&&(le.update(R=>({...R,isRecording:!1})),f("stepComplete",{step:1,data:z}))}catch{l(5,p="Errore stop registrazione")}}async function x(){l(5,p="");try{await de.setFps(c),await de.setHeight(u),await de.setMass(m)}catch{l(5,p="Errore impostazioni");return}try{const g=await fetch(`${be()}/api/video/info`).then(z=>z.json());if(!(g!=null&&g.video_path)){l(5,p="Nessun video disponibile. Registra o carica prima il video.");return}}catch{l(5,p="Errore verifica video disponibile");return}try{const g=await de.startCalibration();g.success?(l(6,b=!0),le.update(z=>({...z,isCalibrating:!0})),T()):l(5,p=g.error||"Errore calibrazione")}catch{l(5,p="Errore di connessione")}}async function T(){const g=setInterval(async()=>{try{const z=await de.calibrationStatus();z.success&&!z.in_progress?(clearInterval(g),l(6,b=!1),le.update(R=>({...R,isCalibrating:!1})),f("stepComplete",{step:2,data:z}),await k()):z.success===!1&&!z.in_progress&&(clearInterval(g),l(6,b=!1),le.update(R=>({...R,isCalibrating:!1})),l(5,p="Calibrazione fallita"))}catch{clearInterval(g),l(6,b=!1),l(5,p="Errore verifica calibrazione")}},500)}async function k(){l(5,p="");try{const g=await de.startAnalysis();g.success?(l(7,w=!0),le.update(z=>({...z,isAnalyzing:!0})),$()):l(5,p=g.error||"Errore avvio analisi")}catch{l(5,p="Errore di connessione")}}async function $(){const g=setInterval(async()=>{try{if(!(await de.analysisStatus()).is_analyzing){clearInterval(g);const R=await de.analysisResults();R.success&&(l(7,w=!1),le.update(ee=>({...ee,isAnalyzing:!1})),f("stepComplete",{step:3,data:{...R.results,trajectory:R.trajectory,velocity:R.velocity,phase_times:R.phase_times}}))}}catch{}},500)}async function S(){try{await de.pauseAnalysis(),le.update(g=>({...g,isPaused:!0}))}catch{}}async function B(){try{await de.resumeAnalysis(),le.update(g=>({...g,isPaused:!1}))}catch{}}async function V(){try{await de.stopAnalysis()}catch{}f("cancelToStep1")}function D(){a===1&&n.isCameraPreview?E():f("goBack")}async function E(){try{Ct(n.previewStream)}catch{}xt(),yt(!1),kt("none"),l(10,v=null)}function U(g){v=g,l(10,v)}const W=()=>l(8,h=!1),Z=g=>l(10,v=g.detail.index);function G(){c=Ae(this.value),l(2,c)}function q(){u=Ae(this.value),l(3,u)}function K(){m=Ae(this.value),l(4,m)}return t.$$set=g=>{"currentStep"in g&&l(0,a=g.currentStep)},[a,r,c,u,m,p,b,w,h,C,v,_,j,n,A,M,P,N,I,x,k,S,B,V,D,U,W,Z,G,q,K]}class yn extends Ke{constructor(e){super(),Ze(this,e,wn,_n,Le,{currentStep:0},null,[-1,-1])}}function ll(t){let e;return{c(){e=o("div"),i(e,"class","absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-500 shadow-[0_0_10px_rgba(99,102,241,0.5)]")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function nl(t){let e;return{c(){e=o("div"),i(e,"class","absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-500 shadow-[0_0_10px_rgba(99,102,241,0.5)]")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function il(t){let e,l,n,a,f,d,r,c=t[0].max_height+"",u,m,p,b,w,h,C,v,_,j=t[0].flight_time+"",A,Y,M,O,P,N,I,x,T,k=(t[0].calculated_takeoff_velocity||t[0].takeoff_velocity||0).toFixed(1)+"",$,S,B,V,D,E,U,W,Z,G=(t[0].calculated_estimated_power||t[0].estimated_power||0).toFixed(0)+"",q,K,g,z,R,ee,Te,se,ce,ke,te,ae,ge=(t[0].calculated_contact_time||t[0].contact_time||0).toFixed(3)+"",Ce,De,ue,pe,Me,Qe,J,we=(t[0].calculated_eccentric_time||t[0].eccentric_time||0).toFixed(3)+"",ve,ye,dl,He,ot,fl,Xe,rt=(t[0].calculated_concentric_time||t[0].concentric_time||0).toFixed(3)+"",At,ul,pl,Oe,ct,ml,Ne,Ue,dt,hl,$e,ft=(t[0].calculated_average_force||t[0].average_force||0).toFixed(1)+"",Et,bl,gl,Ye,ut,vl,et,pt=t[0].jump_detected?"SÃ¬":"No",Pt,mt;return{c(){e=o("div"),l=o("div"),n=o("div"),a=o("div"),a.innerHTML='<span class="text-[10px] text-slate-400 uppercase tracking-wide font-semibold">Altezza Max</span> <svg class="w-3 h-3 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>',f=y(),d=o("div"),r=o("span"),u=H(c),m=y(),p=o("span"),p.textContent="cm",b=y(),w=o("div"),h=o("div"),h.innerHTML='<span class="text-[10px] text-slate-400 uppercase tracking-wide font-semibold">Tempo Volo</span> <svg class="w-3 h-3 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>',C=y(),v=o("div"),_=o("span"),A=H(j),Y=y(),M=o("span"),M.textContent="s",O=y(),P=o("div"),N=o("div"),N.innerHTML='<span class="text-[10px] text-slate-400 uppercase tracking-wide font-semibold">Vel. Decollo</span> <svg class="w-3 h-3 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>',I=y(),x=o("div"),T=o("span"),$=H(k),S=y(),B=o("span"),B.textContent="cm/s",V=y(),D=o("div"),E=o("div"),E.innerHTML='<span class="text-[10px] text-slate-400 uppercase tracking-wide font-semibold">Potenza</span> <svg class="w-3 h-3 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>',U=y(),W=o("div"),Z=o("span"),q=H(G),K=y(),g=o("span"),g.textContent="W",z=y(),R=o("div"),ee=o("div"),ee.innerHTML='<h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">Fasi Temporali</h3>',Te=y(),se=o("div"),ce=o("div"),ke=o("span"),ke.textContent="Tempo Contatto",te=y(),ae=o("span"),Ce=H(ge),De=H(" s"),ue=y(),pe=o("div"),Me=o("span"),Me.textContent="Fase Eccentrica",Qe=y(),J=o("span"),ve=H(we),ye=H(" s"),dl=y(),He=o("div"),ot=o("span"),ot.textContent="Fase Concentrica",fl=y(),Xe=o("span"),At=H(rt),ul=H(" s"),pl=y(),Oe=o("div"),ct=o("div"),ct.innerHTML='<h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">Biomeccanica</h3>',ml=y(),Ne=o("div"),Ue=o("div"),dt=o("span"),dt.textContent="Forza Media",hl=y(),$e=o("span"),Et=H(ft),bl=H(" N"),gl=y(),Ye=o("div"),ut=o("span"),ut.textContent="Salto Valido",vl=y(),et=o("span"),Pt=H(pt),i(a,"class","flex justify-between items-start mb-1"),i(r,"class","text-2xl font-bold tracking-tight text-emerald-400"),i(p,"class","text-xs text-slate-500 font-medium"),i(d,"class","flex items-baseline gap-1 mt-auto"),i(n,"class","relative group flex flex-col p-3 bg-slate-900/40 rounded-lg border border-slate-700/50 hover:border-slate-600 transition-all hover:bg-slate-800/60"),i(h,"class","flex justify-between items-start mb-1"),i(_,"class","text-2xl font-bold tracking-tight text-blue-400"),i(M,"class","text-xs text-slate-500 font-medium"),i(v,"class","flex items-baseline gap-1 mt-auto"),i(w,"class","relative group flex flex-col p-3 bg-slate-900/40 rounded-lg border border-slate-700/50 hover:border-slate-600 transition-all hover:bg-slate-800/60"),i(N,"class","flex justify-between items-start mb-1"),i(T,"class","text-2xl font-bold tracking-tight text-purple-400"),i(B,"class","text-xs text-slate-500 font-medium"),i(x,"class","flex items-baseline gap-1 mt-auto"),i(P,"class","relative group flex flex-col p-3 bg-slate-900/40 rounded-lg border border-slate-700/50 hover:border-slate-600 transition-all hover:bg-slate-800/60"),i(E,"class","flex justify-between items-start mb-1"),i(Z,"class","text-2xl font-bold tracking-tight text-amber-400"),i(g,"class","text-xs text-slate-500 font-medium"),i(W,"class","flex items-baseline gap-1 mt-auto"),i(D,"class","relative group flex flex-col p-3 bg-slate-900/40 rounded-lg border border-slate-700/50 hover:border-slate-600 transition-all hover:bg-slate-800/60"),i(l,"class","grid grid-cols-2 gap-3"),i(ee,"class","px-4 py-2 border-b border-slate-700 bg-slate-800/50 flex justify-between items-center"),i(ke,"class","text-sm text-slate-400 font-medium"),i(ae,"class","text-sm font-mono font-bold text-slate-200"),i(ce,"class","flex justify-between items-center py-2 border-b border-slate-700/40 last:border-0"),i(Me,"class","text-sm text-slate-400 font-medium"),i(J,"class","text-sm font-mono font-bold text-slate-200"),i(pe,"class","flex justify-between items-center py-2 border-b border-slate-700/40 last:border-0"),i(ot,"class","text-sm text-slate-400 font-medium"),i(Xe,"class","text-sm font-mono font-bold text-slate-200"),i(He,"class","flex justify-between items-center py-2 border-b border-slate-700/40 last:border-0"),i(se,"class","p-4 flex flex-col gap-0.5"),i(R,"class","bg-slate-800 rounded-lg border border-slate-700 overflow-hidden shadow-sm"),i(ct,"class","px-4 py-2 border-b border-slate-700 bg-slate-800/50 flex justify-between items-center"),i(dt,"class","text-sm text-slate-400 font-medium"),i($e,"class","text-sm font-mono font-bold text-slate-200"),i(Ue,"class","flex justify-between items-center py-2 border-b border-slate-700/40 last:border-0"),i(ut,"class","text-sm text-slate-400 font-medium"),i(et,"class",mt=fe(`text-sm font-mono font-bold px-2 py-0.5 rounded ${t[0].jump_detected?"text-emerald-400 bg-emerald-400/10":"text-red-400 bg-red-400/10"}`)+" svelte-l1fefl"),i(Ye,"class","flex justify-between items-center py-2 border-b border-slate-700/40 last:border-0"),i(Ne,"class","p-4 flex flex-col gap-0.5"),i(Oe,"class","bg-slate-800 rounded-lg border border-slate-700 overflow-hidden shadow-sm"),i(e,"class","space-y-5")},m(ie,me){F(ie,e,me),s(e,l),s(l,n),s(n,a),s(n,f),s(n,d),s(d,r),s(r,u),s(d,m),s(d,p),s(l,b),s(l,w),s(w,h),s(w,C),s(w,v),s(v,_),s(_,A),s(v,Y),s(v,M),s(l,O),s(l,P),s(P,N),s(P,I),s(P,x),s(x,T),s(T,$),s(x,S),s(x,B),s(l,V),s(l,D),s(D,E),s(D,U),s(D,W),s(W,Z),s(Z,q),s(W,K),s(W,g),s(e,z),s(e,R),s(R,ee),s(R,Te),s(R,se),s(se,ce),s(ce,ke),s(ce,te),s(ce,ae),s(ae,Ce),s(ae,De),s(se,ue),s(se,pe),s(pe,Me),s(pe,Qe),s(pe,J),s(J,ve),s(J,ye),s(se,dl),s(se,He),s(He,ot),s(He,fl),s(He,Xe),s(Xe,At),s(Xe,ul),s(e,pl),s(e,Oe),s(Oe,ct),s(Oe,ml),s(Oe,Ne),s(Ne,Ue),s(Ue,dt),s(Ue,hl),s(Ue,$e),s($e,Et),s($e,bl),s(Ne,gl),s(Ne,Ye),s(Ye,ut),s(Ye,vl),s(Ye,et),s(et,Pt)},p(ie,me){me&1&&c!==(c=ie[0].max_height+"")&&ne(u,c),me&1&&j!==(j=ie[0].flight_time+"")&&ne(A,j),me&1&&k!==(k=(ie[0].calculated_takeoff_velocity||ie[0].takeoff_velocity||0).toFixed(1)+"")&&ne($,k),me&1&&G!==(G=(ie[0].calculated_estimated_power||ie[0].estimated_power||0).toFixed(0)+"")&&ne(q,G),me&1&&ge!==(ge=(ie[0].calculated_contact_time||ie[0].contact_time||0).toFixed(3)+"")&&ne(Ce,ge),me&1&&we!==(we=(ie[0].calculated_eccentric_time||ie[0].eccentric_time||0).toFixed(3)+"")&&ne(ve,we),me&1&&rt!==(rt=(ie[0].calculated_concentric_time||ie[0].concentric_time||0).toFixed(3)+"")&&ne(At,rt),me&1&&ft!==(ft=(ie[0].calculated_average_force||ie[0].average_force||0).toFixed(1)+"")&&ne(Et,ft),me&1&&pt!==(pt=ie[0].jump_detected?"SÃ¬":"No")&&ne(Pt,pt),me&1&&mt!==(mt=fe(`text-sm font-mono font-bold px-2 py-0.5 rounded ${ie[0].jump_detected?"text-emerald-400 bg-emerald-400/10":"text-red-400 bg-red-400/10"}`)+" svelte-l1fefl")&&i(et,"class",mt)},d(ie){ie&&L(e)}}}function sl(t){let e,l,n,a,f,d,r,c,u,m,p,b,w,h,C,v,_,j,A,Y,M,O,P,N,I=(t[2]==="trajectory"||t[2]==="combined")&&al(),x=(t[2]==="velocity"||t[2]==="combined")&&ol();return{c(){e=o("div"),l=o("div"),n=o("h3"),n.textContent="Analisi Curve",a=y(),f=o("div"),d=o("button"),r=H("Pos."),u=y(),m=o("button"),p=H("Vel."),w=y(),h=o("button"),C=H("Conf."),_=y(),j=o("div"),A=o("canvas"),Y=y(),M=o("div"),I&&I.c(),O=y(),x&&x.c(),i(n,"class","text-xs font-bold text-slate-400 uppercase"),i(d,"class",c=fe(`px-3 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${t[2]==="trajectory"?"bg-indigo-600 text-white shadow-sm":"text-slate-400 hover:text-white hover:bg-slate-700"}`)+" svelte-l1fefl"),i(m,"class",b=fe(`px-3 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${t[2]==="velocity"?"bg-indigo-600 text-white shadow-sm":"text-slate-400 hover:text-white hover:bg-slate-700"}`)+" svelte-l1fefl"),i(h,"class",v=fe(`px-3 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${t[2]==="combined"?"bg-indigo-600 text-white shadow-sm":"text-slate-400 hover:text-white hover:bg-slate-700"}`)+" svelte-l1fefl"),i(f,"class","flex gap-1 bg-slate-800 p-1 rounded-lg border border-slate-700"),i(l,"class","flex justify-between items-center mb-4"),i(A,"class","w-full h-full object-contain block"),i(M,"class","absolute top-4 right-4 bg-slate-900/90 p-3 rounded-lg border border-slate-800 backdrop-blur-md shadow-xl pointer-events-none"),i(j,"class","flex-1 min-h-[250px] bg-slate-950 rounded-xl border border-slate-800 shadow-inner relative overflow-hidden group mb-4"),i(e,"class","h-full flex flex-col")},m(T,k){F(T,e,k),s(e,l),s(l,n),s(l,a),s(l,f),s(f,d),s(d,r),s(f,u),s(f,m),s(m,p),s(f,w),s(f,h),s(h,C),s(e,_),s(e,j),s(j,A),t[13](A),s(j,Y),s(j,M),I&&I.m(M,null),s(M,O),x&&x.m(M,null),P||(N=[X(d,"click",t[10]),X(m,"click",t[11]),X(h,"click",t[12])],P=!0)},p(T,k){k&4&&c!==(c=fe(`px-3 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${T[2]==="trajectory"?"bg-indigo-600 text-white shadow-sm":"text-slate-400 hover:text-white hover:bg-slate-700"}`)+" svelte-l1fefl")&&i(d,"class",c),k&4&&b!==(b=fe(`px-3 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${T[2]==="velocity"?"bg-indigo-600 text-white shadow-sm":"text-slate-400 hover:text-white hover:bg-slate-700"}`)+" svelte-l1fefl")&&i(m,"class",b),k&4&&v!==(v=fe(`px-3 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${T[2]==="combined"?"bg-indigo-600 text-white shadow-sm":"text-slate-400 hover:text-white hover:bg-slate-700"}`)+" svelte-l1fefl")&&i(h,"class",v),T[2]==="trajectory"||T[2]==="combined"?I||(I=al(),I.c(),I.m(M,O)):I&&(I.d(1),I=null),T[2]==="velocity"||T[2]==="combined"?x||(x=ol(),x.c(),x.m(M,null)):x&&(x.d(1),x=null)},d(T){T&&L(e),t[13](null),I&&I.d(),x&&x.d(),P=!1,he(N)}}}function al(t){let e;return{c(){e=o("div"),e.innerHTML='<div class="w-2 h-2 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.6)]"></div> <span class="text-[10px] font-medium text-slate-300">Altezza</span>',i(e,"class","flex items-center gap-2 mb-2")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function ol(t){let e;return{c(){e=o("div"),e.innerHTML='<div class="w-2 h-2 rounded-full bg-purple-400 shadow-[0_0_8px_rgba(167,139,250,0.6)]"></div> <span class="text-[10px] font-medium text-slate-300">VelocitÃ </span>',i(e,"class","flex items-center gap-2")},m(l,n){F(l,e,n)},d(l){l&&L(e)}}}function rl(t){let e,l;return{c(){e=o("div"),l=H(t[5]),i(e,"class","mb-3 text-center text-xs font-medium text-emerald-400 bg-emerald-900/20 py-1 rounded")},m(n,a){F(n,e,a),s(e,l)},p(n,a){a&32&&ne(l,n[5])},d(n){n&&L(e)}}}function xn(t){let e,l,n,a,f,d,r,c,u,m,p,b,w,h,C,v,_,j,A,Y,M,O,P,N,I,x,T,k,$,S,B,V,D,E,U,W,Z=t[1]==="metrics"&&ll(),G=t[1]==="charts"&&nl(),q=t[1]==="metrics"&&il(t),K=t[1]==="charts"&&sl(t),g=t[5]&&rl(t);return{c(){e=o("div"),l=o("div"),n=o("div"),n.innerHTML='<div class="flex items-center gap-2.5"><span class="relative flex h-2.5 w-2.5"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span></span> <span class="text-emerald-400 text-xs font-bold uppercase tracking-wider">Analisi Completata</span></div>',a=y(),f=o("div"),d=o("button"),r=re("svg"),c=re("path"),m=H(`\r
         Metriche\r
         `),Z&&Z.c(),b=y(),w=o("button"),h=re("svg"),C=re("polyline"),v=re("polyline"),j=H(`\r
         Grafici\r
         `),G&&G.c(),Y=y(),M=o("div"),q&&q.c(),O=y(),K&&K.c(),P=y(),N=o("div"),g&&g.c(),I=y(),x=o("div"),T=o("button"),k=re("svg"),$=re("path"),S=re("polyline"),B=re("polyline"),V=H(`\r
            Salva Dati`),D=y(),E=o("button"),E.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path></svg>
            Nuova Analisi`,i(n,"class","px-5 py-3 flex items-center justify-between bg-emerald-950/30 border-b border-emerald-500/10"),i(c,"d","M22 12h-4l-3 9L9 3l-3 9H2"),i(r,"xmlns","http://www.w3.org/2000/svg"),i(r,"width","16"),i(r,"height","16"),i(r,"viewBox","0 0 24 24"),i(r,"fill","none"),i(r,"stroke","currentColor"),i(r,"stroke-width","2"),i(r,"stroke-linecap","round"),i(r,"stroke-linejoin","round"),i(r,"class",u=t[1]==="metrics"?"text-indigo-400":""),i(d,"class",p=fe(`flex-1 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-all relative ${t[1]==="metrics"?"text-white":"text-slate-500 hover:text-slate-300"}`)+" svelte-l1fefl"),i(C,"points","23 6 13.5 15.5 8.5 10.5 1 18"),i(v,"points","17 6 23 6 23 12"),i(h,"xmlns","http://www.w3.org/2000/svg"),i(h,"width","16"),i(h,"height","16"),i(h,"viewBox","0 0 24 24"),i(h,"fill","none"),i(h,"stroke","currentColor"),i(h,"stroke-width","2"),i(h,"stroke-linecap","round"),i(h,"stroke-linejoin","round"),i(h,"class",_=t[1]==="charts"?"text-indigo-400":""),i(w,"class",A=fe(`flex-1 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-all relative ${t[1]==="charts"?"text-white":"text-slate-500 hover:text-slate-300"}`)+" svelte-l1fefl"),i(f,"class","flex border-b border-slate-800 bg-slate-900/50"),i(l,"class","shrink-0 bg-slate-900 z-10"),i(M,"class","flex-1 overflow-y-auto p-5 custom-scrollbar bg-slate-900/50 svelte-l1fefl"),i($,"d","M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"),i(S,"points","17 21 17 13 7 13 7 21"),i(B,"points","7 3 7 8 15 8"),i(k,"xmlns","http://www.w3.org/2000/svg"),i(k,"width","18"),i(k,"height","18"),i(k,"viewBox","0 0 24 24"),i(k,"fill","none"),i(k,"stroke","currentColor"),i(k,"stroke-width","2"),i(k,"stroke-linecap","round"),i(k,"stroke-linejoin","round"),T.disabled=t[4],i(T,"class","flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 text-slate-200 py-3 rounded-xl text-sm font-semibold transition-all border border-slate-700 hover:border-slate-600 active:scale-[0.98]"),i(E,"class","flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-xl text-sm font-semibold transition-all shadow-lg shadow-indigo-900/20 hover:shadow-indigo-900/40 active:scale-[0.98]"),i(x,"class","grid grid-cols-2 gap-3"),i(N,"class","shrink-0 p-4 bg-slate-900 border-t border-slate-800 z-20 shadow-[0_-5px_20px_rgba(0,0,0,0.3)]"),i(e,"class","bg-slate-900 rounded-2xl border border-slate-800 shadow-xl overflow-hidden relative ring-1 ring-white/5 flex flex-col h-full w-full")},m(z,R){F(z,e,R),s(e,l),s(l,n),s(l,a),s(l,f),s(f,d),s(d,r),s(r,c),s(d,m),Z&&Z.m(d,null),s(f,b),s(f,w),s(w,h),s(h,C),s(h,v),s(w,j),G&&G.m(w,null),s(e,Y),s(e,M),q&&q.m(M,null),s(M,O),K&&K.m(M,null),s(e,P),s(e,N),g&&g.m(N,null),s(N,I),s(N,x),s(x,T),s(T,k),s(k,$),s(k,S),s(k,B),s(T,V),s(x,D),s(x,E),U||(W=[X(d,"click",t[8]),X(w,"click",t[9]),X(T,"click",t[7]),X(E,"click",t[14])],U=!0)},p(z,[R]){R&2&&u!==(u=z[1]==="metrics"?"text-indigo-400":"")&&i(r,"class",u),z[1]==="metrics"?Z||(Z=ll(),Z.c(),Z.m(d,null)):Z&&(Z.d(1),Z=null),R&2&&p!==(p=fe(`flex-1 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-all relative ${z[1]==="metrics"?"text-white":"text-slate-500 hover:text-slate-300"}`)+" svelte-l1fefl")&&i(d,"class",p),R&2&&_!==(_=z[1]==="charts"?"text-indigo-400":"")&&i(h,"class",_),z[1]==="charts"?G||(G=nl(),G.c(),G.m(w,null)):G&&(G.d(1),G=null),R&2&&A!==(A=fe(`flex-1 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-all relative ${z[1]==="charts"?"text-white":"text-slate-500 hover:text-slate-300"}`)+" svelte-l1fefl")&&i(w,"class",A),z[1]==="metrics"?q?q.p(z,R):(q=il(z),q.c(),q.m(M,O)):q&&(q.d(1),q=null),z[1]==="charts"?K?K.p(z,R):(K=sl(z),K.c(),K.m(M,null)):K&&(K.d(1),K=null),z[5]?g?g.p(z,R):(g=rl(z),g.c(),g.m(N,I)):g&&(g.d(1),g=null),R&16&&(T.disabled=z[4])},i:Q,o:Q,d(z){z&&L(e),Z&&Z.d(),G&&G.d(),q&&q.d(),K&&K.d(),g&&g.d(),U=!1,he(W)}}}const Se=5;function Mt(t,e,l,n){t.clearRect(0,0,e,l),t.fillStyle=n,t.fillRect(0,0,e,l)}function St(t,{padding:e,width:l,height:n,chartWidth:a,chartHeight:f,minT:d,deltaT:r,minY:c,deltaY:u,style:m,xFormatter:p,yFormatter:b}){t.strokeStyle=m.grid,t.lineWidth=1,t.fillStyle=m.label,t.font="10px Inter",t.textAlign="right",t.textBaseline="middle";for(let h=0;h<=Se;h++){const C=h/Se,v=e+f*C,_=c+u*(Se-h)/Se;t.beginPath(),t.moveTo(e,v),t.lineTo(l-e,v),t.stroke(),t.fillText(b(_),e-8,v)}t.textAlign="center",t.textBaseline="top";const w=5;for(let h=0;h<=w;h++){const C=h/w,v=e+a*C,_=d+r*C;t.beginPath(),t.moveTo(v,e),t.lineTo(v,n-e),t.stroke(),t.fillText(p(_),v,n-e+8)}}function Tt(t,e,l,n,a,f,d){const r=(c,u,m)=>{if(c!=null&&u!=null){const p=a+(c-l)/n*f,b=a+(u-l)/n*f;t.fillStyle=m,t.fillRect(p,a,b-p,d)}};r(e.eccentricStart,e.eccentricEnd,"rgba(255, 165, 0, 0.1)"),r(e.concentricStart,e.concentricEnd,"rgba(74, 222, 128, 0.1)")}function jt(t,e,l,n,a,f,d){const r=(c,u)=>{if(c==null)return;const m=a+(c-l)/n*f;t.strokeStyle=u,t.setLineDash([4,4]),t.beginPath(),t.moveTo(m,a),t.lineTo(m,d-a),t.stroke(),t.setLineDash([])};r(e.contactStart,"rgba(255, 255, 0, 0.6)"),r(e.eccentricEnd,"rgba(255, 165, 0, 0.6)"),r(e.takeoff,"rgba(255, 0, 0, 0.6)")}function kn(t,e,l){let n;nt(t,le,x=>l(17,n=x));let{results:a}=e;const f=gt();let d="metrics",r="trajectory",c=!1,u="",m,p=[],b=null;const w={background:"#020617",grid:"#1e293b",line:"#4ade80",lineShadow:"rgba(74, 222, 128, 0.35)",label:"#94a3b8"},h={background:"#020617",grid:"#1e293b",line:"#a78bfa",lineShadow:"rgba(167, 139, 250, 0.35)",label:"#a78bfa",zero:"#64748b"};function C(){if(!m||n.trajectoryData.length===0)return;const x=window.devicePixelRatio||1,T=m.getBoundingClientRect();l(3,m.width=T.width*x,m),l(3,m.height=T.height*x,m);const k=m.getContext("2d");k.scale(x,x);const $=T.width,S=T.height,B=40,V=$-2*B,D=S-2*B;Mt(k,$,S,w.background);const E=n.trajectoryData,U=Math.max(...E.map(g=>g.t)),W=Math.min(...E.map(g=>g.t)),Z=Math.max(...E.map(g=>g.y)),G=Math.min(...E.map(g=>g.y)),q=U===W?1:U-W,K=Z===G?1:Z-G;St(k,{padding:B,width:$,height:S,chartWidth:V,chartHeight:D,minT:W,deltaT:q,minY:G,deltaY:K,style:w,xFormatter:g=>g.toFixed(2),yFormatter:g=>g.toFixed(0)}),b&&Tt(k,b,W,q,B,V,D),k.lineWidth=3,k.strokeStyle=w.line,k.lineJoin="round",k.lineCap="round",k.shadowColor=w.lineShadow,k.shadowBlur=10,k.beginPath(),E.forEach((g,z)=>{const R=B+(g.t-W)/q*V,ee=S-B-(g.y-G)/K*D;z===0?k.moveTo(R,ee):k.lineTo(R,ee)}),k.stroke(),k.shadowBlur=0,b&&jt(k,b,W,q,B,V,S)}function v(){if(!m||p.length===0)return;const x=window.devicePixelRatio||1,T=m.getBoundingClientRect();l(3,m.width=T.width*x,m),l(3,m.height=T.height*x,m);const k=m.getContext("2d");k.scale(x,x);const $=T.width,S=T.height,B=40,V=$-2*B,D=S-2*B;Mt(k,$,S,h.background);const E=p,U=Math.max(...E.map(g=>g.t)),W=Math.min(...E.map(g=>g.t)),Z=Math.max(...E.map(g=>g.v)),G=Math.min(...E.map(g=>g.v)),q=U===W?1:U-W,K=Z===G?Math.abs(Z)||1:Z-G;if(St(k,{padding:B,width:$,height:S,chartWidth:V,chartHeight:D,minT:W,deltaT:q,minY:G,deltaY:K,style:h,xFormatter:g=>g.toFixed(2),yFormatter:g=>g.toFixed(0)}),G<=0&&Z>=0){const g=S-B-(0-G)/K*D;k.strokeStyle=h.zero,k.setLineDash([5,5]),k.beginPath(),k.moveTo(B,g),k.lineTo($-B,g),k.stroke(),k.setLineDash([])}b&&Tt(k,b,W,q,B,V,D),k.lineWidth=3,k.strokeStyle=h.line,k.lineJoin="round",k.shadowColor=h.lineShadow,k.shadowBlur=10,k.beginPath(),E.forEach((g,z)=>{const R=B+(g.t-W)/q*V,ee=S-B-(g.v-G)/K*D;z===0?k.moveTo(R,ee):k.lineTo(R,ee)}),k.stroke(),k.shadowBlur=0,b&&jt(k,b,W,q,B,V,S)}function _(){var Qe;if(!m)return;const x=n.trajectoryData,T=p;if(x.length===0||T.length===0)return;const k=window.devicePixelRatio||1,$=m.getBoundingClientRect();l(3,m.width=$.width*k,m),l(3,m.height=$.height*k,m);const S=m.getContext("2d");S.scale(k,k);const B=$.width,V=$.height,D=40,E=B-2*D,U=V-2*D;Mt(S,B,V,w.background);const W=((Qe=x[0])==null?void 0:Qe.y)||0,Z=x.map(J=>({...J,y:J.y-W}));let G=Math.max(0,...Z.map(J=>J.y)),q=Math.min(0,...Z.map(J=>J.y)),K=Math.max(0,...T.map(J=>J.v)),g=Math.min(0,...T.map(J=>J.v));const z=G-q||1,R=K-g||1,ee=Math.abs(q)/z,Te=Math.abs(g)/R,se=Math.max(ee,Te);let ce=q,ke=G,te=g,ae=K;ee<se&&(ce=-(se*G)/(1-se)),Te<se&&(te=-(se*K)/(1-se));const ge=ke-ce||1,Ce=ae-te||1,De=Math.max(...x.map(J=>J.t),...T.map(J=>J.t)),ue=Math.min(...x.map(J=>J.t),...T.map(J=>J.t)),pe=De-ue||1;St(S,{padding:D,width:B,height:V,chartWidth:E,chartHeight:U,minT:ue,deltaT:pe,minY:ce,deltaY:ge,style:w,xFormatter:J=>J.toFixed(2),yFormatter:J=>J.toFixed(0)});const Me=V-D-(0-ce)/ge*U;Me>=D&&Me<=V-D&&(S.strokeStyle="#64748b",S.setLineDash([4,4]),S.lineWidth=1.5,S.beginPath(),S.moveTo(D,Me),S.lineTo(B-D,Me),S.stroke(),S.setLineDash([])),b&&Tt(S,b,ue,pe,D,E,U),S.lineWidth=3,S.strokeStyle=w.line,S.lineJoin="round",S.shadowColor=w.lineShadow,S.shadowBlur=10,S.beginPath(),Z.forEach((J,we)=>{const ve=D+(J.t-ue)/pe*E,ye=V-D-(J.y-ce)/ge*U;we===0?S.moveTo(ve,ye):S.lineTo(ve,ye)}),S.stroke(),S.shadowBlur=0,S.lineWidth=3,S.strokeStyle=h.line,S.shadowColor=h.lineShadow,S.shadowBlur=10,S.beginPath(),T.forEach((J,we)=>{const ve=D+(J.t-ue)/pe*E,ye=V-D-(J.v-te)/Ce*U;we===0?S.moveTo(ve,ye):S.lineTo(ve,ye)}),S.stroke(),S.shadowBlur=0,S.fillStyle=h.label,S.textAlign="left",S.textBaseline="middle";for(let J=0;J<=Se;J++){const we=J/Se,ve=D+U*we,ye=te+Ce*(Se-J)/Se;S.fillText(ye.toFixed(0),B-D+8,ve)}b&&jt(S,b,ue,pe,D,E,V)}async function j(){l(4,c=!0),l(5,u="");try{const T=await(await fetch(`${be()}/api/results/save`,{method:"POST"})).json();T.success?l(5,u="Risultati salvati!"):l(5,u=T.error||"Errore salvataggio")}catch{l(5,u="Errore connessione")}finally{l(4,c=!1),setTimeout(()=>l(5,u=""),3e3)}}const A=()=>l(1,d="metrics"),Y=()=>l(1,d="charts"),M=()=>l(2,r="trajectory"),O=()=>l(2,r="velocity"),P=()=>l(2,r="combined");function N(x){Ee[x?"unshift":"push"](()=>{m=x,l(3,m)})}const I=()=>f("reset");return t.$$set=x=>{"results"in x&&l(0,a=x.results)},t.$$.update=()=>{t.$$.dirty&1&&a&&(p=a.velocity||[],b=a.phase_times||null,a.trajectory&&yl(le,n.trajectoryData=a.trajectory,n)),t.$$.dirty&14&&d==="charts"&&m&&setTimeout(()=>{r==="trajectory"?C():r==="velocity"?v():r==="combined"&&_()},50)},[a,d,r,m,c,u,f,j,A,Y,M,O,P,N,I]}class Cn extends Ke{constructor(e){super(),Ze(this,e,kn,xn,Le,{results:0})}}function Mn(t){let e,l;return e=new Cn({props:{results:t[2]}}),e.$on("reset",t[5]),{c(){at(e.$$.fragment)},m(n,a){Je(e,n,a),l=!0},p(n,a){const f={};a&4&&(f.results=n[2]),e.$set(f)},i(n){l||(ze(e.$$.fragment,n),l=!0)},o(n){Ie(e.$$.fragment,n),l=!1},d(n){qe(e,n)}}}function Sn(t){let e,l;return e=new yn({props:{currentStep:t[0]}}),e.$on("stepComplete",t[3]),e.$on("goBack",t[6]),e.$on("cancelToStep1",t[7]),{c(){at(e.$$.fragment)},m(n,a){Je(e,n,a),l=!0},p(n,a){const f={};a&1&&(f.currentStep=n[0]),e.$set(f)},i(n){l||(ze(e.$$.fragment,n),l=!0)},o(n){Ie(e.$$.fragment,n),l=!1},d(n){qe(e,n)}}}function Tn(t){let e,l,n,a,f,d,r,c,u,m,p,b,w,h,C,v,_,j,A;b=new Xl({props:{analysisCompleted:t[1]}});const Y=[Sn,Mn],M=[];function O(P,N){return P[1]?1:0}return C=O(t),v=M[C]=Y[C](t),{c(){e=o("main"),l=o("header"),n=o("div"),n.innerHTML=`<div class="bg-indigo-600 p-1.5 rounded-md shadow-lg shadow-indigo-500/20"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg></div>
      JumpAnalyzer <span class="text-[10px] bg-slate-800 px-1.5 py-0.5 rounded text-slate-400 font-medium border border-slate-700">PRO BETA</span>`,a=y(),f=o("div"),d=o("button"),d.textContent="Chiudi",r=y(),c=o("div"),u=y(),m=o("div"),p=o("div"),at(b.$$.fragment),w=y(),h=o("div"),v.c(),i(n,"class","font-bold text-lg text-white tracking-tight flex items-center gap-2"),i(d,"class","text-xs font-medium text-red-400 hover:text-red-300 border border-red-900/30 bg-red-900/10 px-3 py-1.5 rounded hover:bg-red-900/20 transition-colors"),i(c,"class","w-8 h-8 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 border-2 border-slate-800 cursor-pointer"),i(f,"class","flex items-center gap-4"),i(l,"class","h-14 bg-slate-900 border-b border-slate-800 flex items-center px-6 shrink-0 justify-between shadow-sm z-20"),i(p,"class","lg:col-span-8 flex flex-col h-full overflow-hidden"),i(h,"class","lg:col-span-4 flex flex-col h-full overflow-hidden"),i(m,"class","flex-1 p-4 grid grid-cols-1 lg:grid-cols-12 gap-4 overflow-hidden max-w-[1800px] mx-auto w-full"),i(e,"class","h-screen bg-slate-950 text-slate-200 font-sans flex flex-col overflow-hidden selection:bg-indigo-500/30")},m(P,N){F(P,e,N),s(e,l),s(l,n),s(l,a),s(l,f),s(f,d),s(f,r),s(f,c),s(e,u),s(e,m),s(m,p),Je(b,p,null),s(m,w),s(m,h),M[C].m(h,null),_=!0,j||(A=X(d,"click",t[4]),j=!0)},p(P,[N]){const I={};N&2&&(I.analysisCompleted=P[1]),b.$set(I);let x=C;C=O(P),C===x?M[C].p(P,N):(Dl(),Ie(M[x],1,1,()=>{M[x]=null}),Ll(),v=M[C],v?v.p(P,N):(v=M[C]=Y[C](P),v.c()),ze(v,1),v.m(h,null))},i(P){_||(ze(b.$$.fragment,P),ze(v),_=!0)},o(P){Ie(b.$$.fragment,P),Ie(v),_=!1},d(P){P&&L(e),qe(b),M[C].d(),j=!1,A()}}}let jn=500;function An(t,e,l){let n;nt(t,le,_=>l(11,n=_));let a=1,f=!1,d=null,r,c=150,u=0;async function m(){if(!(!n.isAnalyzing&&!n.isRecording&&!n.isCalibrating))try{if(n.isAnalyzing||n.isRecording||n.isCalibrating){const _=await fetch(`${be()}/api/video/frame`,{signal:AbortSignal.timeout(1e3)});if(_.ok){const j=await _.json();j.success&&j.frame&&Vt(j.frame)}}if(n.isAnalyzing){const _=await fetch(`${be()}/api/analysis/data`,{signal:AbortSignal.timeout(1e3)});if(_.ok){const j=await _.json();j.realtime&&Vl(j.realtime,j.trajectory,j.velocity)}}u>0&&(u=Math.max(0,u-1),l(9,c=Math.max(150,c-50)))}catch{u++,u>3&&l(9,c=Math.min(jn,c+50))}}Ft(()=>{l(8,r=setInterval(m,c))}),Tl(()=>{r&&clearInterval(r)});function p(_){const{step:j,data:A}=_.detail;j===1?l(0,a=2):j===2?l(0,a=3):j===3&&(l(2,d=A),l(1,f=!0))}async function b(){const _=[];n.isAnalyzing&&_.push(fetch(`${be()}/api/analysis/stop`,{method:"POST"}).catch(()=>{})),n.isRecording&&_.push(fetch(`${be()}/api/recording/stop`,{method:"POST"}).catch(()=>{})),await Promise.all(_)}async function w(){var _,j;await b();try{(j=(_=n.previewStream)==null?void 0:_.getTracks())==null||j.forEach(A=>A.stop())}catch{}xt(),le.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});try{window.close()}catch{}}function h(_=!1){l(1,f=!1),l(2,d=null),l(0,a=1),u=0,l(9,c=150),le.update(j=>({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:_?j.inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:_?j.localVideoUrl:null}))}async function C(){a>1&&(await b(),l(0,a--,a))}async function v(){await b(),l(0,a=1),h(!0)}return t.$$.update=()=>{t.$$.dirty&768&&r&&(clearInterval(r),l(8,r=setInterval(m,c)))},[a,f,d,p,w,h,C,v,r,c]}class En extends Ke{constructor(e){super(),Ze(this,e,An,Tn,Le,{})}}window.__APP_LOADING__=!0;function cl(){try{const t=document.getElementById("app");if(!t)throw new Error("Elemento #app non trovato nel DOM");t.innerHTML="";const e=new En({target:t});window.__APP_LOADED__=!0,window.__APP_LOADING__=!1}catch(t){console.error("Errore durante l'inizializzazione dell'app:",t),window.__APP_LOADING__=!1;const e=document.getElementById("app");e&&(e.innerHTML=`
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #0f172a; color: white; font-family: sans-serif; padding: 20px;">
          <div style="text-align: center; max-width: 600px;">
            <h1 style="color: #ef4444; margin-bottom: 20px;">Errore di Caricamento</h1>
            <p style="color: #94a3b8; margin-bottom: 10px;">Si Ã¨ verificato un errore durante il caricamento dell'applicazione.</p>
            <p style="color: #64748b; font-size: 14px; margin-top: 20px; word-break: break-word;">${t.message||"Errore sconosciuto"}</p>
            <p style="color: #64748b; font-size: 12px; margin-top: 10px;">Stack: ${t.stack||"N/A"}</p>
            <p style="color: #64748b; font-size: 12px; margin-top: 10px;">Apri la console del browser (F12) per maggiori dettagli.</p>
          </div>
        </div>
      `)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",cl):cl()})();
