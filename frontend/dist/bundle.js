var sn=Object.defineProperty;var on=(ee,Oe,Xe)=>Oe in ee?sn(ee,Oe,{enumerable:!0,configurable:!0,writable:!0,value:Xe}):ee[Oe]=Xe;var cl=(ee,Oe,Xe)=>on(ee,typeof Oe!="symbol"?Oe+"":Oe,Xe);(function(){"use strict";function ee(){}function Oe(t){return t()}function Xe(){return Object.create(null)}function Ae(t){t.forEach(Oe)}function fl(t){return typeof t=="function"}function nt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Et;function zt(t,e){return t===e?!0:(Et||(Et=document.createElement("a")),Et.href=e,t===Et.href)}function Zl(t){return Object.keys(t).length===0}function Ql(t,...e){if(t==null){for(const n of e)n(void 0);return ee}const l=t.subscribe(...e);return l.unsubscribe?()=>l.unsubscribe():l}function Dt(t,e,l){t.$$.on_destroy.push(Ql(e,l))}function $l(t,e,l){return t.set(l),e}function o(t,e){t.appendChild(e)}function L(t,e,l){t.insertBefore(e,l||null)}function j(t){t.parentNode&&t.parentNode.removeChild(t)}function ei(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function r(t){return document.createElement(t)}function at(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function I(t){return document.createTextNode(t)}function k(){return I(" ")}function jt(){return I("")}function te(t,e,l,n){return t.addEventListener(e,l,n),()=>t.removeEventListener(e,l,n)}function ul(t){return function(e){e.target===this&&t.call(this,e)}}function i(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function Ze(t){return t===""?null:+t}function ti(t){return Array.from(t.childNodes)}function fe(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ye(t,e){t.value=e??""}function dl(t,e,l,n){l==null?t.style.removeProperty(e):t.style.setProperty(e,l,"")}function ml(t,e,l){for(let n=0;n<t.options.length;n+=1){const a=t.options[n];if(a.__value===e){a.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function li(t){const e=t.querySelector(":checked");return e&&e.__value}function ii(t,e,{bubbles:l=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:l,cancelable:n})}let vt;function _t(t){vt=t}function Ut(){if(!vt)throw new Error("Function called outside component initialization");return vt}function Wt(t){Ut().$$.on_mount.push(t)}function Gt(t){Ut().$$.on_destroy.push(t)}function Jt(){const t=Ut();return(e,l,{cancelable:n=!1}={})=>{const a=t.$$.callbacks[e];if(a){const u=ii(e,l,{cancelable:n});return a.slice().forEach(w=>{w.call(t,u)}),!u.defaultPrevented}return!0}}const st=[],Me=[];let ot=[];const qt=[],ni=Promise.resolve();let Kt=!1;function ai(){Kt||(Kt=!0,ni.then(pl))}function Lt(t){ot.push(t)}function si(t){qt.push(t)}const Xt=new Set;let rt=0;function pl(){if(rt!==0)return;const t=vt;do{try{for(;rt<st.length;){const e=st[rt];rt++,_t(e),oi(e.$$)}}catch(e){throw st.length=0,rt=0,e}for(_t(null),st.length=0,rt=0;Me.length;)Me.pop()();for(let e=0;e<ot.length;e+=1){const l=ot[e];Xt.has(l)||(Xt.add(l),l())}ot.length=0}while(st.length);for(;qt.length;)qt.pop()();Kt=!1,Xt.clear(),_t(t)}function oi(t){if(t.fragment!==null){t.update(),Ae(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Lt)}}function ri(t){const e=[],l=[];ot.forEach(n=>t.indexOf(n)===-1?e.push(n):l.push(n)),l.forEach(n=>n()),ot=e}const Rt=new Set;let Qe;function ci(){Qe={r:0,c:[],p:Qe}}function fi(){Qe.r||Ae(Qe.c),Qe=Qe.p}function $e(t,e){t&&t.i&&(Rt.delete(t),t.i(e))}function ct(t,e,l,n){if(t&&t.o){if(Rt.has(t))return;Rt.add(t),Qe.c.push(()=>{Rt.delete(t),n&&(l&&t.d(1),n())}),t.o(e)}else n&&n()}function hl(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ui(t,e,l){const n=t.$$.props[e];n!==void 0&&(t.$$.bound[n]=l,l(t.$$.ctx[n]))}function Vt(t){t&&t.c()}function yt(t,e,l){const{fragment:n,after_update:a}=t.$$;n&&n.m(e,l),Lt(()=>{const u=t.$$.on_mount.map(Oe).filter(fl);t.$$.on_destroy?t.$$.on_destroy.push(...u):Ae(u),t.$$.on_mount=[]}),a.forEach(Lt)}function wt(t,e){const l=t.$$;l.fragment!==null&&(ri(l.after_update),Ae(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function di(t,e){t.$$.dirty[0]===-1&&(st.push(t),ai(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function xt(t,e,l,n,a,u,w=null,d=[-1]){const m=vt;_t(t);const f=t.$$={fragment:null,ctx:[],props:u,update:ee,not_equal:a,bound:Xe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(m?m.$$.context:[])),callbacks:Xe(),dirty:d,skip_bound:!1,root:e.target||m.$$.root};w&&w(f.root);let g=!1;if(f.ctx=l?l(t,e.props||{},(c,v,...p)=>{const b=p.length?p[0]:v;return f.ctx&&a(f.ctx[c],f.ctx[c]=b)&&(!f.skip_bound&&f.bound[c]&&f.bound[c](b),g&&di(t,c)),v}):[],f.update(),g=!0,Ae(f.before_update),f.fragment=n?n(f.ctx):!1,e.target){if(e.hydrate){const c=ti(e.target);f.fragment&&f.fragment.l(c),c.forEach(j)}else f.fragment&&f.fragment.c();e.intro&&$e(t.$$.fragment),yt(t,e.target,e.anchor),pl()}_t(m)}class kt{constructor(){cl(this,"$$");cl(this,"$$set")}$destroy(){wt(this,1),this.$destroy=ee}$on(e,l){if(!fl(l))return ee;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(l),()=>{const a=n.indexOf(l);a!==-1&&n.splice(a,1)}}$set(e){this.$$set&&!Zl(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const mi="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(mi);const ft=[];function pi(t,e=ee){let l;const n=new Set;function a(d){if(nt(t,d)&&(t=d,l)){const m=!ft.length;for(const f of n)f[1](),ft.push(f,t);if(m){for(let f=0;f<ft.length;f+=2)ft[f][0](ft[f+1]);ft.length=0}}}function u(d){a(d(t))}function w(d,m=ee){const f=[d,m];return n.add(f),n.size===1&&(l=e(a,u)||ee),d(t),()=>{n.delete(f),n.size===0&&l&&(l(),l=null)}}return{set:a,update:u,subscribe:w}}const de=pi({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,previewStream:null,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});function bl(t){de.update(e=>({...e,videoFrame:t}))}function hi(t,e,l){de.update(n=>({...n,realtimeData:t,trajectoryData:e||n.trajectoryData,velocityData:l||n.velocityData}))}function bi(t){de.update(e=>({...e,localVideoUrl:t}))}function Zt(t){de.update(e=>({...e,isCameraPreview:!!t}))}function gi(t){de.update(e=>({...e,previewStream:t||null}))}function Qt(){de.update(t=>({...t,previewStream:null}))}function $t(t){de.update(e=>({...e,inputMode:t==="upload"||t==="camera"?t:"none"}))}const Se=()=>typeof window<"u"&&window.BACKEND_URL?window.BACKEND_URL:"http://localhost:5000",vi=Se();async function Te(t,e={}){const l=`${vi}${t}`,n=await fetch(l,e);try{return await n.json()}catch{return{}}}const Je={setCamera(t){return Te("/api/settings/camera",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({index:Number(t)})})},setFps(t){return Te("/api/settings/fps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:t})})},setHeight(t){return Te("/api/settings/height",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:t})})},setMass(t){return Te("/api/settings/mass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:t})})},startRecording(){return Te("/api/recording/start",{method:"POST"})},stopRecording(){return Te("/api/recording/stop",{method:"POST"})},startCalibration(){return Te("/api/calibration/start",{method:"POST"})},calibrationStatus(){return Te("/api/calibration/status")},startAnalysis(){return Te("/api/analysis/start",{method:"POST"})},analysisStatus(){return Te("/api/analysis/status")},analysisResults(){return Te("/api/analysis/results")},pauseAnalysis(){return Te("/api/analysis/pause",{method:"POST"})},resumeAnalysis(){return Te("/api/analysis/resume",{method:"POST"})},stopAnalysis(){return Te("/api/analysis/stop",{method:"POST"})},videoFrame(){return Te("/api/video/frame")},analysisData(){return Te("/api/analysis/data")},async getPlayerData(t,e){var l;try{document.cookie=`session_id=${e}; path=/api/players`;const n=await fetch(`http://94.177.160.183/api/players/${t}`,{method:"GET",credentials:"include",headers:{Accept:"*/*"}});if(!n.ok)return{success:!1,error:`Errore HTTP: ${n.status}`};const a=await n.json();return(l=a==null?void 0:a.data)!=null&&l.info?{success:!0,data:{height_cm:a.data.info.height_cm,weight_kg:a.data.info.weight_kg,name:a.data.info.name,surname:a.data.info.surname,position:a.data.info.position}}:{success:!1,error:"Dati giocatore non validi"}}catch(n){return{success:!1,error:`Errore di connessione: ${n.message}`}}}};function _i(t){let e;return{c(){e=r("div"),e.innerHTML='<svg class="w-16 sm:w-20 md:w-24 h-16 sm:h-20 md:h-24 mx-auto text-slate-500 mb-3 sm:mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> <p class="text-slate-300 text-base sm:text-lg font-medium">Nessun video caricato</p> <p class="text-slate-500 text-sm mt-2">Carica o registra un video per iniziare</p>',i(e,"class","text-center p-6 sm:p-8"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){L(l,e,n)},p:ee,d(l){l&&j(e)}}}function yi(t){let e,l,n,a,u,w,d,m=t[4].isRecording&&gl(),f=t[4].isAnalyzing&&vl(),g=t[4].isCalibrating&&_l(),c=t[0]&&!t[4].localVideoUrl&&yl(t);return{c(){e=r("img"),n=k(),m&&m.c(),a=k(),f&&f.c(),u=k(),g&&g.c(),w=k(),c&&c.c(),d=jt(),zt(e.src,l=t[8])||i(e,"src",l),i(e,"alt","Video frame"),i(e,"class","w-full h-full max-w-full max-h-full object-contain")},m(v,p){L(v,e,p),L(v,n,p),m&&m.m(v,p),L(v,a,p),f&&f.m(v,p),L(v,u,p),g&&g.m(v,p),L(v,w,p),c&&c.m(v,p),L(v,d,p)},p(v,p){p&256&&!zt(e.src,l=v[8])&&i(e,"src",l),v[4].isRecording?m||(m=gl(),m.c(),m.m(a.parentNode,a)):m&&(m.d(1),m=null),v[4].isAnalyzing?f||(f=vl(),f.c(),f.m(u.parentNode,u)):f&&(f.d(1),f=null),v[4].isCalibrating?g||(g=_l(),g.c(),g.m(w.parentNode,w)):g&&(g.d(1),g=null),v[0]&&!v[4].localVideoUrl?c?c.p(v,p):(c=yl(v),c.c(),c.m(d.parentNode,d)):c&&(c.d(1),c=null)},d(v){v&&(j(e),j(n),j(a),j(u),j(w),j(d)),m&&m.d(v),f&&f.d(v),g&&g.d(v),c&&c.d(v)}}}function wi(t){let e,l;return{c(){e=r("video"),zt(e.src,l=t[4].localVideoUrl)||i(e,"src",l),e.controls=!0,i(e,"class","w-full h-full object-contain")},m(n,a){L(n,e,a),t[12](e)},p(n,a){a&16&&!zt(e.src,l=n[4].localVideoUrl)&&i(e,"src",l)},d(n){n&&j(e),t[12](null)}}}function xi(t){let e;return{c(){e=r("video"),e.autoplay=!0,e.playsInline=!0,e.muted=!0,i(e,"class","w-full h-full object-contain")},m(l,n){L(l,e,n),t[11](e)},p:ee,d(l){l&&j(e),t[11](null)}}}function gl(t){let e;return{c(){e=r("div"),e.innerHTML='<div class="w-2.5 sm:w-3 h-2.5 sm:h-3 bg-white rounded-full animate-pulse svelte-1mb1g50" aria-hidden="true"></div> <span class="text-white font-semibold text-xs sm:text-sm">REC</span>',i(e,"class","absolute top-3 sm:top-4 right-3 sm:right-4 flex items-center gap-2 bg-red-600 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-lg"),i(e,"role","status"),i(e,"aria-live","polite"),i(e,"aria-label","Registrazione in corso")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function vl(t){let e;return{c(){e=r("div"),e.innerHTML='<span class="text-white font-semibold text-xs sm:text-sm">ANALYZING</span>',i(e,"class","absolute top-3 sm:top-4 left-3 sm:left-4 bg-green-600 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-lg"),i(e,"role","status"),i(e,"aria-live","polite"),i(e,"aria-label","Analisi in corso")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function _l(t){let e;return{c(){e=r("div"),e.innerHTML='<span class="text-white font-semibold text-xs sm:text-sm">CALIBRATING</span>',i(e,"class","absolute top-3 sm:top-4 left-3 sm:left-4 bg-yellow-600 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-lg"),i(e,"role","status"),i(e,"aria-live","polite"),i(e,"aria-label","Calibrazione in corso")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function yl(t){let e,l,n,a,u,w,d,m,f,g=`${t[2]+1} / ${Math.max(t[1],0)}`,c,v,p,b,_,x=t[5]&&wl(t);return{c(){e=r("div"),l=r("label"),l.textContent="Seleziona frame",n=k(),a=r("input"),m=k(),f=r("div"),c=I(g),v=k(),x&&x.c(),p=jt(),i(l,"for","frame-slider"),i(l,"class","sr-only"),i(a,"id","frame-slider"),i(a,"type","range"),i(a,"min","0"),i(a,"max",u=Math.max(t[1]-1,0)),i(a,"class","w-32 sm:w-48 md:w-64 lg:w-80 accent-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-900 rounded"),i(a,"aria-label",w="Frame "+(t[2]+1)+" di "+Math.max(t[1],0)),i(a,"aria-valuemin","0"),i(a,"aria-valuemax",d=Math.max(t[1]-1,0)),i(a,"aria-valuenow",t[2]),i(f,"class","text-slate-300 text-xs sm:text-sm whitespace-nowrap font-medium"),i(f,"aria-live","polite"),i(e,"class","absolute bottom-3 sm:bottom-4 left-1/2 -translate-x-1/2 bg-slate-900/90 backdrop-blur-sm px-3 sm:px-4 py-2 sm:py-3 rounded-full border border-slate-700 flex items-center gap-2 sm:gap-4 shadow-xl max-w-[95%]")},m(C,E){L(C,e,E),o(e,l),o(e,n),o(e,a),Ye(a,t[2]),o(e,m),o(e,f),o(f,c),L(C,v,E),x&&x.m(C,E),L(C,p,E),b||(_=[te(a,"change",t[13]),te(a,"input",t[13]),te(a,"input",t[14])],b=!0)},p(C,E){E&2&&u!==(u=Math.max(C[1]-1,0))&&i(a,"max",u),E&6&&w!==(w="Frame "+(C[2]+1)+" di "+Math.max(C[1],0))&&i(a,"aria-label",w),E&2&&d!==(d=Math.max(C[1]-1,0))&&i(a,"aria-valuemax",d),E&4&&i(a,"aria-valuenow",C[2]),E&4&&Ye(a,C[2]),E&6&&g!==(g=`${C[2]+1} / ${Math.max(C[1],0)}`)&&fe(c,g),C[5]?x?x.p(C,E):(x=wl(C),x.c(),x.m(p.parentNode,p)):x&&(x.d(1),x=null)},d(C){C&&(j(e),j(v),j(p)),x&&x.d(C),b=!1,Ae(_)}}}function wl(t){let e,l;return{c(){e=r("div"),l=I(t[5]),i(e,"class","absolute bottom-20 sm:bottom-24 left-1/2 -translate-x-1/2 bg-red-600/90 text-white text-xs px-3 py-1.5 rounded shadow-lg border border-red-500/50"),i(e,"role","alert")},m(n,a){L(n,e,a),o(e,l)},p(n,a){a&32&&fe(l,n[5])},d(n){n&&j(e)}}}function ki(t){let e,l,n,a;function u(m,f){return m[4].isCameraPreview&&m[4].previewStream?xi:m[0]&&m[4].localVideoUrl?wi:m[8]?yi:_i}let w=u(t),d=w(t);return{c(){e=r("div"),l=r("div"),l.innerHTML='<h2 class="text-lg sm:text-xl font-semibold text-white">Anteprima Video</h2>',n=k(),a=r("div"),d.c(),i(l,"class","video-header bg-gradient-to-r from-blue-600 to-purple-600 px-4 sm:px-6 py-3 sm:py-4"),i(a,"class","video-content aspect-video bg-black flex items-center justify-center relative"),i(a,"data-reflow",t[7]),i(a,"aria-live","polite"),i(a,"aria-atomic","true"),i(e,"class","video-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700"),i(e,"role","region"),i(e,"aria-label","Anteprima video")},m(m,f){L(m,e,f),o(e,l),o(e,n),o(e,a),d.m(a,null),t[15](e)},p(m,[f]){w===(w=u(m))&&d?d.p(m,f):(d.d(1),d=w(m),d&&(d.c(),d.m(a,null))),f&128&&i(a,"data-reflow",m[7])},i:ee,o:ee,d(m){m&&j(e),d.d(),t[15](null)}}}function Ci(t,e,l){let n,a;Dt(t,de,A=>l(4,a=A));let{analysisCompleted:u=!1}=e,w=0,d=0,m=!1,f="",g,c,v,p,b=0,_;async function x(){try{const D=await(await fetch(`${Se()}/api/video/info`)).json();D&&D.success&&(l(1,w=D.total_frames||0),l(10,m=!0))}catch{}}async function C(A){l(5,f="");try{const U=await(await fetch(`${Se()}/api/video/frame_at?index=${A}`)).json();U&&U.success?(l(2,d=U.index),bl(U.frame)):U&&U.error&&l(5,f=U.error)}catch{l(5,f="Errore caricamento frame")}finally{}}function E(A){!u||w<=0||(g&&clearTimeout(g),g=setTimeout(()=>{C(A)},50))}function R(){l(7,b++,b)}Wt(()=>{if(a.isCameraPreview&&a.previewStream&&_)try{l(3,_.srcObject=a.previewStream,_)}catch{}typeof window<"u"&&"ResizeObserver"in window?(v=new ResizeObserver(()=>{R()}),c&&v.observe(c)):typeof window<"u"&&window.addEventListener("resize",R),p=()=>{R(),setTimeout(R,50),setTimeout(R,150)},typeof document<"u"&&(document.addEventListener("fullscreenchange",p),document.addEventListener("webkitfullscreenchange",p),document.addEventListener("mozfullscreenchange",p),document.addEventListener("MSFullscreenChange",p))}),Gt(()=>{v&&c&&v.unobserve(c),v&&v.disconnect(),typeof window<"u"&&window.removeEventListener("resize",R),typeof document<"u"&&p&&(document.removeEventListener("fullscreenchange",p),document.removeEventListener("webkitfullscreenchange",p),document.removeEventListener("mozfullscreenchange",p),document.removeEventListener("MSFullscreenChange",p))});function Y(A){Me[A?"unshift":"push"](()=>{_=A,l(3,_),l(4,a)})}function M(A){Me[A?"unshift":"push"](()=>{_=A,l(3,_),l(4,a)})}function G(){d=Ze(this.value),l(2,d)}const V=A=>E(+A.target.value);function ie(A){Me[A?"unshift":"push"](()=>{c=A,l(6,c)})}return t.$$set=A=>{"analysisCompleted"in A&&l(0,u=A.analysisCompleted)},t.$$.update=()=>{if(t.$$.dirty&16&&l(8,n=a.videoFrame?`data:image/jpeg;base64,${a.videoFrame}`:null),t.$$.dirty&1031&&(async()=>u&&!m&&(await x(),w>0&&await C(d)))(),t.$$.dirty&24&&a.isCameraPreview&&a.previewStream&&_)try{l(3,_.srcObject=a.previewStream,_)}catch{}},[u,w,d,_,a,f,c,b,n,E,m,Y,M,G,V,ie]}class Si extends kt{constructor(e){super(),xt(this,e,Ci,ki,nt,{analysisCompleted:0})}}async function Ti(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("API mediaDevices non disponibile");let t=null;try{t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}catch{}try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput")}finally{if(t)try{t.getTracks().forEach(e=>e.stop())}catch{}}}async function Ai(t,e){const l=Array.isArray(e)?e:[],n=l[t]||l[0];return n&&n.deviceId?await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:n.deviceId}},audio:!1}):await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}function el(t){var e;try{(e=t==null?void 0:t.getTracks())==null||e.forEach(l=>l.stop())}catch{}}function xl(t,e,l){const n=t.slice();return n[11]=e[l],n[13]=l,n}function kl(t){let e,l,n,a,u,w,d,m,f,g,c,v,p,b,_,x,C,E,R=t[4]&&Cl(t);function Y(V,ie){return V[2]?Ei:V[3].length>0?Mi:Pi}let M=Y(t),G=M(t);return{c(){e=r("div"),l=r("div"),n=r("div"),a=r("h4"),a.textContent="Seleziona fotocamera",u=k(),w=r("button"),w.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',d=k(),m=r("div"),R&&R.c(),f=k(),G.c(),g=k(),c=r("div"),v=r("button"),v.textContent="Annulla",p=k(),b=r("button"),_=I("Conferma e anteprima"),i(a,"id","camera-modal-title"),i(a,"class","text-white font-semibold text-lg"),i(w,"class","text-slate-400 hover:text-white focus:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-800 rounded p-1"),i(w,"aria-label","Chiudi modal"),i(n,"class","px-4 sm:px-6 py-3 sm:py-4 border-b border-slate-700 flex items-center justify-between"),i(m,"class","p-4 sm:p-6 space-y-4"),i(v,"class","btn-secondary"),i(v,"aria-label","Annulla selezione fotocamera"),i(b,"class","btn-primary"),b.disabled=x=t[2]||t[3].length===0,i(b,"aria-label","Conferma selezione e avvia anteprima"),i(c,"class","px-4 sm:px-6 py-3 sm:py-4 border-t border-slate-700 flex gap-2 sm:gap-3 justify-end"),i(l,"class","bg-slate-800 border border-slate-700 rounded-xl w-full max-w-md shadow-2xl"),i(l,"role","document"),i(e,"class","fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4"),i(e,"role","dialog"),i(e,"aria-modal","true"),i(e,"aria-labelledby","camera-modal-title")},m(V,ie){L(V,e,ie),o(e,l),o(l,n),o(n,a),o(n,u),o(n,w),o(l,d),o(l,m),R&&R.m(m,null),o(m,f),G.m(m,null),o(l,g),o(l,c),o(c,v),o(c,p),o(c,b),o(b,_),C||(E=[te(w,"click",t[5]),te(v,"click",t[5]),te(b,"click",t[6]),te(e,"click",ul(t[5])),te(e,"keydown",t[9])],C=!0)},p(V,ie){V[4]?R?R.p(V,ie):(R=Cl(V),R.c(),R.m(m,f)):R&&(R.d(1),R=null),M===(M=Y(V))&&G?G.p(V,ie):(G.d(1),G=M(V),G&&(G.c(),G.m(m,null))),ie&12&&x!==(x=V[2]||V[3].length===0)&&(b.disabled=x)},d(V){V&&j(e),R&&R.d(),G.d(),C=!1,Ae(E)}}}function Cl(t){let e,l;return{c(){e=r("div"),l=I(t[4]),i(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-3 text-red-300 text-sm"),i(e,"role","alert")},m(n,a){L(n,e,a),o(e,l)},p(n,a){a&16&&fe(l,n[4])},d(n){n&&j(e)}}}function Pi(t){let e;return{c(){e=r("p"),e.textContent="Nessuna fotocamera disponibile.",i(e,"class","text-slate-400"),i(e,"role","status")},m(l,n){L(l,e,n)},p:ee,d(l){l&&j(e)}}}function Mi(t){let e,l,n,a,u,w,d,m,f=hl(t[3]),g=[];for(let c=0;c<f.length;c+=1)g[c]=Sl(xl(t,f,c));return{c(){e=r("div"),l=r("label"),l.textContent="Fotocamera",n=k(),a=r("select");for(let c=0;c<g.length;c+=1)g[c].c();u=k(),w=r("p"),w.textContent="Seleziona una fotocamera dalla lista",i(l,"for","camera-select"),i(l,"class","block text-sm font-medium text-slate-300 mb-2"),i(a,"id","camera-select"),i(a,"class","input-field"),i(a,"aria-describedby","camera-select-help"),t[0]===void 0&&Lt(()=>t[8].call(a)),i(w,"id","camera-select-help"),i(w,"class","sr-only")},m(c,v){L(c,e,v),o(e,l),o(e,n),o(e,a);for(let p=0;p<g.length;p+=1)g[p]&&g[p].m(a,null);ml(a,t[0],!0),o(e,u),o(e,w),d||(m=[te(a,"change",t[7]),te(a,"change",t[8])],d=!0)},p(c,v){if(v&8){f=hl(c[3]);let p;for(p=0;p<f.length;p+=1){const b=xl(c,f,p);g[p]?g[p].p(b,v):(g[p]=Sl(b),g[p].c(),g[p].m(a,null))}for(;p<g.length;p+=1)g[p].d(1);g.length=f.length}v&1&&ml(a,c[0])},d(c){c&&j(e),ei(g,c),d=!1,Ae(m)}}}function Ei(t){let e;return{c(){e=r("div"),e.innerHTML='<svg class="animate-spin h-5 w-5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <p class="text-slate-300">Caricamento fotocamere...</p>',i(e,"class","flex items-center gap-3"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){L(l,e,n)},p:ee,d(l){l&&j(e)}}}function Sl(t){let e,l=(t[11].label||`Camera ${t[13]+1}`)+"",n;return{c(){e=r("option"),n=I(l),e.__value=t[13],Ye(e,e.__value)},m(a,u){L(a,e,u),o(e,n)},p(a,u){u&8&&l!==(l=(a[11].label||`Camera ${a[13]+1}`)+"")&&fe(n,l)},d(a){a&&j(e)}}}function zi(t){let e,l=t[1]&&kl(t);return{c(){l&&l.c(),e=jt()},m(n,a){l&&l.m(n,a),L(n,e,a)},p(n,[a]){n[1]?l?l.p(n,a):(l=kl(n),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},i:ee,o:ee,d(n){n&&j(e),l&&l.d(n)}}}function Di(t,e,l){let{show:n=!1}=e,{loading:a=!1}=e,{cameras:u=[]}=e,{selectedIndex:w=null}=e,{error:d=""}=e;const m=Jt();function f(){m("close")}function g(){m("confirm")}function c(b){const _=Number(b.target.value);m("select",{index:_})}function v(){w=li(this),l(0,w)}const p=b=>b.key==="Escape"&&f();return t.$$set=b=>{"show"in b&&l(1,n=b.show),"loading"in b&&l(2,a=b.loading),"cameras"in b&&l(3,u=b.cameras),"selectedIndex"in b&&l(0,w=b.selectedIndex),"error"in b&&l(4,d=b.error)},[w,n,a,u,d,f,g,c,v,p]}class ji extends kt{constructor(e){super(),xt(this,e,Di,zi,nt,{show:1,loading:2,cameras:3,selectedIndex:0,error:4})}}function Tl(t){let e,l,n;return{c(){e=r("button"),e.innerHTML='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg> <span class="hidden sm:inline">Indietro</span>',i(e,"class","bg-white/20 hover:bg-white/30 focus:bg-white/30 text-white px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg transition-all duration-200 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-white/50 focus:ring-offset-2 focus:ring-offset-purple-600"),i(e,"aria-label","Torna allo step precedente")},m(a,u){L(a,e,u),l||(n=te(e,"click",t[23]),l=!0)},p:ee,d(a){a&&j(e),l=!1,n()}}}function Al(t){let e,l,n;return{c(){e=r("div"),l=r("p"),n=I(t[5]),i(l,"class","text-red-400 text-sm"),i(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-3 sm:p-4"),i(e,"role","alert"),i(e,"aria-live","assertive")},m(a,u){L(a,e,u),o(e,l),o(l,n)},p(a,u){u[0]&32&&fe(n,a[5])},d(a){a&&j(e)}}}function Pl(t){let e,l,n=t[13].inputMode==="camera"?"1. Registra Video":"1. Carica o Registra Video",a,u,w,d=t[13].inputMode!=="camera"&&Ml(t);function m(c,v){return c[13].isRecording?Li:Ri}let f=m(t),g=f(t);return{c(){e=r("div"),l=r("h3"),a=I(n),u=k(),d&&d.c(),w=k(),g.c(),i(l,"class","text-base sm:text-lg font-semibold text-white mb-3 sm:mb-4"),i(e,"class","space-y-4")},m(c,v){L(c,e,v),o(e,l),o(l,a),o(e,u),d&&d.m(e,null),o(e,w),g.m(e,null)},p(c,v){v[0]&8192&&n!==(n=c[13].inputMode==="camera"?"1. Registra Video":"1. Carica o Registra Video")&&fe(a,n),c[13].inputMode!=="camera"?d?d.p(c,v):(d=Ml(c),d.c(),d.m(e,w)):d&&(d.d(1),d=null),f===(f=m(c))&&g?g.p(c,v):(g.d(1),g=f(c),g&&(g.c(),g.m(e,null)))},d(c){c&&j(e),d&&d.d(),g.d()}}}function Ml(t){let e,l,n,a,u,w,d,m,f=t[1]?"Caricamento...":"Carica Video",g,c,v,p,b,_;return{c(){e=r("label"),l=r("input"),a=k(),u=r("div"),w=at("svg"),d=at("path"),m=k(),g=I(f),v=k(),p=r("div"),p.textContent="oppure",i(l,"type","file"),i(l,"accept","video/*"),l.disabled=n=t[1]||t[13].isRecording,i(l,"class","hidden"),i(l,"aria-label","Seleziona file video da caricare"),i(d,"stroke-linecap","round"),i(d,"stroke-linejoin","round"),i(d,"stroke-width","2"),i(d,"d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"),i(w,"class","w-5 h-5 inline mr-2"),i(w,"fill","none"),i(w,"stroke","currentColor"),i(w,"viewBox","0 0 24 24"),i(w,"aria-hidden","true"),i(u,"class",c="btn-primary cursor-pointer text-center "+(t[1]?"opacity-50":"")),i(u,"role","button"),i(u,"tabindex","0"),i(e,"class","block"),i(p,"class","text-center text-slate-400 text-sm"),i(p,"aria-hidden","true")},m(x,C){L(x,e,C),o(e,l),o(e,a),o(e,u),o(u,w),o(w,d),o(u,m),o(u,g),L(x,v,C),L(x,p,C),b||(_=[te(l,"change",t[14]),te(u,"keydown",t[29])],b=!0)},p(x,C){C[0]&8194&&n!==(n=x[1]||x[13].isRecording)&&(l.disabled=n),C[0]&2&&f!==(f=x[1]?"Caricamento...":"Carica Video")&&fe(g,f),C[0]&2&&c!==(c="btn-primary cursor-pointer text-center "+(x[1]?"opacity-50":""))&&i(u,"class",c)},d(x){x&&(j(e),j(v),j(p)),b=!1,Ae(_)}}}function Li(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><rect x="6" y="6" width="12" height="12"></rect></svg>
            Ferma Registrazione`,i(e,"class","btn-danger w-full"),i(e,"aria-label","Ferma registrazione video")},m(a,u){L(a,e,u),l||(n=te(e,"click",t[18]),l=!0)},p:ee,d(a){a&&j(e),l=!1,n()}}}function Ri(t){let e,l,n,a,u=t[13].inputMode==="camera"?"Cambia Telecamera":"Registra Video",w,d,m,f,g,c,v,p=t[13].isCameraPreview&&El(t),b=t[13].isCameraPreview&&zl();return{c(){e=r("button"),l=at("svg"),n=at("path"),a=k(),w=I(u),m=k(),p&&p.c(),f=k(),b&&b.c(),g=jt(),i(n,"stroke-linecap","round"),i(n,"stroke-linejoin","round"),i(n,"stroke-width","2"),i(n,"d","M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"),i(l,"class","w-5 h-5 inline mr-2"),i(l,"fill","none"),i(l,"stroke","currentColor"),i(l,"viewBox","0 0 24 24"),i(l,"aria-hidden","true"),i(e,"class","btn-secondary w-full"),i(e,"aria-label",d=t[13].inputMode==="camera"?"Cambia telecamera":"Apri modal selezione telecamera per registrare video")},m(_,x){L(_,e,x),o(e,l),o(l,n),o(e,a),o(e,w),L(_,m,x),p&&p.m(_,x),L(_,f,x),b&&b.m(_,x),L(_,g,x),c||(v=te(e,"click",t[16]),c=!0)},p(_,x){x[0]&8192&&u!==(u=_[13].inputMode==="camera"?"Cambia Telecamera":"Registra Video")&&fe(w,u),x[0]&8192&&d!==(d=_[13].inputMode==="camera"?"Cambia telecamera":"Apri modal selezione telecamera per registrare video")&&i(e,"aria-label",d),_[13].isCameraPreview?p?p.p(_,x):(p=El(_),p.c(),p.m(f.parentNode,f)):p&&(p.d(1),p=null),_[13].isCameraPreview?b||(b=zl(),b.c(),b.m(g.parentNode,g)):b&&(b.d(1),b=null)},d(_){_&&(j(e),j(m),j(f),j(g)),p&&p.d(_),b&&b.d(_),c=!1,v()}}}function El(t){let e,l,n;return{c(){e=r("button"),e.textContent="Analizza Video",i(e,"class","btn-primary w-full mt-3"),i(e,"aria-label","Avvia analisi video e inizia registrazione")},m(a,u){L(a,e,u),l||(n=te(e,"click",t[15]),l=!0)},p:ee,d(a){a&&j(e),l=!1,n()}}}function zl(t){let e;return{c(){e=r("div"),e.textContent='Anteprima fotocamera attiva. Premi "Analizza Video" per iniziare la registrazione, poi "Ferma Registrazione" al termine del salto.',i(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-3 text-blue-300 text-sm"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function Dl(t){let e,l,n,a,u,w,d,m,f,g,c,v,p,b,_,x,C,E,R,Y,M,G,V,ie,A,D=t[6]?"Calibrazione e Analisi in corso...":"Avvia Analisi",U,se,_e,ye,xe,X=t[6]&&jl();return{c(){e=r("div"),l=r("h3"),l.textContent="2. Calibrazione Sistema",n=k(),a=r("div"),u=r("label"),u.textContent="FPS Video",w=k(),d=r("input"),m=k(),f=r("p"),f.textContent="Frame per secondo del video",g=k(),c=r("div"),v=r("label"),v.textContent="Altezza Persona (cm)",p=k(),b=r("input"),_=k(),x=r("p"),x.textContent="Altezza reale della persona",C=k(),E=r("div"),R=r("label"),R.textContent="Massa Corporea (kg)",Y=k(),M=r("input"),G=k(),V=r("p"),V.textContent="Peso della persona",ie=k(),A=r("button"),U=I(D),_e=k(),X&&X.c(),i(l,"class","text-base sm:text-lg font-semibold text-white mb-3 sm:mb-4"),i(u,"for","fps-input"),i(u,"class","block text-sm font-medium text-slate-300 mb-2"),i(d,"id","fps-input"),i(d,"type","number"),i(d,"min","1"),i(d,"max","240"),d.disabled=t[6],i(d,"class","input-field"),i(d,"aria-describedby","fps-help"),i(f,"id","fps-help"),i(f,"class","text-slate-500 text-xs mt-1"),i(v,"for","height-input"),i(v,"class","block text-sm font-medium text-slate-300 mb-2"),i(b,"id","height-input"),i(b,"type","number"),i(b,"min","100"),i(b,"max","250"),b.disabled=t[6],i(b,"class","input-field"),i(b,"aria-describedby","height-help"),i(x,"id","height-help"),i(x,"class","text-slate-500 text-xs mt-1"),i(R,"for","mass-input"),i(R,"class","block text-sm font-medium text-slate-300 mb-2"),i(M,"id","mass-input"),i(M,"type","number"),i(M,"min","40"),i(M,"max","150"),M.disabled=t[6],i(M,"class","input-field"),i(M,"aria-describedby","mass-help"),i(V,"id","mass-help"),i(V,"class","text-slate-500 text-xs mt-1"),A.disabled=t[6],i(A,"class","btn-primary w-full"),i(A,"aria-label",se=t[6]?"Calibrazione e analisi in corso":"Avvia calibrazione e analisi"),i(e,"class","space-y-4")},m(Z,re){L(Z,e,re),o(e,l),o(e,n),o(e,a),o(a,u),o(a,w),o(a,d),Ye(d,t[2]),o(a,m),o(a,f),o(e,g),o(e,c),o(c,v),o(c,p),o(c,b),Ye(b,t[3]),o(c,_),o(c,x),o(e,C),o(e,E),o(E,R),o(E,Y),o(E,M),Ye(M,t[4]),o(E,G),o(E,V),o(e,ie),o(e,A),o(A,U),o(e,_e),X&&X.m(e,null),ye||(xe=[te(d,"input",t[30]),te(b,"input",t[31]),te(M,"input",t[32]),te(A,"click",t[24])],ye=!0)},p(Z,re){re[0]&64&&(d.disabled=Z[6]),re[0]&4&&Ze(d.value)!==Z[2]&&Ye(d,Z[2]),re[0]&64&&(b.disabled=Z[6]),re[0]&8&&Ze(b.value)!==Z[3]&&Ye(b,Z[3]),re[0]&64&&(M.disabled=Z[6]),re[0]&16&&Ze(M.value)!==Z[4]&&Ye(M,Z[4]),re[0]&64&&D!==(D=Z[6]?"Calibrazione e Analisi in corso...":"Avvia Analisi")&&fe(U,D),re[0]&64&&(A.disabled=Z[6]),re[0]&64&&se!==(se=Z[6]?"Calibrazione e analisi in corso":"Avvia calibrazione e analisi")&&i(A,"aria-label",se),Z[6]?X||(X=jl(),X.c(),X.m(e,null)):X&&(X.d(1),X=null)},d(Z){Z&&j(e),X&&X.d(),ye=!1,Ae(xe)}}}function jl(t){let e;return{c(){e=r("div"),e.innerHTML='<p class="text-blue-400 text-sm">Sistema in calibrazione. Assicurati che la persona sia in posizione eretta nel frame.</p>',i(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-3 sm:p-4"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function Ll(t){var oe,y,h,T;let e,l,n,a,u,w,d,m,f,g,c,v,p=(((oe=t[13].realtimeData)==null?void 0:oe.current_height)??0)+"",b,_,x,C,E,R,Y,M=(((y=t[13].realtimeData)==null?void 0:y.max_height)??0)+"",G,V,ie,A,D,U,se,_e=(((h=t[13].realtimeData)==null?void 0:h.takeoff_velocity)??0)+"",ye,xe,X,Z,re,pe,ae,ce=(((T=t[13].realtimeData)==null?void 0:T.estimated_power)??0)+"",me,O,S;function N(F,W){return F[7]?Vi:Fi}let ue=N(t),q=ue(t),s=t[7]&&Rl(t);return{c(){e=r("div"),l=r("h3"),l.textContent="3. Analisi Salto",n=k(),q.c(),a=k(),u=r("div"),w=r("h4"),w.textContent="Dati in Tempo Reale",d=k(),m=r("div"),f=r("div"),g=r("p"),g.textContent="Altezza Corrente",c=k(),v=r("p"),b=I(p),_=I(" cm"),x=k(),C=r("div"),E=r("p"),E.textContent="Altezza Max",R=k(),Y=r("p"),G=I(M),V=I(" cm"),ie=k(),A=r("div"),D=r("p"),D.textContent="Velocità Decollo",U=k(),se=r("p"),ye=I(_e),xe=I(" cm/s"),X=k(),Z=r("div"),re=r("p"),re.textContent="Potenza Est.",pe=k(),ae=r("p"),me=I(ce),O=I(" W"),S=k(),s&&s.c(),i(l,"class","text-base sm:text-lg font-semibold text-white mb-3 sm:mb-4"),i(w,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-2 sm:mb-3"),i(g,"class","text-slate-400 text-[10px] sm:text-xs uppercase tracking-wide mb-0.5 sm:mb-1"),i(v,"class","text-base sm:text-lg md:text-xl font-bold text-blue-400"),i(v,"aria-live","polite"),i(f,"class","text-center"),i(f,"role","listitem"),i(E,"class","text-slate-400 text-[10px] sm:text-xs uppercase tracking-wide mb-0.5 sm:mb-1"),i(Y,"class","text-base sm:text-lg md:text-xl font-bold text-green-400"),i(Y,"aria-live","polite"),i(C,"class","text-center"),i(C,"role","listitem"),i(D,"class","text-slate-400 text-[10px] sm:text-xs uppercase tracking-wide mb-0.5 sm:mb-1"),i(se,"class","text-base sm:text-lg md:text-xl font-bold text-purple-400"),i(se,"aria-live","polite"),i(A,"class","text-center"),i(A,"role","listitem"),i(re,"class","text-slate-400 text-[10px] sm:text-xs uppercase tracking-wide mb-0.5 sm:mb-1"),i(ae,"class","text-base sm:text-lg md:text-xl font-bold text-yellow-400"),i(ae,"aria-live","polite"),i(Z,"class","text-center"),i(Z,"role","listitem"),i(m,"class","grid grid-cols-2 gap-1.5 sm:gap-2 md:gap-3"),i(m,"role","list"),i(u,"class","bg-slate-900/50 rounded-xl p-2.5 sm:p-3 md:p-4 border border-slate-700"),i(u,"role","region"),i(u,"aria-label","Dati in tempo reale"),i(e,"class","space-y-4")},m(F,W){L(F,e,W),o(e,l),o(e,n),q.m(e,null),o(e,a),o(e,u),o(u,w),o(u,d),o(u,m),o(m,f),o(f,g),o(f,c),o(f,v),o(v,b),o(v,_),o(m,x),o(m,C),o(C,E),o(C,R),o(C,Y),o(Y,G),o(Y,V),o(m,ie),o(m,A),o(A,D),o(A,U),o(A,se),o(se,ye),o(se,xe),o(m,X),o(m,Z),o(Z,re),o(Z,pe),o(Z,ae),o(ae,me),o(ae,O),o(e,S),s&&s.m(e,null)},p(F,W){var he,ne,we,Q;ue===(ue=N(F))&&q?q.p(F,W):(q.d(1),q=ue(F),q&&(q.c(),q.m(e,a))),W[0]&8192&&p!==(p=(((he=F[13].realtimeData)==null?void 0:he.current_height)??0)+"")&&fe(b,p),W[0]&8192&&M!==(M=(((ne=F[13].realtimeData)==null?void 0:ne.max_height)??0)+"")&&fe(G,M),W[0]&8192&&_e!==(_e=(((we=F[13].realtimeData)==null?void 0:we.takeoff_velocity)??0)+"")&&fe(ye,_e),W[0]&8192&&ce!==(ce=(((Q=F[13].realtimeData)==null?void 0:Q.estimated_power)??0)+"")&&fe(me,ce),F[7]?s?s.p(F,W):(s=Rl(F),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(F){F&&j(e),q.d(),s&&s.d()}}}function Vi(t){let e;return{c(){e=r("div"),e.innerHTML='<p class="text-green-400 text-sm font-medium">Analisi in corso...</p> <p class="text-slate-400 text-xs mt-1">Il sistema sta elaborando il salto</p>',i(e,"class","bg-green-500/10 border border-green-500/50 rounded-lg p-3 sm:p-4"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){L(l,e,n)},p:ee,d(l){l&&j(e)}}}function Fi(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            Avvia Analisi`,i(e,"class","btn-primary w-full"),i(e,"aria-label","Avvia analisi del salto")},m(a,u){L(a,e,u),l||(n=te(e,"click",t[19]),l=!0)},p:ee,d(a){a&&j(e),l=!1,n()}}}function Rl(t){let e,l,n,a,u;function w(f,g){return f[13].isPaused?Bi:Ii}let d=w(t),m=d(t);return{c(){e=r("div"),m.c(),l=k(),n=r("button"),n.textContent="Annulla",i(n,"class","btn-danger flex-1"),i(n,"aria-label","Annulla analisi"),i(e,"class","flex gap-2")},m(f,g){L(f,e,g),m.m(e,null),o(e,l),o(e,n),a||(u=te(n,"click",t[22]),a=!0)},p(f,g){d===(d=w(f))&&m?m.p(f,g):(m.d(1),m=d(f),m&&(m.c(),m.m(e,l)))},d(f){f&&j(e),m.d(),a=!1,u()}}}function Ii(t){let e,l,n;return{c(){e=r("button"),e.textContent="Pausa",i(e,"class","btn-secondary flex-1"),i(e,"aria-label","Metti in pausa l'analisi")},m(a,u){L(a,e,u),l||(n=te(e,"click",t[20]),l=!0)},p:ee,d(a){a&&j(e),l=!1,n()}}}function Bi(t){let e,l,n;return{c(){e=r("button"),e.textContent="Riprendi",i(e,"class","btn-secondary flex-1"),i(e,"aria-label","Riprendi analisi")},m(a,u){L(a,e,u),l||(n=te(e,"click",t[21]),l=!0)},p:ee,d(a){a&&j(e),l=!1,n()}}}function Oi(t){let e,l,n,a,u,w,d,m,f,g,c,v,p,b,_,x,C,E,R,Y,M,G,V,ie,A,D,U,se,_e,ye,xe,X=(t[0]>1||t[13].isCameraPreview)&&Tl(t);function Z(O){t[26](O)}let re={show:t[8],loading:t[11],cameras:t[9],error:t[12]};t[10]!==void 0&&(re.selectedIndex=t[10]),b=new ji({props:re}),Me.push(()=>ui(b,"selectedIndex",Z)),b.$on("close",t[27]),b.$on("confirm",t[17]),b.$on("select",t[28]);let pe=t[5]&&Al(t),ae=t[0]===1&&Pl(t),ce=t[0]===2&&Dl(t),me=t[0]===3&&Ll(t);return{c(){e=r("div"),l=r("div"),n=r("div"),a=r("div"),u=r("h2"),u.textContent="Step Holder",w=k(),d=r("p"),m=I("Step "),f=I(t[0]),g=I(" di 3"),c=k(),X&&X.c(),v=k(),p=r("div"),Vt(b.$$.fragment),x=k(),pe&&pe.c(),C=k(),ae&&ae.c(),E=k(),ce&&ce.c(),R=k(),me&&me.c(),Y=k(),M=r("div"),G=r("div"),V=r("span"),V.textContent="Progresso",ie=k(),A=r("span"),D=I(t[0]),U=I("/3"),se=k(),_e=r("div"),ye=r("div"),i(u,"class","text-lg sm:text-xl font-semibold text-white"),i(d,"class","text-purple-100 text-xs sm:text-sm mt-1"),i(d,"aria-live","polite"),i(n,"class","flex justify-between items-center gap-4"),i(l,"class","step-header bg-gradient-to-r from-purple-600 to-pink-600 px-4 sm:px-6 py-3 sm:py-4"),i(V,"class","text-xs text-slate-400"),i(A,"class","text-xs text-slate-400 font-medium"),i(G,"class","flex justify-between items-center mb-2"),i(ye,"class","bg-gradient-to-r from-purple-600 to-pink-600 h-2 rounded-full transition-all duration-300"),dl(ye,"width",t[0]/3*100+"%"),i(ye,"aria-hidden","true"),i(_e,"class","w-full bg-slate-700 rounded-full h-2 overflow-hidden"),i(M,"class","mt-6 sm:mt-8 pt-4 sm:pt-6 border-t border-slate-700"),i(M,"role","progressbar"),i(M,"aria-valuenow",t[0]),i(M,"aria-valuemin","1"),i(M,"aria-valuemax","3"),i(M,"aria-label","Progresso analisi"),i(p,"class","step-content p-3 sm:p-4 md:p-6 space-y-3 sm:space-y-4 md:space-y-6 flex-1 overflow-auto svelte-10imy5p"),i(e,"class","step-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 h-full flex flex-col"),i(e,"role","region"),i(e,"aria-label","Pannello controllo analisi")},m(O,S){L(O,e,S),o(e,l),o(l,n),o(n,a),o(a,u),o(a,w),o(a,d),o(d,m),o(d,f),o(d,g),o(n,c),X&&X.m(n,null),o(e,v),o(e,p),yt(b,p,null),o(p,x),pe&&pe.m(p,null),o(p,C),ae&&ae.m(p,null),o(p,E),ce&&ce.m(p,null),o(p,R),me&&me.m(p,null),o(p,Y),o(p,M),o(M,G),o(G,V),o(G,ie),o(G,A),o(A,D),o(A,U),o(M,se),o(M,_e),o(_e,ye),xe=!0},p(O,S){(!xe||S[0]&1)&&fe(f,O[0]),O[0]>1||O[13].isCameraPreview?X?X.p(O,S):(X=Tl(O),X.c(),X.m(n,null)):X&&(X.d(1),X=null);const N={};S[0]&256&&(N.show=O[8]),S[0]&2048&&(N.loading=O[11]),S[0]&512&&(N.cameras=O[9]),S[0]&4096&&(N.error=O[12]),!_&&S[0]&1024&&(_=!0,N.selectedIndex=O[10],si(()=>_=!1)),b.$set(N),O[5]?pe?pe.p(O,S):(pe=Al(O),pe.c(),pe.m(p,C)):pe&&(pe.d(1),pe=null),O[0]===1?ae?ae.p(O,S):(ae=Pl(O),ae.c(),ae.m(p,E)):ae&&(ae.d(1),ae=null),O[0]===2?ce?ce.p(O,S):(ce=Dl(O),ce.c(),ce.m(p,R)):ce&&(ce.d(1),ce=null),O[0]===3?me?me.p(O,S):(me=Ll(O),me.c(),me.m(p,Y)):me&&(me.d(1),me=null),(!xe||S[0]&1)&&fe(D,O[0]),(!xe||S[0]&1)&&dl(ye,"width",O[0]/3*100+"%"),(!xe||S[0]&1)&&i(M,"aria-valuenow",O[0])},i(O){xe||($e(b.$$.fragment,O),xe=!0)},o(O){ct(b.$$.fragment,O),xe=!1},d(O){O&&j(e),X&&X.d(),wt(b),pe&&pe.d(),ae&&ae.d(),ce&&ce.d(),me&&me.d()}}}let Vl=1,Fl="94822145f84207b6792a83e2d6708c9ce009153bcb34656647de4851ce80214f";function Ni(t,e,l){let n;Dt(t,de,y=>l(13,n=y));let{currentStep:a=1}=e;const u=Jt();let w=null,d=!1,m=30,f=174,g=62,c="",v=!1,p=!1,b=!1,_=[],x=null,C=!1,E="",R="",Y="",M=!1;async function G(y){if(w=y.target.files[0],w){try{const h=URL.createObjectURL(w);bi(h)}catch{}$t("upload"),await V()}}async function V(){if(!w)return;l(1,d=!0),l(5,c="");const y=new FormData;y.append("video",w);try{const T=await(await fetch(`${Se()}/api/video/upload`,{method:"POST",body:y})).json();T.success?(l(2,m=Math.round(T.fps)||30),u("stepComplete",{step:1,data:T})):l(5,c=T.error||"Errore caricamento video")}catch{l(5,c="Errore di connessione al server")}finally{l(1,d=!1)}}async function ie(){try{if(x!=null)try{await Je.setCamera(Number(x))}catch{l(5,c="Errore impostazione fotocamera");return}try{el(n.previewStream)}catch{}Qt(),Zt(!1);const y=await Je.startRecording();y.success?de.update(h=>({...h,isRecording:!0})):l(5,c=y.error||"Errore avvio registrazione")}catch{l(5,c="Errore di connessione al server")}}function A(){l(12,E=""),l(8,b=!0),D()}async function D(){l(11,C=!0),l(9,_=[]),l(10,x=null);try{const y=await Ti();y.length>0?(l(9,_=y),l(10,x=0)):l(12,E="Nessuna fotocamera trovata")}catch{l(12,E="Errore rilevamento fotocamere")}finally{l(11,C=!1)}}async function U(){if(l(12,E=""),x==null){l(12,E="Seleziona una fotocamera");return}try{l(8,b=!1);try{el(n.previewStream);const y=await Ai(Number(x),_);gi(y),Zt(!0),$t("camera")}catch{l(12,E="Impossibile avviare l'anteprima fotocamera")}}catch{l(12,E="Errore apertura anteprima")}}async function se(){try{const h=await(await fetch(`${Se()}/api/recording/stop`,{method:"POST"})).json();h.success&&(de.update(T=>({...T,isRecording:!1})),u("stepComplete",{step:1,data:h}))}catch{l(5,c="Errore stop registrazione")}}async function _e(){l(5,c="");try{const y=await fetch(`${Se()}/api/video/info`).then(h=>h.json());if(!(y!=null&&y.video_path)){l(5,c="Nessun video disponibile: registra o carica prima il video.");return}}catch{l(5,c="Errore verifica video disponibile");return}try{const y=await Je.startAnalysis();y.success?(l(7,p=!0),de.update(h=>({...h,isAnalyzing:!0})),ye()):l(5,c=y.error||"Errore avvio analisi")}catch{l(5,c="Errore di connessione")}}async function ye(){const y=setInterval(async()=>{try{if(!(await Je.analysisStatus()).is_analyzing){clearInterval(y);const T=await Je.analysisResults();T.success&&(l(7,p=!1),de.update(F=>({...F,isAnalyzing:!1})),u("stepComplete",{step:3,data:{...T.results,trajectory:T.trajectory,velocity:T.velocity,phase_times:T.phase_times}}))}}catch{}},500)}async function xe(){try{await fetch(`${Se()}/api/analysis/pause`,{method:"POST"}),de.update(y=>({...y,isPaused:!0}))}catch{}}async function X(){try{await fetch(`${Se()}/api/analysis/resume`,{method:"POST"}),de.update(y=>({...y,isPaused:!1}))}catch{}}async function Z(){try{await fetch(`${Se()}/api/analysis/stop`,{method:"POST"})}catch{}u("cancelToStep1")}function re(){a===1&&n.isCameraPreview?pe():u("goBack")}async function pe(){try{el(n.previewStream)}catch{}Qt(),Zt(!1),$t("none"),l(10,x=null)}async function ae(){l(5,c="");try{await fetch(`${Se()}/api/settings/fps`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:m})}),await fetch(`${Se()}/api/settings/height`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:f})}),await fetch(`${Se()}/api/settings/mass`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:g})})}catch{l(5,c="Errore impostazioni");return}try{const h=await(await fetch(`${Se()}/api/calibration/start`,{method:"POST"})).json();h.success?(l(6,v=!0),de.update(T=>({...T,isCalibrating:!0})),ce()):l(5,c=h.error||"Errore calibrazione")}catch{l(5,c="Errore di connessione")}}async function ce(){const y=setInterval(async()=>{try{const T=await(await fetch(`${Se()}/api/calibration/status`)).json();T.success&&!T.in_progress?(clearInterval(y),l(6,v=!1),de.update(F=>({...F,isCalibrating:!1})),u("stepComplete",{step:2,data:T}),await _e()):T.success===!1&&!T.in_progress&&(clearInterval(y),l(6,v=!1),de.update(F=>({...F,isCalibrating:!1})),l(5,c="Calibrazione fallita"))}catch{clearInterval(y),l(6,v=!1),l(5,c="Errore verifica calibrazione")}},500)}async function me(){R="",Y="";try{const y=await Je.getPlayerData(Number(Vl),Fl);y.success&&y.data?(l(3,f=y.data.height_cm||f),l(4,g=y.data.weight_kg||g),await Je.setHeight(f),await Je.setMass(g),y.data.name&&y.data.surname?Y=`${y.data.name} ${y.data.surname}`:y.data.name&&(Y=y.data.name)):R=y.error||"Errore nel caricamento dei dati del giocatore"}catch(y){R=`Errore: ${y.message}`}finally{}}function O(y){x=y,l(10,x)}const S=()=>l(8,b=!1),N=y=>l(10,x=y.detail.index),ue=y=>{var h,T;return y.key==="Enter"&&!d&&!n.isRecording&&((T=(h=y.currentTarget.closest("label"))==null?void 0:h.querySelector("input"))==null?void 0:T.click())};function q(){m=Ze(this.value),l(2,m)}function s(){f=Ze(this.value),l(3,f)}function oe(){g=Ze(this.value),l(4,g)}return t.$$set=y=>{"currentStep"in y&&l(0,a=y.currentStep)},t.$$.update=()=>{t.$$.dirty[0]&33554433&&a===2&&!M&&Vl&&Fl&&(l(25,M=!0),me()),t.$$.dirty[0]&1&&a!==2&&l(25,M=!1)},[a,d,m,f,g,c,v,p,b,_,x,C,E,n,G,ie,A,U,se,_e,xe,X,Z,re,ae,M,O,S,N,ue,q,s,oe]}class Hi extends kt{constructor(e){super(),xt(this,e,Ni,Oi,nt,{currentStep:0},null,[-1,-1])}}function Il(t){let e,l,n,a,u,w;return{c(){e=r("div"),l=r("h3"),l.textContent="Traiettoria del Salto",n=k(),a=r("canvas"),i(l,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(a,"width","400"),i(a,"height","250"),i(a,"class","w-full rounded-lg cursor-pointer hover:opacity-90 focus:opacity-90 transition-opacity focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-900"),i(a,"role","button"),i(a,"tabindex","0"),i(a,"aria-label","Grafico traiettoria del salto. Clicca per ingrandire"),i(e,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(e,"role","region"),i(e,"aria-label","Grafico traiettoria")},m(d,m){L(d,e,m),o(e,l),o(e,n),o(e,a),t[16](a),u||(w=[te(a,"click",t[17]),te(a,"keydown",t[18])],u=!0)},p:ee,d(d){d&&j(e),t[16](null),u=!1,Ae(w)}}}function Bl(t){let e,l,n,a,u,w;return{c(){e=r("div"),l=r("h3"),l.textContent="Velocità nel Tempo",n=k(),a=r("canvas"),i(l,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(a,"width","400"),i(a,"height","250"),i(a,"class","w-full rounded-lg cursor-pointer hover:opacity-90 focus:opacity-90 transition-opacity focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-900"),i(a,"role","button"),i(a,"tabindex","0"),i(a,"aria-label","Grafico velocità nel tempo. Clicca per ingrandire"),i(e,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(e,"role","region"),i(e,"aria-label","Grafico velocità")},m(d,m){L(d,e,m),o(e,l),o(e,n),o(e,a),t[19](a),u||(w=[te(a,"click",t[20]),te(a,"keydown",t[21])],u=!0)},p:ee,d(d){d&&j(e),t[19](null),u=!1,Ae(w)}}}function Ol(t){let e,l,n,a,u,w;return{c(){e=r("div"),l=r("h3"),l.textContent="Confronto Traiettoria e Velocità",n=k(),a=r("canvas"),i(l,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(a,"width","400"),i(a,"height","250"),i(a,"class","w-full rounded-lg cursor-pointer hover:opacity-90 focus:opacity-90 transition-opacity focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-900"),i(a,"role","button"),i(a,"tabindex","0"),i(a,"aria-label","Grafico confronto traiettoria e velocità. Clicca per ingrandire"),i(e,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(e,"role","region"),i(e,"aria-label","Grafico confronto")},m(d,m){L(d,e,m),o(e,l),o(e,n),o(e,a),t[22](a),u||(w=[te(a,"click",t[23]),te(a,"keydown",t[24])],u=!0)},p:ee,d(d){d&&j(e),t[22](null),u=!1,Ae(w)}}}function Nl(t){let e,l,n;return{c(){e=r("div"),l=r("p"),n=I(t[11]),i(l,"class","text-blue-400 text-sm"),i(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-3 sm:p-4"),i(e,"role","status"),i(e,"aria-live","polite")},m(a,u){L(a,e,u),o(e,l),o(l,n)},p(a,u){u[0]&2048&&fe(n,a[11])},d(a){a&&j(e)}}}function Hl(t){let e,l,n,a,u,w,d,m;function f(_,x){if(_[4]==="trajectory")return Wi;if(_[4]==="velocity")return Ui;if(_[4]==="combined")return Yi}let g=f(t),c=g&&g(t);function v(_,x){if(_[4]==="trajectory")return qi;if(_[4]==="velocity")return Ji;if(_[4]==="combined")return Gi}let p=v(t),b=p&&p(t);return{c(){e=r("div"),l=r("div"),n=r("button"),n.innerHTML='<svg class="w-5 sm:w-6 h-5 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',a=k(),u=r("h3"),c&&c.c(),w=k(),b&&b.c(),i(n,"class","absolute top-3 sm:top-4 right-3 sm:right-4 text-white hover:text-red-400 focus:text-red-400 transition-colors z-10 bg-slate-800 rounded-full p-2 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-slate-900"),i(n,"aria-label","Chiudi grafico a schermo intero"),i(u,"id","fullscreen-chart-title"),i(u,"class","text-base sm:text-lg font-semibold text-white mb-3 sm:mb-4 pr-10"),i(l,"class","relative bg-slate-900 rounded-xl p-4 sm:p-6 max-w-[95vw] max-h-[95vh] overflow-auto z-10 shadow-2xl border border-slate-700"),i(e,"class","fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4"),i(e,"role","dialog"),i(e,"aria-modal","true"),i(e,"aria-labelledby","fullscreen-chart-title")},m(_,x){L(_,e,x),o(e,l),o(l,n),o(l,a),o(l,u),c&&c.m(u,null),o(l,w),b&&b.m(l,null),d||(m=[te(n,"click",t[13]),te(e,"click",ul(t[13])),te(e,"keydown",t[28])],d=!0)},p(_,x){g!==(g=f(_))&&(c&&c.d(1),c=g&&g(_),c&&(c.c(),c.m(u,null))),p===(p=v(_))&&b?b.p(_,x):(b&&b.d(1),b=p&&p(_),b&&(b.c(),b.m(l,null)))},d(_){_&&j(e),c&&c.d(),b&&b.d(),d=!1,Ae(m)}}}function Yi(t){let e;return{c(){e=I("Confronto Traiettoria e Velocità")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function Ui(t){let e;return{c(){e=I("Velocità nel Tempo")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function Wi(t){let e;return{c(){e=I("Traiettoria del Salto")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function Gi(t){let e;return{c(){e=r("canvas"),i(e,"class","rounded-lg")},m(l,n){L(l,e,n),t[27](e)},p:ee,d(l){l&&j(e),t[27](null)}}}function Ji(t){let e;return{c(){e=r("canvas"),i(e,"class","rounded-lg")},m(l,n){L(l,e,n),t[26](e)},p:ee,d(l){l&&j(e),t[26](null)}}}function qi(t){let e;return{c(){e=r("canvas"),i(e,"class","rounded-lg")},m(l,n){L(l,e,n),t[25](e)},p:ee,d(l){l&&j(e),t[25](null)}}}function Ki(t){let e,l,n,a,u,w,d,m,f,g,c,v,p=t[0].max_height+"",b,_,x,C,E,R,Y,M=t[0].flight_time+"",G,V,ie,A,D,U,se,_e=(t[0].calculated_takeoff_velocity||t[0].takeoff_velocity||0)+"",ye,xe,X,Z,re,pe,ae,ce=(t[0].calculated_estimated_power||t[0].estimated_power||0)+"",me,O,S,N,ue,q,s,oe,y,h,T,F=(t[0].calculated_contact_time||t[0].contact_time||0)+"",W,he,ne,we,Q,le,Ce,H=(t[0].calculated_eccentric_time||t[0].eccentric_time||0)+"",B,z,$,ge,Ne,Ft,Ue,dt=(t[0].calculated_concentric_time||t[0].concentric_time||0)+"",Ct,et,He,Ie,qe,St,We,mt=t[0].fall_time+"",Tt,tt,lt,be,it,At,P,K,ve,Pe,Re,Ve=(t[0].calculated_average_force||t[0].average_force||0)+"",Pt,It,Mt,Ge,Bt,Wl,pt,Ot=t[0].jump_detected?"Sì":"No",ll,Nt,Gl,il,nl,al,sl,ht,Be,Ke,bt,Jl,Ht=t[10]?"Salvataggio...":"Salva Risultati",ol,Yt,ql,gt,Kl,rl,Xl,Ee=t[9].trajectoryData.length>0&&Il(t),ze=t[8].length>0&&Bl(t),De=t[9].trajectoryData.length>0&&t[8].length>0&&Ol(t),je=t[11]&&Nl(t),Le=t[4]&&Hl(t);return{c(){e=r("div"),l=r("div"),l.innerHTML='<h2 class="text-lg sm:text-xl font-semibold text-white">Risultati Analisi</h2> <p class="text-green-100 text-xs sm:text-sm mt-1">Analisi completata con successo</p>',n=k(),a=r("div"),u=r("div"),w=r("h3"),w.textContent="Metriche Principali",d=k(),m=r("div"),f=r("div"),g=r("p"),g.textContent="Altezza Max",c=k(),v=r("p"),b=I(p),_=I(" cm"),x=k(),C=r("div"),E=r("p"),E.textContent="Tempo di Volo",R=k(),Y=r("p"),G=I(M),V=I(" s"),ie=k(),A=r("div"),D=r("p"),D.textContent="Velocità Decollo",U=k(),se=r("p"),ye=I(_e),xe=I(" cm/s"),X=k(),Z=r("div"),re=r("p"),re.textContent="Potenza Est.",pe=k(),ae=r("p"),me=I(ce),O=I(" W"),S=k(),N=r("div"),ue=r("h3"),ue.textContent="Analisi Fasi",q=k(),s=r("div"),oe=r("div"),y=r("span"),y.textContent="Tempo Contatto",h=k(),T=r("span"),W=I(F),he=I(" s"),ne=k(),we=r("div"),Q=r("span"),Q.textContent="Fase Eccentrica",le=k(),Ce=r("span"),B=I(H),z=I(" s"),$=k(),ge=r("div"),Ne=r("span"),Ne.textContent="Fase Concentrica",Ft=k(),Ue=r("span"),Ct=I(dt),et=I(" s"),He=k(),Ie=r("div"),qe=r("span"),qe.textContent="Tempo Caduta",St=k(),We=r("span"),Tt=I(mt),tt=I(" s"),lt=k(),be=r("div"),it=r("h3"),it.textContent="Parametri Biomeccanici",At=k(),P=r("div"),K=r("div"),ve=r("span"),ve.textContent="Forza Media",Pe=k(),Re=r("span"),Pt=I(Ve),It=I(" N"),Mt=k(),Ge=r("div"),Bt=r("span"),Bt.textContent="Salto Rilevato",Wl=k(),pt=r("span"),ll=I(Ot),Gl=k(),Ee&&Ee.c(),il=k(),ze&&ze.c(),nl=k(),De&&De.c(),al=k(),je&&je.c(),sl=k(),ht=r("div"),Be=r("button"),Ke=at("svg"),bt=at("path"),Jl=k(),ol=I(Ht),ql=k(),gt=r("button"),gt.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        Nuova Analisi`,Kl=k(),Le&&Le.c(),i(l,"class","results-header bg-gradient-to-r from-green-600 to-teal-600 px-4 sm:px-6 py-3 sm:py-4"),i(w,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(g,"class","text-xs text-slate-400 mb-1"),i(v,"class","text-xl sm:text-2xl font-bold text-green-400"),i(v,"aria-live","polite"),i(f,"role","listitem"),i(E,"class","text-xs text-slate-400 mb-1"),i(Y,"class","text-xl sm:text-2xl font-bold text-blue-400"),i(Y,"aria-live","polite"),i(C,"role","listitem"),i(D,"class","text-xs text-slate-400 mb-1"),i(se,"class","text-xl sm:text-2xl font-bold text-purple-400"),i(se,"aria-live","polite"),i(A,"role","listitem"),i(re,"class","text-xs text-slate-400 mb-1"),i(ae,"class","text-xl sm:text-2xl font-bold text-yellow-400"),i(ae,"aria-live","polite"),i(Z,"role","listitem"),i(m,"class","grid grid-cols-2 gap-3 sm:gap-4"),i(m,"role","list"),i(u,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(u,"role","region"),i(u,"aria-label","Metriche principali"),i(ue,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(y,"class","text-xs sm:text-sm text-slate-400"),i(T,"class","text-base sm:text-lg font-semibold text-white"),i(T,"aria-live","polite"),i(oe,"class","flex justify-between items-center"),i(oe,"role","listitem"),i(Q,"class","text-xs sm:text-sm text-slate-400"),i(Ce,"class","text-base sm:text-lg font-semibold text-white"),i(Ce,"aria-live","polite"),i(we,"class","flex justify-between items-center"),i(we,"role","listitem"),i(Ne,"class","text-xs sm:text-sm text-slate-400"),i(Ue,"class","text-base sm:text-lg font-semibold text-white"),i(Ue,"aria-live","polite"),i(ge,"class","flex justify-between items-center"),i(ge,"role","listitem"),i(qe,"class","text-xs sm:text-sm text-slate-400"),i(We,"class","text-base sm:text-lg font-semibold text-white"),i(We,"aria-live","polite"),i(Ie,"class","flex justify-between items-center"),i(Ie,"role","listitem"),i(s,"class","space-y-2.5 sm:space-y-3"),i(s,"role","list"),i(N,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(N,"role","region"),i(N,"aria-label","Analisi fasi"),i(it,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(ve,"class","text-xs sm:text-sm text-slate-400"),i(Re,"class","text-base sm:text-lg font-semibold text-white"),i(Re,"aria-live","polite"),i(K,"class","flex justify-between items-center"),i(K,"role","listitem"),i(Bt,"class","text-xs sm:text-sm text-slate-400"),i(pt,"class",Nt="text-base sm:text-lg font-semibold "+(t[0].jump_detected?"text-green-400":"text-red-400")),i(pt,"aria-live","polite"),i(Ge,"class","flex justify-between items-center"),i(Ge,"role","listitem"),i(P,"class","space-y-2.5 sm:space-y-3"),i(P,"role","list"),i(be,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(be,"role","region"),i(be,"aria-label","Parametri biomeccanici"),i(bt,"stroke-linecap","round"),i(bt,"stroke-linejoin","round"),i(bt,"stroke-width","2"),i(bt,"d","M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"),i(Ke,"class","w-5 h-5 inline mr-2"),i(Ke,"fill","none"),i(Ke,"stroke","currentColor"),i(Ke,"viewBox","0 0 24 24"),i(Ke,"aria-hidden","true"),Be.disabled=t[10],i(Be,"class","flex-1 bg-gradient-to-r from-green-600 to-teal-600 text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg font-semibold hover:from-green-700 hover:to-teal-700 focus:from-green-700 focus:to-teal-700 transition-all duration-200 shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-slate-800 disabled:opacity-50 disabled:cursor-not-allowed"),i(Be,"aria-label",Yt=t[10]?"Salvataggio in corso":"Salva risultati analisi"),i(gt,"class","flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 focus:from-blue-700 focus:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-800"),i(gt,"aria-label","Avvia una nuova analisi"),i(ht,"class","flex flex-col sm:flex-row gap-2 sm:gap-3 pt-3 sm:pt-4"),i(a,"class","results-content p-4 sm:p-6 space-y-4 sm:space-y-6 flex-1 overflow-auto svelte-dxhq61"),i(e,"class","results-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 h-full flex flex-col"),i(e,"role","region"),i(e,"aria-label","Risultati analisi salto")},m(J,ke){L(J,e,ke),o(e,l),o(e,n),o(e,a),o(a,u),o(u,w),o(u,d),o(u,m),o(m,f),o(f,g),o(f,c),o(f,v),o(v,b),o(v,_),o(m,x),o(m,C),o(C,E),o(C,R),o(C,Y),o(Y,G),o(Y,V),o(m,ie),o(m,A),o(A,D),o(A,U),o(A,se),o(se,ye),o(se,xe),o(m,X),o(m,Z),o(Z,re),o(Z,pe),o(Z,ae),o(ae,me),o(ae,O),o(a,S),o(a,N),o(N,ue),o(N,q),o(N,s),o(s,oe),o(oe,y),o(oe,h),o(oe,T),o(T,W),o(T,he),o(s,ne),o(s,we),o(we,Q),o(we,le),o(we,Ce),o(Ce,B),o(Ce,z),o(s,$),o(s,ge),o(ge,Ne),o(ge,Ft),o(ge,Ue),o(Ue,Ct),o(Ue,et),o(s,He),o(s,Ie),o(Ie,qe),o(Ie,St),o(Ie,We),o(We,Tt),o(We,tt),o(a,lt),o(a,be),o(be,it),o(be,At),o(be,P),o(P,K),o(K,ve),o(K,Pe),o(K,Re),o(Re,Pt),o(Re,It),o(P,Mt),o(P,Ge),o(Ge,Bt),o(Ge,Wl),o(Ge,pt),o(pt,ll),o(a,Gl),Ee&&Ee.m(a,null),o(a,il),ze&&ze.m(a,null),o(a,nl),De&&De.m(a,null),o(a,al),je&&je.m(a,null),o(a,sl),o(a,ht),o(ht,Be),o(Be,Ke),o(Ke,bt),o(Be,Jl),o(Be,ol),o(ht,ql),o(ht,gt),o(e,Kl),Le&&Le.m(e,null),rl||(Xl=[te(Be,"click",t[15]),te(gt,"click",t[14])],rl=!0)},p(J,ke){ke[0]&1&&p!==(p=J[0].max_height+"")&&fe(b,p),ke[0]&1&&M!==(M=J[0].flight_time+"")&&fe(G,M),ke[0]&1&&_e!==(_e=(J[0].calculated_takeoff_velocity||J[0].takeoff_velocity||0)+"")&&fe(ye,_e),ke[0]&1&&ce!==(ce=(J[0].calculated_estimated_power||J[0].estimated_power||0)+"")&&fe(me,ce),ke[0]&1&&F!==(F=(J[0].calculated_contact_time||J[0].contact_time||0)+"")&&fe(W,F),ke[0]&1&&H!==(H=(J[0].calculated_eccentric_time||J[0].eccentric_time||0)+"")&&fe(B,H),ke[0]&1&&dt!==(dt=(J[0].calculated_concentric_time||J[0].concentric_time||0)+"")&&fe(Ct,dt),ke[0]&1&&mt!==(mt=J[0].fall_time+"")&&fe(Tt,mt),ke[0]&1&&Ve!==(Ve=(J[0].calculated_average_force||J[0].average_force||0)+"")&&fe(Pt,Ve),ke[0]&1&&Ot!==(Ot=J[0].jump_detected?"Sì":"No")&&fe(ll,Ot),ke[0]&1&&Nt!==(Nt="text-base sm:text-lg font-semibold "+(J[0].jump_detected?"text-green-400":"text-red-400"))&&i(pt,"class",Nt),J[9].trajectoryData.length>0?Ee?Ee.p(J,ke):(Ee=Il(J),Ee.c(),Ee.m(a,il)):Ee&&(Ee.d(1),Ee=null),J[8].length>0?ze?ze.p(J,ke):(ze=Bl(J),ze.c(),ze.m(a,nl)):ze&&(ze.d(1),ze=null),J[9].trajectoryData.length>0&&J[8].length>0?De?De.p(J,ke):(De=Ol(J),De.c(),De.m(a,al)):De&&(De.d(1),De=null),J[11]?je?je.p(J,ke):(je=Nl(J),je.c(),je.m(a,sl)):je&&(je.d(1),je=null),ke[0]&1024&&Ht!==(Ht=J[10]?"Salvataggio...":"Salva Risultati")&&fe(ol,Ht),ke[0]&1024&&(Be.disabled=J[10]),ke[0]&1024&&Yt!==(Yt=J[10]?"Salvataggio in corso":"Salva risultati analisi")&&i(Be,"aria-label",Yt),J[4]?Le?Le.p(J,ke):(Le=Hl(J),Le.c(),Le.m(e,null)):Le&&(Le.d(1),Le=null)},i:ee,o:ee,d(J){J&&j(e),Ee&&Ee.d(),ze&&ze.d(),De&&De.d(),je&&je.d(),Le&&Le.d(),rl=!1,Ae(Xl)}}}const Fe=5;function ut(t,e){const l=t.getContext("2d");l.clearRect(0,0,t.width,t.height),l.fillStyle=e,l.fillRect(0,0,t.width,t.height)}function tl(t,{padding:e,width:l,height:n,chartWidth:a,chartHeight:u,minT:w,deltaT:d,minY:m,deltaY:f,style:g,xFormatter:c,yFormatter:v,invertYLabel:p=!0,rightSideLabels:b=!1}){t.strokeStyle=g.axis,t.lineWidth=2,t.beginPath(),t.moveTo(e,e),t.lineTo(e,n-e),t.lineTo(l-e,n-e),t.stroke(),t.strokeStyle=g.grid,t.lineWidth=1,t.fillStyle=g.label,t.font="11px sans-serif",t.textBaseline="middle";for(let _=0;_<=Fe;_++){const x=_/Fe,C=e+u*x,E=p?m+f*(Fe-_)/Fe:m+f*_/Fe;t.beginPath(),t.moveTo(e,C),t.lineTo(l-e,C),t.stroke();const R=v(E),Y=b?l-e+12:e-12,M=b?"left":"right";t.textAlign=M,t.fillText(R,Y,C)}t.textAlign="center",t.textBaseline="top";for(let _=0;_<=Fe;_++){const x=_/Fe,C=e+a*x,E=w+d*x;t.beginPath(),t.moveTo(C,e),t.lineTo(C,n-e),t.stroke();const R=c(E);t.fillText(R,C,n-e+12)}}function Yl(t,{width:e,height:l,padding:n,xText:a,yText:u,style:w}){t.fillStyle=w.label,t.font="12px sans-serif",t.textAlign="center",t.textBaseline="alphabetic",t.fillText(a,e/2,l-18),t.save(),t.translate(20,l/2),t.rotate(-Math.PI/2),t.textAlign="center",t.fillText(u,0,0),t.restore()}function Xi(t,e,{padding:l,height:n,minV:a,deltaV:u,chartHeight:w,style:d}){if(e.length<2)return;const m=e[0].x,f=e[e.length-1].x,g=(0-a)/u,c=n-l-g*w;t.save(),t.beginPath(),t.moveTo(m,n-l),e.forEach(v=>t.lineTo(v.x,v.y)),t.lineTo(f,n-l),t.closePath(),t.clip(),g<=0?(t.fillStyle=d.fillAbove,t.fillRect(m,l,f-m,n-l)):g>=1?(t.fillStyle=d.fillBelow,t.fillRect(m,l,f-m,n-l)):(t.fillStyle=d.fillAbove,t.fillRect(m,l,f-m,c-l),t.fillStyle=d.fillBelow,t.fillRect(m,c,f-m,n-l-(c-l))),t.restore()}function Zi(t,e,l){let n;Dt(t,de,S=>l(9,n=S));let{results:a}=e;const u=Jt();let w,d,m,f=null,g,c,v,p=[],b=null;const _={background:"#0f172a",grid:"#233044",axis:"#3c4b63",line:"#38bdf8",lineShadow:"rgba(56, 189, 248, 0.35)",fill:"rgba(56, 189, 248, 0.18)",label:"#94a3b8",zero:"#64748b"},x={background:"#121e33",grid:"#24324a",axis:"#3f4d66",line:"#c084fc",lineShadow:"rgba(192, 132, 252, 0.35)",fillAbove:"rgba(192, 132, 252, 0.18)",fillBelow:"rgba(148, 163, 184, 0.12)",label:"#a5b4fc",zero:"#64748b"};Wt(()=>{w&&n.trajectoryData.length>0&&C(),d&&p.length>0&&E(),window.addEventListener("keydown",G)}),Gt(()=>{window.removeEventListener("keydown",G)});function C(S=null,N=null,ue=null){const q=S||w;if(!q)return;const s=q.getContext("2d"),oe=N||q.width,y=ue||q.height;N&&(q.width=N),ue&&(q.height=ue);const h=52,T=oe-2*h,F=y-2*h;ut(q,_.background);const W=n.trajectoryData;if(W.length===0)return;const he=Math.max(...W.map(B=>B.t)),ne=Math.min(...W.map(B=>B.t)),we=Math.max(...W.map(B=>B.y)),Q=Math.min(...W.map(B=>B.y)),le=he===ne?1:he-ne,Ce=we===Q?1:we-Q,H=b;if(tl(s,{padding:h,width:oe,height:y,chartWidth:T,chartHeight:F,minT:ne,deltaT:le,minY:Q,deltaY:Ce,style:_,xFormatter:B=>B.toFixed(2),yFormatter:B=>B.toFixed(1)}),Q<=0&&we>=0){const B=y-h-(0-Q)/Ce*F;s.strokeStyle=_.zero,s.setLineDash([6,6]),s.beginPath(),s.moveTo(h,B),s.lineTo(oe-h,B),s.stroke(),s.setLineDash([])}if(b){if(H.eccentricStart!==null&&H.eccentricEnd!==null){const B=h+(H.eccentricStart-ne)/le*T,z=h+(H.eccentricEnd-ne)/le*T;s.fillStyle="rgba(255, 165, 0, 0.15)",s.fillRect(B,h,z-B,F)}if(H.concentricStart!==null&&H.concentricEnd!==null){const B=h+(H.concentricStart-ne)/le*T,z=h+(H.concentricEnd-ne)/le*T;s.fillStyle="rgba(0, 255, 0, 0.15)",s.fillRect(B,h,z-B,F)}}if(s.lineWidth=3,s.strokeStyle=_.line,s.lineJoin="round",s.lineCap="round",s.shadowColor=_.lineShadow,s.shadowBlur=12,s.beginPath(),W.forEach((B,z)=>{const $=h+(B.t-ne)/le*T,ge=y-h-(B.y-Q)/Ce*F;z===0?s.moveTo($,ge):s.lineTo($,ge)}),s.stroke(),s.shadowBlur=0,s.lineTo(h+T,y-h),s.lineTo(h,y-h),s.closePath(),s.fillStyle=_.fill,s.fill(),s.fillStyle=_.line,W.forEach((B,z)=>{if(z%Math.max(1,Math.floor(W.length/25))===0||z===W.length-1){const $=h+(B.t-ne)/le*T,ge=y-h-(B.y-Q)/Ce*F;s.beginPath(),s.arc($,ge,3,0,Math.PI*2),s.fill()}}),H){const B={contact:"rgba(255, 255, 0, 0.7)",eccentric:"rgba(255, 165, 0, 0.7)",takeoff:"rgba(255, 0, 0, 0.7)"};if(H.contactStart!==null){const z=h+(H.contactStart-ne)/le*T;s.strokeStyle=B.contact,s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo(z,h),s.lineTo(z,y-h),s.stroke(),s.setLineDash([]),s.fillStyle=B.contact,s.font="10px sans-serif",s.textAlign="center",s.textBaseline="top",s.fillText("Inizio Contatto",z,h+2)}if(H.eccentricEnd!==null){const z=h+(H.eccentricEnd-ne)/le*T;s.strokeStyle=B.eccentric,s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo(z,h),s.lineTo(z,y-h),s.stroke(),s.setLineDash([]),s.fillStyle=B.eccentric,s.font="10px sans-serif",s.textAlign="center",s.textBaseline="top",s.fillText("Fine Eccentrica",z,h+14)}if(H.takeoff!==null){const z=h+(H.takeoff-ne)/le*T;s.strokeStyle=B.takeoff,s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo(z,h),s.lineTo(z,y-h),s.stroke(),s.setLineDash([]),s.fillStyle=B.takeoff,s.font="10px sans-serif",s.textAlign="center",s.textBaseline="top",s.fillText("Decollo",z,h+26)}}Yl(s,{width:oe,height:y,padding:h,xText:"Tempo (s)",yText:"Altezza (cm)",style:_})}function E(S=null,N=null,ue=null){const q=S||d;if(!q)return;const s=q.getContext("2d"),oe=N||q.width,y=ue||q.height;N&&(q.width=N),ue&&(q.height=ue);const h=52,T=oe-2*h,F=y-2*h;ut(q,x.background);const W=p;if(W.length===0)return;const he=Math.max(...W.map(z=>z.t)),ne=Math.min(...W.map(z=>z.t)),we=Math.max(...W.map(z=>z.v)),Q=Math.min(...W.map(z=>z.v)),le=he===ne?1:he-ne,Ce=we===Q?Math.abs(we)||1:we-Q,H=b;if(tl(s,{padding:h,width:oe,height:y,chartWidth:T,chartHeight:F,minT:ne,deltaT:le,minY:Q,deltaY:Ce,style:x,xFormatter:z=>z.toFixed(2),yFormatter:z=>z.toFixed(1),invertYLabel:!0,rightSideLabels:!0}),Q<=0&&we>=0){const z=y-h-(0-Q)/Ce*F;s.strokeStyle=x.zero,s.setLineDash([6,6]),s.beginPath(),s.moveTo(h,z),s.lineTo(oe-h,z),s.stroke(),s.setLineDash([])}if(b){if(H.eccentricStart!==null&&H.eccentricEnd!==null){const z=h+(H.eccentricStart-ne)/le*T,$=h+(H.eccentricEnd-ne)/le*T;s.fillStyle="rgba(255, 165, 0, 0.15)",s.fillRect(z,h,$-z,F)}if(H.concentricStart!==null&&H.concentricEnd!==null){const z=h+(H.concentricStart-ne)/le*T,$=h+(H.concentricEnd-ne)/le*T;s.fillStyle="rgba(0, 255, 0, 0.15)",s.fillRect(z,h,$-z,F)}}s.lineWidth=3,s.strokeStyle=x.line,s.lineJoin="round",s.lineCap="round",s.shadowColor=x.lineShadow,s.shadowBlur=12;const B=[];if(s.beginPath(),W.forEach((z,$)=>{const ge=h+(z.t-ne)/le*T,Ne=y-h-(z.v-Q)/Ce*F;B.push({x:ge,y:Ne}),$===0?s.moveTo(ge,Ne):s.lineTo(ge,Ne)}),s.stroke(),s.shadowBlur=0,Xi(s,B,{padding:h,height:y,minV:Q,deltaV:Ce,chartHeight:F,style:x}),s.fillStyle=x.line,B.forEach((z,$)=>{($%Math.max(1,Math.floor(B.length/25))===0||$===B.length-1)&&(s.beginPath(),s.arc(z.x,z.y,3,0,Math.PI*2),s.fill())}),H){const z={contact:"rgba(255, 255, 0, 0.7)",eccentric:"rgba(255, 165, 0, 0.7)",takeoff:"rgba(255, 0, 0, 0.7)"};if(H.contactStart!==null){const $=h+(H.contactStart-ne)/le*T;s.strokeStyle=z.contact,s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo($,h),s.lineTo($,y-h),s.stroke(),s.setLineDash([]),s.fillStyle=z.contact,s.font="10px sans-serif",s.textAlign="center",s.textBaseline="top",s.fillText("Inizio Contatto",$,h+2)}if(H.eccentricEnd!==null){const $=h+(H.eccentricEnd-ne)/le*T;s.strokeStyle=z.eccentric,s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo($,h),s.lineTo($,y-h),s.stroke(),s.setLineDash([]),s.fillStyle=z.eccentric,s.font="10px sans-serif",s.textAlign="center",s.textBaseline="top",s.fillText("Fine Eccentrica",$,h+14)}if(H.takeoff!==null){const $=h+(H.takeoff-ne)/le*T;s.strokeStyle=z.takeoff,s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo($,h),s.lineTo($,y-h),s.stroke(),s.setLineDash([]),s.fillStyle=z.takeoff,s.font="10px sans-serif",s.textAlign="center",s.textBaseline="top",s.fillText("Decollo",$,h+26)}}Yl(s,{width:oe,height:y,padding:h,xText:"Tempo (s)",yText:"Velocità (cm/s)",style:x})}function R(S=null,N=null,ue=null){var it,At;const q=S||m;if(!q)return;const s=q.getContext("2d"),oe=N||q.width,y=ue||q.height;N&&(q.width=N),ue&&(q.height=ue);const h=52,T=oe-2*h,F=y-2*h;ut(q,_.background);const W=n.trajectoryData,he=p;if(W.length===0||he.length===0)return;const ne=[...W.map(P=>P.t),...he.map(P=>P.t)],we=Math.max(...ne),Q=Math.min(...ne),le=we===Q?1:we-Q,Ce=Math.max(...W.map(P=>P.y)),H=Math.min(...W.map(P=>P.y)),B=Ce===H?1:Ce-H,z=Math.max(...he.map(P=>P.v)),$=Math.min(...he.map(P=>P.v)),ge=z===$?Math.abs(z)||1:z-$,Ne=((it=W[0])==null?void 0:it.t)||0,Ft=((At=he[0])==null?void 0:At.t)||0,Ue=Math.min(Ne,Ft),dt=W.find(P=>Math.abs(P.t-Ue)<.01)||W[0],Ct=he.find(P=>Math.abs(P.t-Ue)<.01)||he[0],et=y-h-(dt.y-H)/B*F,He=y-h-(Ct.v-$)/ge*F,Ie=et-He,qe=he.map(P=>y-h-(P.v-$)/ge*F+Ie),St=Math.min(...qe),We=Math.max(...qe),mt=We-St,Tt=y-2*h;let tt=1,lt=Ie;if(St<h||We>y-h||mt>Tt){const P=qe.map(Ge=>Ge-et),K=Math.min(...P),ve=Math.max(...P),Pe=Math.max(0,ve),Re=Math.abs(Math.min(0,K)),Ve=Pe+Re,Pt=y-h-et,It=et-h,Mt=Pt+It;Ve>Mt&&(tt=Mt/Ve),lt=Ie}const be=b;tl(s,{padding:h,width:oe,height:y,chartWidth:T,chartHeight:F,minT:Q,deltaT:le,minY:H,deltaY:B,style:_,xFormatter:P=>P.toFixed(2),yFormatter:P=>P.toFixed(1)}),s.strokeStyle=x.grid,s.lineWidth=1,s.fillStyle=x.label,s.font="11px sans-serif",s.textBaseline="middle";for(let P=0;P<=Fe;P++){const K=P/Fe,ve=h+F*K,Pe=$+ge*(Fe-P)/Fe;s.beginPath(),s.moveTo(h,ve),s.lineTo(oe-h,ve),s.stroke();const Re=Pe.toFixed(1);s.textAlign="left",s.fillText(Re,oe-h+12,ve)}if(H<=0&&Ce>=0){const P=y-h-(0-H)/B*F;s.strokeStyle=_.zero,s.setLineDash([6,6]),s.beginPath(),s.moveTo(h,P),s.lineTo(oe-h,P),s.stroke(),s.setLineDash([])}if($<=0&&z>=0){const P=y-h-(0-$)/ge*F,ve=He+(P-He)*tt+lt;s.strokeStyle=x.zero,s.setLineDash([6,6]),s.beginPath(),s.moveTo(h,ve),s.lineTo(oe-h,ve),s.stroke(),s.setLineDash([])}if(b){if(be.eccentricStart!==null&&be.eccentricEnd!==null){const P=h+(be.eccentricStart-Q)/le*T,K=h+(be.eccentricEnd-Q)/le*T;s.fillStyle="rgba(255, 165, 0, 0.15)",s.fillRect(P,h,K-P,F)}if(be.concentricStart!==null&&be.concentricEnd!==null){const P=h+(be.concentricStart-Q)/le*T,K=h+(be.concentricEnd-Q)/le*T;s.fillStyle="rgba(0, 255, 0, 0.15)",s.fillRect(P,h,K-P,F)}}if(s.lineWidth=3,s.strokeStyle=_.line,s.lineJoin="round",s.lineCap="round",s.shadowColor=_.lineShadow,s.shadowBlur=12,s.beginPath(),W.forEach((P,K)=>{const ve=h+(P.t-Q)/le*T,Pe=y-h-(P.y-H)/B*F;K===0?s.moveTo(ve,Pe):s.lineTo(ve,Pe)}),s.stroke(),s.shadowBlur=0,s.lineWidth=3,s.strokeStyle=x.line,s.shadowColor=x.lineShadow,s.shadowBlur=12,s.beginPath(),he.forEach((P,K)=>{const ve=h+(P.t-Q)/le*T,Pe=y-h-(P.v-$)/ge*F,Ve=He+(Pe-He)*tt+lt;K===0?s.moveTo(ve,Ve):s.lineTo(ve,Ve)}),s.stroke(),s.shadowBlur=0,s.fillStyle=_.line,W.forEach((P,K)=>{if(K%Math.max(1,Math.floor(W.length/25))===0||K===W.length-1){const ve=h+(P.t-Q)/le*T,Pe=y-h-(P.y-H)/B*F;s.beginPath(),s.arc(ve,Pe,3,0,Math.PI*2),s.fill()}}),s.fillStyle=x.line,he.forEach((P,K)=>{if(K%Math.max(1,Math.floor(he.length/25))===0||K===he.length-1){const ve=h+(P.t-Q)/le*T,Pe=y-h-(P.v-$)/ge*F,Ve=He+(Pe-He)*tt+lt;s.beginPath(),s.arc(ve,Ve,3,0,Math.PI*2),s.fill()}}),be){const P={contact:"rgba(255, 255, 0, 0.7)",eccentric:"rgba(255, 165, 0, 0.7)",takeoff:"rgba(255, 0, 0, 0.7)"};if(be.contactStart!==null){const K=h+(be.contactStart-Q)/le*T;s.strokeStyle=P.contact,s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo(K,h),s.lineTo(K,y-h),s.stroke(),s.setLineDash([]),s.fillStyle=P.contact,s.font="10px sans-serif",s.textAlign="center",s.textBaseline="top",s.fillText("Inizio Contatto",K,h+2)}if(be.eccentricEnd!==null){const K=h+(be.eccentricEnd-Q)/le*T;s.strokeStyle=P.eccentric,s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo(K,h),s.lineTo(K,y-h),s.stroke(),s.setLineDash([]),s.fillStyle=P.eccentric,s.font="10px sans-serif",s.textAlign="center",s.textBaseline="top",s.fillText("Fine Eccentrica",K,h+14)}if(be.takeoff!==null){const K=h+(be.takeoff-Q)/le*T;s.strokeStyle=P.takeoff,s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo(K,h),s.lineTo(K,y-h),s.stroke(),s.setLineDash([]),s.fillStyle=P.takeoff,s.font="10px sans-serif",s.textAlign="center",s.textBaseline="top",s.fillText("Decollo",K,h+26)}}s.fillStyle=_.label,s.font="12px sans-serif",s.textAlign="center",s.textBaseline="alphabetic",s.fillText("Tempo (s)",oe/2,y-18),s.save(),s.translate(20,y/2),s.rotate(-Math.PI/2),s.textAlign="center",s.fillStyle=_.label,s.fillText("Altezza (cm)",0,0),s.restore(),s.save(),s.translate(oe-20,y/2),s.rotate(-Math.PI/2),s.textAlign="center",s.fillStyle=x.label,s.fillText("Velocità (cm/s)",0,0),s.restore()}function Y(S){l(4,f=S),setTimeout(()=>{const N=Math.floor(window.innerWidth*.9),ue=Math.floor(window.innerHeight*.8);S==="trajectory"&&g?C(g,N,ue):S==="velocity"&&c?E(c,N,ue):S==="combined"&&v&&R(v,N,ue)},100)}function M(){l(4,f=null)}function G(S){S.key==="Escape"&&f&&M()}function V(){u("reset")}let ie=!1,A="";async function D(){l(10,ie=!0),l(11,A="");try{const N=await(await fetch(`${Se()}/api/results/save`,{method:"POST"})).json();N.success?l(11,A="Risultati salvati con successo!"):l(11,A=N.error||"Errore durante il salvataggio")}catch{l(11,A="Errore di connessione al server")}finally{l(10,ie=!1)}}function U(S){Me[S?"unshift":"push"](()=>{w=S,l(1,w)})}const se=()=>Y("trajectory"),_e=S=>(S.key==="Enter"||S.key===" ")&&Y("trajectory");function ye(S){Me[S?"unshift":"push"](()=>{d=S,l(2,d)})}const xe=()=>Y("velocity"),X=S=>(S.key==="Enter"||S.key===" ")&&Y("velocity");function Z(S){Me[S?"unshift":"push"](()=>{m=S,l(3,m)})}const re=()=>Y("combined"),pe=S=>(S.key==="Enter"||S.key===" ")&&Y("combined");function ae(S){Me[S?"unshift":"push"](()=>{g=S,l(5,g)})}function ce(S){Me[S?"unshift":"push"](()=>{c=S,l(6,c)})}function me(S){Me[S?"unshift":"push"](()=>{v=S,l(7,v)})}const O=S=>S.key==="Escape"&&M();return t.$$set=S=>{"results"in S&&l(0,a=S.results)},t.$$.update=()=>{if(t.$$.dirty[0]&1&&a&&(l(8,p=a.velocity||[]),b=a.phase_times||null,a.trajectory&&$l(de,n.trajectoryData=a.trajectory,n)),t.$$.dirty[0]&514&&w&&(n.trajectoryData.length>0?C():ut(w,_.background)),t.$$.dirty[0]&260&&d&&(p.length>0?E():ut(d,x.background)),t.$$.dirty[0]&776&&m&&(n.trajectoryData.length>0&&p.length>0?R():ut(m,_.background)),t.$$.dirty[0]&560&&f==="trajectory"&&g&&n.trajectoryData.length>0){const S=Math.floor(window.innerWidth*.9),N=Math.floor(window.innerHeight*.8);C(g,S,N)}if(t.$$.dirty[0]&336&&f==="velocity"&&c&&p.length>0){const S=Math.floor(window.innerWidth*.9),N=Math.floor(window.innerHeight*.8);E(c,S,N)}if(t.$$.dirty[0]&912&&f==="combined"&&v&&n.trajectoryData.length>0&&p.length>0){const S=Math.floor(window.innerWidth*.9),N=Math.floor(window.innerHeight*.8);R(v,S,N)}},[a,w,d,m,f,g,c,v,p,n,ie,A,Y,M,V,D,U,se,_e,ye,xe,X,Z,re,pe,ae,ce,me,O]}class Qi extends kt{constructor(e){super(),xt(this,e,Zi,Ki,nt,{results:0},null,[-1,-1])}}function $i(t){let e,l;return e=new Qi({props:{results:t[2]}}),e.$on("reset",t[7]),{c(){Vt(e.$$.fragment)},m(n,a){yt(e,n,a),l=!0},p(n,a){const u={};a&4&&(u.results=n[2]),e.$set(u)},i(n){l||($e(e.$$.fragment,n),l=!0)},o(n){ct(e.$$.fragment,n),l=!1},d(n){wt(e,n)}}}function en(t){let e,l;return e=new Hi({props:{currentStep:t[0]}}),e.$on("stepComplete",t[5]),e.$on("goBack",t[8]),e.$on("cancelToStep1",t[9]),{c(){Vt(e.$$.fragment)},m(n,a){yt(e,n,a),l=!0},p(n,a){const u={};a&1&&(u.currentStep=n[0]),e.$set(u)},i(n){l||($e(e.$$.fragment,n),l=!0)},o(n){ct(e.$$.fragment,n),l=!1},d(n){wt(e,n)}}}function tn(t){let e,l,n,a,u,w,d,m,f,g,c,v,p,b,_,x,C,E,R;v=new Si({props:{analysisCompleted:t[1]}});const Y=[en,$i],M=[];function G(V,ie){return V[1]?1:0}return _=G(t),x=M[_]=Y[_](t),{c(){e=r("main"),l=r("header"),n=r("div"),a=r("div"),u=r("h1"),u.textContent="Jump Analyzer Pro",w=k(),d=r("button"),d.textContent="Chiudi Analisi",m=k(),f=r("div"),g=r("div"),c=r("div"),Vt(v.$$.fragment),p=k(),b=r("div"),x.c(),i(u,"class","text-2xl sm:text-3xl lg:text-4xl font-bold text-white tracking-tight"),i(d,"class","bg-red-600 hover:bg-red-700 focus:bg-red-700 text-white px-4 sm:px-5 py-2 rounded-lg font-semibold border border-red-500/50 shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-slate-800"),i(d,"aria-label","Chiudi analisi e esci dall'applicazione"),i(a,"class","flex items-center justify-between gap-4"),i(n,"class","max-w-[1400px] mx-auto px-4 sm:px-6 py-4 sm:py-6"),i(l,"class","bg-slate-800/50 backdrop-blur-sm border-b border-slate-700"),i(l,"role","banner"),i(c,"class","lg:col-span-2"),i(c,"aria-label","Anteprima video"),i(b,"class","lg:col-span-1"),i(b,"aria-label","Pannello controllo"),i(g,"class","grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6"),i(f,"class","max-w-[1400px] mx-auto px-4 sm:px-6 py-6 sm:py-8"),i(e,"class","min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900"),i(e,"role","main"),i(e,"aria-label","Jump Analyzer Pro - Analisi salto")},m(V,ie){L(V,e,ie),o(e,l),o(l,n),o(n,a),o(a,u),o(a,w),o(a,d),o(e,m),o(e,f),o(f,g),o(g,c),yt(v,c,null),t[12](c),o(g,p),o(g,b),M[_].m(b,null),t[13](b),C=!0,E||(R=te(d,"click",t[6]),E=!0)},p(V,[ie]){const A={};ie&2&&(A.analysisCompleted=V[1]),v.$set(A);let D=_;_=G(V),_===D?M[_].p(V,ie):(ci(),ct(M[D],1,1,()=>{M[D]=null}),fi(),x=M[_],x?x.p(V,ie):(x=M[_]=Y[_](V),x.c()),$e(x,1),x.m(b,null))},i(V){C||($e(v.$$.fragment,V),$e(x),C=!0)},o(V){ct(v.$$.fragment,V),ct(x),C=!1},d(V){V&&j(e),wt(v),t[12](null),M[_].d(),t[13](null),E=!1,R()}}}let ln=500;function nn(t,e,l){let n;Dt(t,de,D=>l(18,n=D));let a=1,u=!1,w=null,d,m,f,g,c,v,p=150,b=0;function _(){if(!m||!f)return;if(typeof window<"u"?window.innerWidth>=1024:!0){const U=m.clientHeight;l(4,f.style.height=U?`${U}px`:"",f)}else l(4,f.style.height="",f)}function x(){v&&clearTimeout(v),v=setTimeout(_,100)}async function C(){if(!(!n.isAnalyzing&&!n.isRecording&&!n.isCalibrating))try{if(n.isAnalyzing||n.isRecording||n.isCalibrating){const D=await fetch(`${Se()}/api/video/frame`,{signal:AbortSignal.timeout(1e3)});if(D.ok){const U=await D.json();U.success&&U.frame&&bl(U.frame)}}if(n.isAnalyzing){const D=await fetch(`${Se()}/api/analysis/data`,{signal:AbortSignal.timeout(1e3)});if(D.ok){const U=await D.json();U.realtime&&hi(U.realtime,U.trajectory,U.velocity)}}b>0&&(b=Math.max(0,b-1),l(11,p=Math.max(150,p-50)))}catch{b++,b>3&&l(11,p=Math.min(ln,p+50))}}Wt(()=>{l(10,d=setInterval(C,p)),window&&"ResizeObserver"in window?(g=new ResizeObserver(x),m&&g.observe(m)):window==null||window.addEventListener("resize",x),c=()=>{x(),setTimeout(_,150)},typeof document<"u"&&(document.addEventListener("fullscreenchange",c),document.addEventListener("webkitfullscreenchange",c),document.addEventListener("mozfullscreenchange",c),document.addEventListener("MSFullscreenChange",c)),setTimeout(_,0)}),Gt(()=>{d&&clearInterval(d),v&&clearTimeout(v),g&&m&&g.unobserve(m),g&&g.disconnect(),typeof window<"u"&&window.removeEventListener("resize",x),typeof document<"u"&&c&&(document.removeEventListener("fullscreenchange",c),document.removeEventListener("webkitfullscreenchange",c),document.removeEventListener("mozfullscreenchange",c),document.removeEventListener("MSFullscreenChange",c))});function E(D){const{step:U,data:se}=D.detail;U===1?l(0,a=2):U===2?(l(0,a=3),_()):U===3&&(l(2,w=se),l(1,u=!0),_())}async function R(){const D=[];n.isAnalyzing&&D.push(fetch(`${Se()}/api/analysis/stop`,{method:"POST"}).catch(()=>{})),n.isRecording&&D.push(fetch(`${Se()}/api/recording/stop`,{method:"POST"}).catch(()=>{})),await Promise.all(D)}async function Y(){var D,U;await R();try{(U=(D=n.previewStream)==null?void 0:D.getTracks())==null||U.forEach(se=>se.stop())}catch{}Qt(),de.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});try{window.close()}catch{}}function M(){l(1,u=!1),l(2,w=null),l(0,a=1),b=0,l(11,p=150),de.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null})}async function G(){a>1&&(a===2?(await R(),de.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null})):a===3&&(await R(),de.update(D=>({...D,isAnalyzing:!1,isPaused:!1,isCameraPreview:D.isCameraPreview,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:D.localVideoUrl}))),l(0,a--,a),_())}async function V(){await R(),l(0,a=1),de.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null}),_()}function ie(D){Me[D?"unshift":"push"](()=>{m=D,l(3,m)})}function A(D){Me[D?"unshift":"push"](()=>{f=D,l(4,f)})}return t.$$.update=()=>{t.$$.dirty&3072&&d&&(clearInterval(d),l(10,d=setInterval(C,p)))},[a,u,w,m,f,E,Y,M,G,V,d,p,ie,A]}class an extends kt{constructor(e){super(),xt(this,e,nn,tn,nt,{})}}window.__APP_LOADING__=!0;function Ul(){try{const t=document.getElementById("app");if(!t)throw new Error("Elemento #app non trovato nel DOM");t.innerHTML="";const e=new an({target:t});window.__APP_LOADED__=!0,window.__APP_LOADING__=!1}catch(t){console.error("Errore durante l'inizializzazione dell'app:",t),window.__APP_LOADING__=!1;const e=document.getElementById("app");e&&(e.innerHTML=`
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #0f172a; color: white; font-family: sans-serif; padding: 20px;">
          <div style="text-align: center; max-width: 600px;">
            <h1 style="color: #ef4444; margin-bottom: 20px;">Errore di Caricamento</h1>
            <p style="color: #94a3b8; margin-bottom: 10px;">Si è verificato un errore durante il caricamento dell'applicazione.</p>
            <p style="color: #64748b; font-size: 14px; margin-top: 20px; word-break: break-word;">${t.message||"Errore sconosciuto"}</p>
            <p style="color: #64748b; font-size: 12px; margin-top: 10px;">Stack: ${t.stack||"N/A"}</p>
            <p style="color: #64748b; font-size: 12px; margin-top: 10px;">Apri la console del browser (F12) per maggiori dettagli.</p>
          </div>
        </div>
      `)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ul):Ul()})();
