var In=Object.defineProperty;var Vn=(N,ue,_e)=>ue in N?In(N,ue,{enumerable:!0,configurable:!0,writable:!0,value:_e}):N[ue]=_e;var Ht=(N,ue,_e)=>Vn(N,typeof ue!="symbol"?ue+"":ue,_e);(function(){"use strict";function N(){}function ue(t){return t()}function _e(){return Object.create(null)}function de(t){t.forEach(ue)}function Ut(t){return typeof t=="function"}function Te(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let nt;function it(t,e){return t===e?!0:(nt||(nt=document.createElement("a")),nt.href=e,t===nt.href)}function Il(t){return Object.keys(t).length===0}function Vl(t,...e){if(t==null){for(const n of e)n(void 0);return N}const l=t.subscribe(...e);return l.unsubscribe?()=>l.unsubscribe():l}function st(t,e,l){t.$$.on_destroy.push(Vl(e,l))}function i(t,e){t.appendChild(e)}function E(t,e,l){t.insertBefore(e,l||null)}function P(t){t.parentNode&&t.parentNode.removeChild(t)}function Nl(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function r(t){return document.createElement(t)}function Ae(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function j(t){return document.createTextNode(t)}function _(){return j(" ")}function at(){return j("")}function Q(t,e,l,n){return t.addEventListener(e,l,n),()=>t.removeEventListener(e,l,n)}function a(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function we(t){return t===""?null:+t}function Fl(t){return Array.from(t.childNodes)}function B(t,e){e=""+e,t.data!==e&&(t.data=e)}function me(t,e){t.value=e??""}function Bt(t,e,l,n){l==null?t.style.removeProperty(e):t.style.setProperty(e,l,"")}function Wt(t,e,l){for(let n=0;n<t.options.length;n+=1){const s=t.options[n];if(s.__value===e){s.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function Hl(t){const e=t.querySelector(":checked");return e&&e.__value}function Ul(t,e,{bubbles:l=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:l,cancelable:n})}let Ue;function Be(t){Ue=t}function kt(){if(!Ue)throw new Error("Function called outside component initialization");return Ue}function xt(t){kt().$$.on_mount.push(t)}function Jt(t){kt().$$.on_destroy.push(t)}function Ct(){const t=kt();return(e,l,{cancelable:n=!1}={})=>{const s=t.$$.callbacks[e];if(s){const f=Ul(e,l,{cancelable:n});return s.slice().forEach(g=>{g.call(t,f)}),!f.defaultPrevented}return!0}}const Pe=[],pe=[];let ze=[];const St=[],Bl=Promise.resolve();let Tt=!1;function Wl(){Tt||(Tt=!0,Bl.then(qt))}function rt(t){ze.push(t)}function Jl(t){St.push(t)}const At=new Set;let Ee=0;function qt(){if(Ee!==0)return;const t=Ue;do{try{for(;Ee<Pe.length;){const e=Pe[Ee];Ee++,Be(e),ql(e.$$)}}catch(e){throw Pe.length=0,Ee=0,e}for(Be(null),Pe.length=0,Ee=0;pe.length;)pe.pop()();for(let e=0;e<ze.length;e+=1){const l=ze[e];At.has(l)||(At.add(l),l())}ze.length=0}while(Pe.length);for(;St.length;)St.pop()();Tt=!1,At.clear(),Be(t)}function ql(t){if(t.fragment!==null){t.update(),de(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(rt)}}function Gl(t){const e=[],l=[];ze.forEach(n=>t.indexOf(n)===-1?e.push(n):l.push(n)),l.forEach(n=>n()),ze=e}const ot=new Set;let ye;function Yl(){ye={r:0,c:[],p:ye}}function Kl(){ye.r||de(ye.c),ye=ye.p}function ke(t,e){t&&t.i&&(ot.delete(t),t.i(e))}function Me(t,e,l,n){if(t&&t.o){if(ot.has(t))return;ot.add(t),ye.c.push(()=>{ot.delete(t),n&&(l&&t.d(1),n())}),t.o(e)}else n&&n()}function Gt(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Zl(t,e,l){const n=t.$$.props[e];n!==void 0&&(t.$$.bound[n]=l,l(t.$$.ctx[n]))}function ct(t){t&&t.c()}function We(t,e,l){const{fragment:n,after_update:s}=t.$$;n&&n.m(e,l),rt(()=>{const f=t.$$.on_mount.map(ue).filter(Ut);t.$$.on_destroy?t.$$.on_destroy.push(...f):de(f),t.$$.on_mount=[]}),s.forEach(rt)}function Je(t,e){const l=t.$$;l.fragment!==null&&(Gl(l.after_update),de(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function Ql(t,e){t.$$.dirty[0]===-1&&(Pe.push(t),Wl(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function qe(t,e,l,n,s,f,g=null,u=[-1]){const o=Ue;Be(t);const c=t.$$={fragment:null,ctx:[],props:f,update:N,not_equal:s,bound:_e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(o?o.$$.context:[])),callbacks:_e(),dirty:u,skip_bound:!1,root:e.target||o.$$.root};g&&g(c.root);let b=!1;if(c.ctx=l?l(t,e.props||{},(m,d,...h)=>{const v=h.length?h[0]:d;return c.ctx&&s(c.ctx[m],c.ctx[m]=v)&&(!c.skip_bound&&c.bound[m]&&c.bound[m](v),b&&Ql(t,m)),d}):[],c.update(),b=!0,de(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const m=Fl(e.target);c.fragment&&c.fragment.l(m),m.forEach(P)}else c.fragment&&c.fragment.c();e.intro&&ke(t.$$.fragment),We(t,e.target,e.anchor),qt()}Be(o)}class Ge{constructor(){Ht(this,"$$");Ht(this,"$$set")}$destroy(){Je(this,1),this.$destroy=N}$on(e,l){if(!Ut(l))return N;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(l),()=>{const s=n.indexOf(l);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!Il(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Xl="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Xl);const je=[];function $l(t,e=N){let l;const n=new Set;function s(u){if(Te(t,u)&&(t=u,l)){const o=!je.length;for(const c of n)c[1](),je.push(c,t);if(o){for(let c=0;c<je.length;c+=2)je[c][0](je[c+1]);je.length=0}}}function f(u){s(u(t))}function g(u,o=N){const c=[u,o];return n.add(c),n.size===1&&(l=e(s,f)||N),u(t),()=>{n.delete(c),n.size===0&&l&&(l(),l=null)}}return{set:s,update:f,subscribe:g}}const J=$l({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,previewStream:null,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});function Yt(t){J.update(e=>({...e,videoFrame:t}))}function en(t,e,l){J.update(n=>({...n,realtimeData:t,trajectoryData:e||n.trajectoryData,velocityData:l||n.velocityData}))}function tn(t){J.update(e=>({...e,localVideoUrl:t}))}function Pt(t){J.update(e=>({...e,isCameraPreview:!!t}))}function ln(t){J.update(e=>({...e,previewStream:t||null}))}function zt(){J.update(t=>({...t,previewStream:null}))}function Kt(t){J.update(e=>({...e,inputMode:t==="upload"||t==="camera"?t:"none"}))}const te=()=>typeof window<"u"&&window.BACKEND_URL?window.BACKEND_URL:"http://localhost:5000",nn=te();async function ae(t,e={}){const l=`${nn}${t}`,n=await fetch(l,e);try{return await n.json()}catch{return{}}}const De={setCamera(t){return ae("/api/settings/camera",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({index:Number(t)})})},setFps(t){return ae("/api/settings/fps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:t})})},setHeight(t){return ae("/api/settings/height",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:t})})},setMass(t){return ae("/api/settings/mass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:t})})},startRecording(){return ae("/api/recording/start",{method:"POST"})},stopRecording(){return ae("/api/recording/stop",{method:"POST"})},startCalibration(){return ae("/api/calibration/start",{method:"POST"})},calibrationStatus(){return ae("/api/calibration/status")},startAnalysis(){return ae("/api/analysis/start",{method:"POST"})},analysisStatus(){return ae("/api/analysis/status")},analysisResults(){return ae("/api/analysis/results")},pauseAnalysis(){return ae("/api/analysis/pause",{method:"POST"})},resumeAnalysis(){return ae("/api/analysis/resume",{method:"POST"})},stopAnalysis(){return ae("/api/analysis/stop",{method:"POST"})},videoFrame(){return ae("/api/video/frame")},analysisData(){return ae("/api/analysis/data")}};function sn(t){let e;return{c(){e=r("div"),e.innerHTML='<svg class="w-24 h-24 mx-auto text-slate-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> <p class="text-slate-400 text-lg">Nessun video caricato</p> <p class="text-slate-500 text-sm mt-2">Carica o registra un video per iniziare</p>',a(e,"class","text-center p-8")},m(l,n){E(l,e,n)},p:N,d(l){l&&P(e)}}}function an(t){let e,l,n,s,f,g,u,o=t[4].isRecording&&Zt(),c=t[4].isAnalyzing&&Qt(),b=t[4].isCalibrating&&Xt(),m=t[0]&&!t[4].localVideoUrl&&$t(t);return{c(){e=r("img"),n=_(),o&&o.c(),s=_(),c&&c.c(),f=_(),b&&b.c(),g=_(),m&&m.c(),u=at(),it(e.src,l=t[8])||a(e,"src",l),a(e,"alt","Video frame"),a(e,"class","w-full h-full max-w-full max-h-full object-contain")},m(d,h){E(d,e,h),E(d,n,h),o&&o.m(d,h),E(d,s,h),c&&c.m(d,h),E(d,f,h),b&&b.m(d,h),E(d,g,h),m&&m.m(d,h),E(d,u,h)},p(d,h){h&256&&!it(e.src,l=d[8])&&a(e,"src",l),d[4].isRecording?o||(o=Zt(),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null),d[4].isAnalyzing?c||(c=Qt(),c.c(),c.m(f.parentNode,f)):c&&(c.d(1),c=null),d[4].isCalibrating?b||(b=Xt(),b.c(),b.m(g.parentNode,g)):b&&(b.d(1),b=null),d[0]&&!d[4].localVideoUrl?m?m.p(d,h):(m=$t(d),m.c(),m.m(u.parentNode,u)):m&&(m.d(1),m=null)},d(d){d&&(P(e),P(n),P(s),P(f),P(g),P(u)),o&&o.d(d),c&&c.d(d),b&&b.d(d),m&&m.d(d)}}}function rn(t){let e,l;return{c(){e=r("video"),it(e.src,l=t[4].localVideoUrl)||a(e,"src",l),e.controls=!0,a(e,"class","w-full h-full object-contain")},m(n,s){E(n,e,s),t[12](e)},p(n,s){s&16&&!it(e.src,l=n[4].localVideoUrl)&&a(e,"src",l)},d(n){n&&P(e),t[12](null)}}}function on(t){let e;return{c(){e=r("video"),e.autoplay=!0,e.playsInline=!0,e.muted=!0,a(e,"class","w-full h-full object-contain")},m(l,n){E(l,e,n),t[11](e)},p:N,d(l){l&&P(e),t[11](null)}}}function Zt(t){let e;return{c(){e=r("div"),e.innerHTML='<div class="w-3 h-3 bg-white rounded-full animate-pulse svelte-1mb1g50"></div> <span class="text-white font-semibold text-sm">REC</span>',a(e,"class","absolute top-4 right-4 flex items-center gap-2 bg-red-600 px-4 py-2 rounded-full")},m(l,n){E(l,e,n)},d(l){l&&P(e)}}}function Qt(t){let e;return{c(){e=r("div"),e.innerHTML='<span class="text-white font-semibold text-sm">ANALYZING</span>',a(e,"class","absolute top-4 left-4 bg-green-600 px-4 py-2 rounded-full")},m(l,n){E(l,e,n)},d(l){l&&P(e)}}}function Xt(t){let e;return{c(){e=r("div"),e.innerHTML='<span class="text-white font-semibold text-sm">CALIBRATING</span>',a(e,"class","absolute top-4 left-4 bg-yellow-600 px-4 py-2 rounded-full")},m(l,n){E(l,e,n)},d(l){l&&P(e)}}}function $t(t){let e,l,n,s,f,g=`${t[2]+1} / ${Math.max(t[1],0)}`,u,o,c,b,m,d=t[5]&&el(t);return{c(){e=r("div"),l=r("input"),s=_(),f=r("div"),u=j(g),o=_(),d&&d.c(),c=at(),a(l,"type","range"),a(l,"min","0"),a(l,"max",n=Math.max(t[1]-1,0)),a(l,"class","w-64 md:w-96 accent-purple-500"),a(f,"class","text-slate-300 text-sm whitespace-nowrap"),a(e,"class","absolute bottom-4 left-1/2 -translate-x-1/2 bg-slate-900/80 backdrop-blur px-4 py-3 rounded-full border border-slate-700 flex items-center gap-4")},m(h,v){E(h,e,v),i(e,l),me(l,t[2]),i(e,s),i(e,f),i(f,u),E(h,o,v),d&&d.m(h,v),E(h,c,v),b||(m=[Q(l,"change",t[13]),Q(l,"input",t[13]),Q(l,"input",t[14])],b=!0)},p(h,v){v&2&&n!==(n=Math.max(h[1]-1,0))&&a(l,"max",n),v&4&&me(l,h[2]),v&6&&g!==(g=`${h[2]+1} / ${Math.max(h[1],0)}`)&&B(u,g),h[5]?d?d.p(h,v):(d=el(h),d.c(),d.m(c.parentNode,c)):d&&(d.d(1),d=null)},d(h){h&&(P(e),P(o),P(c)),d&&d.d(h),b=!1,de(m)}}}function el(t){let e,l;return{c(){e=r("div"),l=j(t[5]),a(e,"class","absolute bottom-16 left-1/2 -translate-x-1/2 bg-red-600/80 text-white text-xs px-3 py-1 rounded")},m(n,s){E(n,e,s),i(e,l)},p(n,s){s&32&&B(l,n[5])},d(n){n&&P(e)}}}function cn(t){let e,l,n,s;function f(o,c){return o[4].isCameraPreview&&o[4].previewStream?on:o[0]&&o[4].localVideoUrl?rn:o[8]?an:sn}let g=f(t),u=g(t);return{c(){e=r("div"),l=r("div"),l.innerHTML='<h2 class="text-xl font-semibold text-white">Anteprima Video</h2>',n=_(),s=r("div"),u.c(),a(l,"class","video-header bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4"),a(s,"class","video-content aspect-video bg-black flex items-center justify-center relative"),a(s,"data-reflow",t[7]),a(e,"class","video-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700")},m(o,c){E(o,e,c),i(e,l),i(e,n),i(e,s),u.m(s,null),t[15](e)},p(o,[c]){g===(g=f(o))&&u?u.p(o,c):(u.d(1),u=g(o),u&&(u.c(),u.m(s,null))),c&128&&a(s,"data-reflow",o[7])},i:N,o:N,d(o){o&&P(e),u.d(),t[15](null)}}}function fn(t,e,l){let n,s;st(t,J,C=>l(4,s=C));let{analysisCompleted:f=!1}=e,g=0,u=0,o=!1,c="",b,m,d,h,v=0,x;async function p(){try{const M=await(await fetch(`${te()}/api/video/info`)).json();M&&M.success&&(l(1,g=M.total_frames||0),l(10,o=!0))}catch{}}async function S(C){l(5,c="");try{const F=await(await fetch(`${te()}/api/video/frame_at?index=${C}`)).json();F&&F.success?(l(2,u=F.index),Yt(F.frame)):F&&F.error&&l(5,c=F.error)}catch{l(5,c="Errore caricamento frame")}finally{}}function T(C){!f||g<=0||(b&&clearTimeout(b),b=setTimeout(()=>{S(C)},50))}function A(){l(7,v++,v)}xt(()=>{if(s.isCameraPreview&&s.previewStream&&x)try{l(3,x.srcObject=s.previewStream,x)}catch{}typeof window<"u"&&"ResizeObserver"in window?(d=new ResizeObserver(()=>{A()}),m&&d.observe(m)):typeof window<"u"&&window.addEventListener("resize",A),h=()=>{A(),setTimeout(A,50),setTimeout(A,150)},typeof document<"u"&&(document.addEventListener("fullscreenchange",h),document.addEventListener("webkitfullscreenchange",h),document.addEventListener("mozfullscreenchange",h),document.addEventListener("MSFullscreenChange",h))}),Jt(()=>{d&&m&&d.unobserve(m),d&&d.disconnect(),typeof window<"u"&&window.removeEventListener("resize",A),typeof document<"u"&&h&&(document.removeEventListener("fullscreenchange",h),document.removeEventListener("webkitfullscreenchange",h),document.removeEventListener("mozfullscreenchange",h),document.removeEventListener("MSFullscreenChange",h))});function I(C){pe[C?"unshift":"push"](()=>{x=C,l(3,x),l(4,s)})}function z(C){pe[C?"unshift":"push"](()=>{x=C,l(3,x),l(4,s)})}function y(){u=we(this.value),l(2,u)}const w=C=>T(+C.target.value);function D(C){pe[C?"unshift":"push"](()=>{m=C,l(6,m)})}return t.$$set=C=>{"analysisCompleted"in C&&l(0,f=C.analysisCompleted)},t.$$.update=()=>{if(t.$$.dirty&16&&l(8,n=s.videoFrame?`data:image/jpeg;base64,${s.videoFrame}`:null),t.$$.dirty&1031&&(async()=>f&&!o&&(await p(),g>0&&await S(u)))(),t.$$.dirty&24&&s.isCameraPreview&&s.previewStream&&x)try{l(3,x.srcObject=s.previewStream,x)}catch{}},[f,g,u,x,s,c,m,v,n,T,o,I,z,y,w,D]}class un extends Ge{constructor(e){super(),qe(this,e,fn,cn,Te,{analysisCompleted:0})}}async function dn(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("API mediaDevices non disponibile");let t=null;try{t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}catch{}try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput")}finally{if(t)try{t.getTracks().forEach(e=>e.stop())}catch{}}}async function pn(t,e){const l=Array.isArray(e)?e:[],n=l[t]||l[0];return n&&n.deviceId?await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:n.deviceId}},audio:!1}):await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}function Et(t){var e;try{(e=t==null?void 0:t.getTracks())==null||e.forEach(l=>l.stop())}catch{}}function tl(t,e,l){const n=t.slice();return n[10]=e[l],n[12]=l,n}function ll(t){let e,l,n,s,f,g,u,o,c,b,m,d,h,v,x,p,S,T,A=t[4]&&nl(t);function I(w,D){return w[2]?bn:w[3].length>0?hn:mn}let z=I(t),y=z(t);return{c(){e=r("div"),l=r("div"),n=r("div"),s=r("h4"),s.textContent="Seleziona fotocamera",f=_(),g=r("button"),g.textContent="✕",u=_(),o=r("div"),A&&A.c(),c=_(),y.c(),b=_(),m=r("div"),d=r("button"),d.textContent="Annulla",h=_(),v=r("button"),x=j("Conferma e anteprima"),a(s,"class","text-white font-semibold"),a(g,"class","text-slate-300 hover:text-white"),a(n,"class","px-6 py-4 border-b border-slate-700 flex items-center justify-between"),a(o,"class","p-6 space-y-4"),a(d,"class","btn-secondary"),a(v,"class","btn-primary"),v.disabled=p=t[2]||t[3].length===0,a(m,"class","px-6 py-4 border-t border-slate-700 flex gap-2 justify-end"),a(l,"class","bg-slate-800 border border-slate-700 rounded-xl w-full max-w-md shadow-2xl"),a(e,"class","fixed inset-0 z-50 flex items-center justify-center bg-black/60")},m(w,D){E(w,e,D),i(e,l),i(l,n),i(n,s),i(n,f),i(n,g),i(l,u),i(l,o),A&&A.m(o,null),i(o,c),y.m(o,null),i(l,b),i(l,m),i(m,d),i(m,h),i(m,v),i(v,x),S||(T=[Q(g,"click",t[5]),Q(d,"click",t[5]),Q(v,"click",t[6])],S=!0)},p(w,D){w[4]?A?A.p(w,D):(A=nl(w),A.c(),A.m(o,c)):A&&(A.d(1),A=null),z===(z=I(w))&&y?y.p(w,D):(y.d(1),y=z(w),y&&(y.c(),y.m(o,null))),D&12&&p!==(p=w[2]||w[3].length===0)&&(v.disabled=p)},d(w){w&&P(e),A&&A.d(),y.d(),S=!1,de(T)}}}function nl(t){let e,l;return{c(){e=r("div"),l=j(t[4]),a(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-3 text-red-300 text-sm")},m(n,s){E(n,e,s),i(e,l)},p(n,s){s&16&&B(l,n[4])},d(n){n&&P(e)}}}function mn(t){let e;return{c(){e=r("p"),e.textContent="Nessuna fotocamera disponibile.",a(e,"class","text-slate-400")},m(l,n){E(l,e,n)},p:N,d(l){l&&P(e)}}}function hn(t){let e,l,n,s,f,g=Gt(t[3]),u=[];for(let o=0;o<g.length;o+=1)u[o]=il(tl(t,g,o));return{c(){e=r("label"),e.textContent="Fotocamera",l=_(),n=r("select");for(let o=0;o<u.length;o+=1)u[o].c();a(e,"for","camera-select"),a(e,"class","block text-sm font-medium text-slate-300 mb-2"),a(n,"id","camera-select"),a(n,"class","input-field"),t[0]===void 0&&rt(()=>t[8].call(n))},m(o,c){E(o,e,c),E(o,l,c),E(o,n,c);for(let b=0;b<u.length;b+=1)u[b]&&u[b].m(n,null);Wt(n,t[0],!0),s||(f=[Q(n,"change",t[7]),Q(n,"change",t[8])],s=!0)},p(o,c){if(c&8){g=Gt(o[3]);let b;for(b=0;b<g.length;b+=1){const m=tl(o,g,b);u[b]?u[b].p(m,c):(u[b]=il(m),u[b].c(),u[b].m(n,null))}for(;b<u.length;b+=1)u[b].d(1);u.length=g.length}c&1&&Wt(n,o[0])},d(o){o&&(P(e),P(l),P(n)),Nl(u,o),s=!1,de(f)}}}function bn(t){let e;return{c(){e=r("p"),e.textContent="Caricamento fotocamere...",a(e,"class","text-slate-300")},m(l,n){E(l,e,n)},p:N,d(l){l&&P(e)}}}function il(t){let e,l=(t[10].label||`Camera ${t[12]}`)+"",n;return{c(){e=r("option"),n=j(l),e.__value=t[12],me(e,e.__value)},m(s,f){E(s,e,f),i(e,n)},p(s,f){f&8&&l!==(l=(s[10].label||`Camera ${s[12]}`)+"")&&B(n,l)},d(s){s&&P(e)}}}function gn(t){let e,l=t[1]&&ll(t);return{c(){l&&l.c(),e=at()},m(n,s){l&&l.m(n,s),E(n,e,s)},p(n,[s]){n[1]?l?l.p(n,s):(l=ll(n),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},i:N,o:N,d(n){n&&P(e),l&&l.d(n)}}}function vn(t,e,l){let{show:n=!1}=e,{loading:s=!1}=e,{cameras:f=[]}=e,{selectedIndex:g=null}=e,{error:u=""}=e;const o=Ct();function c(){o("close")}function b(){o("confirm")}function m(h){const v=Number(h.target.value);o("select",{index:v})}function d(){g=Hl(this),l(0,g)}return t.$$set=h=>{"show"in h&&l(1,n=h.show),"loading"in h&&l(2,s=h.loading),"cameras"in h&&l(3,f=h.cameras),"selectedIndex"in h&&l(0,g=h.selectedIndex),"error"in h&&l(4,u=h.error)},[g,n,s,f,u,c,b,m,d]}class _n extends Ge{constructor(e){super(),qe(this,e,vn,gn,Te,{show:1,loading:2,cameras:3,selectedIndex:0,error:4})}}function sl(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
          Indietro`,a(e,"class","bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2")},m(s,f){E(s,e,f),l||(n=Q(e,"click",t[23]),l=!0)},p:N,d(s){s&&P(e),l=!1,n()}}}function al(t){let e,l,n;return{c(){e=r("div"),l=r("p"),n=j(t[5]),a(l,"class","text-red-400 text-sm"),a(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-4")},m(s,f){E(s,e,f),i(e,l),i(l,n)},p(s,f){f[0]&32&&B(n,s[5])},d(s){s&&P(e)}}}function rl(t){let e,l,n=t[13].inputMode==="camera"?"1. Registra Video":"1. Carica o Registra Video",s,f,g,u=t[13].inputMode!=="camera"&&ol(t);function o(m,d){return m[13].isRecording?wn:yn}let c=o(t),b=c(t);return{c(){e=r("div"),l=r("h3"),s=j(n),f=_(),u&&u.c(),g=_(),b.c(),a(l,"class","text-lg font-semibold text-white mb-4"),a(e,"class","space-y-4")},m(m,d){E(m,e,d),i(e,l),i(l,s),i(e,f),u&&u.m(e,null),i(e,g),b.m(e,null)},p(m,d){d[0]&8192&&n!==(n=m[13].inputMode==="camera"?"1. Registra Video":"1. Carica o Registra Video")&&B(s,n),m[13].inputMode!=="camera"?u?u.p(m,d):(u=ol(m),u.c(),u.m(e,g)):u&&(u.d(1),u=null),c===(c=o(m))&&b?b.p(m,d):(b.d(1),b=c(m),b&&(b.c(),b.m(e,null)))},d(m){m&&P(e),u&&u.d(),b.d()}}}function ol(t){let e,l,n,s,f,g,u,o,c=t[1]?"Caricamento...":"Carica Video",b,m,d,h,v,x;return{c(){e=r("label"),l=r("input"),s=_(),f=r("div"),g=Ae("svg"),u=Ae("path"),o=_(),b=j(c),d=_(),h=r("div"),h.textContent="oppure",a(l,"type","file"),a(l,"accept","video/*"),l.disabled=n=t[1]||t[13].isRecording,a(l,"class","hidden"),a(u,"stroke-linecap","round"),a(u,"stroke-linejoin","round"),a(u,"stroke-width","2"),a(u,"d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"),a(g,"class","w-5 h-5 inline mr-2"),a(g,"fill","none"),a(g,"stroke","currentColor"),a(g,"viewBox","0 0 24 24"),a(f,"class",m="btn-primary cursor-pointer text-center "+(t[1]?"opacity-50":"")),a(e,"class","block"),a(h,"class","text-center text-slate-400 text-sm")},m(p,S){E(p,e,S),i(e,l),i(e,s),i(e,f),i(f,g),i(g,u),i(f,o),i(f,b),E(p,d,S),E(p,h,S),v||(x=Q(l,"change",t[14]),v=!0)},p(p,S){S[0]&8194&&n!==(n=p[1]||p[13].isRecording)&&(l.disabled=n),S[0]&2&&c!==(c=p[1]?"Caricamento...":"Carica Video")&&B(b,c),S[0]&2&&m!==(m="btn-primary cursor-pointer text-center "+(p[1]?"opacity-50":""))&&a(f,"class",m)},d(p){p&&(P(e),P(d),P(h)),v=!1,x()}}}function wn(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12"></rect></svg>
            Ferma Registrazione`,a(e,"class","btn-danger w-full")},m(s,f){E(s,e,f),l||(n=Q(e,"click",t[18]),l=!0)},p:N,d(s){s&&P(e),l=!1,n()}}}function yn(t){let e,l,n,s,f=t[13].inputMode==="camera"?"Cambia Telecamera":"Registra Video",g,u,o,c,b,m,d=t[13].isCameraPreview&&cl(t),h=t[13].isCameraPreview&&fl();return{c(){e=r("button"),l=Ae("svg"),n=Ae("path"),s=_(),g=j(f),u=_(),d&&d.c(),o=_(),h&&h.c(),c=at(),a(n,"stroke-linecap","round"),a(n,"stroke-linejoin","round"),a(n,"stroke-width","2"),a(n,"d","M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"),a(l,"class","w-5 h-5 inline mr-2"),a(l,"fill","none"),a(l,"stroke","currentColor"),a(l,"viewBox","0 0 24 24"),a(e,"class","btn-secondary w-full")},m(v,x){E(v,e,x),i(e,l),i(l,n),i(e,s),i(e,g),E(v,u,x),d&&d.m(v,x),E(v,o,x),h&&h.m(v,x),E(v,c,x),b||(m=Q(e,"click",t[16]),b=!0)},p(v,x){x[0]&8192&&f!==(f=v[13].inputMode==="camera"?"Cambia Telecamera":"Registra Video")&&B(g,f),v[13].isCameraPreview?d?d.p(v,x):(d=cl(v),d.c(),d.m(o.parentNode,o)):d&&(d.d(1),d=null),v[13].isCameraPreview?h||(h=fl(),h.c(),h.m(c.parentNode,c)):h&&(h.d(1),h=null)},d(v){v&&(P(e),P(u),P(o),P(c)),d&&d.d(v),h&&h.d(v),b=!1,m()}}}function cl(t){let e,l,n;return{c(){e=r("button"),e.textContent="Analizza Video",a(e,"class","btn-primary w-full mt-3")},m(s,f){E(s,e,f),l||(n=Q(e,"click",t[15]),l=!0)},p:N,d(s){s&&P(e),l=!1,n()}}}function fl(t){let e;return{c(){e=r("div"),e.textContent='Anteprima fotocamera attiva. Premi "Analizza Video" per iniziare la registrazione, poi "Ferma Registrazione" al termine del salto.',a(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-3 text-blue-300 text-sm")},m(l,n){E(l,e,n)},d(l){l&&P(e)}}}function ul(t){let e,l,n,s,f,g,u,o,c,b,m,d,h,v,x,p,S,T,A,I,z,y,w,D,C,M=t[6]?"Calibrazione e Analisi in corso...":"Avvia Analisi",F,W,K,le,ie,O=t[6]&&dl();return{c(){e=r("div"),l=r("h3"),l.textContent="2. Calibrazione Sistema",n=_(),s=r("div"),f=r("label"),f.textContent="FPS Video",g=_(),u=r("input"),o=_(),c=r("p"),c.textContent="Frame per secondo del video",b=_(),m=r("div"),d=r("label"),d.textContent="Altezza Persona (cm)",h=_(),v=r("input"),x=_(),p=r("p"),p.textContent="Altezza reale della persona",S=_(),T=r("div"),A=r("label"),A.textContent="Massa Corporea (kg)",I=_(),z=r("input"),y=_(),w=r("p"),w.textContent="Peso della persona",D=_(),C=r("button"),F=j(M),K=_(),O&&O.c(),a(l,"class","text-lg font-semibold text-white mb-4"),a(f,"for","fps-input"),a(f,"class","block text-sm font-medium text-slate-300 mb-2"),a(u,"id","fps-input"),a(u,"type","number"),a(u,"min","1"),a(u,"max","240"),u.disabled=t[6],a(u,"class","input-field"),a(c,"class","text-slate-500 text-xs mt-1"),a(d,"for","height-input"),a(d,"class","block text-sm font-medium text-slate-300 mb-2"),a(v,"id","height-input"),a(v,"type","number"),a(v,"min","100"),a(v,"max","250"),v.disabled=t[6],a(v,"class","input-field"),a(p,"class","text-slate-500 text-xs mt-1"),a(A,"for","mass-input"),a(A,"class","block text-sm font-medium text-slate-300 mb-2"),a(z,"id","mass-input"),a(z,"type","number"),a(z,"min","40"),a(z,"max","150"),z.disabled=t[6],a(z,"class","input-field"),a(w,"class","text-slate-500 text-xs mt-1"),C.disabled=t[6],a(C,"class",W="btn-primary w-full "+(t[6]?"opacity-50":"")),a(e,"class","space-y-4")},m(V,q){E(V,e,q),i(e,l),i(e,n),i(e,s),i(s,f),i(s,g),i(s,u),me(u,t[2]),i(s,o),i(s,c),i(e,b),i(e,m),i(m,d),i(m,h),i(m,v),me(v,t[3]),i(m,x),i(m,p),i(e,S),i(e,T),i(T,A),i(T,I),i(T,z),me(z,t[4]),i(T,y),i(T,w),i(e,D),i(e,C),i(C,F),i(e,K),O&&O.m(e,null),le||(ie=[Q(u,"input",t[28]),Q(v,"input",t[29]),Q(z,"input",t[30]),Q(C,"click",t[24])],le=!0)},p(V,q){q[0]&64&&(u.disabled=V[6]),q[0]&4&&we(u.value)!==V[2]&&me(u,V[2]),q[0]&64&&(v.disabled=V[6]),q[0]&8&&we(v.value)!==V[3]&&me(v,V[3]),q[0]&64&&(z.disabled=V[6]),q[0]&16&&we(z.value)!==V[4]&&me(z,V[4]),q[0]&64&&M!==(M=V[6]?"Calibrazione e Analisi in corso...":"Avvia Analisi")&&B(F,M),q[0]&64&&(C.disabled=V[6]),q[0]&64&&W!==(W="btn-primary w-full "+(V[6]?"opacity-50":""))&&a(C,"class",W),V[6]?O||(O=dl(),O.c(),O.m(e,null)):O&&(O.d(1),O=null)},d(V){V&&P(e),O&&O.d(),le=!1,de(ie)}}}function dl(t){let e;return{c(){e=r("div"),e.innerHTML='<p class="text-blue-400 text-sm">Sistema in calibrazione. Assicurati che la persona sia in posizione eretta nel frame.</p>',a(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-4")},m(l,n){E(l,e,n)},d(l){l&&P(e)}}}function pl(t){var he,xe,Ye,ve;let e,l,n,s,f,g,u,o,c,b,m,d,h=(((he=t[13].realtimeData)==null?void 0:he.current_height)??0)+"",v,x,p,S,T,A,I,z=(((xe=t[13].realtimeData)==null?void 0:xe.max_height)??0)+"",y,w,D,C,M,F,W,K=(((Ye=t[13].realtimeData)==null?void 0:Ye.takeoff_velocity)??0)+"",le,ie,O,V,q,$,U,G=(((ve=t[13].realtimeData)==null?void 0:ve.estimated_power)??0)+"",X,R,k;function L(ee,fe){return ee[7]?kn:xn}let H=L(t),ne=H(t),Z=t[7]&&ml(t);return{c(){e=r("div"),l=r("h3"),l.textContent="3. Analisi Salto",n=_(),ne.c(),s=_(),f=r("div"),g=r("h4"),g.textContent="Dati in Tempo Reale",u=_(),o=r("div"),c=r("div"),b=r("p"),b.textContent="Altezza Corrente",m=_(),d=r("p"),v=j(h),x=j(" cm"),p=_(),S=r("div"),T=r("p"),T.textContent="Altezza Max",A=_(),I=r("p"),y=j(z),w=j(" cm"),D=_(),C=r("div"),M=r("p"),M.textContent="Velocità Decollo",F=_(),W=r("p"),le=j(K),ie=j(" cm/s"),O=_(),V=r("div"),q=r("p"),q.textContent="Potenza Est.",$=_(),U=r("p"),X=j(G),R=j(" W"),k=_(),Z&&Z.c(),a(l,"class","text-lg font-semibold text-white mb-4"),a(g,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3"),a(b,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(d,"class","text-xl font-bold text-blue-400"),a(c,"class","text-center"),a(T,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(I,"class","text-xl font-bold text-green-400"),a(S,"class","text-center"),a(M,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(W,"class","text-xl font-bold text-purple-400"),a(C,"class","text-center"),a(q,"class","text-slate-400 text-xs uppercase tracking-wide mb-1"),a(U,"class","text-xl font-bold text-yellow-400"),a(V,"class","text-center"),a(o,"class","grid grid-cols-2 gap-3"),a(f,"class","bg-slate-900/50 rounded-xl p-4 border border-slate-700"),a(e,"class","space-y-4")},m(ee,fe){E(ee,e,fe),i(e,l),i(e,n),ne.m(e,null),i(e,s),i(e,f),i(f,g),i(f,u),i(f,o),i(o,c),i(c,b),i(c,m),i(c,d),i(d,v),i(d,x),i(o,p),i(o,S),i(S,T),i(S,A),i(S,I),i(I,y),i(I,w),i(o,D),i(o,C),i(C,M),i(C,F),i(C,W),i(W,le),i(W,ie),i(o,O),i(o,V),i(V,q),i(V,$),i(V,U),i(U,X),i(U,R),i(e,k),Z&&Z.m(e,null)},p(ee,fe){var Ke,Ze,be,Ce;H===(H=L(ee))&&ne?ne.p(ee,fe):(ne.d(1),ne=H(ee),ne&&(ne.c(),ne.m(e,s))),fe[0]&8192&&h!==(h=(((Ke=ee[13].realtimeData)==null?void 0:Ke.current_height)??0)+"")&&B(v,h),fe[0]&8192&&z!==(z=(((Ze=ee[13].realtimeData)==null?void 0:Ze.max_height)??0)+"")&&B(y,z),fe[0]&8192&&K!==(K=(((be=ee[13].realtimeData)==null?void 0:be.takeoff_velocity)??0)+"")&&B(le,K),fe[0]&8192&&G!==(G=(((Ce=ee[13].realtimeData)==null?void 0:Ce.estimated_power)??0)+"")&&B(X,G),ee[7]?Z?Z.p(ee,fe):(Z=ml(ee),Z.c(),Z.m(e,null)):Z&&(Z.d(1),Z=null)},d(ee){ee&&P(e),ne.d(),Z&&Z.d()}}}function kn(t){let e;return{c(){e=r("div"),e.innerHTML='<p class="text-green-400 text-sm font-medium">Analisi in corso...</p> <p class="text-slate-400 text-xs mt-1">Il sistema sta elaborando il salto</p>',a(e,"class","bg-green-500/10 border border-green-500/50 rounded-lg p-4")},m(l,n){E(l,e,n)},p:N,d(l){l&&P(e)}}}function xn(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            Avvia Analisi`,a(e,"class","btn-primary w-full")},m(s,f){E(s,e,f),l||(n=Q(e,"click",t[19]),l=!0)},p:N,d(s){s&&P(e),l=!1,n()}}}function ml(t){let e,l,n,s,f;function g(c,b){return c[13].isPaused?Sn:Cn}let u=g(t),o=u(t);return{c(){e=r("div"),o.c(),l=_(),n=r("button"),n.textContent="Annulla",a(n,"class","btn-danger flex-1"),a(e,"class","flex gap-2")},m(c,b){E(c,e,b),o.m(e,null),i(e,l),i(e,n),s||(f=Q(n,"click",t[22]),s=!0)},p(c,b){u===(u=g(c))&&o?o.p(c,b):(o.d(1),o=u(c),o&&(o.c(),o.m(e,l)))},d(c){c&&P(e),o.d(),s=!1,f()}}}function Cn(t){let e,l,n;return{c(){e=r("button"),e.textContent="Pausa",a(e,"class","btn-secondary flex-1")},m(s,f){E(s,e,f),l||(n=Q(e,"click",t[20]),l=!0)},p:N,d(s){s&&P(e),l=!1,n()}}}function Sn(t){let e,l,n;return{c(){e=r("button"),e.textContent="Riprendi",a(e,"class","btn-secondary flex-1")},m(s,f){E(s,e,f),l||(n=Q(e,"click",t[21]),l=!0)},p:N,d(s){s&&P(e),l=!1,n()}}}function Tn(t){let e,l,n,s,f,g,u,o,c,b,m,d,h,v,x,p,S,T,A,I,z,y,w,D,C,M,F,W,K,le,ie,O=t[0]>1&&sl(t);function V(R){t[25](R)}let q={show:t[8],loading:t[11],cameras:t[9],error:t[12]};t[10]!==void 0&&(q.selectedIndex=t[10]),v=new _n({props:q}),pe.push(()=>Zl(v,"selectedIndex",V)),v.$on("close",t[26]),v.$on("confirm",t[17]),v.$on("select",t[27]);let $=t[5]&&al(t),U=t[0]===1&&rl(t),G=t[0]===2&&ul(t),X=t[0]===3&&pl(t);return{c(){e=r("div"),l=r("div"),n=r("div"),s=r("div"),f=r("h2"),f.textContent="Step Holder",g=_(),u=r("p"),o=j("Step "),c=j(t[0]),b=j(" di 3"),m=_(),O&&O.c(),d=_(),h=r("div"),ct(v.$$.fragment),p=_(),$&&$.c(),S=_(),U&&U.c(),T=_(),G&&G.c(),A=_(),X&&X.c(),I=_(),z=r("div"),y=r("div"),w=r("span"),w.textContent="Progresso",D=_(),C=r("span"),M=j(t[0]),F=j("/3"),W=_(),K=r("div"),le=r("div"),a(f,"class","text-xl font-semibold text-white"),a(u,"class","text-purple-100 text-sm mt-1"),a(n,"class","flex justify-between items-center"),a(l,"class","step-header bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-4"),a(w,"class","text-xs text-slate-400"),a(C,"class","text-xs text-slate-400"),a(y,"class","flex justify-between items-center mb-2"),a(le,"class","bg-gradient-to-r from-purple-600 to-pink-600 h-2 rounded-full transition-all duration-300"),Bt(le,"width",t[0]/3*100+"%"),a(K,"class","w-full bg-slate-700 rounded-full h-2"),a(z,"class","mt-8 pt-6 border-t border-slate-700"),a(h,"class","step-content p-6 space-y-6 flex-1 overflow-auto svelte-10imy5p"),a(e,"class","step-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 h-full flex flex-col")},m(R,k){E(R,e,k),i(e,l),i(l,n),i(n,s),i(s,f),i(s,g),i(s,u),i(u,o),i(u,c),i(u,b),i(n,m),O&&O.m(n,null),i(e,d),i(e,h),We(v,h,null),i(h,p),$&&$.m(h,null),i(h,S),U&&U.m(h,null),i(h,T),G&&G.m(h,null),i(h,A),X&&X.m(h,null),i(h,I),i(h,z),i(z,y),i(y,w),i(y,D),i(y,C),i(C,M),i(C,F),i(z,W),i(z,K),i(K,le),ie=!0},p(R,k){(!ie||k[0]&1)&&B(c,R[0]),R[0]>1?O?O.p(R,k):(O=sl(R),O.c(),O.m(n,null)):O&&(O.d(1),O=null);const L={};k[0]&256&&(L.show=R[8]),k[0]&2048&&(L.loading=R[11]),k[0]&512&&(L.cameras=R[9]),k[0]&4096&&(L.error=R[12]),!x&&k[0]&1024&&(x=!0,L.selectedIndex=R[10],Jl(()=>x=!1)),v.$set(L),R[5]?$?$.p(R,k):($=al(R),$.c(),$.m(h,S)):$&&($.d(1),$=null),R[0]===1?U?U.p(R,k):(U=rl(R),U.c(),U.m(h,T)):U&&(U.d(1),U=null),R[0]===2?G?G.p(R,k):(G=ul(R),G.c(),G.m(h,A)):G&&(G.d(1),G=null),R[0]===3?X?X.p(R,k):(X=pl(R),X.c(),X.m(h,I)):X&&(X.d(1),X=null),(!ie||k[0]&1)&&B(M,R[0]),(!ie||k[0]&1)&&Bt(le,"width",R[0]/3*100+"%")},i(R){ie||(ke(v.$$.fragment,R),ie=!0)},o(R){Me(v.$$.fragment,R),ie=!1},d(R){R&&P(e),O&&O.d(),Je(v),$&&$.d(),U&&U.d(),G&&G.d(),X&&X.d()}}}function An(t,e,l){let n;st(t,J,k=>l(13,n=k));let{currentStep:s=1}=e;const f=Ct();let g=null,u=!1,o=30,c=170,b=70,m="",d=!1,h=!1,v=!1,x=[],p=null,S=!1,T="";async function A(k){if(g=k.target.files[0],g){try{const L=URL.createObjectURL(g);tn(L)}catch{}Kt("upload"),await I()}}async function I(){if(!g)return;l(1,u=!0),l(5,m="");const k=new FormData;k.append("video",g);try{const H=await(await fetch(`${te()}/api/video/upload`,{method:"POST",body:k})).json();H.success?(l(2,o=Math.round(H.fps)||30),f("stepComplete",{step:1,data:H})):l(5,m=H.error||"Errore caricamento video")}catch{l(5,m="Errore di connessione al server")}finally{l(1,u=!1)}}async function z(){try{if(p!=null)try{await De.setCamera(Number(p))}catch{l(5,m="Errore impostazione fotocamera");return}const k=await De.startRecording();if(k.success){J.update(L=>({...L,isRecording:!0}));try{Et(n.previewStream)}catch{}zt(),Pt(!1)}else l(5,m=k.error||"Errore avvio registrazione")}catch{l(5,m="Errore di connessione al server")}}function y(){l(12,T=""),l(8,v=!0),w()}async function w(){l(11,S=!0),l(9,x=[]),l(10,p=null);try{const k=await dn();k.length>0?(l(9,x=k),l(10,p=0)):l(12,T="Nessuna fotocamera trovata")}catch{l(12,T="Errore rilevamento fotocamere")}finally{l(11,S=!1)}}async function D(){if(l(12,T=""),p==null){l(12,T="Seleziona una fotocamera");return}try{l(8,v=!1);try{Et(n.previewStream);const k=await pn(Number(p),x);ln(k),Pt(!0),Kt("camera")}catch{l(12,T="Impossibile avviare l'anteprima fotocamera")}}catch{l(12,T="Errore apertura anteprima")}}async function C(){try{const L=await(await fetch(`${te()}/api/recording/stop`,{method:"POST"})).json();L.success&&(J.update(H=>({...H,isRecording:!1})),f("stepComplete",{step:1,data:L}))}catch{l(5,m="Errore stop registrazione")}}async function M(){if(l(5,m=""),n.inputMode==="camera"&&!n.isRecording)try{if((await De.startRecording()).success){J.update(L=>({...L,isRecording:!0}));try{Et(n.previewStream)}catch{}zt(),Pt(!1)}}catch{l(5,m="Errore avvio registrazione");return}try{const k=await De.startAnalysis();k.success?(l(7,h=!0),J.update(L=>({...L,isAnalyzing:!0})),F()):l(5,m=k.error||"Errore avvio analisi")}catch{l(5,m="Errore di connessione")}}async function F(){const k=setInterval(async()=>{try{if(!(await De.analysisStatus()).is_analyzing){clearInterval(k);const H=await De.analysisResults();H.success&&(l(7,h=!1),J.update(ne=>({...ne,isAnalyzing:!1})),f("stepComplete",{step:3,data:{...H.results,trajectory:H.trajectory,velocity:H.velocity}}))}}catch{}},500)}async function W(){try{await fetch(`${te()}/api/analysis/pause`,{method:"POST"}),J.update(k=>({...k,isPaused:!0}))}catch{}}async function K(){try{await fetch(`${te()}/api/analysis/resume`,{method:"POST"}),J.update(k=>({...k,isPaused:!1}))}catch{}}async function le(){try{await fetch(`${te()}/api/analysis/stop`,{method:"POST"})}catch{}f("cancelToStep1")}function ie(){f("goBack")}async function O(){l(5,m="");try{await fetch(`${te()}/api/settings/fps`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:o})}),await fetch(`${te()}/api/settings/height`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:c})}),await fetch(`${te()}/api/settings/mass`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:b})})}catch{l(5,m="Errore impostazioni");return}try{const L=await(await fetch(`${te()}/api/calibration/start`,{method:"POST"})).json();L.success?(l(6,d=!0),J.update(H=>({...H,isCalibrating:!0})),V()):l(5,m=L.error||"Errore calibrazione")}catch{l(5,m="Errore di connessione")}}async function V(){const k=setInterval(async()=>{try{const H=await(await fetch(`${te()}/api/calibration/status`)).json();H.success&&!H.in_progress?(clearInterval(k),l(6,d=!1),J.update(ne=>({...ne,isCalibrating:!1})),f("stepComplete",{step:2,data:H}),await M()):H.success===!1&&!H.in_progress&&(clearInterval(k),l(6,d=!1),J.update(ne=>({...ne,isCalibrating:!1})),l(5,m="Calibrazione fallita"))}catch{clearInterval(k),l(6,d=!1),l(5,m="Errore verifica calibrazione")}},500)}function q(k){p=k,l(10,p)}const $=()=>l(8,v=!1),U=k=>l(10,p=k.detail.index);function G(){o=we(this.value),l(2,o)}function X(){c=we(this.value),l(3,c)}function R(){b=we(this.value),l(4,b)}return t.$$set=k=>{"currentStep"in k&&l(0,s=k.currentStep)},[s,u,o,c,b,m,d,h,v,x,p,S,T,n,A,z,y,D,C,M,W,K,le,ie,O,q,$,U,G,X,R]}class Pn extends Ge{constructor(e){super(),qe(this,e,An,Tn,Te,{currentStep:0},null,[-1,-1])}}function hl(t){let e,l,n,s;return{c(){e=r("div"),l=r("h3"),l.textContent="Traiettoria del Salto",n=_(),s=r("canvas"),a(l,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(s,"width","400"),a(s,"height","250"),a(s,"class","w-full rounded-lg"),a(e,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700")},m(f,g){E(f,e,g),i(e,l),i(e,n),i(e,s),t[8](s)},p:N,d(f){f&&P(e),t[8](null)}}}function bl(t){let e,l,n,s;return{c(){e=r("div"),l=r("h3"),l.textContent="Velocità nel Tempo",n=_(),s=r("canvas"),a(l,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(s,"width","400"),a(s,"height","250"),a(s,"class","w-full rounded-lg"),a(e,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700")},m(f,g){E(f,e,g),i(e,l),i(e,n),i(e,s),t[9](s)},p:N,d(f){f&&P(e),t[9](null)}}}function gl(t){let e,l,n;return{c(){e=r("div"),l=r("p"),n=j(t[4]),a(l,"class","text-blue-400 text-sm"),a(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-4")},m(s,f){E(s,e,f),i(e,l),i(l,n)},p(s,f){f&16&&B(n,s[4])},d(s){s&&P(e)}}}function zn(t){let e,l,n,s,f,g,u,o,c,b,m,d,h=t[0].max_height+"",v,x,p,S,T,A,I,z=t[0].flight_time+"",y,w,D,C,M,F,W,K=t[0].takeoff_velocity+"",le,ie,O,V,q,$,U,G=t[0].estimated_power+"",X,R,k,L,H,ne,Z,he,xe,Ye,ve,ee=t[0].contact_time+"",fe,Ke,Ze,be,Ce,_l,Qe,ft=t[0].eccentric_time+"",Mt,wl,yl,Re,ut,kl,Xe,dt=t[0].concentric_time+"",jt,xl,Cl,Le,pt,Sl,$e,mt=t[0].fall_time+"",Dt,Tl,Al,Oe,ht,Pl,Ie,Ve,bt,zl,et,gt=t[0].average_force+"",Rt,El,Ml,Ne,vt,jl,tt,_t=t[0].jump_detected?"Sì":"No",Lt,wt,Dl,Ot,It,Vt,Fe,ge,Se,He,Rl,yt=t[3]?"Salvataggio...":"Salva Risultati",Nt,Ll,lt,Ft,Ol,re=t[5].trajectoryData.length>0&&hl(t),oe=t[5].velocityData.length>0&&bl(t),ce=t[4]&&gl(t);return{c(){e=r("div"),l=r("div"),l.innerHTML='<h2 class="text-xl font-semibold text-white">Risultati Analisi</h2> <p class="text-green-100 text-sm mt-1">Analisi completata con successo</p>',n=_(),s=r("div"),f=r("div"),g=r("h3"),g.textContent="Metriche Principali",u=_(),o=r("div"),c=r("div"),b=r("p"),b.textContent="Altezza Max",m=_(),d=r("p"),v=j(h),x=j(" cm"),p=_(),S=r("div"),T=r("p"),T.textContent="Tempo di Volo",A=_(),I=r("p"),y=j(z),w=j(" s"),D=_(),C=r("div"),M=r("p"),M.textContent="Velocità Decollo",F=_(),W=r("p"),le=j(K),ie=j(" cm/s"),O=_(),V=r("div"),q=r("p"),q.textContent="Potenza Est.",$=_(),U=r("p"),X=j(G),R=j(" W"),k=_(),L=r("div"),H=r("h3"),H.textContent="Analisi Fasi",ne=_(),Z=r("div"),he=r("div"),xe=r("span"),xe.textContent="Tempo Contatto",Ye=_(),ve=r("span"),fe=j(ee),Ke=j(" s"),Ze=_(),be=r("div"),Ce=r("span"),Ce.textContent="Fase Eccentrica",_l=_(),Qe=r("span"),Mt=j(ft),wl=j(" s"),yl=_(),Re=r("div"),ut=r("span"),ut.textContent="Fase Concentrica",kl=_(),Xe=r("span"),jt=j(dt),xl=j(" s"),Cl=_(),Le=r("div"),pt=r("span"),pt.textContent="Tempo Caduta",Sl=_(),$e=r("span"),Dt=j(mt),Tl=j(" s"),Al=_(),Oe=r("div"),ht=r("h3"),ht.textContent="Parametri Biomeccanici",Pl=_(),Ie=r("div"),Ve=r("div"),bt=r("span"),bt.textContent="Forza Media",zl=_(),et=r("span"),Rt=j(gt),El=j(" N"),Ml=_(),Ne=r("div"),vt=r("span"),vt.textContent="Salto Rilevato",jl=_(),tt=r("span"),Lt=j(_t),Dl=_(),re&&re.c(),Ot=_(),oe&&oe.c(),It=_(),ce&&ce.c(),Vt=_(),Fe=r("div"),ge=r("button"),Se=Ae("svg"),He=Ae("path"),Rl=_(),Nt=j(yt),Ll=_(),lt=r("button"),lt.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        Nuova Analisi`,a(l,"class","results-header bg-gradient-to-r from-green-600 to-teal-600 px-6 py-4"),a(g,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(b,"class","text-xs text-slate-400 mb-1"),a(d,"class","text-2xl font-bold text-green-400"),a(T,"class","text-xs text-slate-400 mb-1"),a(I,"class","text-2xl font-bold text-blue-400"),a(M,"class","text-xs text-slate-400 mb-1"),a(W,"class","text-2xl font-bold text-purple-400"),a(q,"class","text-xs text-slate-400 mb-1"),a(U,"class","text-2xl font-bold text-yellow-400"),a(o,"class","grid grid-cols-2 gap-4"),a(f,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700"),a(H,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(xe,"class","text-sm text-slate-400"),a(ve,"class","text-lg font-semibold text-white"),a(he,"class","flex justify-between items-center"),a(Ce,"class","text-sm text-slate-400"),a(Qe,"class","text-lg font-semibold text-white"),a(be,"class","flex justify-between items-center"),a(ut,"class","text-sm text-slate-400"),a(Xe,"class","text-lg font-semibold text-white"),a(Re,"class","flex justify-between items-center"),a(pt,"class","text-sm text-slate-400"),a($e,"class","text-lg font-semibold text-white"),a(Le,"class","flex justify-between items-center"),a(Z,"class","space-y-3"),a(L,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700"),a(ht,"class","text-sm font-semibold text-slate-300 uppercase tracking-wide mb-4"),a(bt,"class","text-sm text-slate-400"),a(et,"class","text-lg font-semibold text-white"),a(Ve,"class","flex justify-between items-center"),a(vt,"class","text-sm text-slate-400"),a(tt,"class",wt="text-lg font-semibold "+(t[0].jump_detected?"text-green-400":"text-red-400")),a(Ne,"class","flex justify-between items-center"),a(Ie,"class","space-y-3"),a(Oe,"class","bg-slate-900/50 rounded-xl p-5 border border-slate-700"),a(He,"stroke-linecap","round"),a(He,"stroke-linejoin","round"),a(He,"stroke-width","2"),a(He,"d","M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"),a(Se,"class","w-5 h-5 inline mr-2"),a(Se,"fill","none"),a(Se,"stroke","currentColor"),a(Se,"viewBox","0 0 24 24"),ge.disabled=t[3],a(ge,"class","flex-1 bg-gradient-to-r from-green-600 to-teal-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-green-700 hover:to-teal-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"),a(lt,"class","flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl"),a(Fe,"class","flex gap-3 pt-4"),a(s,"class","results-content p-6 space-y-6 flex-1 overflow-auto svelte-dxhq61"),a(e,"class","results-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 h-full flex flex-col")},m(Y,se){E(Y,e,se),i(e,l),i(e,n),i(e,s),i(s,f),i(f,g),i(f,u),i(f,o),i(o,c),i(c,b),i(c,m),i(c,d),i(d,v),i(d,x),i(o,p),i(o,S),i(S,T),i(S,A),i(S,I),i(I,y),i(I,w),i(o,D),i(o,C),i(C,M),i(C,F),i(C,W),i(W,le),i(W,ie),i(o,O),i(o,V),i(V,q),i(V,$),i(V,U),i(U,X),i(U,R),i(s,k),i(s,L),i(L,H),i(L,ne),i(L,Z),i(Z,he),i(he,xe),i(he,Ye),i(he,ve),i(ve,fe),i(ve,Ke),i(Z,Ze),i(Z,be),i(be,Ce),i(be,_l),i(be,Qe),i(Qe,Mt),i(Qe,wl),i(Z,yl),i(Z,Re),i(Re,ut),i(Re,kl),i(Re,Xe),i(Xe,jt),i(Xe,xl),i(Z,Cl),i(Z,Le),i(Le,pt),i(Le,Sl),i(Le,$e),i($e,Dt),i($e,Tl),i(s,Al),i(s,Oe),i(Oe,ht),i(Oe,Pl),i(Oe,Ie),i(Ie,Ve),i(Ve,bt),i(Ve,zl),i(Ve,et),i(et,Rt),i(et,El),i(Ie,Ml),i(Ie,Ne),i(Ne,vt),i(Ne,jl),i(Ne,tt),i(tt,Lt),i(s,Dl),re&&re.m(s,null),i(s,Ot),oe&&oe.m(s,null),i(s,It),ce&&ce.m(s,null),i(s,Vt),i(s,Fe),i(Fe,ge),i(ge,Se),i(Se,He),i(ge,Rl),i(ge,Nt),i(Fe,Ll),i(Fe,lt),Ft||(Ol=[Q(ge,"click",t[7]),Q(lt,"click",t[6])],Ft=!0)},p(Y,[se]){se&1&&h!==(h=Y[0].max_height+"")&&B(v,h),se&1&&z!==(z=Y[0].flight_time+"")&&B(y,z),se&1&&K!==(K=Y[0].takeoff_velocity+"")&&B(le,K),se&1&&G!==(G=Y[0].estimated_power+"")&&B(X,G),se&1&&ee!==(ee=Y[0].contact_time+"")&&B(fe,ee),se&1&&ft!==(ft=Y[0].eccentric_time+"")&&B(Mt,ft),se&1&&dt!==(dt=Y[0].concentric_time+"")&&B(jt,dt),se&1&&mt!==(mt=Y[0].fall_time+"")&&B(Dt,mt),se&1&&gt!==(gt=Y[0].average_force+"")&&B(Rt,gt),se&1&&_t!==(_t=Y[0].jump_detected?"Sì":"No")&&B(Lt,_t),se&1&&wt!==(wt="text-lg font-semibold "+(Y[0].jump_detected?"text-green-400":"text-red-400"))&&a(tt,"class",wt),Y[5].trajectoryData.length>0?re?re.p(Y,se):(re=hl(Y),re.c(),re.m(s,Ot)):re&&(re.d(1),re=null),Y[5].velocityData.length>0?oe?oe.p(Y,se):(oe=bl(Y),oe.c(),oe.m(s,It)):oe&&(oe.d(1),oe=null),Y[4]?ce?ce.p(Y,se):(ce=gl(Y),ce.c(),ce.m(s,Vt)):ce&&(ce.d(1),ce=null),se&8&&yt!==(yt=Y[3]?"Salvataggio...":"Salva Risultati")&&B(Nt,yt),se&8&&(ge.disabled=Y[3])},i:N,o:N,d(Y){Y&&P(e),re&&re.d(),oe&&oe.d(),ce&&ce.d(),Ft=!1,de(Ol)}}}function En(t,e,l){let n;st(t,J,p=>l(5,n=p));let{results:s}=e;const f=Ct();let g,u;xt(()=>{g&&n.trajectoryData.length>0&&o(),u&&n.velocityData.length>0&&c()});function o(){const p=g.getContext("2d"),S=g.width,T=g.height;p.fillStyle="#1e293b",p.fillRect(0,0,S,T);const A=n.trajectoryData;if(A.length===0)return;const I=Math.max(...A.map(M=>M.t)),z=Math.max(...A.map(M=>M.y)),y=Math.min(...A.map(M=>M.y)),w=40,D=S-2*w,C=T-2*w;p.strokeStyle="#475569",p.lineWidth=2,p.beginPath(),p.moveTo(w,w),p.lineTo(w,T-w),p.lineTo(S-w,T-w),p.stroke(),p.strokeStyle="#334155",p.lineWidth=1;for(let M=0;M<=5;M++){const F=w+C*M/5;p.beginPath(),p.moveTo(w,F),p.lineTo(S-w,F),p.stroke()}p.strokeStyle="#3b82f6",p.lineWidth=3,p.beginPath(),A.forEach((M,F)=>{const W=w+M.t/I*D,K=T-w-(M.y-y)/(z-y)*C;F===0?p.moveTo(W,K):p.lineTo(W,K)}),p.stroke(),p.fillStyle="#94a3b8",p.font="12px sans-serif",p.fillText("Tempo (s)",S/2-30,T-10),p.save(),p.translate(15,T/2),p.rotate(-Math.PI/2),p.fillText("Altezza (cm)",0,0),p.restore()}function c(){const p=u.getContext("2d"),S=u.width,T=u.height;p.fillStyle="#1e293b",p.fillRect(0,0,S,T);const A=n.velocityData;if(A.length===0)return;const I=Math.max(...A.map(M=>M.t)),z=Math.max(...A.map(M=>Math.abs(M.v))),y=40,w=S-2*y,D=T-2*y;p.strokeStyle="#475569",p.lineWidth=2,p.beginPath(),p.moveTo(y,y),p.lineTo(y,T-y),p.lineTo(S-y,T-y),p.stroke();const C=T-y-D/2;p.strokeStyle="#64748b",p.lineWidth=1,p.beginPath(),p.moveTo(y,C),p.lineTo(S-y,C),p.stroke(),p.strokeStyle="#a855f7",p.lineWidth=3,p.beginPath(),A.forEach((M,F)=>{const W=y+M.t/I*w,K=C-M.v/z*(D/2);F===0?p.moveTo(W,K):p.lineTo(W,K)}),p.stroke(),p.fillStyle="#94a3b8",p.font="12px sans-serif",p.fillText("Tempo (s)",S/2-30,T-10),p.save(),p.translate(15,T/2),p.rotate(-Math.PI/2),p.fillText("Velocità (cm/s)",0,0),p.restore()}function b(){f("reset")}let m=!1,d="";async function h(){l(3,m=!0),l(4,d="");try{const S=await(await fetch(`${te()}/api/results/save`,{method:"POST"})).json();S.success?l(4,d="Risultati salvati con successo!"):l(4,d=S.error||"Errore durante il salvataggio")}catch{l(4,d="Errore di connessione al server")}finally{l(3,m=!1)}}function v(p){pe[p?"unshift":"push"](()=>{g=p,l(1,g)})}function x(p){pe[p?"unshift":"push"](()=>{u=p,l(2,u)})}return t.$$set=p=>{"results"in p&&l(0,s=p.results)},[s,g,u,m,d,n,b,h,v,x]}class Mn extends Ge{constructor(e){super(),qe(this,e,En,zn,Te,{results:0})}}function jn(t){let e,l;return e=new Mn({props:{results:t[2]}}),e.$on("reset",t[7]),{c(){ct(e.$$.fragment)},m(n,s){We(e,n,s),l=!0},p(n,s){const f={};s&4&&(f.results=n[2]),e.$set(f)},i(n){l||(ke(e.$$.fragment,n),l=!0)},o(n){Me(e.$$.fragment,n),l=!1},d(n){Je(e,n)}}}function Dn(t){let e,l;return e=new Pn({props:{currentStep:t[0]}}),e.$on("stepComplete",t[5]),e.$on("goBack",t[8]),e.$on("cancelToStep1",t[9]),{c(){ct(e.$$.fragment)},m(n,s){We(e,n,s),l=!0},p(n,s){const f={};s&1&&(f.currentStep=n[0]),e.$set(f)},i(n){l||(ke(e.$$.fragment,n),l=!0)},o(n){Me(e.$$.fragment,n),l=!1},d(n){Je(e,n)}}}function Rn(t){let e,l,n,s,f,g,u,o,c,b,m,d,h,v,x,p,S,T,A;d=new un({props:{analysisCompleted:t[1]}});const I=[Dn,jn],z=[];function y(w,D){return w[1]?1:0}return x=y(t),p=z[x]=I[x](t),{c(){e=r("main"),l=r("header"),n=r("div"),s=r("div"),f=r("h1"),f.textContent="Jump Analyzer Pro",g=_(),u=r("button"),u.textContent="Annulla Analisi",o=_(),c=r("div"),b=r("div"),m=r("div"),ct(d.$$.fragment),h=_(),v=r("div"),p.c(),a(f,"class","text-4xl font-bold text-white tracking-tight"),a(u,"class","bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold border border-red-500/50 shadow-md"),a(s,"class","flex items-center justify-between"),a(n,"class","max-w-[1400px] mx-auto px-6 py-6"),a(l,"class","bg-slate-800/50 backdrop-blur-sm border-b border-slate-700"),a(m,"class","lg:col-span-2"),a(v,"class","lg:col-span-1"),a(b,"class","grid grid-cols-1 lg:grid-cols-3 gap-6"),a(c,"class","max-w-[1400px] mx-auto px-6 py-8"),a(e,"class","min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900")},m(w,D){E(w,e,D),i(e,l),i(l,n),i(n,s),i(s,f),i(s,g),i(s,u),i(e,o),i(e,c),i(c,b),i(b,m),We(d,m,null),t[10](m),i(b,h),i(b,v),z[x].m(v,null),t[11](v),S=!0,T||(A=Q(u,"click",t[6]),T=!0)},p(w,[D]){const C={};D&2&&(C.analysisCompleted=w[1]),d.$set(C);let M=x;x=y(w),x===M?z[x].p(w,D):(Yl(),Me(z[M],1,1,()=>{z[M]=null}),Kl(),p=z[x],p?p.p(w,D):(p=z[x]=I[x](w),p.c()),ke(p,1),p.m(v,null))},i(w){S||(ke(d.$$.fragment,w),ke(p),S=!0)},o(w){Me(d.$$.fragment,w),Me(p),S=!1},d(w){w&&P(e),Je(d),t[10](null),z[x].d(),t[11](null),T=!1,A()}}}function Ln(t,e,l){let n;st(t,J,y=>l(15,n=y));let s=1,f=!1,g=null,u,o,c,b,m;function d(){if(!o||!c)return;if(typeof window<"u"?window.innerWidth>=1024:!0){const w=o.clientHeight;l(4,c.style.height=w?`${w}px`:"",c)}else l(4,c.style.height="",c)}xt(()=>{u=setInterval(async()=>{if(n.isAnalyzing||n.isRecording||n.isCalibrating){try{const w=await(await fetch(`${te()}/api/video/frame`)).json();w.success&&w.frame&&Yt(w.frame)}catch{}if(n.isAnalyzing)try{const w=await(await fetch(`${te()}/api/analysis/data`)).json();w.realtime&&en(w.realtime,w.trajectory,w.velocity)}catch{}}},100),window&&"ResizeObserver"in window?(b=new ResizeObserver(()=>{d()}),o&&b.observe(o)):window.addEventListener("resize",d),m=()=>{d(),setTimeout(d,50),setTimeout(d,150)},typeof document<"u"&&(document.addEventListener("fullscreenchange",m),document.addEventListener("webkitfullscreenchange",m),document.addEventListener("mozfullscreenchange",m),document.addEventListener("MSFullscreenChange",m)),setTimeout(d,0)}),Jt(()=>{u&&clearInterval(u),b&&o&&b.unobserve(o),b&&b.disconnect(),typeof window<"u"&&window.removeEventListener("resize",d),typeof document<"u"&&m&&(document.removeEventListener("fullscreenchange",m),document.removeEventListener("webkitfullscreenchange",m),document.removeEventListener("mozfullscreenchange",m),document.removeEventListener("MSFullscreenChange",m))});function h(y){const{step:w,data:D}=y.detail;w===1?l(0,s=2):w===2?(l(0,s=3),d()):w===3&&(l(2,g=D),l(1,f=!0),d())}async function v(){try{await fetch(`${te()}/api/analysis/stop`,{method:"POST"})}catch{}}async function x(){try{await fetch(`${te()}/api/recording/stop`,{method:"POST"})}catch{}}async function p(){var y,w;try{await fetch(`${te()}/api/analysis/stop`,{method:"POST"})}catch{}try{await fetch(`${te()}/api/recording/stop`,{method:"POST"})}catch{}try{(w=(y=n.previewStream)==null?void 0:y.getTracks())==null||w.forEach(D=>D.stop())}catch{}zt(),J.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});try{window.close()}catch{}}function S(){l(1,f=!1),l(2,g=null),l(0,s=1),J.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null})}async function T(){s>1&&(s===2?(await v(),await x(),J.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null})):s===3&&(await v(),J.update(y=>({...y,isAnalyzing:!1,isPaused:!1,isCameraPreview:y.isCameraPreview,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:y.localVideoUrl}))),l(0,s--,s),d())}async function A(){await v(),await x(),l(0,s=1),J.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null}),d()}function I(y){pe[y?"unshift":"push"](()=>{o=y,l(3,o)})}function z(y){pe[y?"unshift":"push"](()=>{c=y,l(4,c)})}return d(),[s,f,g,o,c,h,p,S,T,A,I,z]}class On extends Ge{constructor(e){super(),qe(this,e,Ln,Rn,Te,{})}}window.__APP_LOADING__=!0;function vl(){try{const t=document.getElementById("app");if(!t)throw new Error("Elemento #app non trovato nel DOM");t.innerHTML="";const e=new On({target:t});window.__APP_LOADED__=!0,window.__APP_LOADING__=!1}catch(t){console.error("Errore durante l'inizializzazione dell'app:",t),window.__APP_LOADING__=!1;const e=document.getElementById("app");e&&(e.innerHTML=`
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #0f172a; color: white; font-family: sans-serif; padding: 20px;">
          <div style="text-align: center; max-width: 600px;">
            <h1 style="color: #ef4444; margin-bottom: 20px;">Errore di Caricamento</h1>
            <p style="color: #94a3b8; margin-bottom: 10px;">Si è verificato un errore durante il caricamento dell'applicazione.</p>
            <p style="color: #64748b; font-size: 14px; margin-top: 20px; word-break: break-word;">${t.message||"Errore sconosciuto"}</p>
            <p style="color: #64748b; font-size: 12px; margin-top: 10px;">Stack: ${t.stack||"N/A"}</p>
            <p style="color: #64748b; font-size: 12px; margin-top: 10px;">Apri la console del browser (F12) per maggiori dettagli.</p>
          </div>
        </div>
      `)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",vl):vl()})();
