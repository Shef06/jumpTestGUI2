var sn=Object.defineProperty;var on=(Z,Oe,qe)=>Oe in Z?sn(Z,Oe,{enumerable:!0,configurable:!0,writable:!0,value:qe}):Z[Oe]=qe;var sl=(Z,Oe,qe)=>on(Z,typeof Oe!="symbol"?Oe+"":Oe,qe);(function(){"use strict";function Z(){}function Oe(t){return t()}function qe(){return Object.create(null)}function Me(t){t.forEach(Oe)}function ol(t){return typeof t=="function"}function lt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Tt;function At(t,e){return t===e?!0:(Tt||(Tt=document.createElement("a")),Tt.href=e,t===Tt.href)}function Zl(t){return Object.keys(t).length===0}function Ql(t,...e){if(t==null){for(const n of e)n(void 0);return Z}const l=t.subscribe(...e);return l.unsubscribe?()=>l.unsubscribe():l}function Mt(t,e,l){t.$$.on_destroy.push(Ql(e,l))}function $l(t,e,l){return t.set(l),e}function s(t,e){t.appendChild(e)}function L(t,e,l){t.insertBefore(e,l||null)}function j(t){t.parentNode&&t.parentNode.removeChild(t)}function ei(t,e){for(let l=0;l<t.length;l+=1)t[l]&&t[l].d(e)}function r(t){return document.createElement(t)}function it(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function V(t){return document.createTextNode(t)}function k(){return V(" ")}function Pt(){return V("")}function Q(t,e,l,n){return t.addEventListener(e,l,n),()=>t.removeEventListener(e,l,n)}function rl(t){return function(e){e.target===this&&t.call(this,e)}}function i(t,e,l){l==null?t.removeAttribute(e):t.getAttribute(e)!==l&&t.setAttribute(e,l)}function Ke(t){return t===""?null:+t}function ti(t){return Array.from(t.childNodes)}function ce(t,e){e=""+e,t.data!==e&&(t.data=e)}function Ne(t,e){t.value=e??""}function cl(t,e,l,n){l==null?t.style.removeProperty(e):t.style.setProperty(e,l,"")}function fl(t,e,l){for(let n=0;n<t.options.length;n+=1){const a=t.options[n];if(a.__value===e){a.selected=!0;return}}(!l||e!==void 0)&&(t.selectedIndex=-1)}function li(t){const e=t.querySelector(":checked");return e&&e.__value}function ii(t,e,{bubbles:l=!1,cancelable:n=!1}={}){return new CustomEvent(t,{detail:e,bubbles:l,cancelable:n})}let gt;function vt(t){gt=t}function Bt(){if(!gt)throw new Error("Function called outside component initialization");return gt}function Nt(t){Bt().$$.on_mount.push(t)}function Ht(t){Bt().$$.on_destroy.push(t)}function Ut(){const t=Bt();return(e,l,{cancelable:n=!1}={})=>{const a=t.$$.callbacks[e];if(a){const u=ii(e,l,{cancelable:n});return a.slice().forEach(_=>{_.call(t,u)}),!u.defaultPrevented}return!0}}const nt=[],Ee=[];let at=[];const Wt=[],ni=Promise.resolve();let Yt=!1;function ai(){Yt||(Yt=!0,ni.then(ul))}function Et(t){at.push(t)}function si(t){Wt.push(t)}const Gt=new Set;let st=0;function ul(){if(st!==0)return;const t=gt;do{try{for(;st<nt.length;){const e=nt[st];st++,vt(e),oi(e.$$)}}catch(e){throw nt.length=0,st=0,e}for(vt(null),nt.length=0,st=0;Ee.length;)Ee.pop()();for(let e=0;e<at.length;e+=1){const l=at[e];Gt.has(l)||(Gt.add(l),l())}at.length=0}while(nt.length);for(;Wt.length;)Wt.pop()();Yt=!1,Gt.clear(),vt(t)}function oi(t){if(t.fragment!==null){t.update(),Me(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Et)}}function ri(t){const e=[],l=[];at.forEach(n=>t.indexOf(n)===-1?e.push(n):l.push(n)),l.forEach(n=>n()),at=e}const zt=new Set;let Xe;function ci(){Xe={r:0,c:[],p:Xe}}function fi(){Xe.r||Me(Xe.c),Xe=Xe.p}function Ze(t,e){t&&t.i&&(zt.delete(t),t.i(e))}function ot(t,e,l,n){if(t&&t.o){if(zt.has(t))return;zt.add(t),Xe.c.push(()=>{zt.delete(t),n&&(l&&t.d(1),n())}),t.o(e)}else n&&n()}function dl(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function ui(t,e,l){const n=t.$$.props[e];n!==void 0&&(t.$$.bound[n]=l,l(t.$$.ctx[n]))}function Dt(t){t&&t.c()}function _t(t,e,l){const{fragment:n,after_update:a}=t.$$;n&&n.m(e,l),Et(()=>{const u=t.$$.on_mount.map(Oe).filter(ol);t.$$.on_destroy?t.$$.on_destroy.push(...u):Me(u),t.$$.on_mount=[]}),a.forEach(Et)}function yt(t,e){const l=t.$$;l.fragment!==null&&(ri(l.after_update),Me(l.on_destroy),l.fragment&&l.fragment.d(e),l.on_destroy=l.fragment=null,l.ctx=[])}function di(t,e){t.$$.dirty[0]===-1&&(nt.push(t),ai(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function wt(t,e,l,n,a,u,_=null,d=[-1]){const m=gt;vt(t);const f=t.$$={fragment:null,ctx:[],props:u,update:Z,not_equal:a,bound:qe(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(m?m.$$.context:[])),callbacks:qe(),dirty:d,skip_bound:!1,root:e.target||m.$$.root};_&&_(f.root);let b=!1;if(f.ctx=l?l(t,e.props||{},(c,g,...p)=>{const h=p.length?p[0]:g;return f.ctx&&a(f.ctx[c],f.ctx[c]=h)&&(!f.skip_bound&&f.bound[c]&&f.bound[c](h),b&&di(t,c)),g}):[],f.update(),b=!0,Me(f.before_update),f.fragment=n?n(f.ctx):!1,e.target){if(e.hydrate){const c=ti(e.target);f.fragment&&f.fragment.l(c),c.forEach(j)}else f.fragment&&f.fragment.c();e.intro&&Ze(t.$$.fragment),_t(t,e.target,e.anchor),ul()}vt(m)}class xt{constructor(){sl(this,"$$");sl(this,"$$set")}$destroy(){yt(this,1),this.$destroy=Z}$on(e,l){if(!ol(l))return Z;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(l),()=>{const a=n.indexOf(l);a!==-1&&n.splice(a,1)}}$set(e){this.$$set&&!Zl(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const mi="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(mi);const rt=[];function pi(t,e=Z){let l;const n=new Set;function a(d){if(lt(t,d)&&(t=d,l)){const m=!rt.length;for(const f of n)f[1](),rt.push(f,t);if(m){for(let f=0;f<rt.length;f+=2)rt[f][0](rt[f+1]);rt.length=0}}}function u(d){a(d(t))}function _(d,m=Z){const f=[d,m];return n.add(f),n.size===1&&(l=e(a,u)||Z),d(t),()=>{n.delete(f),n.size===0&&l&&(l(),l=null)}}return{set:a,update:u,subscribe:_}}const ue=pi({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,previewStream:null,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});function ml(t){ue.update(e=>({...e,videoFrame:t}))}function hi(t,e,l){ue.update(n=>({...n,realtimeData:t,trajectoryData:e||n.trajectoryData,velocityData:l||n.velocityData}))}function bi(t){ue.update(e=>({...e,localVideoUrl:t}))}function Jt(t){ue.update(e=>({...e,isCameraPreview:!!t}))}function gi(t){ue.update(e=>({...e,previewStream:t||null}))}function qt(){ue.update(t=>({...t,previewStream:null}))}function Kt(t){ue.update(e=>({...e,inputMode:t==="upload"||t==="camera"?t:"none"}))}const Ce=()=>typeof window<"u"&&window.BACKEND_URL?window.BACKEND_URL:"http://localhost:5000",vi=Ce();async function Te(t,e={}){const l=`${vi}${t}`,n=await fetch(l,e);try{return await n.json()}catch{return{}}}const He={setCamera(t){return Te("/api/settings/camera",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({index:Number(t)})})},setFps(t){return Te("/api/settings/fps",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:t})})},setHeight(t){return Te("/api/settings/height",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:t})})},setMass(t){return Te("/api/settings/mass",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:t})})},startRecording(){return Te("/api/recording/start",{method:"POST"})},stopRecording(){return Te("/api/recording/stop",{method:"POST"})},startCalibration(){return Te("/api/calibration/start",{method:"POST"})},calibrationStatus(){return Te("/api/calibration/status")},startAnalysis(){return Te("/api/analysis/start",{method:"POST"})},analysisStatus(){return Te("/api/analysis/status")},analysisResults(){return Te("/api/analysis/results")},pauseAnalysis(){return Te("/api/analysis/pause",{method:"POST"})},resumeAnalysis(){return Te("/api/analysis/resume",{method:"POST"})},stopAnalysis(){return Te("/api/analysis/stop",{method:"POST"})},videoFrame(){return Te("/api/video/frame")},analysisData(){return Te("/api/analysis/data")},async getPlayerData(t,e){var l;try{document.cookie=`session_id=${e}; path=/api/players`;const n=await fetch(`http://94.177.160.183/api/players/${t}`,{method:"GET",credentials:"include",headers:{Accept:"*/*"}});if(!n.ok)return{success:!1,error:`Errore HTTP: ${n.status}`};const a=await n.json();return(l=a==null?void 0:a.data)!=null&&l.info?{success:!0,data:{height_cm:a.data.info.height_cm,weight_kg:a.data.info.weight_kg,name:a.data.info.name,surname:a.data.info.surname,position:a.data.info.position}}:{success:!1,error:"Dati giocatore non validi"}}catch(n){return{success:!1,error:`Errore di connessione: ${n.message}`}}}};function _i(t){let e;return{c(){e=r("div"),e.innerHTML='<svg class="w-16 sm:w-20 md:w-24 h-16 sm:h-20 md:h-24 mx-auto text-slate-500 mb-3 sm:mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> <p class="text-slate-300 text-base sm:text-lg font-medium">Nessun video caricato</p> <p class="text-slate-500 text-sm mt-2">Carica o registra un video per iniziare</p>',i(e,"class","text-center p-6 sm:p-8"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){L(l,e,n)},p:Z,d(l){l&&j(e)}}}function yi(t){let e,l,n,a,u,_,d,m=t[4].isRecording&&pl(),f=t[4].isAnalyzing&&hl(),b=t[4].isCalibrating&&bl(),c=t[0]&&!t[4].localVideoUrl&&gl(t);return{c(){e=r("img"),n=k(),m&&m.c(),a=k(),f&&f.c(),u=k(),b&&b.c(),_=k(),c&&c.c(),d=Pt(),At(e.src,l=t[8])||i(e,"src",l),i(e,"alt","Video frame"),i(e,"class","w-full h-full max-w-full max-h-full object-contain")},m(g,p){L(g,e,p),L(g,n,p),m&&m.m(g,p),L(g,a,p),f&&f.m(g,p),L(g,u,p),b&&b.m(g,p),L(g,_,p),c&&c.m(g,p),L(g,d,p)},p(g,p){p&256&&!At(e.src,l=g[8])&&i(e,"src",l),g[4].isRecording?m||(m=pl(),m.c(),m.m(a.parentNode,a)):m&&(m.d(1),m=null),g[4].isAnalyzing?f||(f=hl(),f.c(),f.m(u.parentNode,u)):f&&(f.d(1),f=null),g[4].isCalibrating?b||(b=bl(),b.c(),b.m(_.parentNode,_)):b&&(b.d(1),b=null),g[0]&&!g[4].localVideoUrl?c?c.p(g,p):(c=gl(g),c.c(),c.m(d.parentNode,d)):c&&(c.d(1),c=null)},d(g){g&&(j(e),j(n),j(a),j(u),j(_),j(d)),m&&m.d(g),f&&f.d(g),b&&b.d(g),c&&c.d(g)}}}function wi(t){let e,l;return{c(){e=r("video"),At(e.src,l=t[4].localVideoUrl)||i(e,"src",l),e.controls=!0,i(e,"class","w-full h-full object-contain")},m(n,a){L(n,e,a),t[12](e)},p(n,a){a&16&&!At(e.src,l=n[4].localVideoUrl)&&i(e,"src",l)},d(n){n&&j(e),t[12](null)}}}function xi(t){let e;return{c(){e=r("video"),e.autoplay=!0,e.playsInline=!0,e.muted=!0,i(e,"class","w-full h-full object-contain")},m(l,n){L(l,e,n),t[11](e)},p:Z,d(l){l&&j(e),t[11](null)}}}function pl(t){let e;return{c(){e=r("div"),e.innerHTML='<div class="w-2.5 sm:w-3 h-2.5 sm:h-3 bg-white rounded-full animate-pulse svelte-1mb1g50" aria-hidden="true"></div> <span class="text-white font-semibold text-xs sm:text-sm">REC</span>',i(e,"class","absolute top-3 sm:top-4 right-3 sm:right-4 flex items-center gap-2 bg-red-600 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-lg"),i(e,"role","status"),i(e,"aria-live","polite"),i(e,"aria-label","Registrazione in corso")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function hl(t){let e;return{c(){e=r("div"),e.innerHTML='<span class="text-white font-semibold text-xs sm:text-sm">ANALYZING</span>',i(e,"class","absolute top-3 sm:top-4 left-3 sm:left-4 bg-green-600 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-lg"),i(e,"role","status"),i(e,"aria-live","polite"),i(e,"aria-label","Analisi in corso")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function bl(t){let e;return{c(){e=r("div"),e.innerHTML='<span class="text-white font-semibold text-xs sm:text-sm">CALIBRATING</span>',i(e,"class","absolute top-3 sm:top-4 left-3 sm:left-4 bg-yellow-600 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-lg"),i(e,"role","status"),i(e,"aria-live","polite"),i(e,"aria-label","Calibrazione in corso")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function gl(t){let e,l,n,a,u,_,d,m,f,b=`${t[2]+1} / ${Math.max(t[1],0)}`,c,g,p,h,v,w=t[5]&&vl(t);return{c(){e=r("div"),l=r("label"),l.textContent="Seleziona frame",n=k(),a=r("input"),m=k(),f=r("div"),c=V(b),g=k(),w&&w.c(),p=Pt(),i(l,"for","frame-slider"),i(l,"class","sr-only"),i(a,"id","frame-slider"),i(a,"type","range"),i(a,"min","0"),i(a,"max",u=Math.max(t[1]-1,0)),i(a,"class","w-32 sm:w-48 md:w-64 lg:w-80 accent-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-900 rounded"),i(a,"aria-label",_="Frame "+(t[2]+1)+" di "+Math.max(t[1],0)),i(a,"aria-valuemin","0"),i(a,"aria-valuemax",d=Math.max(t[1]-1,0)),i(a,"aria-valuenow",t[2]),i(f,"class","text-slate-300 text-xs sm:text-sm whitespace-nowrap font-medium"),i(f,"aria-live","polite"),i(e,"class","absolute bottom-3 sm:bottom-4 left-1/2 -translate-x-1/2 bg-slate-900/90 backdrop-blur-sm px-3 sm:px-4 py-2 sm:py-3 rounded-full border border-slate-700 flex items-center gap-2 sm:gap-4 shadow-xl max-w-[95%]")},m(C,M){L(C,e,M),s(e,l),s(e,n),s(e,a),Ne(a,t[2]),s(e,m),s(e,f),s(f,c),L(C,g,M),w&&w.m(C,M),L(C,p,M),h||(v=[Q(a,"change",t[13]),Q(a,"input",t[13]),Q(a,"input",t[14])],h=!0)},p(C,M){M&2&&u!==(u=Math.max(C[1]-1,0))&&i(a,"max",u),M&6&&_!==(_="Frame "+(C[2]+1)+" di "+Math.max(C[1],0))&&i(a,"aria-label",_),M&2&&d!==(d=Math.max(C[1]-1,0))&&i(a,"aria-valuemax",d),M&4&&i(a,"aria-valuenow",C[2]),M&4&&Ne(a,C[2]),M&6&&b!==(b=`${C[2]+1} / ${Math.max(C[1],0)}`)&&ce(c,b),C[5]?w?w.p(C,M):(w=vl(C),w.c(),w.m(p.parentNode,p)):w&&(w.d(1),w=null)},d(C){C&&(j(e),j(g),j(p)),w&&w.d(C),h=!1,Me(v)}}}function vl(t){let e,l;return{c(){e=r("div"),l=V(t[5]),i(e,"class","absolute bottom-20 sm:bottom-24 left-1/2 -translate-x-1/2 bg-red-600/90 text-white text-xs px-3 py-1.5 rounded shadow-lg border border-red-500/50"),i(e,"role","alert")},m(n,a){L(n,e,a),s(e,l)},p(n,a){a&32&&ce(l,n[5])},d(n){n&&j(e)}}}function ki(t){let e,l,n,a;function u(m,f){return m[4].isCameraPreview&&m[4].previewStream?xi:m[0]&&m[4].localVideoUrl?wi:m[8]?yi:_i}let _=u(t),d=_(t);return{c(){e=r("div"),l=r("div"),l.innerHTML='<h2 class="text-lg sm:text-xl font-semibold text-white">Anteprima Video</h2>',n=k(),a=r("div"),d.c(),i(l,"class","video-header bg-gradient-to-r from-blue-600 to-purple-600 px-4 sm:px-6 py-3 sm:py-4"),i(a,"class","video-content aspect-video bg-black flex items-center justify-center relative"),i(a,"data-reflow",t[7]),i(a,"aria-live","polite"),i(a,"aria-atomic","true"),i(e,"class","video-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700"),i(e,"role","region"),i(e,"aria-label","Anteprima video")},m(m,f){L(m,e,f),s(e,l),s(e,n),s(e,a),d.m(a,null),t[15](e)},p(m,[f]){_===(_=u(m))&&d?d.p(m,f):(d.d(1),d=_(m),d&&(d.c(),d.m(a,null))),f&128&&i(a,"data-reflow",m[7])},i:Z,o:Z,d(m){m&&j(e),d.d(),t[15](null)}}}function Ci(t,e,l){let n,a;Mt(t,ue,T=>l(4,a=T));let{analysisCompleted:u=!1}=e,_=0,d=0,m=!1,f="",b,c,g,p,h=0,v;async function w(){try{const z=await(await fetch(`${Ce()}/api/video/info`)).json();z&&z.success&&(l(1,_=z.total_frames||0),l(10,m=!0))}catch{}}async function C(T){l(5,f="");try{const U=await(await fetch(`${Ce()}/api/video/frame_at?index=${T}`)).json();U&&U.success?(l(2,d=U.index),ml(U.frame)):U&&U.error&&l(5,f=U.error)}catch{l(5,f="Errore caricamento frame")}finally{}}function M(T){!u||_<=0||(b&&clearTimeout(b),b=setTimeout(()=>{C(T)},50))}function R(){l(7,h++,h)}Nt(()=>{if(a.isCameraPreview&&a.previewStream&&v)try{l(3,v.srcObject=a.previewStream,v)}catch{}typeof window<"u"&&"ResizeObserver"in window?(g=new ResizeObserver(()=>{R()}),c&&g.observe(c)):typeof window<"u"&&window.addEventListener("resize",R),p=()=>{R(),setTimeout(R,50),setTimeout(R,150)},typeof document<"u"&&(document.addEventListener("fullscreenchange",p),document.addEventListener("webkitfullscreenchange",p),document.addEventListener("mozfullscreenchange",p),document.addEventListener("MSFullscreenChange",p))}),Ht(()=>{g&&c&&g.unobserve(c),g&&g.disconnect(),typeof window<"u"&&window.removeEventListener("resize",R),typeof document<"u"&&p&&(document.removeEventListener("fullscreenchange",p),document.removeEventListener("webkitfullscreenchange",p),document.removeEventListener("mozfullscreenchange",p),document.removeEventListener("MSFullscreenChange",p))});function H(T){Ee[T?"unshift":"push"](()=>{v=T,l(3,v),l(4,a)})}function A(T){Ee[T?"unshift":"push"](()=>{v=T,l(3,v),l(4,a)})}function Y(){d=Ke(this.value),l(2,d)}const I=T=>M(+T.target.value);function $(T){Ee[T?"unshift":"push"](()=>{c=T,l(6,c)})}return t.$$set=T=>{"analysisCompleted"in T&&l(0,u=T.analysisCompleted)},t.$$.update=()=>{if(t.$$.dirty&16&&l(8,n=a.videoFrame?`data:image/jpeg;base64,${a.videoFrame}`:null),t.$$.dirty&1031&&(async()=>u&&!m&&(await w(),_>0&&await C(d)))(),t.$$.dirty&24&&a.isCameraPreview&&a.previewStream&&v)try{l(3,v.srcObject=a.previewStream,v)}catch{}},[u,_,d,v,a,f,c,h,n,M,m,H,A,Y,I,$]}class Si extends xt{constructor(e){super(),wt(this,e,Ci,ki,lt,{analysisCompleted:0})}}async function Ti(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("API mediaDevices non disponibile");let t=null;try{t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}catch{}try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput")}finally{if(t)try{t.getTracks().forEach(e=>e.stop())}catch{}}}async function Ai(t,e){const l=Array.isArray(e)?e:[],n=l[t]||l[0];return n&&n.deviceId?await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:n.deviceId}},audio:!1}):await navigator.mediaDevices.getUserMedia({video:!0,audio:!1})}function Xt(t){var e;try{(e=t==null?void 0:t.getTracks())==null||e.forEach(l=>l.stop())}catch{}}function _l(t,e,l){const n=t.slice();return n[11]=e[l],n[13]=l,n}function yl(t){let e,l,n,a,u,_,d,m,f,b,c,g,p,h,v,w,C,M,R=t[4]&&wl(t);function H(I,$){return I[2]?Ei:I[3].length>0?Pi:Mi}let A=H(t),Y=A(t);return{c(){e=r("div"),l=r("div"),n=r("div"),a=r("h4"),a.textContent="Seleziona fotocamera",u=k(),_=r("button"),_.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',d=k(),m=r("div"),R&&R.c(),f=k(),Y.c(),b=k(),c=r("div"),g=r("button"),g.textContent="Annulla",p=k(),h=r("button"),v=V("Conferma e anteprima"),i(a,"id","camera-modal-title"),i(a,"class","text-white font-semibold text-lg"),i(_,"class","text-slate-400 hover:text-white focus:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-800 rounded p-1"),i(_,"aria-label","Chiudi modal"),i(n,"class","px-4 sm:px-6 py-3 sm:py-4 border-b border-slate-700 flex items-center justify-between"),i(m,"class","p-4 sm:p-6 space-y-4"),i(g,"class","btn-secondary"),i(g,"aria-label","Annulla selezione fotocamera"),i(h,"class","btn-primary"),h.disabled=w=t[2]||t[3].length===0,i(h,"aria-label","Conferma selezione e avvia anteprima"),i(c,"class","px-4 sm:px-6 py-3 sm:py-4 border-t border-slate-700 flex gap-2 sm:gap-3 justify-end"),i(l,"class","bg-slate-800 border border-slate-700 rounded-xl w-full max-w-md shadow-2xl"),i(l,"role","document"),i(e,"class","fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4"),i(e,"role","dialog"),i(e,"aria-modal","true"),i(e,"aria-labelledby","camera-modal-title")},m(I,$){L(I,e,$),s(e,l),s(l,n),s(n,a),s(n,u),s(n,_),s(l,d),s(l,m),R&&R.m(m,null),s(m,f),Y.m(m,null),s(l,b),s(l,c),s(c,g),s(c,p),s(c,h),s(h,v),C||(M=[Q(_,"click",t[5]),Q(g,"click",t[5]),Q(h,"click",t[6]),Q(e,"click",rl(t[5])),Q(e,"keydown",t[9])],C=!0)},p(I,$){I[4]?R?R.p(I,$):(R=wl(I),R.c(),R.m(m,f)):R&&(R.d(1),R=null),A===(A=H(I))&&Y?Y.p(I,$):(Y.d(1),Y=A(I),Y&&(Y.c(),Y.m(m,null))),$&12&&w!==(w=I[2]||I[3].length===0)&&(h.disabled=w)},d(I){I&&j(e),R&&R.d(),Y.d(),C=!1,Me(M)}}}function wl(t){let e,l;return{c(){e=r("div"),l=V(t[4]),i(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-3 text-red-300 text-sm"),i(e,"role","alert")},m(n,a){L(n,e,a),s(e,l)},p(n,a){a&16&&ce(l,n[4])},d(n){n&&j(e)}}}function Mi(t){let e;return{c(){e=r("p"),e.textContent="Nessuna fotocamera disponibile.",i(e,"class","text-slate-400"),i(e,"role","status")},m(l,n){L(l,e,n)},p:Z,d(l){l&&j(e)}}}function Pi(t){let e,l,n,a,u,_,d,m,f=dl(t[3]),b=[];for(let c=0;c<f.length;c+=1)b[c]=xl(_l(t,f,c));return{c(){e=r("div"),l=r("label"),l.textContent="Fotocamera",n=k(),a=r("select");for(let c=0;c<b.length;c+=1)b[c].c();u=k(),_=r("p"),_.textContent="Seleziona una fotocamera dalla lista",i(l,"for","camera-select"),i(l,"class","block text-sm font-medium text-slate-300 mb-2"),i(a,"id","camera-select"),i(a,"class","input-field"),i(a,"aria-describedby","camera-select-help"),t[0]===void 0&&Et(()=>t[8].call(a)),i(_,"id","camera-select-help"),i(_,"class","sr-only")},m(c,g){L(c,e,g),s(e,l),s(e,n),s(e,a);for(let p=0;p<b.length;p+=1)b[p]&&b[p].m(a,null);fl(a,t[0],!0),s(e,u),s(e,_),d||(m=[Q(a,"change",t[7]),Q(a,"change",t[8])],d=!0)},p(c,g){if(g&8){f=dl(c[3]);let p;for(p=0;p<f.length;p+=1){const h=_l(c,f,p);b[p]?b[p].p(h,g):(b[p]=xl(h),b[p].c(),b[p].m(a,null))}for(;p<b.length;p+=1)b[p].d(1);b.length=f.length}g&1&&fl(a,c[0])},d(c){c&&j(e),ei(b,c),d=!1,Me(m)}}}function Ei(t){let e;return{c(){e=r("div"),e.innerHTML='<svg class="animate-spin h-5 w-5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <p class="text-slate-300">Caricamento fotocamere...</p>',i(e,"class","flex items-center gap-3"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){L(l,e,n)},p:Z,d(l){l&&j(e)}}}function xl(t){let e,l=(t[11].label||`Camera ${t[13]+1}`)+"",n;return{c(){e=r("option"),n=V(l),e.__value=t[13],Ne(e,e.__value)},m(a,u){L(a,e,u),s(e,n)},p(a,u){u&8&&l!==(l=(a[11].label||`Camera ${a[13]+1}`)+"")&&ce(n,l)},d(a){a&&j(e)}}}function zi(t){let e,l=t[1]&&yl(t);return{c(){l&&l.c(),e=Pt()},m(n,a){l&&l.m(n,a),L(n,e,a)},p(n,[a]){n[1]?l?l.p(n,a):(l=yl(n),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},i:Z,o:Z,d(n){n&&j(e),l&&l.d(n)}}}function Di(t,e,l){let{show:n=!1}=e,{loading:a=!1}=e,{cameras:u=[]}=e,{selectedIndex:_=null}=e,{error:d=""}=e;const m=Ut();function f(){m("close")}function b(){m("confirm")}function c(h){const v=Number(h.target.value);m("select",{index:v})}function g(){_=li(this),l(0,_)}const p=h=>h.key==="Escape"&&f();return t.$$set=h=>{"show"in h&&l(1,n=h.show),"loading"in h&&l(2,a=h.loading),"cameras"in h&&l(3,u=h.cameras),"selectedIndex"in h&&l(0,_=h.selectedIndex),"error"in h&&l(4,d=h.error)},[_,n,a,u,d,f,b,c,g,p]}class ji extends xt{constructor(e){super(),wt(this,e,Di,zi,lt,{show:1,loading:2,cameras:3,selectedIndex:0,error:4})}}function kl(t){let e,l,n;return{c(){e=r("button"),e.innerHTML='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg> <span class="hidden sm:inline">Indietro</span>',i(e,"class","bg-white/20 hover:bg-white/30 focus:bg-white/30 text-white px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg transition-all duration-200 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-white/50 focus:ring-offset-2 focus:ring-offset-purple-600"),i(e,"aria-label","Torna allo step precedente")},m(a,u){L(a,e,u),l||(n=Q(e,"click",t[23]),l=!0)},p:Z,d(a){a&&j(e),l=!1,n()}}}function Cl(t){let e,l,n;return{c(){e=r("div"),l=r("p"),n=V(t[5]),i(l,"class","text-red-400 text-sm"),i(e,"class","bg-red-500/10 border border-red-500/50 rounded-lg p-3 sm:p-4"),i(e,"role","alert"),i(e,"aria-live","assertive")},m(a,u){L(a,e,u),s(e,l),s(l,n)},p(a,u){u[0]&32&&ce(n,a[5])},d(a){a&&j(e)}}}function Sl(t){let e,l,n=t[13].inputMode==="camera"?"1. Registra Video":"1. Carica o Registra Video",a,u,_,d=t[13].inputMode!=="camera"&&Tl(t);function m(c,g){return c[13].isRecording?Li:Ri}let f=m(t),b=f(t);return{c(){e=r("div"),l=r("h3"),a=V(n),u=k(),d&&d.c(),_=k(),b.c(),i(l,"class","text-base sm:text-lg font-semibold text-white mb-3 sm:mb-4"),i(e,"class","space-y-4")},m(c,g){L(c,e,g),s(e,l),s(l,a),s(e,u),d&&d.m(e,null),s(e,_),b.m(e,null)},p(c,g){g[0]&8192&&n!==(n=c[13].inputMode==="camera"?"1. Registra Video":"1. Carica o Registra Video")&&ce(a,n),c[13].inputMode!=="camera"?d?d.p(c,g):(d=Tl(c),d.c(),d.m(e,_)):d&&(d.d(1),d=null),f===(f=m(c))&&b?b.p(c,g):(b.d(1),b=f(c),b&&(b.c(),b.m(e,null)))},d(c){c&&j(e),d&&d.d(),b.d()}}}function Tl(t){let e,l,n,a,u,_,d,m,f=t[1]?"Caricamento...":"Carica Video",b,c,g,p,h,v;return{c(){e=r("label"),l=r("input"),a=k(),u=r("div"),_=it("svg"),d=it("path"),m=k(),b=V(f),g=k(),p=r("div"),p.textContent="oppure",i(l,"type","file"),i(l,"accept","video/*"),l.disabled=n=t[1]||t[13].isRecording,i(l,"class","hidden"),i(l,"aria-label","Seleziona file video da caricare"),i(d,"stroke-linecap","round"),i(d,"stroke-linejoin","round"),i(d,"stroke-width","2"),i(d,"d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"),i(_,"class","w-5 h-5 inline mr-2"),i(_,"fill","none"),i(_,"stroke","currentColor"),i(_,"viewBox","0 0 24 24"),i(_,"aria-hidden","true"),i(u,"class",c="btn-primary cursor-pointer text-center "+(t[1]?"opacity-50":"")),i(u,"role","button"),i(u,"tabindex","0"),i(e,"class","block"),i(p,"class","text-center text-slate-400 text-sm"),i(p,"aria-hidden","true")},m(w,C){L(w,e,C),s(e,l),s(e,a),s(e,u),s(u,_),s(_,d),s(u,m),s(u,b),L(w,g,C),L(w,p,C),h||(v=[Q(l,"change",t[14]),Q(u,"keydown",t[29])],h=!0)},p(w,C){C[0]&8194&&n!==(n=w[1]||w[13].isRecording)&&(l.disabled=n),C[0]&2&&f!==(f=w[1]?"Caricamento...":"Carica Video")&&ce(b,f),C[0]&2&&c!==(c="btn-primary cursor-pointer text-center "+(w[1]?"opacity-50":""))&&i(u,"class",c)},d(w){w&&(j(e),j(g),j(p)),h=!1,Me(v)}}}function Li(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><rect x="6" y="6" width="12" height="12"></rect></svg>
            Ferma Registrazione`,i(e,"class","btn-danger w-full"),i(e,"aria-label","Ferma registrazione video")},m(a,u){L(a,e,u),l||(n=Q(e,"click",t[18]),l=!0)},p:Z,d(a){a&&j(e),l=!1,n()}}}function Ri(t){let e,l,n,a,u=t[13].inputMode==="camera"?"Cambia Telecamera":"Registra Video",_,d,m,f,b,c,g,p=t[13].isCameraPreview&&Al(t),h=t[13].isCameraPreview&&Ml();return{c(){e=r("button"),l=it("svg"),n=it("path"),a=k(),_=V(u),m=k(),p&&p.c(),f=k(),h&&h.c(),b=Pt(),i(n,"stroke-linecap","round"),i(n,"stroke-linejoin","round"),i(n,"stroke-width","2"),i(n,"d","M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"),i(l,"class","w-5 h-5 inline mr-2"),i(l,"fill","none"),i(l,"stroke","currentColor"),i(l,"viewBox","0 0 24 24"),i(l,"aria-hidden","true"),i(e,"class","btn-secondary w-full"),i(e,"aria-label",d=t[13].inputMode==="camera"?"Cambia telecamera":"Apri modal selezione telecamera per registrare video")},m(v,w){L(v,e,w),s(e,l),s(l,n),s(e,a),s(e,_),L(v,m,w),p&&p.m(v,w),L(v,f,w),h&&h.m(v,w),L(v,b,w),c||(g=Q(e,"click",t[16]),c=!0)},p(v,w){w[0]&8192&&u!==(u=v[13].inputMode==="camera"?"Cambia Telecamera":"Registra Video")&&ce(_,u),w[0]&8192&&d!==(d=v[13].inputMode==="camera"?"Cambia telecamera":"Apri modal selezione telecamera per registrare video")&&i(e,"aria-label",d),v[13].isCameraPreview?p?p.p(v,w):(p=Al(v),p.c(),p.m(f.parentNode,f)):p&&(p.d(1),p=null),v[13].isCameraPreview?h||(h=Ml(),h.c(),h.m(b.parentNode,b)):h&&(h.d(1),h=null)},d(v){v&&(j(e),j(m),j(f),j(b)),p&&p.d(v),h&&h.d(v),c=!1,g()}}}function Al(t){let e,l,n;return{c(){e=r("button"),e.textContent="Analizza Video",i(e,"class","btn-primary w-full mt-3"),i(e,"aria-label","Avvia analisi video e inizia registrazione")},m(a,u){L(a,e,u),l||(n=Q(e,"click",t[15]),l=!0)},p:Z,d(a){a&&j(e),l=!1,n()}}}function Ml(t){let e;return{c(){e=r("div"),e.textContent='Anteprima fotocamera attiva. Premi "Analizza Video" per iniziare la registrazione, poi "Ferma Registrazione" al termine del salto.',i(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-3 text-blue-300 text-sm"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function Pl(t){let e,l,n,a,u,_,d,m,f,b,c,g,p,h,v,w,C,M,R,H,A,Y,I,$,T,z=t[6]?"Calibrazione e Analisi in corso...":"Avvia Analisi",U,ae,pe,he,ve,K=t[6]&&El();return{c(){e=r("div"),l=r("h3"),l.textContent="2. Calibrazione Sistema",n=k(),a=r("div"),u=r("label"),u.textContent="FPS Video",_=k(),d=r("input"),m=k(),f=r("p"),f.textContent="Frame per secondo del video",b=k(),c=r("div"),g=r("label"),g.textContent="Altezza Persona (cm)",p=k(),h=r("input"),v=k(),w=r("p"),w.textContent="Altezza reale della persona",C=k(),M=r("div"),R=r("label"),R.textContent="Massa Corporea (kg)",H=k(),A=r("input"),Y=k(),I=r("p"),I.textContent="Peso della persona",$=k(),T=r("button"),U=V(z),pe=k(),K&&K.c(),i(l,"class","text-base sm:text-lg font-semibold text-white mb-3 sm:mb-4"),i(u,"for","fps-input"),i(u,"class","block text-sm font-medium text-slate-300 mb-2"),i(d,"id","fps-input"),i(d,"type","number"),i(d,"min","1"),i(d,"max","240"),d.disabled=t[6],i(d,"class","input-field"),i(d,"aria-describedby","fps-help"),i(f,"id","fps-help"),i(f,"class","text-slate-500 text-xs mt-1"),i(g,"for","height-input"),i(g,"class","block text-sm font-medium text-slate-300 mb-2"),i(h,"id","height-input"),i(h,"type","number"),i(h,"min","100"),i(h,"max","250"),h.disabled=t[6],i(h,"class","input-field"),i(h,"aria-describedby","height-help"),i(w,"id","height-help"),i(w,"class","text-slate-500 text-xs mt-1"),i(R,"for","mass-input"),i(R,"class","block text-sm font-medium text-slate-300 mb-2"),i(A,"id","mass-input"),i(A,"type","number"),i(A,"min","40"),i(A,"max","150"),A.disabled=t[6],i(A,"class","input-field"),i(A,"aria-describedby","mass-help"),i(I,"id","mass-help"),i(I,"class","text-slate-500 text-xs mt-1"),T.disabled=t[6],i(T,"class","btn-primary w-full"),i(T,"aria-label",ae=t[6]?"Calibrazione e analisi in corso":"Avvia calibrazione e analisi"),i(e,"class","space-y-4")},m(X,oe){L(X,e,oe),s(e,l),s(e,n),s(e,a),s(a,u),s(a,_),s(a,d),Ne(d,t[2]),s(a,m),s(a,f),s(e,b),s(e,c),s(c,g),s(c,p),s(c,h),Ne(h,t[3]),s(c,v),s(c,w),s(e,C),s(e,M),s(M,R),s(M,H),s(M,A),Ne(A,t[4]),s(M,Y),s(M,I),s(e,$),s(e,T),s(T,U),s(e,pe),K&&K.m(e,null),he||(ve=[Q(d,"input",t[30]),Q(h,"input",t[31]),Q(A,"input",t[32]),Q(T,"click",t[24])],he=!0)},p(X,oe){oe[0]&64&&(d.disabled=X[6]),oe[0]&4&&Ke(d.value)!==X[2]&&Ne(d,X[2]),oe[0]&64&&(h.disabled=X[6]),oe[0]&8&&Ke(h.value)!==X[3]&&Ne(h,X[3]),oe[0]&64&&(A.disabled=X[6]),oe[0]&16&&Ke(A.value)!==X[4]&&Ne(A,X[4]),oe[0]&64&&z!==(z=X[6]?"Calibrazione e Analisi in corso...":"Avvia Analisi")&&ce(U,z),oe[0]&64&&(T.disabled=X[6]),oe[0]&64&&ae!==(ae=X[6]?"Calibrazione e analisi in corso":"Avvia calibrazione e analisi")&&i(T,"aria-label",ae),X[6]?K||(K=El(),K.c(),K.m(e,null)):K&&(K.d(1),K=null)},d(X){X&&j(e),K&&K.d(),he=!1,Me(ve)}}}function El(t){let e;return{c(){e=r("div"),e.innerHTML='<p class="text-blue-400 text-sm">Sistema in calibrazione. Assicurati che la persona sia in posizione eretta nel frame.</p>',i(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-3 sm:p-4"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function zl(t){var se,x,y,P;let e,l,n,a,u,_,d,m,f,b,c,g,p=(((se=t[13].realtimeData)==null?void 0:se.current_height)??0)+"",h,v,w,C,M,R,H,A=(((x=t[13].realtimeData)==null?void 0:x.max_height)??0)+"",Y,I,$,T,z,U,ae,pe=(((y=t[13].realtimeData)==null?void 0:y.takeoff_velocity)??0)+"",he,ve,K,X,oe,me,ie,re=(((P=t[13].realtimeData)==null?void 0:P.estimated_power)??0)+"",de,B,S;function N(F,q){return F[7]?Ii:Fi}let fe=N(t),J=fe(t),o=t[7]&&Dl(t);return{c(){e=r("div"),l=r("h3"),l.textContent="3. Analisi Salto",n=k(),J.c(),a=k(),u=r("div"),_=r("h4"),_.textContent="Dati in Tempo Reale",d=k(),m=r("div"),f=r("div"),b=r("p"),b.textContent="Altezza Corrente",c=k(),g=r("p"),h=V(p),v=V(" cm"),w=k(),C=r("div"),M=r("p"),M.textContent="Altezza Max",R=k(),H=r("p"),Y=V(A),I=V(" cm"),$=k(),T=r("div"),z=r("p"),z.textContent="Velocità Decollo",U=k(),ae=r("p"),he=V(pe),ve=V(" cm/s"),K=k(),X=r("div"),oe=r("p"),oe.textContent="Potenza Est.",me=k(),ie=r("p"),de=V(re),B=V(" W"),S=k(),o&&o.c(),i(l,"class","text-base sm:text-lg font-semibold text-white mb-3 sm:mb-4"),i(_,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-2 sm:mb-3"),i(b,"class","text-slate-400 text-[10px] sm:text-xs uppercase tracking-wide mb-0.5 sm:mb-1"),i(g,"class","text-base sm:text-lg md:text-xl font-bold text-blue-400"),i(g,"aria-live","polite"),i(f,"class","text-center"),i(f,"role","listitem"),i(M,"class","text-slate-400 text-[10px] sm:text-xs uppercase tracking-wide mb-0.5 sm:mb-1"),i(H,"class","text-base sm:text-lg md:text-xl font-bold text-green-400"),i(H,"aria-live","polite"),i(C,"class","text-center"),i(C,"role","listitem"),i(z,"class","text-slate-400 text-[10px] sm:text-xs uppercase tracking-wide mb-0.5 sm:mb-1"),i(ae,"class","text-base sm:text-lg md:text-xl font-bold text-purple-400"),i(ae,"aria-live","polite"),i(T,"class","text-center"),i(T,"role","listitem"),i(oe,"class","text-slate-400 text-[10px] sm:text-xs uppercase tracking-wide mb-0.5 sm:mb-1"),i(ie,"class","text-base sm:text-lg md:text-xl font-bold text-yellow-400"),i(ie,"aria-live","polite"),i(X,"class","text-center"),i(X,"role","listitem"),i(m,"class","grid grid-cols-2 gap-1.5 sm:gap-2 md:gap-3"),i(m,"role","list"),i(u,"class","bg-slate-900/50 rounded-xl p-2.5 sm:p-3 md:p-4 border border-slate-700"),i(u,"role","region"),i(u,"aria-label","Dati in tempo reale"),i(e,"class","space-y-4")},m(F,q){L(F,e,q),s(e,l),s(e,n),J.m(e,null),s(e,a),s(e,u),s(u,_),s(u,d),s(u,m),s(m,f),s(f,b),s(f,c),s(f,g),s(g,h),s(g,v),s(m,w),s(m,C),s(C,M),s(C,R),s(C,H),s(H,Y),s(H,I),s(m,$),s(m,T),s(T,z),s(T,U),s(T,ae),s(ae,he),s(ae,ve),s(m,K),s(m,X),s(X,oe),s(X,me),s(X,ie),s(ie,de),s(ie,B),s(e,S),o&&o.m(e,null)},p(F,q){var xe,le,be,ee;fe===(fe=N(F))&&J?J.p(F,q):(J.d(1),J=fe(F),J&&(J.c(),J.m(e,a))),q[0]&8192&&p!==(p=(((xe=F[13].realtimeData)==null?void 0:xe.current_height)??0)+"")&&ce(h,p),q[0]&8192&&A!==(A=(((le=F[13].realtimeData)==null?void 0:le.max_height)??0)+"")&&ce(Y,A),q[0]&8192&&pe!==(pe=(((be=F[13].realtimeData)==null?void 0:be.takeoff_velocity)??0)+"")&&ce(he,pe),q[0]&8192&&re!==(re=(((ee=F[13].realtimeData)==null?void 0:ee.estimated_power)??0)+"")&&ce(de,re),F[7]?o?o.p(F,q):(o=Dl(F),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(F){F&&j(e),J.d(),o&&o.d()}}}function Ii(t){let e;return{c(){e=r("div"),e.innerHTML='<p class="text-green-400 text-sm font-medium">Analisi in corso...</p> <p class="text-slate-400 text-xs mt-1">Il sistema sta elaborando il salto</p>',i(e,"class","bg-green-500/10 border border-green-500/50 rounded-lg p-3 sm:p-4"),i(e,"role","status"),i(e,"aria-live","polite")},m(l,n){L(l,e,n)},p:Z,d(l){l&&j(e)}}}function Fi(t){let e,l,n;return{c(){e=r("button"),e.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            Avvia Analisi`,i(e,"class","btn-primary w-full"),i(e,"aria-label","Avvia analisi del salto")},m(a,u){L(a,e,u),l||(n=Q(e,"click",t[19]),l=!0)},p:Z,d(a){a&&j(e),l=!1,n()}}}function Dl(t){let e,l,n,a,u;function _(f,b){return f[13].isPaused?Oi:Vi}let d=_(t),m=d(t);return{c(){e=r("div"),m.c(),l=k(),n=r("button"),n.textContent="Annulla",i(n,"class","btn-danger flex-1"),i(n,"aria-label","Annulla analisi"),i(e,"class","flex gap-2")},m(f,b){L(f,e,b),m.m(e,null),s(e,l),s(e,n),a||(u=Q(n,"click",t[22]),a=!0)},p(f,b){d===(d=_(f))&&m?m.p(f,b):(m.d(1),m=d(f),m&&(m.c(),m.m(e,l)))},d(f){f&&j(e),m.d(),a=!1,u()}}}function Vi(t){let e,l,n;return{c(){e=r("button"),e.textContent="Pausa",i(e,"class","btn-secondary flex-1"),i(e,"aria-label","Metti in pausa l'analisi")},m(a,u){L(a,e,u),l||(n=Q(e,"click",t[20]),l=!0)},p:Z,d(a){a&&j(e),l=!1,n()}}}function Oi(t){let e,l,n;return{c(){e=r("button"),e.textContent="Riprendi",i(e,"class","btn-secondary flex-1"),i(e,"aria-label","Riprendi analisi")},m(a,u){L(a,e,u),l||(n=Q(e,"click",t[21]),l=!0)},p:Z,d(a){a&&j(e),l=!1,n()}}}function Bi(t){let e,l,n,a,u,_,d,m,f,b,c,g,p,h,v,w,C,M,R,H,A,Y,I,$,T,z,U,ae,pe,he,ve,K=(t[0]>1||t[13].isCameraPreview)&&kl(t);function X(B){t[26](B)}let oe={show:t[8],loading:t[11],cameras:t[9],error:t[12]};t[10]!==void 0&&(oe.selectedIndex=t[10]),h=new ji({props:oe}),Ee.push(()=>ui(h,"selectedIndex",X)),h.$on("close",t[27]),h.$on("confirm",t[17]),h.$on("select",t[28]);let me=t[5]&&Cl(t),ie=t[0]===1&&Sl(t),re=t[0]===2&&Pl(t),de=t[0]===3&&zl(t);return{c(){e=r("div"),l=r("div"),n=r("div"),a=r("div"),u=r("h2"),u.textContent="Step Holder",_=k(),d=r("p"),m=V("Step "),f=V(t[0]),b=V(" di 3"),c=k(),K&&K.c(),g=k(),p=r("div"),Dt(h.$$.fragment),w=k(),me&&me.c(),C=k(),ie&&ie.c(),M=k(),re&&re.c(),R=k(),de&&de.c(),H=k(),A=r("div"),Y=r("div"),I=r("span"),I.textContent="Progresso",$=k(),T=r("span"),z=V(t[0]),U=V("/3"),ae=k(),pe=r("div"),he=r("div"),i(u,"class","text-lg sm:text-xl font-semibold text-white"),i(d,"class","text-purple-100 text-xs sm:text-sm mt-1"),i(d,"aria-live","polite"),i(n,"class","flex justify-between items-center gap-4"),i(l,"class","step-header bg-gradient-to-r from-purple-600 to-pink-600 px-4 sm:px-6 py-3 sm:py-4"),i(I,"class","text-xs text-slate-400"),i(T,"class","text-xs text-slate-400 font-medium"),i(Y,"class","flex justify-between items-center mb-2"),i(he,"class","bg-gradient-to-r from-purple-600 to-pink-600 h-2 rounded-full transition-all duration-300"),cl(he,"width",t[0]/3*100+"%"),i(he,"aria-hidden","true"),i(pe,"class","w-full bg-slate-700 rounded-full h-2 overflow-hidden"),i(A,"class","mt-6 sm:mt-8 pt-4 sm:pt-6 border-t border-slate-700"),i(A,"role","progressbar"),i(A,"aria-valuenow",t[0]),i(A,"aria-valuemin","1"),i(A,"aria-valuemax","3"),i(A,"aria-label","Progresso analisi"),i(p,"class","step-content p-3 sm:p-4 md:p-6 space-y-3 sm:space-y-4 md:space-y-6 flex-1 overflow-auto svelte-10imy5p"),i(e,"class","step-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 h-full flex flex-col"),i(e,"role","region"),i(e,"aria-label","Pannello controllo analisi")},m(B,S){L(B,e,S),s(e,l),s(l,n),s(n,a),s(a,u),s(a,_),s(a,d),s(d,m),s(d,f),s(d,b),s(n,c),K&&K.m(n,null),s(e,g),s(e,p),_t(h,p,null),s(p,w),me&&me.m(p,null),s(p,C),ie&&ie.m(p,null),s(p,M),re&&re.m(p,null),s(p,R),de&&de.m(p,null),s(p,H),s(p,A),s(A,Y),s(Y,I),s(Y,$),s(Y,T),s(T,z),s(T,U),s(A,ae),s(A,pe),s(pe,he),ve=!0},p(B,S){(!ve||S[0]&1)&&ce(f,B[0]),B[0]>1||B[13].isCameraPreview?K?K.p(B,S):(K=kl(B),K.c(),K.m(n,null)):K&&(K.d(1),K=null);const N={};S[0]&256&&(N.show=B[8]),S[0]&2048&&(N.loading=B[11]),S[0]&512&&(N.cameras=B[9]),S[0]&4096&&(N.error=B[12]),!v&&S[0]&1024&&(v=!0,N.selectedIndex=B[10],si(()=>v=!1)),h.$set(N),B[5]?me?me.p(B,S):(me=Cl(B),me.c(),me.m(p,C)):me&&(me.d(1),me=null),B[0]===1?ie?ie.p(B,S):(ie=Sl(B),ie.c(),ie.m(p,M)):ie&&(ie.d(1),ie=null),B[0]===2?re?re.p(B,S):(re=Pl(B),re.c(),re.m(p,R)):re&&(re.d(1),re=null),B[0]===3?de?de.p(B,S):(de=zl(B),de.c(),de.m(p,H)):de&&(de.d(1),de=null),(!ve||S[0]&1)&&ce(z,B[0]),(!ve||S[0]&1)&&cl(he,"width",B[0]/3*100+"%"),(!ve||S[0]&1)&&i(A,"aria-valuenow",B[0])},i(B){ve||(Ze(h.$$.fragment,B),ve=!0)},o(B){ot(h.$$.fragment,B),ve=!1},d(B){B&&j(e),K&&K.d(),yt(h),me&&me.d(),ie&&ie.d(),re&&re.d(),de&&de.d()}}}let jl=1,Ll="94822145f84207b6792a83e2d6708c9ce009153bcb34656647de4851ce80214f";function Ni(t,e,l){let n;Mt(t,ue,x=>l(13,n=x));let{currentStep:a=1}=e;const u=Ut();let _=null,d=!1,m=30,f=174,b=62,c="",g=!1,p=!1,h=!1,v=[],w=null,C=!1,M="",R="",H="",A=!1;async function Y(x){if(_=x.target.files[0],_){try{const y=URL.createObjectURL(_);bi(y)}catch{}Kt("upload"),await I()}}async function I(){if(!_)return;l(1,d=!0),l(5,c="");const x=new FormData;x.append("video",_);try{const P=await(await fetch(`${Ce()}/api/video/upload`,{method:"POST",body:x})).json();P.success?(l(2,m=Math.round(P.fps)||30),u("stepComplete",{step:1,data:P})):l(5,c=P.error||"Errore caricamento video")}catch{l(5,c="Errore di connessione al server")}finally{l(1,d=!1)}}async function $(){try{if(w!=null)try{await He.setCamera(Number(w))}catch{l(5,c="Errore impostazione fotocamera");return}try{Xt(n.previewStream)}catch{}qt(),Jt(!1);const x=await He.startRecording();x.success?ue.update(y=>({...y,isRecording:!0})):l(5,c=x.error||"Errore avvio registrazione")}catch{l(5,c="Errore di connessione al server")}}function T(){l(12,M=""),l(8,h=!0),z()}async function z(){l(11,C=!0),l(9,v=[]),l(10,w=null);try{const x=await Ti();x.length>0?(l(9,v=x),l(10,w=0)):l(12,M="Nessuna fotocamera trovata")}catch{l(12,M="Errore rilevamento fotocamere")}finally{l(11,C=!1)}}async function U(){if(l(12,M=""),w==null){l(12,M="Seleziona una fotocamera");return}try{l(8,h=!1);try{Xt(n.previewStream);const x=await Ai(Number(w),v);gi(x),Jt(!0),Kt("camera")}catch{l(12,M="Impossibile avviare l'anteprima fotocamera")}}catch{l(12,M="Errore apertura anteprima")}}async function ae(){try{const y=await(await fetch(`${Ce()}/api/recording/stop`,{method:"POST"})).json();y.success&&(ue.update(P=>({...P,isRecording:!1})),u("stepComplete",{step:1,data:y}))}catch{l(5,c="Errore stop registrazione")}}async function pe(){l(5,c="");try{const x=await fetch(`${Ce()}/api/video/info`).then(y=>y.json());if(!(x!=null&&x.video_path)){l(5,c="Nessun video disponibile: registra o carica prima il video.");return}}catch{l(5,c="Errore verifica video disponibile");return}try{const x=await He.startAnalysis();x.success?(l(7,p=!0),ue.update(y=>({...y,isAnalyzing:!0})),he()):l(5,c=x.error||"Errore avvio analisi")}catch{l(5,c="Errore di connessione")}}async function he(){const x=setInterval(async()=>{try{if(!(await He.analysisStatus()).is_analyzing){clearInterval(x);const P=await He.analysisResults();P.success&&(l(7,p=!1),ue.update(F=>({...F,isAnalyzing:!1})),u("stepComplete",{step:3,data:{...P.results,trajectory:P.trajectory,velocity:P.velocity,phase_times:P.phase_times}}))}}catch{}},500)}async function ve(){try{await fetch(`${Ce()}/api/analysis/pause`,{method:"POST"}),ue.update(x=>({...x,isPaused:!0}))}catch{}}async function K(){try{await fetch(`${Ce()}/api/analysis/resume`,{method:"POST"}),ue.update(x=>({...x,isPaused:!1}))}catch{}}async function X(){try{await fetch(`${Ce()}/api/analysis/stop`,{method:"POST"})}catch{}u("cancelToStep1")}function oe(){a===1&&n.isCameraPreview?me():u("goBack")}async function me(){try{Xt(n.previewStream)}catch{}qt(),Jt(!1),Kt("none"),l(10,w=null)}async function ie(){l(5,c="");try{await fetch(`${Ce()}/api/settings/fps`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fps:m})}),await fetch(`${Ce()}/api/settings/height`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:f})}),await fetch(`${Ce()}/api/settings/mass`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mass:b})})}catch{l(5,c="Errore impostazioni");return}try{const y=await(await fetch(`${Ce()}/api/calibration/start`,{method:"POST"})).json();y.success?(l(6,g=!0),ue.update(P=>({...P,isCalibrating:!0})),re()):l(5,c=y.error||"Errore calibrazione")}catch{l(5,c="Errore di connessione")}}async function re(){const x=setInterval(async()=>{try{const P=await(await fetch(`${Ce()}/api/calibration/status`)).json();P.success&&!P.in_progress?(clearInterval(x),l(6,g=!1),ue.update(F=>({...F,isCalibrating:!1})),u("stepComplete",{step:2,data:P}),await pe()):P.success===!1&&!P.in_progress&&(clearInterval(x),l(6,g=!1),ue.update(F=>({...F,isCalibrating:!1})),l(5,c="Calibrazione fallita"))}catch{clearInterval(x),l(6,g=!1),l(5,c="Errore verifica calibrazione")}},500)}async function de(){R="",H="";try{const x=await He.getPlayerData(Number(jl),Ll);x.success&&x.data?(l(3,f=x.data.height_cm||f),l(4,b=x.data.weight_kg||b),await He.setHeight(f),await He.setMass(b),x.data.name&&x.data.surname?H=`${x.data.name} ${x.data.surname}`:x.data.name&&(H=x.data.name)):R=x.error||"Errore nel caricamento dei dati del giocatore"}catch(x){R=`Errore: ${x.message}`}finally{}}function B(x){w=x,l(10,w)}const S=()=>l(8,h=!1),N=x=>l(10,w=x.detail.index),fe=x=>{var y,P;return x.key==="Enter"&&!d&&!n.isRecording&&((P=(y=x.currentTarget.closest("label"))==null?void 0:y.querySelector("input"))==null?void 0:P.click())};function J(){m=Ke(this.value),l(2,m)}function o(){f=Ke(this.value),l(3,f)}function se(){b=Ke(this.value),l(4,b)}return t.$$set=x=>{"currentStep"in x&&l(0,a=x.currentStep)},t.$$.update=()=>{t.$$.dirty[0]&33554433&&a===2&&!A&&jl&&Ll&&(l(25,A=!0),de()),t.$$.dirty[0]&1&&a!==2&&l(25,A=!1)},[a,d,m,f,b,c,g,p,h,v,w,C,M,n,Y,$,T,U,ae,pe,ve,K,X,oe,ie,A,B,S,N,fe,J,o,se]}class Hi extends xt{constructor(e){super(),wt(this,e,Ni,Bi,lt,{currentStep:0},null,[-1,-1])}}function Rl(t){let e,l,n,a,u,_;return{c(){e=r("div"),l=r("h3"),l.textContent="Traiettoria del Salto",n=k(),a=r("canvas"),i(l,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(a,"width","400"),i(a,"height","250"),i(a,"class","w-full rounded-lg cursor-pointer hover:opacity-90 focus:opacity-90 transition-opacity focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-900"),i(a,"role","button"),i(a,"tabindex","0"),i(a,"aria-label","Grafico traiettoria del salto. Clicca per ingrandire"),i(e,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(e,"role","region"),i(e,"aria-label","Grafico traiettoria")},m(d,m){L(d,e,m),s(e,l),s(e,n),s(e,a),t[16](a),u||(_=[Q(a,"click",t[17]),Q(a,"keydown",t[18])],u=!0)},p:Z,d(d){d&&j(e),t[16](null),u=!1,Me(_)}}}function Il(t){let e,l,n,a,u,_;return{c(){e=r("div"),l=r("h3"),l.textContent="Velocità nel Tempo",n=k(),a=r("canvas"),i(l,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(a,"width","400"),i(a,"height","250"),i(a,"class","w-full rounded-lg cursor-pointer hover:opacity-90 focus:opacity-90 transition-opacity focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-900"),i(a,"role","button"),i(a,"tabindex","0"),i(a,"aria-label","Grafico velocità nel tempo. Clicca per ingrandire"),i(e,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(e,"role","region"),i(e,"aria-label","Grafico velocità")},m(d,m){L(d,e,m),s(e,l),s(e,n),s(e,a),t[19](a),u||(_=[Q(a,"click",t[20]),Q(a,"keydown",t[21])],u=!0)},p:Z,d(d){d&&j(e),t[19](null),u=!1,Me(_)}}}function Fl(t){let e,l,n,a,u,_;return{c(){e=r("div"),l=r("h3"),l.textContent="Confronto Traiettoria e Velocità",n=k(),a=r("canvas"),i(l,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(a,"width","400"),i(a,"height","250"),i(a,"class","w-full rounded-lg cursor-pointer hover:opacity-90 focus:opacity-90 transition-opacity focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-900"),i(a,"role","button"),i(a,"tabindex","0"),i(a,"aria-label","Grafico confronto traiettoria e velocità. Clicca per ingrandire"),i(e,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(e,"role","region"),i(e,"aria-label","Grafico confronto")},m(d,m){L(d,e,m),s(e,l),s(e,n),s(e,a),t[22](a),u||(_=[Q(a,"click",t[23]),Q(a,"keydown",t[24])],u=!0)},p:Z,d(d){d&&j(e),t[22](null),u=!1,Me(_)}}}function Vl(t){let e,l,n;return{c(){e=r("div"),l=r("p"),n=V(t[11]),i(l,"class","text-blue-400 text-sm"),i(e,"class","bg-blue-500/10 border border-blue-500/50 rounded-lg p-3 sm:p-4"),i(e,"role","status"),i(e,"aria-live","polite")},m(a,u){L(a,e,u),s(e,l),s(l,n)},p(a,u){u[0]&2048&&ce(n,a[11])},d(a){a&&j(e)}}}function Ol(t){let e,l,n,a,u,_,d,m;function f(v,w){if(v[4]==="trajectory")return Yi;if(v[4]==="velocity")return Wi;if(v[4]==="combined")return Ui}let b=f(t),c=b&&b(t);function g(v,w){if(v[4]==="trajectory")return qi;if(v[4]==="velocity")return Ji;if(v[4]==="combined")return Gi}let p=g(t),h=p&&p(t);return{c(){e=r("div"),l=r("div"),n=r("button"),n.innerHTML='<svg class="w-5 sm:w-6 h-5 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',a=k(),u=r("h3"),c&&c.c(),_=k(),h&&h.c(),i(n,"class","absolute top-3 sm:top-4 right-3 sm:right-4 text-white hover:text-red-400 focus:text-red-400 transition-colors z-10 bg-slate-800 rounded-full p-2 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-slate-900"),i(n,"aria-label","Chiudi grafico a schermo intero"),i(u,"id","fullscreen-chart-title"),i(u,"class","text-base sm:text-lg font-semibold text-white mb-3 sm:mb-4 pr-10"),i(l,"class","relative bg-slate-900 rounded-xl p-4 sm:p-6 max-w-[95vw] max-h-[95vh] overflow-auto z-10 shadow-2xl border border-slate-700"),i(e,"class","fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4"),i(e,"role","dialog"),i(e,"aria-modal","true"),i(e,"aria-labelledby","fullscreen-chart-title")},m(v,w){L(v,e,w),s(e,l),s(l,n),s(l,a),s(l,u),c&&c.m(u,null),s(l,_),h&&h.m(l,null),d||(m=[Q(n,"click",t[13]),Q(e,"click",rl(t[13])),Q(e,"keydown",t[28])],d=!0)},p(v,w){b!==(b=f(v))&&(c&&c.d(1),c=b&&b(v),c&&(c.c(),c.m(u,null))),p===(p=g(v))&&h?h.p(v,w):(h&&h.d(1),h=p&&p(v),h&&(h.c(),h.m(l,null)))},d(v){v&&j(e),c&&c.d(),h&&h.d(),d=!1,Me(m)}}}function Ui(t){let e;return{c(){e=V("Confronto Traiettoria e Velocità")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function Wi(t){let e;return{c(){e=V("Velocità nel Tempo")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function Yi(t){let e;return{c(){e=V("Traiettoria del Salto")},m(l,n){L(l,e,n)},d(l){l&&j(e)}}}function Gi(t){let e;return{c(){e=r("canvas"),i(e,"class","rounded-lg")},m(l,n){L(l,e,n),t[27](e)},p:Z,d(l){l&&j(e),t[27](null)}}}function Ji(t){let e;return{c(){e=r("canvas"),i(e,"class","rounded-lg")},m(l,n){L(l,e,n),t[26](e)},p:Z,d(l){l&&j(e),t[26](null)}}}function qi(t){let e;return{c(){e=r("canvas"),i(e,"class","rounded-lg")},m(l,n){L(l,e,n),t[25](e)},p:Z,d(l){l&&j(e),t[25](null)}}}function Ki(t){let e,l,n,a,u,_,d,m,f,b,c,g,p=t[0].max_height+"",h,v,w,C,M,R,H,A=t[0].flight_time+"",Y,I,$,T,z,U,ae,pe=(t[0].calculated_takeoff_velocity||t[0].takeoff_velocity||0)+"",he,ve,K,X,oe,me,ie,re=(t[0].calculated_estimated_power||t[0].estimated_power||0)+"",de,B,S,N,fe,J,o,se,x,y,P,F=(t[0].calculated_contact_time||t[0].contact_time||0)+"",q,xe,le,be,ee,ne,_e,W=(t[0].calculated_eccentric_time||t[0].eccentric_time||0)+"",O,E,te,Se,ze,kt,Ue,ft=(t[0].calculated_concentric_time||t[0].concentric_time||0)+"",We,Qe,Ct,Be,Ye,St,Pe,D=t[0].fall_time+"",ge,ke,Ae,ye,Ge,ut,$e,et,jt,Hl,dt,Lt=(t[0].calculated_average_force||t[0].average_force||0)+"",Qt,Ul,Wl,tt,Rt,Yl,mt,It=t[0].jump_detected?"Sì":"No",$t,Ft,Gl,el,tl,ll,il,pt,Ve,Je,ht,Jl,Vt=t[10]?"Salvataggio...":"Salva Risultati",nl,Ot,ql,bt,Kl,al,Xl,De=t[9].trajectoryData.length>0&&Rl(t),je=t[8].length>0&&Il(t),Le=t[9].trajectoryData.length>0&&t[8].length>0&&Fl(t),Re=t[11]&&Vl(t),Ie=t[4]&&Ol(t);return{c(){e=r("div"),l=r("div"),l.innerHTML='<h2 class="text-lg sm:text-xl font-semibold text-white">Risultati Analisi</h2> <p class="text-green-100 text-xs sm:text-sm mt-1">Analisi completata con successo</p>',n=k(),a=r("div"),u=r("div"),_=r("h3"),_.textContent="Metriche Principali",d=k(),m=r("div"),f=r("div"),b=r("p"),b.textContent="Altezza Max",c=k(),g=r("p"),h=V(p),v=V(" cm"),w=k(),C=r("div"),M=r("p"),M.textContent="Tempo di Volo",R=k(),H=r("p"),Y=V(A),I=V(" s"),$=k(),T=r("div"),z=r("p"),z.textContent="Velocità Decollo",U=k(),ae=r("p"),he=V(pe),ve=V(" cm/s"),K=k(),X=r("div"),oe=r("p"),oe.textContent="Potenza Est.",me=k(),ie=r("p"),de=V(re),B=V(" W"),S=k(),N=r("div"),fe=r("h3"),fe.textContent="Analisi Fasi",J=k(),o=r("div"),se=r("div"),x=r("span"),x.textContent="Tempo Contatto",y=k(),P=r("span"),q=V(F),xe=V(" s"),le=k(),be=r("div"),ee=r("span"),ee.textContent="Fase Eccentrica",ne=k(),_e=r("span"),O=V(W),E=V(" s"),te=k(),Se=r("div"),ze=r("span"),ze.textContent="Fase Concentrica",kt=k(),Ue=r("span"),We=V(ft),Qe=V(" s"),Ct=k(),Be=r("div"),Ye=r("span"),Ye.textContent="Tempo Caduta",St=k(),Pe=r("span"),ge=V(D),ke=V(" s"),Ae=k(),ye=r("div"),Ge=r("h3"),Ge.textContent="Parametri Biomeccanici",ut=k(),$e=r("div"),et=r("div"),jt=r("span"),jt.textContent="Forza Media",Hl=k(),dt=r("span"),Qt=V(Lt),Ul=V(" N"),Wl=k(),tt=r("div"),Rt=r("span"),Rt.textContent="Salto Rilevato",Yl=k(),mt=r("span"),$t=V(It),Gl=k(),De&&De.c(),el=k(),je&&je.c(),tl=k(),Le&&Le.c(),ll=k(),Re&&Re.c(),il=k(),pt=r("div"),Ve=r("button"),Je=it("svg"),ht=it("path"),Jl=k(),nl=V(Vt),ql=k(),bt=r("button"),bt.innerHTML=`<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        Nuova Analisi`,Kl=k(),Ie&&Ie.c(),i(l,"class","results-header bg-gradient-to-r from-green-600 to-teal-600 px-4 sm:px-6 py-3 sm:py-4"),i(_,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(b,"class","text-xs text-slate-400 mb-1"),i(g,"class","text-xl sm:text-2xl font-bold text-green-400"),i(g,"aria-live","polite"),i(f,"role","listitem"),i(M,"class","text-xs text-slate-400 mb-1"),i(H,"class","text-xl sm:text-2xl font-bold text-blue-400"),i(H,"aria-live","polite"),i(C,"role","listitem"),i(z,"class","text-xs text-slate-400 mb-1"),i(ae,"class","text-xl sm:text-2xl font-bold text-purple-400"),i(ae,"aria-live","polite"),i(T,"role","listitem"),i(oe,"class","text-xs text-slate-400 mb-1"),i(ie,"class","text-xl sm:text-2xl font-bold text-yellow-400"),i(ie,"aria-live","polite"),i(X,"role","listitem"),i(m,"class","grid grid-cols-2 gap-3 sm:gap-4"),i(m,"role","list"),i(u,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(u,"role","region"),i(u,"aria-label","Metriche principali"),i(fe,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(x,"class","text-xs sm:text-sm text-slate-400"),i(P,"class","text-base sm:text-lg font-semibold text-white"),i(P,"aria-live","polite"),i(se,"class","flex justify-between items-center"),i(se,"role","listitem"),i(ee,"class","text-xs sm:text-sm text-slate-400"),i(_e,"class","text-base sm:text-lg font-semibold text-white"),i(_e,"aria-live","polite"),i(be,"class","flex justify-between items-center"),i(be,"role","listitem"),i(ze,"class","text-xs sm:text-sm text-slate-400"),i(Ue,"class","text-base sm:text-lg font-semibold text-white"),i(Ue,"aria-live","polite"),i(Se,"class","flex justify-between items-center"),i(Se,"role","listitem"),i(Ye,"class","text-xs sm:text-sm text-slate-400"),i(Pe,"class","text-base sm:text-lg font-semibold text-white"),i(Pe,"aria-live","polite"),i(Be,"class","flex justify-between items-center"),i(Be,"role","listitem"),i(o,"class","space-y-2.5 sm:space-y-3"),i(o,"role","list"),i(N,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(N,"role","region"),i(N,"aria-label","Analisi fasi"),i(Ge,"class","text-xs sm:text-sm font-semibold text-slate-300 uppercase tracking-wide mb-3 sm:mb-4"),i(jt,"class","text-xs sm:text-sm text-slate-400"),i(dt,"class","text-base sm:text-lg font-semibold text-white"),i(dt,"aria-live","polite"),i(et,"class","flex justify-between items-center"),i(et,"role","listitem"),i(Rt,"class","text-xs sm:text-sm text-slate-400"),i(mt,"class",Ft="text-base sm:text-lg font-semibold "+(t[0].jump_detected?"text-green-400":"text-red-400")),i(mt,"aria-live","polite"),i(tt,"class","flex justify-between items-center"),i(tt,"role","listitem"),i($e,"class","space-y-2.5 sm:space-y-3"),i($e,"role","list"),i(ye,"class","bg-slate-900/50 rounded-xl p-4 sm:p-5 border border-slate-700"),i(ye,"role","region"),i(ye,"aria-label","Parametri biomeccanici"),i(ht,"stroke-linecap","round"),i(ht,"stroke-linejoin","round"),i(ht,"stroke-width","2"),i(ht,"d","M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"),i(Je,"class","w-5 h-5 inline mr-2"),i(Je,"fill","none"),i(Je,"stroke","currentColor"),i(Je,"viewBox","0 0 24 24"),i(Je,"aria-hidden","true"),Ve.disabled=t[10],i(Ve,"class","flex-1 bg-gradient-to-r from-green-600 to-teal-600 text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg font-semibold hover:from-green-700 hover:to-teal-700 focus:from-green-700 focus:to-teal-700 transition-all duration-200 shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-slate-800 disabled:opacity-50 disabled:cursor-not-allowed"),i(Ve,"aria-label",Ot=t[10]?"Salvataggio in corso":"Salva risultati analisi"),i(bt,"class","flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 focus:from-blue-700 focus:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-800"),i(bt,"aria-label","Avvia una nuova analisi"),i(pt,"class","flex flex-col sm:flex-row gap-2 sm:gap-3 pt-3 sm:pt-4"),i(a,"class","results-content p-4 sm:p-6 space-y-4 sm:space-y-6 flex-1 overflow-auto svelte-dxhq61"),i(e,"class","results-container bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700 h-full flex flex-col"),i(e,"role","region"),i(e,"aria-label","Risultati analisi salto")},m(G,we){L(G,e,we),s(e,l),s(e,n),s(e,a),s(a,u),s(u,_),s(u,d),s(u,m),s(m,f),s(f,b),s(f,c),s(f,g),s(g,h),s(g,v),s(m,w),s(m,C),s(C,M),s(C,R),s(C,H),s(H,Y),s(H,I),s(m,$),s(m,T),s(T,z),s(T,U),s(T,ae),s(ae,he),s(ae,ve),s(m,K),s(m,X),s(X,oe),s(X,me),s(X,ie),s(ie,de),s(ie,B),s(a,S),s(a,N),s(N,fe),s(N,J),s(N,o),s(o,se),s(se,x),s(se,y),s(se,P),s(P,q),s(P,xe),s(o,le),s(o,be),s(be,ee),s(be,ne),s(be,_e),s(_e,O),s(_e,E),s(o,te),s(o,Se),s(Se,ze),s(Se,kt),s(Se,Ue),s(Ue,We),s(Ue,Qe),s(o,Ct),s(o,Be),s(Be,Ye),s(Be,St),s(Be,Pe),s(Pe,ge),s(Pe,ke),s(a,Ae),s(a,ye),s(ye,Ge),s(ye,ut),s(ye,$e),s($e,et),s(et,jt),s(et,Hl),s(et,dt),s(dt,Qt),s(dt,Ul),s($e,Wl),s($e,tt),s(tt,Rt),s(tt,Yl),s(tt,mt),s(mt,$t),s(a,Gl),De&&De.m(a,null),s(a,el),je&&je.m(a,null),s(a,tl),Le&&Le.m(a,null),s(a,ll),Re&&Re.m(a,null),s(a,il),s(a,pt),s(pt,Ve),s(Ve,Je),s(Je,ht),s(Ve,Jl),s(Ve,nl),s(pt,ql),s(pt,bt),s(e,Kl),Ie&&Ie.m(e,null),al||(Xl=[Q(Ve,"click",t[15]),Q(bt,"click",t[14])],al=!0)},p(G,we){we[0]&1&&p!==(p=G[0].max_height+"")&&ce(h,p),we[0]&1&&A!==(A=G[0].flight_time+"")&&ce(Y,A),we[0]&1&&pe!==(pe=(G[0].calculated_takeoff_velocity||G[0].takeoff_velocity||0)+"")&&ce(he,pe),we[0]&1&&re!==(re=(G[0].calculated_estimated_power||G[0].estimated_power||0)+"")&&ce(de,re),we[0]&1&&F!==(F=(G[0].calculated_contact_time||G[0].contact_time||0)+"")&&ce(q,F),we[0]&1&&W!==(W=(G[0].calculated_eccentric_time||G[0].eccentric_time||0)+"")&&ce(O,W),we[0]&1&&ft!==(ft=(G[0].calculated_concentric_time||G[0].concentric_time||0)+"")&&ce(We,ft),we[0]&1&&D!==(D=G[0].fall_time+"")&&ce(ge,D),we[0]&1&&Lt!==(Lt=(G[0].calculated_average_force||G[0].average_force||0)+"")&&ce(Qt,Lt),we[0]&1&&It!==(It=G[0].jump_detected?"Sì":"No")&&ce($t,It),we[0]&1&&Ft!==(Ft="text-base sm:text-lg font-semibold "+(G[0].jump_detected?"text-green-400":"text-red-400"))&&i(mt,"class",Ft),G[9].trajectoryData.length>0?De?De.p(G,we):(De=Rl(G),De.c(),De.m(a,el)):De&&(De.d(1),De=null),G[8].length>0?je?je.p(G,we):(je=Il(G),je.c(),je.m(a,tl)):je&&(je.d(1),je=null),G[9].trajectoryData.length>0&&G[8].length>0?Le?Le.p(G,we):(Le=Fl(G),Le.c(),Le.m(a,ll)):Le&&(Le.d(1),Le=null),G[11]?Re?Re.p(G,we):(Re=Vl(G),Re.c(),Re.m(a,il)):Re&&(Re.d(1),Re=null),we[0]&1024&&Vt!==(Vt=G[10]?"Salvataggio...":"Salva Risultati")&&ce(nl,Vt),we[0]&1024&&(Ve.disabled=G[10]),we[0]&1024&&Ot!==(Ot=G[10]?"Salvataggio in corso":"Salva risultati analisi")&&i(Ve,"aria-label",Ot),G[4]?Ie?Ie.p(G,we):(Ie=Ol(G),Ie.c(),Ie.m(e,null)):Ie&&(Ie.d(1),Ie=null)},i:Z,o:Z,d(G){G&&j(e),De&&De.d(),je&&je.d(),Le&&Le.d(),Re&&Re.d(),Ie&&Ie.d(),al=!1,Me(Xl)}}}const Fe=5;function ct(t,e){const l=t.getContext("2d");l.clearRect(0,0,t.width,t.height),l.fillStyle=e,l.fillRect(0,0,t.width,t.height)}function Zt(t,{padding:e,width:l,height:n,chartWidth:a,chartHeight:u,minT:_,deltaT:d,minY:m,deltaY:f,style:b,xFormatter:c,yFormatter:g,invertYLabel:p=!0,rightSideLabels:h=!1}){t.strokeStyle=b.axis,t.lineWidth=2,t.beginPath(),t.moveTo(e,e),t.lineTo(e,n-e),t.lineTo(l-e,n-e),t.stroke(),t.strokeStyle=b.grid,t.lineWidth=1,t.fillStyle=b.label,t.font="11px sans-serif",t.textBaseline="middle";for(let v=0;v<=Fe;v++){const w=v/Fe,C=e+u*w,M=p?m+f*(Fe-v)/Fe:m+f*v/Fe;t.beginPath(),t.moveTo(e,C),t.lineTo(l-e,C),t.stroke();const R=g(M),H=h?l-e+12:e-12,A=h?"left":"right";t.textAlign=A,t.fillText(R,H,C)}t.textAlign="center",t.textBaseline="top";for(let v=0;v<=Fe;v++){const w=v/Fe,C=e+a*w,M=_+d*w;t.beginPath(),t.moveTo(C,e),t.lineTo(C,n-e),t.stroke();const R=c(M);t.fillText(R,C,n-e+12)}}function Bl(t,{width:e,height:l,padding:n,xText:a,yText:u,style:_}){t.fillStyle=_.label,t.font="12px sans-serif",t.textAlign="center",t.textBaseline="alphabetic",t.fillText(a,e/2,l-18),t.save(),t.translate(20,l/2),t.rotate(-Math.PI/2),t.textAlign="center",t.fillText(u,0,0),t.restore()}function Xi(t,e,{padding:l,height:n,minV:a,deltaV:u,chartHeight:_,style:d}){if(e.length<2)return;const m=e[0].x,f=e[e.length-1].x,b=(0-a)/u,c=n-l-b*_;t.save(),t.beginPath(),t.moveTo(m,n-l),e.forEach(g=>t.lineTo(g.x,g.y)),t.lineTo(f,n-l),t.closePath(),t.clip(),b<=0?(t.fillStyle=d.fillAbove,t.fillRect(m,l,f-m,n-l)):b>=1?(t.fillStyle=d.fillBelow,t.fillRect(m,l,f-m,n-l)):(t.fillStyle=d.fillAbove,t.fillRect(m,l,f-m,c-l),t.fillStyle=d.fillBelow,t.fillRect(m,c,f-m,n-l-(c-l))),t.restore()}function Zi(t,e,l){let n;Mt(t,ue,S=>l(9,n=S));let{results:a}=e;const u=Ut();let _,d,m,f=null,b,c,g,p=[],h=null;const v={background:"#0f172a",grid:"#233044",axis:"#3c4b63",line:"#38bdf8",lineShadow:"rgba(56, 189, 248, 0.35)",fill:"rgba(56, 189, 248, 0.18)",label:"#94a3b8",zero:"#64748b"},w={background:"#121e33",grid:"#24324a",axis:"#3f4d66",line:"#c084fc",lineShadow:"rgba(192, 132, 252, 0.35)",fillAbove:"rgba(192, 132, 252, 0.18)",fillBelow:"rgba(148, 163, 184, 0.12)",label:"#a5b4fc",zero:"#64748b"};Nt(()=>{_&&n.trajectoryData.length>0&&C(),d&&p.length>0&&M(),window.addEventListener("keydown",Y)}),Ht(()=>{window.removeEventListener("keydown",Y)});function C(S=null,N=null,fe=null){const J=S||_;if(!J)return;const o=J.getContext("2d"),se=N||J.width,x=fe||J.height;N&&(J.width=N),fe&&(J.height=fe);const y=52,P=se-2*y,F=x-2*y;ct(J,v.background);const q=n.trajectoryData;if(q.length===0)return;const xe=Math.max(...q.map(O=>O.t)),le=Math.min(...q.map(O=>O.t)),be=Math.max(...q.map(O=>O.y)),ee=Math.min(...q.map(O=>O.y)),ne=xe===le?1:xe-le,_e=be===ee?1:be-ee,W=h;if(Zt(o,{padding:y,width:se,height:x,chartWidth:P,chartHeight:F,minT:le,deltaT:ne,minY:ee,deltaY:_e,style:v,xFormatter:O=>O.toFixed(2),yFormatter:O=>O.toFixed(1)}),ee<=0&&be>=0){const O=x-y-(0-ee)/_e*F;o.strokeStyle=v.zero,o.setLineDash([6,6]),o.beginPath(),o.moveTo(y,O),o.lineTo(se-y,O),o.stroke(),o.setLineDash([])}if(h){if(W.eccentricStart!==null&&W.eccentricEnd!==null){const O=y+(W.eccentricStart-le)/ne*P,E=y+(W.eccentricEnd-le)/ne*P;o.fillStyle="rgba(255, 165, 0, 0.15)",o.fillRect(O,y,E-O,F)}if(W.concentricStart!==null&&W.concentricEnd!==null){const O=y+(W.concentricStart-le)/ne*P,E=y+(W.concentricEnd-le)/ne*P;o.fillStyle="rgba(0, 255, 0, 0.15)",o.fillRect(O,y,E-O,F)}}if(o.lineWidth=3,o.strokeStyle=v.line,o.lineJoin="round",o.lineCap="round",o.shadowColor=v.lineShadow,o.shadowBlur=12,o.beginPath(),q.forEach((O,E)=>{const te=y+(O.t-le)/ne*P,Se=x-y-(O.y-ee)/_e*F;E===0?o.moveTo(te,Se):o.lineTo(te,Se)}),o.stroke(),o.shadowBlur=0,o.lineTo(y+P,x-y),o.lineTo(y,x-y),o.closePath(),o.fillStyle=v.fill,o.fill(),o.fillStyle=v.line,q.forEach((O,E)=>{if(E%Math.max(1,Math.floor(q.length/25))===0||E===q.length-1){const te=y+(O.t-le)/ne*P,Se=x-y-(O.y-ee)/_e*F;o.beginPath(),o.arc(te,Se,3,0,Math.PI*2),o.fill()}}),W){const O={contact:"rgba(255, 255, 0, 0.7)",eccentric:"rgba(255, 165, 0, 0.7)",takeoff:"rgba(255, 0, 0, 0.7)"};if(W.contactStart!==null){const E=y+(W.contactStart-le)/ne*P;o.strokeStyle=O.contact,o.lineWidth=2,o.setLineDash([4,4]),o.beginPath(),o.moveTo(E,y),o.lineTo(E,x-y),o.stroke(),o.setLineDash([]),o.fillStyle=O.contact,o.font="10px sans-serif",o.textAlign="center",o.textBaseline="top",o.fillText("Inizio Contatto",E,y+2)}if(W.eccentricEnd!==null){const E=y+(W.eccentricEnd-le)/ne*P;o.strokeStyle=O.eccentric,o.lineWidth=2,o.setLineDash([4,4]),o.beginPath(),o.moveTo(E,y),o.lineTo(E,x-y),o.stroke(),o.setLineDash([]),o.fillStyle=O.eccentric,o.font="10px sans-serif",o.textAlign="center",o.textBaseline="top",o.fillText("Fine Eccentrica",E,y+14)}if(W.takeoff!==null){const E=y+(W.takeoff-le)/ne*P;o.strokeStyle=O.takeoff,o.lineWidth=2,o.setLineDash([4,4]),o.beginPath(),o.moveTo(E,y),o.lineTo(E,x-y),o.stroke(),o.setLineDash([]),o.fillStyle=O.takeoff,o.font="10px sans-serif",o.textAlign="center",o.textBaseline="top",o.fillText("Decollo",E,y+26)}}Bl(o,{width:se,height:x,padding:y,xText:"Tempo (s)",yText:"Altezza (cm)",style:v})}function M(S=null,N=null,fe=null){const J=S||d;if(!J)return;const o=J.getContext("2d"),se=N||J.width,x=fe||J.height;N&&(J.width=N),fe&&(J.height=fe);const y=52,P=se-2*y,F=x-2*y;ct(J,w.background);const q=p;if(q.length===0)return;const xe=Math.max(...q.map(E=>E.t)),le=Math.min(...q.map(E=>E.t)),be=Math.max(...q.map(E=>E.v)),ee=Math.min(...q.map(E=>E.v)),ne=xe===le?1:xe-le,_e=be===ee?Math.abs(be)||1:be-ee,W=h;if(Zt(o,{padding:y,width:se,height:x,chartWidth:P,chartHeight:F,minT:le,deltaT:ne,minY:ee,deltaY:_e,style:w,xFormatter:E=>E.toFixed(2),yFormatter:E=>E.toFixed(1),invertYLabel:!0,rightSideLabels:!0}),ee<=0&&be>=0){const E=x-y-(0-ee)/_e*F;o.strokeStyle=w.zero,o.setLineDash([6,6]),o.beginPath(),o.moveTo(y,E),o.lineTo(se-y,E),o.stroke(),o.setLineDash([])}if(h){if(W.eccentricStart!==null&&W.eccentricEnd!==null){const E=y+(W.eccentricStart-le)/ne*P,te=y+(W.eccentricEnd-le)/ne*P;o.fillStyle="rgba(255, 165, 0, 0.15)",o.fillRect(E,y,te-E,F)}if(W.concentricStart!==null&&W.concentricEnd!==null){const E=y+(W.concentricStart-le)/ne*P,te=y+(W.concentricEnd-le)/ne*P;o.fillStyle="rgba(0, 255, 0, 0.15)",o.fillRect(E,y,te-E,F)}}o.lineWidth=3,o.strokeStyle=w.line,o.lineJoin="round",o.lineCap="round",o.shadowColor=w.lineShadow,o.shadowBlur=12;const O=[];if(o.beginPath(),q.forEach((E,te)=>{const Se=y+(E.t-le)/ne*P,ze=x-y-(E.v-ee)/_e*F;O.push({x:Se,y:ze}),te===0?o.moveTo(Se,ze):o.lineTo(Se,ze)}),o.stroke(),o.shadowBlur=0,Xi(o,O,{padding:y,height:x,minV:ee,deltaV:_e,chartHeight:F,style:w}),o.fillStyle=w.line,O.forEach((E,te)=>{(te%Math.max(1,Math.floor(O.length/25))===0||te===O.length-1)&&(o.beginPath(),o.arc(E.x,E.y,3,0,Math.PI*2),o.fill())}),W){const E={contact:"rgba(255, 255, 0, 0.7)",eccentric:"rgba(255, 165, 0, 0.7)",takeoff:"rgba(255, 0, 0, 0.7)"};if(W.contactStart!==null){const te=y+(W.contactStart-le)/ne*P;o.strokeStyle=E.contact,o.lineWidth=2,o.setLineDash([4,4]),o.beginPath(),o.moveTo(te,y),o.lineTo(te,x-y),o.stroke(),o.setLineDash([]),o.fillStyle=E.contact,o.font="10px sans-serif",o.textAlign="center",o.textBaseline="top",o.fillText("Inizio Contatto",te,y+2)}if(W.eccentricEnd!==null){const te=y+(W.eccentricEnd-le)/ne*P;o.strokeStyle=E.eccentric,o.lineWidth=2,o.setLineDash([4,4]),o.beginPath(),o.moveTo(te,y),o.lineTo(te,x-y),o.stroke(),o.setLineDash([]),o.fillStyle=E.eccentric,o.font="10px sans-serif",o.textAlign="center",o.textBaseline="top",o.fillText("Fine Eccentrica",te,y+14)}if(W.takeoff!==null){const te=y+(W.takeoff-le)/ne*P;o.strokeStyle=E.takeoff,o.lineWidth=2,o.setLineDash([4,4]),o.beginPath(),o.moveTo(te,y),o.lineTo(te,x-y),o.stroke(),o.setLineDash([]),o.fillStyle=E.takeoff,o.font="10px sans-serif",o.textAlign="center",o.textBaseline="top",o.fillText("Decollo",te,y+26)}}Bl(o,{width:se,height:x,padding:y,xText:"Tempo (s)",yText:"Velocità (cm/s)",style:w})}function R(S=null,N=null,fe=null){const J=S||m;if(!J)return;const o=J.getContext("2d"),se=N||J.width,x=fe||J.height;N&&(J.width=N),fe&&(J.height=fe);const y=52,P=se-2*y,F=x-2*y;ct(J,v.background);const q=n.trajectoryData,xe=p;if(q.length===0||xe.length===0)return;const le=[...q.map(D=>D.t),...xe.map(D=>D.t)],be=Math.max(...le),ee=Math.min(...le),ne=be===ee?1:be-ee,_e=Math.max(...q.map(D=>D.y)),W=Math.min(...q.map(D=>D.y)),O=Math.max(...xe.map(D=>D.v)),E=Math.min(...xe.map(D=>D.v));let te=W,Se=_e,ze=E,kt=O;const Ue=_e-W||1,ft=O-E||1,We=W<0||_e<0?Math.abs(W)/Ue:0,Qe=E<0||O<0?Math.abs(E)/ft:0;Qe>We?te=-(Qe*_e)/(1-Qe):We>Qe&&(ze=-(We*O)/(1-We));const Ct=Se-te,Be=kt-ze,Ye=D=>typeof D!="number"||!isFinite(D)?0:(D-te)/Ct,St=D=>typeof D!="number"||!isFinite(D)?0:(D-ze)/Be,Pe=h;Zt(o,{padding:y,width:se,height:x,chartWidth:P,chartHeight:F,minT:ee,deltaT:ne,minY:te,deltaY:Ct,style:v,xFormatter:D=>D.toFixed(2),yFormatter:D=>D.toFixed(1)}),o.strokeStyle=w.grid,o.lineWidth=1,o.fillStyle=w.label,o.font="11px sans-serif",o.textBaseline="middle",o.textAlign="left";for(let D=0;D<=Fe;D++){const ge=D/Fe,ke=y+F*ge,ye=(ze+Be*(Fe-D)/Fe).toFixed(1);o.fillText(ye,se-y+12,ke)}if(te<=0&&Se>=0||ze<=0&&kt>=0){const D=x-y-Ye(0)*F;D>=y&&D<=x-y&&(o.strokeStyle="#AAAAAA",o.lineWidth=1.5,o.setLineDash([6,4]),o.beginPath(),o.moveTo(y,D),o.lineTo(se-y,D),o.stroke(),o.setLineDash([]))}if(h){const D=(ge,ke,Ae)=>{if(ge!==null&&ke!==null){const ye=y+(ge-ee)/ne*P,Ge=y+(ke-ee)/ne*P;o.fillStyle=Ae,o.fillRect(ye,y,Ge-ye,F)}};D(Pe.eccentricStart,Pe.eccentricEnd,"rgba(255, 165, 0, 0.15)"),D(Pe.concentricStart,Pe.concentricEnd,"rgba(0, 255, 0, 0.15)")}if(o.lineWidth=3,o.strokeStyle=v.line,o.lineJoin="round",o.lineCap="round",o.shadowColor=v.lineShadow,o.shadowBlur=12,o.beginPath(),q.forEach((D,ge)=>{const ke=y+(D.t-ee)/ne*P,Ae=D&&typeof D.y=="number"?D.y:0,ye=x-y-Ye(Ae)*F;ge===0?o.moveTo(ke,ye):o.lineTo(ke,ye)}),o.stroke(),o.shadowBlur=0,o.lineWidth=3,o.strokeStyle=w.line,o.shadowColor=w.lineShadow,o.shadowBlur=12,o.beginPath(),xe.forEach((D,ge)=>{const ke=y+(D.t-ee)/ne*P,Ae=x-y-St(D.v)*F;ge===0?o.moveTo(ke,Ae):o.lineTo(ke,Ae)}),o.stroke(),o.shadowBlur=0,o.fillStyle=v.line,q.forEach((D,ge)=>{if(ge%Math.max(1,Math.floor(q.length/25))===0||ge===q.length-1){const ke=y+(D.t-ee)/ne*P,Ae=D&&typeof D.y=="number"?D.y:0,ye=x-y-Ye(Ae)*F;o.beginPath(),o.arc(ke,ye,3,0,Math.PI*2),o.fill()}}),o.fillStyle=w.line,xe.forEach((D,ge)=>{if(ge%Math.max(1,Math.floor(xe.length/25))===0||ge===xe.length-1){const ke=y+(D.t-ee)/ne*P,Ae=x-y-St(D.v)*F;o.beginPath(),o.arc(ke,Ae,3,0,Math.PI*2),o.fill()}}),Pe){const D=(ke,Ae,ye,Ge)=>{if(ke!==null){const ut=y+(ke-ee)/ne*P;o.strokeStyle=ye,o.lineWidth=2,o.setLineDash([4,4]),o.beginPath(),o.moveTo(ut,y),o.lineTo(ut,x-y),o.stroke(),o.setLineDash([]),o.fillStyle=ye,o.font="10px sans-serif",o.textAlign="center",o.textBaseline="top",o.fillText(Ae,ut,y+Ge)}},ge={contact:"rgba(255, 255, 0, 0.7)",eccentric:"rgba(255, 165, 0, 0.7)",takeoff:"rgba(255, 0, 0, 0.7)"};D(Pe.contactStart,"Inizio Contatto",ge.contact,2),D(Pe.eccentricEnd,"Fine Eccentrica",ge.eccentric,14),D(Pe.takeoff,"Decollo",ge.takeoff,26)}o.fillStyle=v.label,o.font="12px sans-serif",o.textAlign="center",o.textBaseline="alphabetic",o.fillText("Tempo (s)",se/2,x-18),o.save(),o.translate(20,x/2),o.rotate(-Math.PI/2),o.textAlign="center",o.fillStyle=v.label,o.fillText("Altezza (cm)",0,0),o.restore(),o.save(),o.translate(se-20,x/2),o.rotate(-Math.PI/2),o.textAlign="center",o.fillStyle=w.label,o.fillText("Velocità (cm/s)",0,0),o.restore()}function H(S){l(4,f=S),setTimeout(()=>{const N=Math.floor(window.innerWidth*.9),fe=Math.floor(window.innerHeight*.8);S==="trajectory"&&b?C(b,N,fe):S==="velocity"&&c?M(c,N,fe):S==="combined"&&g&&R(g,N,fe)},100)}function A(){l(4,f=null)}function Y(S){S.key==="Escape"&&f&&A()}function I(){u("reset")}let $=!1,T="";async function z(){l(10,$=!0),l(11,T="");try{const N=await(await fetch(`${Ce()}/api/results/save`,{method:"POST"})).json();N.success?l(11,T="Risultati salvati con successo!"):l(11,T=N.error||"Errore durante il salvataggio")}catch{l(11,T="Errore di connessione al server")}finally{l(10,$=!1)}}function U(S){Ee[S?"unshift":"push"](()=>{_=S,l(1,_)})}const ae=()=>H("trajectory"),pe=S=>(S.key==="Enter"||S.key===" ")&&H("trajectory");function he(S){Ee[S?"unshift":"push"](()=>{d=S,l(2,d)})}const ve=()=>H("velocity"),K=S=>(S.key==="Enter"||S.key===" ")&&H("velocity");function X(S){Ee[S?"unshift":"push"](()=>{m=S,l(3,m)})}const oe=()=>H("combined"),me=S=>(S.key==="Enter"||S.key===" ")&&H("combined");function ie(S){Ee[S?"unshift":"push"](()=>{b=S,l(5,b)})}function re(S){Ee[S?"unshift":"push"](()=>{c=S,l(6,c)})}function de(S){Ee[S?"unshift":"push"](()=>{g=S,l(7,g)})}const B=S=>S.key==="Escape"&&A();return t.$$set=S=>{"results"in S&&l(0,a=S.results)},t.$$.update=()=>{if(t.$$.dirty[0]&1&&a&&(l(8,p=a.velocity||[]),h=a.phase_times||null,a.trajectory&&$l(ue,n.trajectoryData=a.trajectory,n)),t.$$.dirty[0]&514&&_&&(n.trajectoryData.length>0?C():ct(_,v.background)),t.$$.dirty[0]&260&&d&&(p.length>0?M():ct(d,w.background)),t.$$.dirty[0]&776&&m&&(n.trajectoryData.length>0&&p.length>0?R():ct(m,v.background)),t.$$.dirty[0]&560&&f==="trajectory"&&b&&n.trajectoryData.length>0){const S=Math.floor(window.innerWidth*.9),N=Math.floor(window.innerHeight*.8);C(b,S,N)}if(t.$$.dirty[0]&336&&f==="velocity"&&c&&p.length>0){const S=Math.floor(window.innerWidth*.9),N=Math.floor(window.innerHeight*.8);M(c,S,N)}if(t.$$.dirty[0]&912&&f==="combined"&&g&&n.trajectoryData.length>0&&p.length>0){const S=Math.floor(window.innerWidth*.9),N=Math.floor(window.innerHeight*.8);R(g,S,N)}},[a,_,d,m,f,b,c,g,p,n,$,T,H,A,I,z,U,ae,pe,he,ve,K,X,oe,me,ie,re,de,B]}class Qi extends xt{constructor(e){super(),wt(this,e,Zi,Ki,lt,{results:0},null,[-1,-1])}}function $i(t){let e,l;return e=new Qi({props:{results:t[2]}}),e.$on("reset",t[7]),{c(){Dt(e.$$.fragment)},m(n,a){_t(e,n,a),l=!0},p(n,a){const u={};a&4&&(u.results=n[2]),e.$set(u)},i(n){l||(Ze(e.$$.fragment,n),l=!0)},o(n){ot(e.$$.fragment,n),l=!1},d(n){yt(e,n)}}}function en(t){let e,l;return e=new Hi({props:{currentStep:t[0]}}),e.$on("stepComplete",t[5]),e.$on("goBack",t[8]),e.$on("cancelToStep1",t[9]),{c(){Dt(e.$$.fragment)},m(n,a){_t(e,n,a),l=!0},p(n,a){const u={};a&1&&(u.currentStep=n[0]),e.$set(u)},i(n){l||(Ze(e.$$.fragment,n),l=!0)},o(n){ot(e.$$.fragment,n),l=!1},d(n){yt(e,n)}}}function tn(t){let e,l,n,a,u,_,d,m,f,b,c,g,p,h,v,w,C,M,R;g=new Si({props:{analysisCompleted:t[1]}});const H=[en,$i],A=[];function Y(I,$){return I[1]?1:0}return v=Y(t),w=A[v]=H[v](t),{c(){e=r("main"),l=r("header"),n=r("div"),a=r("div"),u=r("h1"),u.textContent="Jump Analyzer Pro",_=k(),d=r("button"),d.textContent="Chiudi Analisi",m=k(),f=r("div"),b=r("div"),c=r("div"),Dt(g.$$.fragment),p=k(),h=r("div"),w.c(),i(u,"class","text-2xl sm:text-3xl lg:text-4xl font-bold text-white tracking-tight"),i(d,"class","bg-red-600 hover:bg-red-700 focus:bg-red-700 text-white px-4 sm:px-5 py-2 rounded-lg font-semibold border border-red-500/50 shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-slate-800"),i(d,"aria-label","Chiudi analisi e esci dall'applicazione"),i(a,"class","flex items-center justify-between gap-4"),i(n,"class","max-w-[1400px] mx-auto px-4 sm:px-6 py-4 sm:py-6"),i(l,"class","bg-slate-800/50 backdrop-blur-sm border-b border-slate-700"),i(l,"role","banner"),i(c,"class","lg:col-span-2"),i(c,"aria-label","Anteprima video"),i(h,"class","lg:col-span-1"),i(h,"aria-label","Pannello controllo"),i(b,"class","grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6"),i(f,"class","max-w-[1400px] mx-auto px-4 sm:px-6 py-6 sm:py-8"),i(e,"class","min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900"),i(e,"role","main"),i(e,"aria-label","Jump Analyzer Pro - Analisi salto")},m(I,$){L(I,e,$),s(e,l),s(l,n),s(n,a),s(a,u),s(a,_),s(a,d),s(e,m),s(e,f),s(f,b),s(b,c),_t(g,c,null),t[12](c),s(b,p),s(b,h),A[v].m(h,null),t[13](h),C=!0,M||(R=Q(d,"click",t[6]),M=!0)},p(I,[$]){const T={};$&2&&(T.analysisCompleted=I[1]),g.$set(T);let z=v;v=Y(I),v===z?A[v].p(I,$):(ci(),ot(A[z],1,1,()=>{A[z]=null}),fi(),w=A[v],w?w.p(I,$):(w=A[v]=H[v](I),w.c()),Ze(w,1),w.m(h,null))},i(I){C||(Ze(g.$$.fragment,I),Ze(w),C=!0)},o(I){ot(g.$$.fragment,I),ot(w),C=!1},d(I){I&&j(e),yt(g),t[12](null),A[v].d(),t[13](null),M=!1,R()}}}let ln=500;function nn(t,e,l){let n;Mt(t,ue,z=>l(18,n=z));let a=1,u=!1,_=null,d,m,f,b,c,g,p=150,h=0;function v(){if(!m||!f)return;if(typeof window<"u"?window.innerWidth>=1024:!0){const U=m.clientHeight;l(4,f.style.height=U?`${U}px`:"",f)}else l(4,f.style.height="",f)}function w(){g&&clearTimeout(g),g=setTimeout(v,100)}async function C(){if(!(!n.isAnalyzing&&!n.isRecording&&!n.isCalibrating))try{if(n.isAnalyzing||n.isRecording||n.isCalibrating){const z=await fetch(`${Ce()}/api/video/frame`,{signal:AbortSignal.timeout(1e3)});if(z.ok){const U=await z.json();U.success&&U.frame&&ml(U.frame)}}if(n.isAnalyzing){const z=await fetch(`${Ce()}/api/analysis/data`,{signal:AbortSignal.timeout(1e3)});if(z.ok){const U=await z.json();U.realtime&&hi(U.realtime,U.trajectory,U.velocity)}}h>0&&(h=Math.max(0,h-1),l(11,p=Math.max(150,p-50)))}catch{h++,h>3&&l(11,p=Math.min(ln,p+50))}}Nt(()=>{l(10,d=setInterval(C,p)),window&&"ResizeObserver"in window?(b=new ResizeObserver(w),m&&b.observe(m)):window==null||window.addEventListener("resize",w),c=()=>{w(),setTimeout(v,150)},typeof document<"u"&&(document.addEventListener("fullscreenchange",c),document.addEventListener("webkitfullscreenchange",c),document.addEventListener("mozfullscreenchange",c),document.addEventListener("MSFullscreenChange",c)),setTimeout(v,0)}),Ht(()=>{d&&clearInterval(d),g&&clearTimeout(g),b&&m&&b.unobserve(m),b&&b.disconnect(),typeof window<"u"&&window.removeEventListener("resize",w),typeof document<"u"&&c&&(document.removeEventListener("fullscreenchange",c),document.removeEventListener("webkitfullscreenchange",c),document.removeEventListener("mozfullscreenchange",c),document.removeEventListener("MSFullscreenChange",c))});function M(z){const{step:U,data:ae}=z.detail;U===1?l(0,a=2):U===2?(l(0,a=3),v()):U===3&&(l(2,_=ae),l(1,u=!0),v())}async function R(){const z=[];n.isAnalyzing&&z.push(fetch(`${Ce()}/api/analysis/stop`,{method:"POST"}).catch(()=>{})),n.isRecording&&z.push(fetch(`${Ce()}/api/recording/stop`,{method:"POST"}).catch(()=>{})),await Promise.all(z)}async function H(){var z,U;await R();try{(U=(z=n.previewStream)==null?void 0:z.getTracks())==null||U.forEach(ae=>ae.stop())}catch{}qt(),ue.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null});try{window.close()}catch{}}function A(){l(1,u=!1),l(2,_=null),l(0,a=1),h=0,l(11,p=150),ue.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null})}async function Y(){a>1&&(a===2?(await R(),ue.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null})):a===3&&(await R(),ue.update(z=>({...z,isAnalyzing:!1,isPaused:!1,isCameraPreview:z.isCameraPreview,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:z.localVideoUrl}))),l(0,a--,a),v())}async function I(){await R(),l(0,a=1),ue.set({isAnalyzing:!1,isRecording:!1,isCalibrating:!1,isPaused:!1,isCameraPreview:!1,inputMode:"none",videoFrame:null,realtimeData:{},trajectoryData:[],velocityData:[],localVideoUrl:null}),v()}function $(z){Ee[z?"unshift":"push"](()=>{m=z,l(3,m)})}function T(z){Ee[z?"unshift":"push"](()=>{f=z,l(4,f)})}return t.$$.update=()=>{t.$$.dirty&3072&&d&&(clearInterval(d),l(10,d=setInterval(C,p)))},[a,u,_,m,f,M,H,A,Y,I,d,p,$,T]}class an extends xt{constructor(e){super(),wt(this,e,nn,tn,lt,{})}}window.__APP_LOADING__=!0;function Nl(){try{const t=document.getElementById("app");if(!t)throw new Error("Elemento #app non trovato nel DOM");t.innerHTML="";const e=new an({target:t});window.__APP_LOADED__=!0,window.__APP_LOADING__=!1}catch(t){console.error("Errore durante l'inizializzazione dell'app:",t),window.__APP_LOADING__=!1;const e=document.getElementById("app");e&&(e.innerHTML=`
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: #0f172a; color: white; font-family: sans-serif; padding: 20px;">
          <div style="text-align: center; max-width: 600px;">
            <h1 style="color: #ef4444; margin-bottom: 20px;">Errore di Caricamento</h1>
            <p style="color: #94a3b8; margin-bottom: 10px;">Si è verificato un errore durante il caricamento dell'applicazione.</p>
            <p style="color: #64748b; font-size: 14px; margin-top: 20px; word-break: break-word;">${t.message||"Errore sconosciuto"}</p>
            <p style="color: #64748b; font-size: 12px; margin-top: 10px;">Stack: ${t.stack||"N/A"}</p>
            <p style="color: #64748b; font-size: 12px; margin-top: 10px;">Apri la console del browser (F12) per maggiori dettagli.</p>
          </div>
        </div>
      `)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Nl):Nl()})();
